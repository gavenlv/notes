# ç¬¬2ç« ï¼šApache Doris å®‰è£…ä¸ç¯å¢ƒé…ç½®

## ğŸ“š ç« èŠ‚æ¦‚è¿°

æœ¬ç« å°†è¯¦ç»†ä»‹ç»Apache Dorisçš„å¤šç§å®‰è£…æ–¹å¼ã€ç¯å¢ƒé…ç½®è¦æ±‚ä»¥åŠé›†ç¾¤éƒ¨ç½²æ–¹æ³•ã€‚æ— è®ºæ‚¨æ˜¯ä¸ªäººå¼€å‘è€…è¿˜æ˜¯ä¼ä¸šç”¨æˆ·ï¼Œéƒ½èƒ½åœ¨æœ¬ç« æ‰¾åˆ°é€‚åˆçš„å®‰è£…æ–¹æ¡ˆã€‚æˆ‘ä»¬å°†ä»æœ€ç®€å•çš„Dockeréƒ¨ç½²å¼€å§‹ï¼Œé€æ­¥ä»‹ç»äºŒè¿›åˆ¶éƒ¨ç½²ã€æºç ç¼–è¯‘ä»¥åŠç”Ÿäº§ç¯å¢ƒçš„é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- äº†è§£Dorisçš„ç¡¬ä»¶å’Œè½¯ä»¶ç¯å¢ƒè¦æ±‚
- æŒæ¡Dockeræ–¹å¼å¿«é€Ÿéƒ¨ç½²Doris
- å­¦ä¼šäºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²Dorisé›†ç¾¤
- æŒæ¡æºç ç¼–è¯‘å®‰è£…Dorisçš„æ–¹æ³•
- äº†è§£ç”Ÿäº§ç¯å¢ƒçš„é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²
- æŒæ¡Dorisçš„åŸºæœ¬é…ç½®å’Œä¼˜åŒ–
- å­¦ä¼šå¸¸è§å®‰è£…é—®é¢˜çš„æ’æŸ¥æ–¹æ³•

---

## 2.1 ç¯å¢ƒè¦æ±‚

### 2.1.1 ç¡¬ä»¶è¦æ±‚

#### æœ€ä½é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰

| ç»„ä»¶ | CPU | å†…å­˜ | ç£ç›˜ | ç½‘ç»œ |
|------|-----|------|------|------|
| FE | 2æ ¸ | 4GB | 10GB SSD | 1Gbps |
| BE | 4æ ¸ | 8GB | 50GB SSD | 1Gbps |

#### æ¨èé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

| ç»„ä»¶ | CPU | å†…å­˜ | ç£ç›˜ | ç½‘ç»œ |
|------|-----|------|------|------|
| FE | 8æ ¸ | 16GB | 100GB SSD | 10Gbps |
| BE | 16æ ¸ | 64GB | 1TB+ SSD | 10Gbps |

#### ç£ç›˜è¦æ±‚

- **SSDæ¨è**ï¼šä½¿ç”¨SSDå­˜å‚¨å¯æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½
- **RAIDé…ç½®**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨RAID 10
- **ç£ç›˜è§„åˆ’**ï¼šFEå’ŒBEå»ºè®®ä½¿ç”¨ç‹¬ç«‹ç£ç›˜
- **æ•°æ®ç›®å½•**ï¼šBEæ•°æ®ç›®å½•å»ºè®®ä½¿ç”¨é«˜æ€§èƒ½ç£ç›˜

### 2.1.2 è½¯ä»¶è¦æ±‚

#### æ“ä½œç³»ç»Ÿ

- **Linux**ï¼šCentOS 7.x/8.xã€Ubuntu 18.04/20.04ã€Debian 9/10
- **å†…æ ¸ç‰ˆæœ¬**ï¼šæ¨è3.10+ï¼Œæ”¯æŒext4/xfsæ–‡ä»¶ç³»ç»Ÿ
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šæ¨èä½¿ç”¨xfsï¼Œæ”¯æŒå¤§æ–‡ä»¶å’Œé«˜å¹¶å‘

#### ä¾èµ–è½¯ä»¶

- **Java**ï¼šJDK 1.8æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆFEèŠ‚ç‚¹éœ€è¦ï¼‰
- **Python**ï¼šPython 2.7+æˆ–3.6+ï¼ˆéƒ¨åˆ†ç®¡ç†è„šæœ¬éœ€è¦ï¼‰
- **GCC**ï¼šGCC 7.3+ï¼ˆæºç ç¼–è¯‘éœ€è¦ï¼‰
- **CMake**ï¼š3.10+ï¼ˆæºç ç¼–è¯‘éœ€è¦ï¼‰

#### ç½‘ç»œè¦æ±‚

- **ç«¯å£å¼€æ”¾**ï¼šç¡®ä¿FEå’ŒBEä¹‹é—´é€šä¿¡ç«¯å£å¼€æ”¾
- **é˜²ç«å¢™**ï¼šå…³é—­æˆ–é…ç½®é˜²ç«å¢™è§„åˆ™
- **æ—¶é—´åŒæ­¥**ï¼šæ‰€æœ‰èŠ‚ç‚¹æ—¶é—´åŒæ­¥ï¼ˆNTPï¼‰

---

## 2.2 Dockeræ–¹å¼å®‰è£…

### 2.2.1 å•èŠ‚ç‚¹Dockeréƒ¨ç½²

Dockeræ–¹å¼æ˜¯æœ€ç®€å•çš„éƒ¨ç½²æ–¹å¼ï¼Œé€‚åˆå¿«é€Ÿä½“éªŒå’Œå¼€å‘æµ‹è¯•ã€‚

```bash
# æ‹‰å–Dorisé•œåƒ
docker pull apache/doris:2.1.0-fe-x86_64
docker pull apache/doris:2.1.0-be-x86_64

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /data/doris/fe/log /data/doris/fe/doris-meta
mkdir -p /data/doris/be/log /data/doris/be/storage

# å¯åŠ¨FEèŠ‚ç‚¹
docker run -itd \
    --name doris-fe \
    -p 8030:8030 \
    -p 9030:9030 \
    -v /data/doris/fe/log:/opt/apache-doris/fe/log \
    -v /data/doris/fe/doris-meta:/opt/apache-doris/fe/doris-meta \
    -e FE_SERVERS="fe1:127.0.0.1:9010" \
    --entrypoint /opt/apache-doris/fe/bin/start_fe.sh \
    apache/doris:2.1.0-fe-x86_64

# å¯åŠ¨BEèŠ‚ç‚¹
docker run -itd \
    --name doris-be \
    -p 8040:8040 \
    -p 9000:9000 \
    -p 9050:9050 \
    -v /data/doris/be/log:/opt/apache-doris/be/log \
    -v /data/doris/be/storage:/opt/apache-doris/be/storage \
    -e FE_SERVERS="fe1:127.0.0.1:9010" \
    --entrypoint /opt/apache-doris/be/bin/start_be.sh \
    apache/doris:2.1.0-be-x86_64
```

### 2.2.2 Docker Composeéƒ¨ç½²

ä½¿ç”¨Docker Composeå¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å¤šå®¹å™¨éƒ¨ç½²ï¼š

```yaml
version: '3.8'

services:
  fe:
    image: apache/doris:2.1.0-fe-x86_64
    container_name: doris-fe
    hostname: fe
    environment:
      - FE_SERVERS=fe1:127.0.0.1:9010
      - FE_ID=1
    ports:
      - "8030:8030"  # HTTP UIç«¯å£
      - "9030:9030"  # MySQLåè®®ç«¯å£
      - "9010:9010"  # FEå†…éƒ¨é€šä¿¡ç«¯å£
    volumes:
      - fe_log:/opt/apache-doris/fe/log
      - fe_meta:/opt/apache-doris/fe/doris-meta
    networks:
      - doris-net
    command: /opt/apache-doris/fe/bin/start_fe.sh --daemon

  be:
    image: apache/doris:2.1.0-be-x86_64
    container_name: doris-be
    hostname: be
    environment:
      - FE_SERVERS=fe1:127.0.0.1:9010
      - BE_ADDR=127.0.0.1:9050
    ports:
      - "8040:8040"  # BE HTTPç«¯å£
      - "9000:9000"  # BEå†…éƒ¨é€šä¿¡ç«¯å£
      - "9050:9050"  # BEå¿ƒè·³ç«¯å£
    volumes:
      - be_log:/opt/apache-doris/be/log
      - be_storage:/opt/apache-doris/be/storage
    networks:
      - doris-net
    depends_on:
      - fe
    command: /opt/apache-doris/be/bin/start_be.sh --daemon

volumes:
  fe_log:
  fe_meta:
  be_log:
  be_storage:

networks:
  doris-net:
    driver: bridge
```

### 2.2.3 è¿æ¥Dockeréƒ¨ç½²çš„Doris

```bash
# ä½¿ç”¨MySQLå®¢æˆ·ç«¯è¿æ¥
mysql -h 127.0.0.1 -P 9030 -uroot

# æ·»åŠ BEèŠ‚ç‚¹
ALTER SYSTEM ADD BACKEND "127.0.0.1:9050";

# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
SHOW BACKENDS;
SHOW FRONTENDS;
```

---

## 2.3 äºŒè¿›åˆ¶æ–¹å¼å®‰è£…

### 2.3.1 ä¸‹è½½äºŒè¿›åˆ¶åŒ…

```bash
# ä¸‹è½½DorisäºŒè¿›åˆ¶åŒ…
wget https://dist.apache.org/repos/dist/release/doris/2.1/2.1.0/apache-doris-2.1.0-bin-x86_64.tar.gz

# è§£å‹
tar -zxvf apache-doris-2.1.0-bin-x86_64.tar.gz
mv apache-doris-2.1.0-bin-x86_64 /opt/doris
```

### 2.3.2 FEèŠ‚ç‚¹é…ç½®ä¸å¯åŠ¨

#### 1. FEé…ç½®æ–‡ä»¶

ç¼–è¾‘FEé…ç½®æ–‡ä»¶ `/opt/doris/fe/conf/fe.conf`ï¼š

```properties
# FEèŠ‚ç‚¹åŸºæœ¬ä¿¡æ¯
priority_networks = 192.168.0.0/16  # æŒ‡å®šFEä½¿ç”¨çš„IP
meta_dir = /opt/doris/fe/doris-meta  # å…ƒæ•°æ®å­˜å‚¨ç›®å½•
log_dir = /opt/doris/fe/log          # æ—¥å¿—ç›®å½•

# ç«¯å£é…ç½®
http_port = 8030                     # HTTP UIç«¯å£
query_port = 9030                    # MySQLåè®®ç«¯å£
rpc_port = 9010                      # FEå†…éƒ¨é€šä¿¡ç«¯å£
edit_log_port = 9011                 # ç¼–è¾‘æ—¥å¿—ç«¯å£

# é›†ç¾¤é…ç½®
cluster_name = doris_cluster         # é›†ç¾¤åç§°
node_num = 1                         # èŠ‚ç‚¹æ•°é‡

# å†…å­˜é…ç½®
JAVA_OPTS="-Xmx8192m -Xms8192m -XX:+UseMembar -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=7"

# é«˜å¯ç”¨é…ç½®ï¼ˆå¤šèŠ‚ç‚¹éƒ¨ç½²æ—¶ï¼‰
# frontend_address_base = 192.168.0.1
# edit_log_port = 9011
# query_port = 9030
# http_port = 8030
```

#### 2. å¯åŠ¨FEèŠ‚ç‚¹

```bash
# åˆ›å»ºå…ƒæ•°æ®å’Œæ—¥å¿—ç›®å½•
mkdir -p /opt/doris/fe/doris-meta /opt/doris/fe/log

# å¯åŠ¨FEèŠ‚ç‚¹
/opt/doris/fe/bin/start_fe.sh --daemon

# æŸ¥çœ‹FEçŠ¶æ€
/opt/doris/fe/bin/show_fe_status.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f /opt/doris/fe/log/fe.log
```

### 2.3.3 BEèŠ‚ç‚¹é…ç½®ä¸å¯åŠ¨

#### 1. BEé…ç½®æ–‡ä»¶

ç¼–è¾‘BEé…ç½®æ–‡ä»¶ `/opt/doris/be/conf/be.conf`ï¼š

```properties
# BEèŠ‚ç‚¹åŸºæœ¬ä¿¡æ¯
priority_networks = 192.168.0.0/16  # æŒ‡å®šBEä½¿ç”¨çš„IP
storage_root_path = /opt/doris/be/storage # æ•°æ®å­˜å‚¨ç›®å½•
log_dir = /opt/doris/be/log               # æ—¥å¿—ç›®å½•

# ç«¯å£é…ç½®
be_port = 9060                     # BEå†…éƒ¨é€šä¿¡ç«¯å£
webserver_port = 8040              # BE HTTPç«¯å£
heartbeat_service_thread_count = 1
create_table_worker_count = 1
tablet_create_timeout_seconds = 60

# å­˜å‚¨é…ç½®
storage_flood_stage_usage_percent = 85
storage_flood_stage_left_capacity_bytes = 1073741824
storage_flood_stage_usage_percent = 95
storage_flood_stage_left_capacity_bytes = 1048576

# å†…å­˜é…ç½®
mem_limit = 80%                    # BEå†…å­˜é™åˆ¶
buffer_pool_limit = 20%            # ç¼“å†²æ± é™åˆ¶

# æ€§èƒ½é…ç½®
disable_storage_persistence = false
max_compaction_threads = 2
max_tablet_version_num = 1000
default_rowset_type = beta
```

#### 2. å¯åŠ¨BEèŠ‚ç‚¹

```bash
# åˆ›å»ºæ•°æ®å’Œæ—¥å¿—ç›®å½•
mkdir -p /opt/doris/be/storage /opt/doris/be/log

# å¯åŠ¨BEèŠ‚ç‚¹
/opt/doris/be/bin/start_be.sh --daemon

# æŸ¥çœ‹BEçŠ¶æ€
/opt/doris/be/bin/show_be_status.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f /opt/doris/be/log/be.INFO
```

### 2.3.4 æ·»åŠ BEèŠ‚ç‚¹åˆ°é›†ç¾¤

```bash
# è¿æ¥FEèŠ‚ç‚¹
mysql -h 127.0.0.1 -P 9030 -uroot

# æ·»åŠ BEèŠ‚ç‚¹
ALTER SYSTEM ADD BACKEND "192.168.0.2:9050";

# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
SHOW BACKENDS;
SHOW FRONTENDS;
```

---

## 2.4 æºç ç¼–è¯‘å®‰è£…

### 2.4.1 å‡†å¤‡ç¼–è¯‘ç¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
# CentOS/RHEL
yum install -y java-1.8.0-openjdk-devel maven cmake gcc-c++ python-devel byacc flex automake libtool bzip2 zip unzip ncurses-devel git

# Ubuntu/Debian
apt-get install -y openjdk-8-jdk maven cmake g++ python byacc flex automake libtool bzip2 zip unzip libncurses5-dev git

# è®¾ç½®Javaç¯å¢ƒå˜é‡
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk
export PATH=$PATH:$JAVA_HOME/bin
```

### 2.4.2 ç¼–è¯‘Doris

```bash
# å…‹éš†æºç 
git clone https://github.com/apache/doris.git
cd doris

# åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬
git checkout 2.1.0

# ç¼–è¯‘FE
sh build.sh --fe --clean

# ç¼–è¯‘BE
sh build.sh --be --clean

# ç¼–è¯‘è¾“å‡º
# FEè¾“å‡ºç›®å½•ï¼šoutput/fe/
# BEè¾“å‡ºç›®å½•ï¼šoutput/be/
```

### 2.4.3 éƒ¨ç½²ç¼–è¯‘åçš„Doris

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir -p /opt/doris/{fe,be}

# å¤åˆ¶ç¼–è¯‘äº§ç‰©
cp -r output/fe/* /opt/doris/fe/
cp -r output/be/* /opt/doris/be/

# é…ç½®å¹¶å¯åŠ¨ï¼ˆå‚è€ƒ2.3èŠ‚ï¼‰
```

---

## 2.5 é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²

### 2.5.1 æ¶æ„è®¾è®¡

é«˜å¯ç”¨é›†ç¾¤é€šå¸¸åŒ…å«ï¼š
- **3ä¸ªFEèŠ‚ç‚¹**ï¼š1ä¸ªFollower+2ä¸ªObserveræˆ–3ä¸ªFollower
- **å¤šä¸ªBEèŠ‚ç‚¹**ï¼šæ ¹æ®æ•°æ®é‡å’ŒæŸ¥è¯¢éœ€æ±‚ç¡®å®š
- **è´Ÿè½½å‡è¡¡**ï¼šå¦‚Nginxæˆ–HAProxy

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯"
        A[åº”ç”¨1]
        B[åº”ç”¨2]
        C[BIå·¥å…·]
    end
    
    subgraph "è´Ÿè½½å‡è¡¡"
        D[Nginx/HAProxy]
    end
    
    subgraph "FEé›†ç¾¤"
        E[FE-Follower]
        F[FE-Follower]
        G[FE-Follower]
    end
    
    subgraph "BEé›†ç¾¤"
        H[BE1]
        I[BE2]
        J[BE3]
        K[BE4]
    end
    
    A --> D
    B --> D
    C --> D
    D --> E
    D --> F
    D --> G
    E --> H
    E --> I
    F --> J
    G --> K
```

### 2.5.2 FEé›†ç¾¤éƒ¨ç½²

#### 1. ç¬¬ä¸€ä¸ªFEèŠ‚ç‚¹ï¼ˆFollowerï¼‰

```bash
# åœ¨192.168.0.1ä¸Šéƒ¨ç½²
/opt/doris/fe/bin/start_fe.sh --helper 192.168.0.1:9010 --daemon
```

#### 2. ç¬¬äºŒä¸ªFEèŠ‚ç‚¹ï¼ˆFollowerï¼‰

```bash
# åœ¨192.168.0.2ä¸Šéƒ¨ç½²
/opt/doris/fe/bin/start_fe.sh --helper 192.168.0.1:9010 --daemon

# åœ¨ç¬¬ä¸€ä¸ªFEèŠ‚ç‚¹ä¸Šæ·»åŠ ç¬¬äºŒä¸ªFEèŠ‚ç‚¹
mysql -h 192.168.0.1 -P 9030 -uroot
ALTER SYSTEM ADD FOLLOWER "192.168.0.2:9011";
```

#### 3. ç¬¬ä¸‰ä¸ªFEèŠ‚ç‚¹ï¼ˆFollowerï¼‰

```bash
# åœ¨192.168.0.3ä¸Šéƒ¨ç½²
/opt/doris/fe/bin/start_fe.sh --helper 192.168.0.1:9010 --daemon

# åœ¨ç¬¬ä¸€ä¸ªFEèŠ‚ç‚¹ä¸Šæ·»åŠ ç¬¬ä¸‰ä¸ªFEèŠ‚ç‚¹
mysql -h 192.168.0.1 -P 9030 -uroot
ALTER SYSTEM ADD FOLLOWER "192.168.0.3:9011";
```

### 2.5.3 BEé›†ç¾¤éƒ¨ç½²

```bash
# åœ¨æ¯ä¸ªBEèŠ‚ç‚¹ä¸Šå¯åŠ¨BE
/opt/doris/be/bin/start_be.sh --daemon

# åœ¨ä»»æ„FEèŠ‚ç‚¹ä¸Šæ·»åŠ æ‰€æœ‰BEèŠ‚ç‚¹
mysql -h 192.168.0.1 -P 9030 -uroot
ALTER SYSTEM ADD BACKEND "192.168.0.4:9050";
ALTER SYSTEM ADD BACKEND "192.168.0.5:9050";
ALTER SYSTEM ADD BACKEND "192.168.0.6:9050";
ALTER SYSTEM ADD BACKEND "192.168.0.7:9050";
```

### 2.5.4 è´Ÿè½½å‡è¡¡é…ç½®

#### Nginxé…ç½®ç¤ºä¾‹

```nginx
upstream doris_fe {
    server 192.168.0.1:9030;
    server 192.168.0.2:9030;
    server 192.168.0.3:9030;
}

server {
    listen 9030;
    proxy_pass doris_fe;
    proxy_connect_timeout 1s;
    proxy_read_timeout 1h;
    proxy_send_timeout 1h;
}
```

---

## 2.6 é…ç½®ä¼˜åŒ–

### 2.6.1 FEé…ç½®ä¼˜åŒ–

```properties
# å†…å­˜é…ç½®
JAVA_OPTS="-Xmx16384m -Xms16384m -XX:+UseMembar -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=7"

# å…ƒæ•°æ®é…ç½®
meta_dir = /data/doris/fe/doris-meta
edit_log_port = 9011
edit_log_roll_num = 50000

# æŸ¥è¯¢é…ç½®
max_connection = 4096
query_timeout = 300
max_query_retry_time = 2
```

### 2.6.2 BEé…ç½®ä¼˜åŒ–

```properties
# å†…å­˜é…ç½®
mem_limit = 80%
buffer_pool_limit = 20%
write_buffer_size = 104857600

# å­˜å‚¨é…ç½®
storage_flood_stage_usage_percent = 85
max_tablet_version_num = 1000
default_rowset_type = beta

# å¹¶å‘é…ç½®
max_compaction_threads = 4
max_pushdown_concurrency_per_node = 2
```

---

## 2.7 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 2.7.1 FEå¯åŠ¨å¤±è´¥

#### é—®é¢˜ï¼šFEå¯åŠ¨åç«‹å³é€€å‡º

**å¯èƒ½åŸå› **ï¼š
- Javaç¯å¢ƒæœªæ­£ç¡®é…ç½®
- å…ƒæ•°æ®ç›®å½•æƒé™ä¸è¶³
- ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥Javaç¯å¢ƒ
java -version

# æ£€æŸ¥ç›®å½•æƒé™
ls -la /opt/doris/fe/doris-meta
chown -R doris:doris /opt/doris/fe/

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tunlp | grep 9030
```

#### é—®é¢˜ï¼šFEå…ƒæ•°æ®æŸå

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åœæ­¢FE
/opt/doris/fe/bin/stop_fe.sh

# å¤‡ä»½å…ƒæ•°æ®
cp -r /opt/doris/fe/doris-meta /opt/doris/fe/doris-meta.bak

# ä½¿ç”¨å…ƒæ•°æ®å·¥å…·æ¢å¤
/opt/doris/fe/bin/meta_tool --help
```

### 2.7.2 BEå¯åŠ¨å¤±è´¥

#### é—®é¢˜ï¼šBEæ— æ³•è¿æ¥åˆ°FE

**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œä¸é€š
- é˜²ç«å¢™é˜»æ­¢
- FEé…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
telnet 192.168.0.1 9010

# æ£€æŸ¥é˜²ç«å¢™
systemctl status firewalld
firewall-cmd --list-ports

# æ£€æŸ¥FEé…ç½®
grep priority_networks /opt/doris/fe/conf/fe.conf
```

#### é—®é¢˜ï¼šBEç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h /opt/doris/be/storage

# æ¸…ç†è¿‡æœŸæ•°æ®
# 1. åˆ é™¤è¿‡æœŸåˆ†åŒº
ALTER TABLE table_name DROP PARTITION partition_name;

# 2. è°ƒæ•´æ•°æ®ä¿ç•™ç­–ç•¥
ALTER TABLE table_name SET ("dynamic_partition.history_partition_num" = "7");
```

### 2.7.3 é›†ç¾¤çŠ¶æ€å¼‚å¸¸

#### é—®é¢˜ï¼šBEèŠ‚ç‚¹çŠ¶æ€ä¸ºdead

**å¯èƒ½åŸå› **ï¼š
- BEè¿›ç¨‹åœæ­¢
- å¿ƒè·³è¶…æ—¶
- ç£ç›˜æ•…éšœ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥BEè¿›ç¨‹
ps aux | grep be

# æŸ¥çœ‹BEæ—¥å¿—
tail -f /opt/doris/be/log/be.INFO

# é‡å¯BE
/opt/doris/be/bin/stop_be.sh
/opt/doris/be/bin/start_be.sh --daemon
```

#### é—®é¢˜ï¼šFEèŠ‚ç‚¹çŠ¶æ€ä¸ºdead

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥FEè¿›ç¨‹
ps aux | grep fe

# æŸ¥çœ‹FEæ—¥å¿—
tail -f /opt/doris/fe/log/fe.log

# é‡å¯FE
/opt/doris/fe/bin/stop_fe.sh
/opt/doris/fe/bin/start_fe.sh --daemon
```

---

## 2.8 ç›‘æ§ä¸ç»´æŠ¤

### 2.8.1 åŸºç¡€ç›‘æ§

```sql
-- æŸ¥çœ‹FEçŠ¶æ€
SHOW FRONTENDS;

-- æŸ¥çœ‹BEçŠ¶æ€
SHOW BACKENDS;

-- æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯
SHOW PROC '/backends';
SHOW PROC '/frontends';
```

### 2.8.2 æ—¥å¿—ç®¡ç†

```bash
# FEæ—¥å¿—è½®è½¬é…ç½®
vim /opt/doris/conf/log4j2.xml

# BEæ—¥å¿—è½®è½¬é…ç½®
vim /opt/doris/be/conf/be.conf
# log_roll_size = 1073741824
```

### 2.8.3 å¤‡ä»½ä¸æ¢å¤

```bash
# å…ƒæ•°æ®å¤‡ä»½
mysql -h 127.0.0.1 -P 9030 -uroot -e "BACKUP TO 'backup_label' FROM db_name;"

# å…ƒæ•°æ®æ¢å¤
mysql -h 127.0.0.1 -P 9030 -uroot -e "RESTORE FROM 'backup_label';"
```

---

## 2.9 æœ¬ç« å°ç»“

æœ¬ç« è¯¦ç»†ä»‹ç»äº†Apache Dorisçš„å¤šç§å®‰è£…æ–¹å¼å’Œç¯å¢ƒé…ç½®æ–¹æ³•ï¼ŒåŒ…æ‹¬Dockerå¿«é€Ÿéƒ¨ç½²ã€äºŒè¿›åˆ¶å®‰è£…ã€æºç ç¼–è¯‘ä»¥åŠé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²ã€‚é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹å¼ï¼Œå¹¶æŒæ¡åŸºæœ¬çš„é…ç½®ä¼˜åŒ–å’Œé—®é¢˜æ’æŸ¥æ–¹æ³•ã€‚

ä¸‹ä¸€ç« å°†æ·±å…¥ä»‹ç»Dorisçš„æ•°æ®æ¨¡å‹ï¼Œå¸®åŠ©æ‚¨ç†è§£Dorisçš„å­˜å‚¨åŸç†å’Œæ•°æ®ç»„ç»‡æ–¹å¼ã€‚

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [Apache Doriså®˜æ–¹å®‰è£…æ–‡æ¡£](https://doris.apache.org/docs/installing/)
- [Apache Dorisé›†ç¾¤éƒ¨ç½²æŒ‡å—](https://doris.apache.org/docs/administrator-guide/cluster-deployment/)
- [Apache Dorisé…ç½®è¯¦è§£](https://doris.apache.org/docs/administrator-guide/config/)

## ğŸ§ª å®è·µç»ƒä¹ 

1. ä½¿ç”¨Dockeræ–¹å¼éƒ¨ç½²ä¸€ä¸ªå•èŠ‚ç‚¹Dorisç¯å¢ƒ
2. ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²ä¸€ä¸ª3èŠ‚ç‚¹é›†ç¾¤ï¼ˆ1FE+2BEï¼‰
3. é…ç½®Dorisçš„é«˜å¯ç”¨é›†ç¾¤ï¼ˆ3FE+3BEï¼‰
4. å°è¯•æºç ç¼–è¯‘Doris
5. é…ç½®Nginxä½œä¸ºDoris FEçš„è´Ÿè½½å‡è¡¡å™¨

---

> ä»£ç ç¤ºä¾‹è¯·å‚è€ƒï¼š[ç¬¬2ç« ä»£ç ç¤ºä¾‹](code/chapter2/)