# ç¬¬1ç« ï¼šApache Doris åŸºç¡€å…¥é—¨

## ğŸ“š ç« èŠ‚æ¦‚è¿°

æœ¬ç« å°†ä»‹ç»Apache Dorisçš„åŸºæœ¬æ¦‚å¿µã€æ¶æ„è®¾è®¡ã€åº”ç”¨åœºæ™¯å’Œæ ¸å¿ƒç‰¹æ€§ï¼Œå¸®åŠ©è¯»è€…å»ºç«‹å¯¹Dorisçš„å…¨é¢è®¤è¯†ã€‚æ— è®ºæ‚¨æ˜¯æ•°æ®åº“æ–°æ‰‹è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„æ•°æ®å·¥ç¨‹å¸ˆï¼Œæœ¬ç« éƒ½å°†ä¸ºæ‚¨æä¾›åšå®çš„åŸºç¡€çŸ¥è¯†ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- ç†è§£Apache Dorisçš„å®šä¹‰å’Œæ ¸å¿ƒä»·å€¼
- æŒæ¡Dorisçš„æ•´ä½“æ¶æ„å’Œç»„ä»¶åŠŸèƒ½
- äº†è§£Dorisçš„åº”ç”¨åœºæ™¯å’Œä¼˜åŠ¿
- ç†Ÿæ‚‰Dorisä¸å…¶ä»–åˆ†æå‹æ•°æ®åº“çš„åŒºåˆ«
- æŒæ¡Dorisçš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­

---

## 1.1 ä»€ä¹ˆæ˜¯Apache Doris

### 1.1.1 å®šä¹‰ä¸èƒŒæ™¯

Apache Dorisæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„MPP(å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†)åˆ†æå‹æ•°æ®åº“ï¼Œæœ€åˆç”±ç™¾åº¦å¤§æ•°æ®éƒ¨å¼€å‘ï¼Œåäº2018å¹´è´¡çŒ®ç»™ApacheåŸºé‡‘ä¼šï¼Œæˆä¸ºé¡¶çº§é¡¹ç›®ã€‚Dorisä¸“ä¸ºå®æ—¶åˆ†æè€Œè®¾è®¡ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€æ˜“æ‰©å±•çš„ç‰¹ç‚¹ã€‚

### 1.1.2 æ ¸å¿ƒä»·å€¼

Dorisçš„æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **é«˜æ€§èƒ½æŸ¥è¯¢**ï¼šåŸºäºMPPæ¶æ„ï¼Œæ”¯æŒPBçº§æ•°æ®ç§’çº§å“åº”
2. **å®æ—¶åˆ†æ**ï¼šæ”¯æŒå®æ—¶æ•°æ®å¯¼å…¥å’Œå®æ—¶æŸ¥è¯¢åˆ†æ
3. **æ˜“ç”¨æ€§**ï¼šå…¼å®¹MySQLåè®®ï¼Œé™ä½ä½¿ç”¨é—¨æ§›
4. **é«˜å¯ç”¨**ï¼šæ”¯æŒå¤šå‰¯æœ¬å’Œæ•…éšœè‡ªåŠ¨è½¬ç§»
5. **æ˜“æ‰©å±•**ï¼šæ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±•ï¼Œæ— éœ€åœæœº

### 1.1.3 å‘å±•å†ç¨‹

- 2017å¹´ï¼šç™¾åº¦å†…éƒ¨å­µåŒ–ï¼Œç”¨äºè§£å†³å®æ—¶åˆ†æéœ€æ±‚
- 2018å¹´ï¼šå¼€æºï¼Œé¡¹ç›®å‘½åä¸ºDoris
- 2019å¹´ï¼šè¿›å…¥Apacheå­µåŒ–å™¨
- 2022å¹´ï¼šæˆä¸ºApacheé¡¶çº§é¡¹ç›®

---

## 1.2 Dorisæ¶æ„è®¾è®¡

### 1.2.1 æ•´ä½“æ¶æ„

Dorisé‡‡ç”¨å…¸å‹çš„MPPæ¶æ„ï¼Œä¸»è¦ç”±ä»¥ä¸‹ç»„ä»¶æ„æˆï¼š

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        A[MySQLå®¢æˆ·ç«¯]
        B[JDBC/ODBC]
        C[ç®¡ç†å·¥å…·]
    end
    
    subgraph "æ¥å…¥å±‚"
        D[FE Frontend]
    end
    
    subgraph "æ‰§è¡Œå±‚"
        E[BE Backend]
        F[BE Backend]
        G[BE Backend]
    end
    
    subgraph "å­˜å‚¨å±‚"
        H[æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ]
        I[HDFS/S3]
    end
    
    A --> D
    B --> D
    C --> D
    D --> E
    D --> F
    D --> G
    E --> H
    F --> H
    G --> H
    E --> I
    F --> I
    G --> I
```

### 1.2.2 æ ¸å¿ƒç»„ä»¶è¯¦è§£

#### 1. Frontend (FE)

Frontendæ˜¯Dorisçš„å‰ç«¯èŠ‚ç‚¹ï¼Œä¸»è¦è´Ÿè´£ï¼š

- **å…ƒæ•°æ®ç®¡ç†**ï¼šå­˜å‚¨å’Œç®¡ç†é›†ç¾¤å…ƒæ•°æ®ã€è¡¨ç»“æ„ã€åˆ†ç‰‡ä¿¡æ¯ç­‰
- **æŸ¥è¯¢è§„åˆ’**ï¼šæ¥æ”¶SQLè¯·æ±‚ï¼Œè¿›è¡Œè§£æã€ä¼˜åŒ–å¹¶ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
- **é›†ç¾¤ç®¡ç†**ï¼šç®¡ç†é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ£€æµ‹ç­‰
- **ç”¨æˆ·æƒé™**ï¼šå¤„ç†ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶

FEèŠ‚ç‚¹æ”¯æŒé«˜å¯ç”¨éƒ¨ç½²ï¼Œé€šå¸¸é‡‡ç”¨3ä¸ªæˆ–5ä¸ªèŠ‚ç‚¹ç»„æˆé›†ç¾¤ï¼Œé€šè¿‡Raftåè®®ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

#### 2. Backend (BE)

Backendæ˜¯Dorisçš„åç«¯èŠ‚ç‚¹ï¼Œä¸»è¦è´Ÿè´£ï¼š

- **æ•°æ®å­˜å‚¨**ï¼šå®é™…å­˜å‚¨æ•°æ®ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨å’Œå¯¹è±¡å­˜å‚¨
- **æŸ¥è¯¢æ‰§è¡Œ**ï¼šæ‰§è¡ŒFEä¸‹å‘çš„æŸ¥è¯¢ä»»åŠ¡ï¼Œè¿”å›ç»“æœ
- **æ•°æ®å¯¼å…¥**ï¼šå¤„ç†æ•°æ®å¯¼å…¥è¯·æ±‚ï¼Œå†™å…¥æ•°æ®
- **å‰¯æœ¬ç®¡ç†**ï¼šç®¡ç†æ•°æ®å‰¯æœ¬ï¼Œä¿è¯æ•°æ®å¯é æ€§

BEèŠ‚ç‚¹å¯ä»¥æ°´å¹³æ‰©å±•ï¼Œæ–°å¢èŠ‚ç‚¹åè‡ªåŠ¨è¿›è¡Œæ•°æ®é‡å¹³è¡¡ã€‚

### 1.2.3 æ•°æ®å­˜å‚¨æ¨¡å‹

Dorisé‡‡ç”¨åˆ—å¼å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒå¤šç§æ•°æ®æ¨¡å‹ï¼š

1. **Duplicateæ¨¡å‹**ï¼šæ˜ç»†æ¨¡å‹ï¼Œä¿ç•™æ‰€æœ‰æ•°æ®è¡Œ
2. **Aggregateæ¨¡å‹**ï¼šèšåˆæ¨¡å‹ï¼Œé¢„èšåˆæ•°æ®
3. **Uniqueæ¨¡å‹**ï¼šå”¯ä¸€æ¨¡å‹ï¼Œä¿è¯ä¸»é”®å”¯ä¸€
4. **Primary Keyæ¨¡å‹**ï¼šä¸»é”®æ¨¡å‹ï¼Œæ”¯æŒæ›´æ–°æ“ä½œ

---

## 1.3 åº”ç”¨åœºæ™¯

### 1.3.1 å…¸å‹åº”ç”¨åœºæ™¯

Dorisé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

1. **å®æ—¶æŠ¥è¡¨åˆ†æ**ï¼šæ”¯æŒå®æ—¶æ•°æ®æ›´æ–°å’ŒæŸ¥è¯¢ï¼Œæ»¡è¶³æŠ¥è¡¨å®æ—¶æ€§éœ€æ±‚
2. **ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼šåˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæ”¯æŒå¤šç»´åº¦åˆ†æ
3. **æ—¥å¿—åˆ†æ**ï¼šå¤„ç†å’Œåˆ†æå¤§é‡æ—¥å¿—æ•°æ®
4. **BIåˆ†æ**ï¼šä½œä¸ºBIå·¥å…·çš„æ•°æ®æºï¼Œæ”¯æŒå³å¸­æŸ¥è¯¢
5. **A/Bæµ‹è¯•**ï¼šæ”¯æŒA/Bæµ‹è¯•ç»“æœåˆ†æ
6. **ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶ç›‘æ§ç³»ç»ŸæŒ‡æ ‡ï¼Œæ”¯æŒå‘Šè­¦è§„åˆ™

### 1.3.2 è¡Œä¸šåº”ç”¨æ¡ˆä¾‹

1. **ç”µå•†è¡Œä¸š**ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æã€å•†å“æ¨èã€é”€å”®åˆ†æ
2. **é‡‘èè¡Œä¸š**ï¼šé£é™©æ§åˆ¶ã€äº¤æ˜“åˆ†æã€å®¢æˆ·ç”»åƒ
3. **æ¸¸æˆè¡Œä¸š**ï¼šç©å®¶è¡Œä¸ºåˆ†æã€æ¸¸æˆæ•°æ®åˆ†æ
4. **å¹¿å‘Šè¡Œä¸š**ï¼šå¹¿å‘Šæ•ˆæœåˆ†æã€æŠ•æ”¾ä¼˜åŒ–
5. **ç‰©æµè¡Œä¸š**ï¼šç‰©æµæ•°æ®åˆ†æã€è·¯å¾„ä¼˜åŒ–

---

## 1.4 Dorisä¸å…¶ä»–æ•°æ®åº“å¯¹æ¯”

### 1.4.1 ä¸ä¼ ç»Ÿæ•°æ®ä»“åº“å¯¹æ¯”

| ç‰¹æ€§ | Apache Doris | ä¼ ç»Ÿæ•°æ®ä»“åº“ |
|------|--------------|--------------|
| æŸ¥è¯¢å»¶è¿Ÿ | ç§’çº§ | åˆ†é’Ÿçº§ |
| æ•°æ®æ›´æ–° | å®æ—¶ | æ‰¹é‡ |
| æ‰©å±•æ€§ | åœ¨çº¿æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±•ä¸ºä¸» |
| æˆæœ¬ | å¼€æºå…è´¹ | å•†ä¸šæˆæƒè´¹ç”¨é«˜ |
| æ˜“ç”¨æ€§ | MySQLåè®® | ä¸“ç”¨å®¢æˆ·ç«¯ |

### 1.4.2 ä¸å…¶ä»–OLAPæ•°æ®åº“å¯¹æ¯”

| ç‰¹æ€§ | Apache Doris | ClickHouse | Apache Druid | Apache Kylin |
|------|--------------|------------|--------------|--------------|
| æŸ¥è¯¢è¯­è¨€ | MySQL | ClickHouse SQL | Native SQL | SQL |
| æ•°æ®æ›´æ–° | æ”¯æŒ | æœ‰é™æ”¯æŒ | æ”¯æŒ | æœ‰é™æ”¯æŒ |
| å®æ—¶æ€§ | é«˜ | é«˜ | é«˜ | ä¸­ |
| æ˜“ç”¨æ€§ | é«˜ | ä¸­ | ä¸­ | ä¸­ |
| ç¤¾åŒºæ´»è·ƒåº¦ | é«˜ | é«˜ | ä¸­ | ä¸­ |

---

## 1.5 æ ¸å¿ƒæ¦‚å¿µä¸æœ¯è¯­

### 1.5.1 åŸºæœ¬æ¦‚å¿µ

1. **æ•°æ®åº“(Database)**ï¼šé€»è¾‘ä¸Šçš„æ•°æ®é›†åˆï¼Œç±»ä¼¼äºMySQLä¸­çš„æ•°æ®åº“
2. **è¡¨(Table)**ï¼šæ•°æ®çš„åŸºæœ¬å­˜å‚¨å•å…ƒï¼Œç”±è¡Œå’Œåˆ—ç»„æˆ
3. **åˆ†åŒº(Partition)**ï¼šå°†è¡¨æŒ‰ç…§æ—¶é—´æˆ–å…¶ä»–ç»´åº¦è¿›è¡Œæ°´å¹³åˆ†å‰²
4. **åˆ†æ¡¶(Bucket)**ï¼šå°†åˆ†åŒºå†…çš„æ•°æ®æŒ‰ç…§å“ˆå¸Œå€¼è¿›è¡Œåˆ†æ•£å­˜å‚¨
5. **å‰¯æœ¬(Replica)**ï¼šæ•°æ®çš„å†—ä½™å¤‡ä»½ï¼Œæé«˜æ•°æ®å¯é æ€§

### 1.5.2 æ•°æ®æ¨¡å‹

1. **Duplicateæ¨¡å‹**ï¼šæ˜ç»†æ¨¡å‹ï¼Œä¸è¿›è¡Œé¢„èšåˆï¼Œä¿ç•™æ‰€æœ‰æ˜ç»†æ•°æ®
2. **Aggregateæ¨¡å‹**ï¼šèšåˆæ¨¡å‹ï¼Œå¯¼å…¥æ—¶è¿›è¡Œé¢„èšåˆï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
3. **Uniqueæ¨¡å‹**ï¼šå”¯ä¸€æ¨¡å‹ï¼Œä¿è¯æŒ‡å®šåˆ—çš„å”¯ä¸€æ€§ï¼Œæ”¯æŒæ›´æ–°
4. **Primary Keyæ¨¡å‹**ï¼šä¸»é”®æ¨¡å‹ï¼Œæ”¯æŒæ›´æ–°å’Œåˆ é™¤æ“ä½œ

### 1.5.3 ç´¢å¼•ç±»å‹

1. **å‰ç¼€ç´¢å¼•**ï¼šé»˜è®¤ç´¢å¼•ï¼Œå¯¹æ¯åˆ—å‰36ä¸ªå­—èŠ‚å»ºç«‹ç´¢å¼•
2. **Bitmapç´¢å¼•**ï¼šé€‚ç”¨äºä½åŸºæ•°åˆ—ï¼Œæ”¯æŒç­‰å€¼æŸ¥è¯¢å’ŒINæŸ¥è¯¢
3. **Bloom Filterç´¢å¼•**ï¼šç”¨äºå¿«é€Ÿåˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨
4. **å€’æ’ç´¢å¼•**ï¼šæ”¯æŒå…¨æ–‡æ£€ç´¢

---

## 1.6 å¿«é€Ÿä½“éªŒ

### 1.6.1 Dockerå¿«é€Ÿéƒ¨ç½²

ä½¿ç”¨Dockerå¿«é€Ÿä½“éªŒDorisï¼š

```bash
# æ‹‰å–Dorisé•œåƒ
docker pull apache/doris:latest

# å¯åŠ¨FEèŠ‚ç‚¹
docker run -it --name doris-fe \
    -p 8030:8030 -p 9030:9030 \
    -e FE_SERVERS="fe1:127.0.0.1:9010" \
    --entrypoint /opt/apache-doris/fe/bin/start_fe.sh \
    apache/doris:latest

# å¯åŠ¨BEèŠ‚ç‚¹
docker run -it --name doris-be \
    -p 8040:8040 \
    -e FE_SERVERS="fe1:127.0.0.1:9010" \
    --entrypoint /opt/apache-doris/be/bin/start_be.sh \
    apache/doris:latest
```

### 1.6.2 è¿æ¥Doris

ä½¿ç”¨MySQLå®¢æˆ·ç«¯è¿æ¥Dorisï¼š

```bash
mysql -h 127.0.0.1 -P 9030 -uroot
```

### 1.6.3 åˆ›å»ºç¬¬ä¸€ä¸ªè¡¨

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE demo;
USE demo;

-- åˆ›å»ºè¡¨
CREATE TABLE users (
    user_id BIGINT,
    user_name VARCHAR(50),
    age INT,
    city VARCHAR(20),
    register_date DATE
) DUPLICATE KEY(user_id)
DISTRIBUTED BY HASH(user_id) BUCKETS 10;

-- æ’å…¥æ•°æ®
INSERT INTO users VALUES
(1, 'Alice', 25, 'Beijing', '2023-01-01'),
(2, 'Bob', 30, 'Shanghai', '2023-01-02'),
(3, 'Charlie', 35, 'Guangzhou', '2023-01-03');

-- æŸ¥è¯¢æ•°æ®
SELECT * FROM users;
```

---

## 1.7 æœ¬ç« å°ç»“

æœ¬ç« ä»‹ç»äº†Apache Dorisçš„åŸºæœ¬æ¦‚å¿µã€æ¶æ„è®¾è®¡ã€åº”ç”¨åœºæ™¯å’Œæ ¸å¿ƒç‰¹æ€§ã€‚Dorisä½œä¸ºä¸€ä¸ªç°ä»£åŒ–çš„MPPåˆ†æå‹æ•°æ®åº“ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€å®æ—¶æ€§ã€æ˜“ç”¨æ€§ç­‰ä¼˜åŠ¿ï¼Œé€‚ç”¨äºå¤šç§å®æ—¶åˆ†æåœºæ™¯ã€‚

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæ‚¨åº”è¯¥å¯¹Dorisæœ‰äº†åˆæ­¥çš„è®¤è¯†ï¼Œä¸ºåç»­æ·±å…¥å­¦ä¹ æ‰“ä¸‹äº†åŸºç¡€ã€‚ä¸‹ä¸€ç« å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å®‰è£…å’Œé…ç½®Dorisç¯å¢ƒã€‚

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [Apache Doriså®˜æ–¹æ–‡æ¡£](https://doris.apache.org/docs/)
- [Apache Dorisæ¶æ„è®¾è®¡](https://doris.apache.org/docs/administrator-guide/architecture/)
- [Apache Doriså¿«é€Ÿå¼€å§‹](https://doris.apache.org/docs/get-started/)

## ğŸ§ª å®è·µç»ƒä¹ 

1. ä½¿ç”¨Dockeréƒ¨ç½²ä¸€ä¸ªå•èŠ‚ç‚¹çš„Dorisç¯å¢ƒ
2. ä½¿ç”¨MySQLå®¢æˆ·ç«¯è¿æ¥Doris
3. åˆ›å»ºä¸€ä¸ªç®€å•çš„è¡¨å¹¶æ’å…¥æ•°æ®
4. å°è¯•åŸºæœ¬çš„æ•°æ®æŸ¥è¯¢æ“ä½œ

---

> ä»£ç ç¤ºä¾‹è¯·å‚è€ƒï¼š[ç¬¬1ç« ä»£ç ç¤ºä¾‹](code/chapter1/)