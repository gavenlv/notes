# Iceberg Spark Catalog Configuration for Production
# ==================================================

# Catalog Configuration
spark.sql.catalog.iceberg_catalog                  org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.iceberg_catalog.type             hive
spark.sql.catalog.iceberg_catalog.uri              thrift://hive-metastore:9083
spark.sql.catalog.iceberg_catalog.warehouse        hdfs://namenode:9000/warehouse
spark.sql.catalog.iceberg_catalog.io-impl          org.apache.iceberg.hadoop.HadoopFileIO

# Catalog Properties
spark.sql.catalog.iceberg_catalog.lock-impl        org.apache.iceberg.hive.HiveLock
spark.sql.catalog.iceberg_catalog.cache-enabled    true
spark.sql.catalog.iceberg_catalog.cache.expiration-interval-ms 300000

# Table Configuration Defaults
spark.sql.catalog.iceberg_catalog.table-default.write.format          parquet
spark.sql.catalog.iceberg_catalog.table-default.write.target-file-size-bytes 536870912
spark.sql.catalog.iceberg_catalog.table-default.write.distribution-mode hash
spark.sql.catalog.iceberg_catalog.table-default.write.metadata.previous-versions-max 20
spark.sql.catalog.iceberg_catalog.table-default.write.metadata.delete-after-commit.enabled true
spark.sql.catalog.iceberg_catalog.table-default.write.metadata.metrics-column.max 100

# Partition Configuration
spark.sql.catalog.iceberg_catalog.table-default.write.parquet.page-size-bytes 1048576
spark.sql.catalog.iceberg_catalog.table-default.write.parquet.dict-size-bytes 2097152

# S3 Configuration (if applicable)
spark.sql.catalog.iceberg_catalog.s3.access-key-id     YOUR_ACCESS_KEY
spark.sql.catalog.iceberg_catalog.s3.secret-access-key YOUR_SECRET_KEY
spark.sql.catalog.iceberg_catalog.s3.region            us-west-2
spark.sql.catalog.iceberg_catalog.s3.endpoint          s3.amazonaws.com
spark.sql.catalog.iceberg_catalog.s3.path-style-access true

# Hadoop Configuration
spark.sql.catalog.iceberg_catalog.hadoop.dfs.replication              3
spark.sql.catalog.iceberg_catalog.hadoop.dfs.blocksize               134217728
spark.sql.catalog.iceberg_catalog.hadoop.dfs.client.read.shortcircuit  true
spark.sql.catalog.iceberg_catalog.hadoop.dfs.domain.socket.path       /var/lib/hadoop-hdfs/dn_socket

# Performance Tuning
spark.sql.catalog.iceberg_catalog.table-default.read.split.open-file-cost 4MB
spark.sql.catalog.iceberg_catalog.table-default.read.split.target-size 128MB
spark.sql.catalog.iceberg_catalog.table-default.read.parquet.vectorization.enabled true
spark.sql.catalog.iceberg_catalog.table-default.read.parquet.batch-size 5000

# Compression Settings
spark.sql.catalog.iceberg_catalog.table-default.write.parquet.compression-codec zstd
spark.sql.catalog.iceberg_catalog.table-default.write.avro.compression-codec deflate

# Snapshot Management
spark.sql.catalog.iceberg_catalog.table-default.history.expire.max-snapshot-age-ms 2592000000
spark.sql.catalog.iceberg_catalog.table-default.history.expire.min-snapshots-to-keep 5

# Schema Evolution
spark.sql.catalog.iceberg_catalog.table-default.schema.allow-incompatible-changes false
spark.sql.catalog.iceberg_catalog.table-default.schema.allow-field-addition true
spark.sql.catalog.iceberg_catalog.table-default.schema.allow-field-deletion false

# Transaction Settings
spark.sql.catalog.iceberg_catalog.table-default.commit.retry.num-retries 4
spark.sql.catalog.iceberg_catalog.table-default.commit.retry.min-wait-ms 100
spark.sql.catalog.iceberg_catalog.table-default.commit.retry.max-wait-ms 60000
spark.sql.catalog.iceberg_catalog.table-default.commit.retry.total-timeout-ms 1800000

# Manifest List Settings
spark.sql.catalog.iceberg_catalog.table-default.manifest.target-partition-size 8388608
spark.sql.catalog.iceberg_catalog.table-default.manifest.min-file-count-to-merge 2