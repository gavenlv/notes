# Log4j2 Configuration for Iceberg Applications
# ==========================================

# Root logger configuration
rootLogger.level = INFO
rootLogger.appenderRef.stdout.ref = ConsoleAppender
rootLogger.appenderRef.file.ref = RollingFileAppender

# Console appender
appender.console.type = Console
appender.console.name = ConsoleAppender
appender.console.target = SYSTEM_OUT
appender.console.layout.type = PatternLayout
appender.console.layout.pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n

# Rolling file appender
appender.rolling.type = RollingFile
appender.rolling.name = RollingFileAppender
appender.rolling.fileName = /var/log/iceberg/iceberg-application.log
appender.rolling.filePattern = /var/log/iceberg/iceberg-application-%d{yyyy-MM-dd}-%i.log.gz
appender.rolling.layout.type = PatternLayout
appender.rolling.layout.pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n
appender.rolling.policies.type = Policies
appender.rolling.policies.time.type = TimeBasedTriggeringPolicy
appender.rolling.policies.time.interval = 1
appender.rolling.policies.time.modulate = true
appender.rolling.policies.size.type = SizeBasedTriggeringPolicy
appender.rolling.policies.size.size = 100MB
appender.rolling.strategy.type = DefaultRolloverStrategy
appender.rolling.strategy.max = 10

# Async logger configuration for better performance
loggers = iceberg, spark, hdfs, asyncRoot
logger.iceberg.name = org.apache.iceberg
logger.iceberg.level = INFO
logger.iceberg.additivity = false
logger.iceberg.appenderRef.console.ref = ConsoleAppender
logger.iceberg.appenderRef.file.ref = RollingFileAppender

# Spark logging
logger.spark.name = org.apache.spark
logger.spark.level = WARN
logger.spark.additivity = false
logger.spark.appenderRef.console.ref = ConsoleAppender
logger.spark.appenderRef.file.ref = RollingFileAppender

# HDFS logging
logger.hdfs.name = org.apache.hadoop
logger.hdfs.level = WARN
logger.hdfs.additivity = false
logger.hdfs.appenderRef.console.ref = ConsoleAppender
logger.hdfs.appenderRef.file.ref = RollingFileAppender

# Specific Iceberg components logging
logger.metadata.name = org.apache.iceberg.TableMetadataParser
logger.metadata.level = DEBUG
logger.metadata.additivity = false

logger.manifest.name = org.apache.iceberg.ManifestReader
logger.manifest.level = DEBUG
logger.manifest.additivity = false

logger.snapshots.name = org.apache.iceberg.BaseMetastoreTableOperations
logger.snapshots.level = DEBUG
logger.snapshots.additivity = false

logger.files.name = org.apache.iceberg.spark.source
logger.files.level = INFO
logger.files.additivity = false

# Performance logging
logger.performance.name = org.apache.iceberg.PerformanceMetrics
logger.performance.level = INFO
logger.performance.additivity = false
logger.performance.appenderRef.file.ref = PerformanceFileAppender

# Performance file appender
appender.performance.type = RollingFile
appender.performance.name = PerformanceFileAppender
appender.performance.fileName = /var/log/iceberg/performance.log
appender.performance.filePattern = /var/log/iceberg/performance-%d{yyyy-MM-dd}.log.gz
appender.performance.layout.type = PatternLayout
appender.performance.layout.pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} %msg%n
appender.performance.policies.type = Policies
appender.performance.policies.time.type = TimeBasedTriggeringPolicy
appender.performance.policies.time.interval = 1
appender.performance.policies.time.modulate = true
appender.performance.strategy.type = DefaultRolloverStrategy
appender.performance.strategy.max = 30

# Audit logging
logger.audit.name = org.apache.iceberg.AuditLogger
logger.audit.level = INFO
logger.audit.additivity = false
logger.audit.appenderRef.file.ref = AuditFileAppender

# Audit file appender
appender.audit.type = RollingFile
appender.audit.name = AuditFileAppender
appender.audit.fileName = /var/log/iceberg/audit.log
appender.audit.filePattern = /var/log/iceberg/audit-%d{yyyy-MM-dd}.log.gz
appender.audit.layout.type = PatternLayout
appender.audit.layout.pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} %msg%n
appender.audit.policies.type = Policies
appender.audit.policies.time.type = TimeBasedTriggeringPolicy
appender.audit.policies.time.interval = 1
appender.audit.policies.time.modulate = true
appender.audit.strategy.type = DefaultRolloverStrategy
appender.audit.strategy.max = 90

# Error logging
logger.error.name = org.apache.iceberg.ErrorLogger
logger.error.level = ERROR
logger.error.additivity = false
logger.error.appenderRef.file.ref = ErrorFileAppender

# Error file appender
appender.error.type = RollingFile
appender.error.name = ErrorFileAppender
appender.error.fileName = /var/log/iceberg/error.log
appender.error.filePattern = /var/log/iceberg/error-%d{yyyy-MM-dd}.log.gz
appender.error.layout.type = PatternLayout
appender.error.layout.pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n
appender.error.policies.type = Policies
appender.error.policies.time.type = TimeBasedTriggeringPolicy
appender.error.policies.time.interval = 1
appender.error.policies.time.modulate = true
appender.error.strategy.type = DefaultRolloverStrategy
appender.error.strategy.max = 90

# Disable debug logs for noisy libraries
logger.noisy1.name = org.apache.http
logger.noisy1.level = WARN

logger.noisy2.name = org.eclipse.jetty
logger.noisy2.level = WARN

logger.noisy3.name = org.apache.zookeeper
logger.noisy3.level = WARN