# ç¬¬1ç« ï¼šHelmåŸºç¡€æ¦‚å¿µ

## ğŸ¯ æœ¬ç« ç›®æ ‡

- ç†è§£Helmçš„æ ¸å¿ƒæ¦‚å¿µå’Œä»·å€¼
- æŒæ¡Helmçš„å®‰è£…å’ŒåŸºæœ¬é…ç½®
- å­¦ä¼šä½¿ç”¨Helmçš„åŸºæœ¬å‘½ä»¤
- ç†è§£Chartã€Releaseã€Repositoryç­‰æ ¸å¿ƒæ¦‚å¿µ

## ğŸ“š ä»€ä¹ˆæ˜¯Helmï¼Ÿ

### 1.1 Helmçš„å®šä¹‰

**Helm** æ˜¯Kubernetesçš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äºLinuxç³»ç»Ÿä¸­çš„aptã€yumï¼Œæˆ–è€…Pythonä¸­çš„pipã€‚å®ƒé€šè¿‡**Chart**çš„å½¢å¼æ¥ç®¡ç†Kubernetesåº”ç”¨çš„éƒ¨ç½²ã€‚

### 1.2 Helmçš„ä»·å€¼

#### ä¼ ç»ŸKuberneteséƒ¨ç½²çš„é—®é¢˜
```yaml
# ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦ç®¡ç†å¤šä¸ªYAMLæ–‡ä»¶
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:v1.0
        ports:
        - containerPort: 8080
        env:
        - name: DB_HOST
          value: "localhost"
---
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 8080
```

**é—®é¢˜ï¼š**
- é…ç½®åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­
- ç¯å¢ƒå·®å¼‚éš¾ä»¥ç®¡ç†
- ç‰ˆæœ¬æ§åˆ¶å¤æ‚
- é‡å¤éƒ¨ç½²å›°éš¾

#### Helmçš„ä¼˜åŠ¿

1. **æ¨¡æ¿åŒ–** - ä½¿ç”¨Goæ¨¡æ¿è¯­æ³•å®ç°é…ç½®å¤ç”¨
2. **ç‰ˆæœ¬ç®¡ç†** - æ”¯æŒåº”ç”¨ç‰ˆæœ¬çš„å›æ»šå’Œå‡çº§
3. **ä¾èµ–ç®¡ç†** - å¯ä»¥ç®¡ç†åº”ç”¨é—´çš„ä¾èµ–å…³ç³»
4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†** - å®Œæ•´çš„éƒ¨ç½²ã€å‡çº§ã€å›æ»šæµç¨‹

## ğŸ”§ Helmæ ¸å¿ƒæ¦‚å¿µ

### 1.3 Chartï¼ˆå›¾è¡¨ï¼‰

**Chart** æ˜¯Helmçš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ˜¯ä¸€ä¸ªé¢„é…ç½®çš„Kubernetesèµ„æºåŒ…ã€‚

```
myapp-chart/
â”œâ”€â”€ Chart.yaml          # Chartçš„å…ƒæ•°æ®
â”œâ”€â”€ values.yaml         # é»˜è®¤é…ç½®å€¼
â”œâ”€â”€ templates/          # æ¨¡æ¿æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ ingress.yaml
â””â”€â”€ charts/             # ä¾èµ–çš„Chart
```

### 1.4 Releaseï¼ˆå‘å¸ƒï¼‰

**Release** æ˜¯Chartåœ¨Kubernetesé›†ç¾¤ä¸­çš„è¿è¡Œå®ä¾‹ã€‚åŒä¸€ä¸ªChartå¯ä»¥éƒ¨ç½²å¤šä¸ªReleaseã€‚

```bash
# éƒ¨ç½²ä¸€ä¸ªRelease
helm install my-release ./my-chart

# æŸ¥çœ‹æ‰€æœ‰Release
helm list
```

### 1.5 Repositoryï¼ˆä»“åº“ï¼‰

**Repository** æ˜¯Chartçš„å­˜å‚¨åº“ï¼Œç±»ä¼¼äºDocker Hubæˆ–NPM Registryã€‚

```bash
# æ·»åŠ å®˜æ–¹ä»“åº“
helm repo add stable https://charts.helm.sh/stable
helm repo add bitnami https://charts.bitnami.com/bitnami

# æœç´¢Chart
helm search repo nginx
```

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1.6 Helmå®‰è£…

#### åœ¨Linux/macOSä¸Šå®‰è£…
```bash
# ä½¿ç”¨è„šæœ¬å®‰è£…
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod 700 get_helm.sh
./get_helm.sh

# æˆ–è€…ä½¿ç”¨åŒ…ç®¡ç†å™¨
# Ubuntu/Debian
curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | sudo tee /usr/share/keyrings/helm.gpg > /dev/null
sudo apt-get install apt-transport-https --yes
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
sudo apt-get update
sudo apt-get install helm
```

#### åœ¨Windowsä¸Šå®‰è£…
```powershell
# ä½¿ç”¨Chocolatey
choco install kubernetes-helm

# æˆ–è€…ä½¿ç”¨Scoop
scoop install helm
```

### 1.7 Kubernetesé›†ç¾¤å‡†å¤‡

#### ä½¿ç”¨Minikubeï¼ˆæ¨èç”¨äºå­¦ä¹ ï¼‰
```bash
# å®‰è£…Minikube
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-latest-amd64.msi
# Windowsç”¨æˆ·åŒå‡»å®‰è£…ï¼ŒLinuxç”¨æˆ·ä½¿ç”¨åŒ…ç®¡ç†å™¨

# å¯åŠ¨Minikube
minikube start --driver=docker

# éªŒè¯é›†ç¾¤
kubectl get nodes
```

#### ä½¿ç”¨Kindï¼ˆKubernetes in Dockerï¼‰
```bash
# å®‰è£…Kind
curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.17.0/kind-linux-amd64
chmod +x ./kind
sudo mv ./kind /usr/local/bin/kind

# åˆ›å»ºé›†ç¾¤
kind create cluster --name helm-learning
```

## ğŸš€ ç¬¬ä¸€ä¸ªHelmå‘½ä»¤

### 1.8 åŸºæœ¬å‘½ä»¤ä½“éªŒ

#### éªŒè¯å®‰è£…
```bash
# æ£€æŸ¥Helmç‰ˆæœ¬
helm version

# è¾“å‡ºç¤ºä¾‹
version.BuildInfo{Version:"v3.12.0", GitCommit:"...", GitTreeState:"clean", GoVersion:"go1.20.4"}
```

#### æ·»åŠ ä»“åº“
```bash
# æ·»åŠ Bitnamiä»“åº“ï¼ˆåŒ…å«å¤§é‡å¸¸ç”¨åº”ç”¨ï¼‰
helm repo add bitnami https://charts.bitnami.com/bitnami

# æ›´æ–°ä»“åº“ç´¢å¼•
helm repo update

# æŸ¥çœ‹å·²æ·»åŠ çš„ä»“åº“
helm repo list
```

#### æœç´¢Chart
```bash
# æœç´¢Nginxç›¸å…³çš„Chart
helm search repo nginx

# è¾“å‡ºç¤ºä¾‹
NAME                    CHART VERSION   APP VERSION     DESCRIPTION
bitnami/nginx          13.2.23         1.23.4          NGINX Open Source is a web server that can be a...
bitnami/nginx-ingress-controller 9.3.22  1.7.0          NGINX Ingress Controller is an Ingress controll...
```

#### éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨
```bash
# éƒ¨ç½²Nginx
helm install my-nginx bitnami/nginx

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
helm list
kubectl get pods

# è®¿é—®åº”ç”¨
kubectl port-forward svc/my-nginx 8080:80
# æµè§ˆå™¨è®¿é—® http://localhost:8080
```

## ğŸ“Š Helmæ¶æ„

### 1.9 Helm 3æ¶æ„

Helm 3é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œä½†æœåŠ¡å™¨ç«¯åŠŸèƒ½å·²é›†æˆåˆ°å®¢æˆ·ç«¯ä¸­ï¼š

```
+----------------+    +-------------------+    +-------------------+
|   Helm Client  | -> | Kubernetes API    | -> | Kubernetes Cluster |
|   (helm CLI)   |    |   Server           |    |   (å®é™…éƒ¨ç½²)       |
+----------------+    +-------------------+    +-------------------+
```

**å…³é”®å˜åŒ–ï¼ˆHelm 2 vs Helm 3ï¼‰ï¼š**
- **ç§»é™¤Tiller**ï¼šHelm 3ä¸å†éœ€è¦TilleræœåŠ¡ç«¯ç»„ä»¶
- **å®‰å…¨æ€§æå‡**ï¼šç›´æ¥ä½¿ç”¨kubeconfigè¿›è¡Œè®¤è¯
- **ç®€åŒ–æ¶æ„**ï¼šçº¯å®¢æˆ·ç«¯å·¥å…·

## ğŸ” æ·±å…¥ç†è§£ï¼šReleaseç®¡ç†

### 1.10 Releaseç”Ÿå‘½å‘¨æœŸ

```bash
# 1. å®‰è£…
helm install my-app ./my-chart

# 2. å‡çº§
helm upgrade my-app ./my-chart --set replicaCount=3

# 3. å›æ»š
helm rollback my-app 1

# 4. å¸è½½
helm uninstall my-app
```

### 1.11 ReleaseçŠ¶æ€ç®¡ç†

```bash
# æŸ¥çœ‹ReleaseçŠ¶æ€
helm status my-app

# æŸ¥çœ‹Releaseå†å²
helm history my-app

# è·å–Releaseçš„manifestï¼ˆç”Ÿæˆçš„YAMLï¼‰
helm get manifest my-app

# è·å–Releaseçš„values
helm get values my-app
```

## ğŸ§ª å®éªŒï¼šåŸºç¡€æ“ä½œç»ƒä¹ 

### å®éªŒ1ï¼šéƒ¨ç½²WordPress

```bash
# 1. æ·»åŠ ä»“åº“
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# 2. æœç´¢WordPress
helm search repo wordpress

# 3. éƒ¨ç½²WordPressï¼ˆä½¿ç”¨è‡ªå®šä¹‰å€¼ï¼‰
helm install my-wordpress bitnami/wordpress \
  --set wordpressUsername=admin \
  --set wordpressPassword=password \
  --set mariadb.auth.rootPassword=secret-password

# 4. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get pods -l app.kubernetes.io/name=wordpress

# 5. è·å–è®¿é—®ä¿¡æ¯
kubectl get svc my-wordpress
```

### å®éªŒ2ï¼šç®¡ç†Release

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰Release
helm list

# 2. æŸ¥çœ‹ç‰¹å®šReleaseè¯¦æƒ…
helm status my-wordpress

# 3. å‡çº§Releaseï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰
helm upgrade my-wordpress bitnami/wordpress --set replicaCount=2

# 4. æŸ¥çœ‹å‡çº§å†å²
helm history my-wordpress

# 5. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
helm rollback my-wordpress 1

# 6. å¸è½½Release
helm uninstall my-wordpress
```

## ğŸ“ æœ¬ç« æ€»ç»“

### å…³é”®çŸ¥è¯†ç‚¹

1. **Helmæ˜¯ä»€ä¹ˆ**ï¼šKubernetesçš„åŒ…ç®¡ç†å™¨
2. **æ ¸å¿ƒæ¦‚å¿µ**ï¼šChartã€Releaseã€Repository
3. **å®‰è£…é…ç½®**ï¼šå¤šç§å®‰è£…æ–¹å¼ï¼Œæ”¯æŒå„ç§å¹³å°
4. **åŸºæœ¬å‘½ä»¤**ï¼šinstallã€upgradeã€rollbackã€uninstall
5. **æ¶æ„ç†è§£**ï¼šHelm 3çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„

### å®è·µæŠ€èƒ½

- âœ… èƒ½å¤Ÿå®‰è£…å’Œé…ç½®Helmç¯å¢ƒ
- âœ… èƒ½å¤Ÿä½¿ç”¨åŸºæœ¬Helmå‘½ä»¤
- âœ… èƒ½å¤Ÿéƒ¨ç½²å’Œç®¡ç†ç®€å•çš„åº”ç”¨
- âœ… ç†è§£Releaseçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

### ä¸‹ä¸€æ­¥å­¦ä¹ 

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ Chartçš„å¼€å‘ï¼ŒåŒ…æ‹¬Chartçš„ç»“æ„ã€æ¨¡æ¿è¯­æ³•å’Œvaluesç®¡ç†ã€‚

---

**ğŸ’¡ æç¤ºï¼šå®Œæˆæœ¬ç« å­¦ä¹ åï¼Œå»ºè®®è¿›å…¥ `code/basic-chart/` ç›®å½•è¿›è¡Œå®è·µç»ƒä¹ ï¼Œå·©å›ºæ‰€å­¦çŸ¥è¯†ã€‚**