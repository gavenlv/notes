# ç¬¬2ç« ï¼šæ ¸å¿ƒè®¡ç®—æœåŠ¡è¯¦è§£

## ğŸ“š æœ¬ç« å¯¼å­¦

Google Cloud Platformæä¾›äº†å¤šç§è®¡ç®—æœåŠ¡ï¼Œæ»¡è¶³ä¸åŒè§„æ¨¡å’Œç±»å‹çš„åº”ç”¨éœ€æ±‚ã€‚æœ¬ç« å°†æ·±å…¥æ¢è®¨GCPçš„æ ¸å¿ƒè®¡ç®—æœåŠ¡ï¼Œå¸®åŠ©æ‚¨ç†è§£å„ç§æœåŠ¡çš„ç‰¹æ€§ã€ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚

### ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- ç†è§£GCPä¸»è¦è®¡ç®—æœåŠ¡çš„ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯
- æŒæ¡Compute Engineè™šæ‹Ÿæœºçš„åˆ›å»ºã€é…ç½®å’Œç®¡ç†
- å­¦ä¼šä½¿ç”¨Google Kubernetes Engine(GKE)éƒ¨ç½²å®¹å™¨åŒ–åº”ç”¨
- äº†è§£Cloud Runæ— æœåŠ¡å™¨å®¹å™¨æœåŠ¡çš„ä½¿ç”¨æ–¹æ³•
- æŒæ¡Cloud Functionsäº‹ä»¶é©±åŠ¨å‡½æ•°å¼€å‘
- èƒ½å¤Ÿæ ¹æ®åº”ç”¨éœ€æ±‚é€‰æ‹©åˆé€‚çš„è®¡ç®—æœåŠ¡

### ğŸ“– æœ¬ç« å†…å®¹æ¦‚è§ˆ

1. [GCPè®¡ç®—æœåŠ¡æ¦‚è§ˆ](#1-gcpè®¡ç®—æœåŠ¡æ¦‚è§ˆ)
2. [Compute Engineè¯¦è§£](#2-compute-engineè¯¦è§£)
3. [Google Kubernetes Engine(GKE)](#3-google-kubernetes-enginegke)
4. [Cloud Runæ— æœåŠ¡å™¨å®¹å™¨](#4-cloud-runæ— æœåŠ¡å™¨å®¹å™¨)
5. [Cloud Functionsäº‹ä»¶é©±åŠ¨å‡½æ•°](#5-cloud-functionsäº‹ä»¶é©±åŠ¨å‡½æ•°)
6. [å®éªŒï¼šéƒ¨ç½²å¤šæœåŠ¡åº”ç”¨](#6-å®éªŒéƒ¨ç½²å¤šæœåŠ¡åº”ç”¨)

---

## 1. GCPè®¡ç®—æœåŠ¡æ¦‚è§ˆ

### 1.1 è®¡ç®—æœåŠ¡åˆ†ç±»

GCPæä¾›äº†ä¸°å¯Œçš„è®¡ç®—æœåŠ¡ï¼Œå¯ä»¥æ ¹æ®ä¸åŒéœ€æ±‚é€‰æ‹©ï¼š

```mermaid
graph TB
    A[GCPè®¡ç®—æœåŠ¡] --> B[IaaSç±»]
    A --> C[PaaSç±»]
    A --> D[FaaSç±»]
    A --> E[Serverlesså®¹å™¨]
    
    B --> B1[Compute Engine]
    C --> C1[App Engine]
    C --> C2[Google Kubernetes Engine]
    D --> D1[Cloud Functions]
    E --> E1[Cloud Run]
```

### 1.2 æœåŠ¡é€‰æ‹©æŒ‡å—

å¦‚ä½•æ ¹æ®åº”ç”¨éœ€æ±‚é€‰æ‹©åˆé€‚çš„è®¡ç®—æœåŠ¡ï¼š

| æœåŠ¡ç±»å‹ | æ§åˆ¶çº§åˆ« | æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ |
|----------|----------|--------|----------|
| **Compute Engine** | å®Œå…¨æ§åˆ¶ | æ‰‹åŠ¨/è‡ªåŠ¨ | ä¼ ç»Ÿåº”ç”¨ï¼Œéœ€è¦å®Œå…¨æ§åˆ¶åŸºç¡€è®¾æ–½ |
| **Google Kubernetes Engine** | å®¹å™¨çº§åˆ« | è‡ªåŠ¨æ‰©å±• | å®¹å™¨åŒ–åº”ç”¨ï¼Œå¾®æœåŠ¡æ¶æ„ |
| **App Engine** | åº”ç”¨çº§åˆ« | è‡ªåŠ¨æ‰©å±• | Webåº”ç”¨ï¼Œå¿«é€Ÿéƒ¨ç½²ï¼Œæ— è¿ç»´éœ€æ±‚ |
| **Cloud Run** | å®¹å™¨çº§åˆ« | è‡ªåŠ¨æ‰©å±• | è½»é‡çº§å®¹å™¨ï¼Œäº‹ä»¶é©±åŠ¨ |
| **Cloud Functions** | å‡½æ•°çº§åˆ« | å®Œå…¨æ— æœåŠ¡å™¨ | äº‹ä»¶é©±åŠ¨ï¼Œè½»é‡çº§å¤„ç†é€»è¾‘ |

### 1.3 è®¡ç®—æœåŠ¡å¯¹æ¯”

è®©æˆ‘ä»¬è¯¦ç»†æ¯”è¾ƒå„ç§è®¡ç®—æœåŠ¡çš„æ ¸å¿ƒç‰¹æ€§ï¼š

| ç‰¹æ€§ | Compute Engine | GKE | Cloud Run | Cloud Functions |
|------|----------------|-----|-----------|-----------------|
| **å¯åŠ¨æ—¶é—´** | åˆ†é’Ÿçº§ | åˆ†é’Ÿçº§ | ç§’çº§ | æ¯«ç§’çº§ |
| **ç¼©æ”¾æ–¹å¼** | æ‰‹åŠ¨/è‡ªåŠ¨ | è‡ªåŠ¨ | è‡ªåŠ¨ | è‡ªåŠ¨ |
| **è®¡è´¹æ–¹å¼** | æŒ‰è¿è¡Œæ—¶é—´ | æŒ‰é›†ç¾¤å’ŒèŠ‚ç‚¹ | æŒ‰è¯·æ±‚å’Œå¤„ç†æ—¶é—´ | æŒ‰è°ƒç”¨æ¬¡æ•°å’Œæ‰§è¡Œæ—¶é—´ |
| **è¯­è¨€æ”¯æŒ** | ä»»ä½•è¯­è¨€ | å®¹å™¨åŒ–åº”ç”¨ | å®¹å™¨åŒ–åº”ç”¨ | ç‰¹å®šè¿è¡Œæ—¶ |
| **è®¿é—®æ–¹å¼** | SSH, RDP | kubectl, API | HTTPè¯·æ±‚ | äº‹ä»¶è§¦å‘ |
| **é€‚ç”¨è´Ÿè½½** | æŒç»­è¿è¡Œ | é•¿æœŸè¿è¡Œ | é—´æ­‡æ€§è¿è¡Œ | çŸ­æœŸå¤„ç† |

---

## 2. Compute Engineè¯¦è§£

### 2.1 Compute EngineåŸºç¡€

Compute Engineæ˜¯GCPçš„åŸºç¡€IaaSæœåŠ¡ï¼Œæä¾›å¯å®šåˆ¶çš„è™šæ‹Ÿæœºã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **å®Œå…¨æ§åˆ¶**ï¼šå¯ä»¥å®Œå…¨æ§åˆ¶æ“ä½œç³»ç»Ÿå’Œè½¯ä»¶é…ç½®
- **é«˜æ€§èƒ½**ï¼šä½¿ç”¨Googleè‡ªç ”ç¡¬ä»¶å’Œç½‘ç»œ
- **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§æœºå™¨ç±»å‹å’Œè‡ªå®šä¹‰é…ç½®
- **å…¨çƒè¦†ç›–**ï¼šå¯åœ¨å…¨çƒä»»ä½•åŒºåŸŸéƒ¨ç½²è™šæ‹Ÿæœº
- **é›†æˆæ€§**ï¼šä¸GCPå…¶ä»–æœåŠ¡æ·±åº¦é›†æˆ

#### æœºå™¨ç±»å‹

Compute Engineæä¾›å¤šç§æœºå™¨ç±»å‹ä»¥æ»¡è¶³ä¸åŒéœ€æ±‚ï¼š

| ç³»åˆ— | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **E2ç³»åˆ—** | æˆæœ¬ä¼˜åŒ–ï¼ŒAMDå¤„ç†å™¨ | é€šç”¨å·¥ä½œè´Ÿè½½ï¼Œå¼€å‘æµ‹è¯• |
| **N2ç³»åˆ—** | å¹³è¡¡æ€§èƒ½ï¼ŒIntelæœ€æ–°å¤„ç†å™¨ | ä¼ä¸šåº”ç”¨ï¼Œæ•°æ®åº“ |
| **N2Dç³»åˆ—** | å¹³è¡¡æ€§èƒ½ï¼ŒAMDå¤„ç†å™¨ | ä¼ä¸šåº”ç”¨ï¼Œæ•°æ®åº“ |
| **C2ç³»åˆ—** | è®¡ç®—ä¼˜åŒ– | é«˜æ€§èƒ½è®¡ç®—ï¼Œæ¸²æŸ“ |
| **M2ç³»åˆ—** | å†…å­˜ä¼˜åŒ– | å†…å­˜å¯†é›†å‹åº”ç”¨ï¼Œå¤§æ•°æ® |
| **A2ç³»åˆ—** | åŠ é€Ÿå™¨ä¼˜åŒ– | AI/MLè®­ç»ƒï¼Œæ¨ç† |

#### é¢„å®šä¹‰vsè‡ªå®šä¹‰æœºå™¨ç±»å‹

**é¢„å®šä¹‰æœºå™¨ç±»å‹**ï¼š
- æ ‡å‡†åŒ–é…ç½®ï¼Œæ˜“äºé€‰æ‹©
- å¸¸è§ç»„åˆï¼še2-medium, n1-standard-4
- æ€§èƒ½å’Œä»·æ ¼å·²ä¼˜åŒ–

**è‡ªå®šä¹‰æœºå™¨ç±»å‹**ï¼š
- ç²¾ç¡®åŒ¹é…éœ€æ±‚ï¼Œé¿å…èµ„æºæµªè´¹
- å¯è‡ªå®šä¹‰vCPUæ•°é‡å’Œå†…å­˜å¤§å°
- æ¯vCPUå¿…é¡»é…è‡³å°‘0.9GBå†…å­˜ï¼ˆæŸäº›ç³»åˆ—æœ€ä½0.6GBï¼‰

```bash
# åˆ›å»ºè‡ªå®šä¹‰æœºå™¨ç±»å‹çš„å®ä¾‹
gcloud compute instances create custom-vm \
  --machine-type "custom-6-24576" \  # 6 vCPU, 24GBå†…å­˜
  --zone "us-central1-a"
```

### 2.2 å®ä¾‹ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### å®ä¾‹çŠ¶æ€

```mermaid
stateDiagram-v2
    [*] --> PROVISIONING: åˆ›å»ºè¯·æ±‚
    PROVISIONING --> STAGING: èµ„æºåˆ†é…
    STAGING --> RUNNING: å¯åŠ¨å®Œæˆ
    RUNNING --> STOPPING: åœæ­¢è¯·æ±‚
    STOPPING --> TERMINATED: åœæ­¢å®Œæˆ
    TERMINATED --> RUNNING: å¯åŠ¨è¯·æ±‚
    RUNNING --> TERMINATED: åˆ é™¤è¯·æ±‚
    TERMINATED --> [*]
    
    RUNNING --> REPAIRING: ä¸»æœºæ•…éšœ
    REPAIRING --> RUNNING: ä¿®å¤å®Œæˆ
    
    RUNNING --> STAGING: é‡ç½®è¯·æ±‚
    STAGING --> RUNNING: é‡ç½®å®Œæˆ
```

#### å®ä¾‹æ“ä½œ

```bash
# åˆ›å»ºå®ä¾‹
gcloud compute instances create my-instance \
  --image-family debian-11 \
  --image-project debian-cloud \
  --machine-type e2-medium \
  --zone us-central1-a \
  --tags http-server,https-server

# è¿æ¥å®ä¾‹
gcloud compute ssh my-instance --zone us-central1-a

# æŸ¥çœ‹å®ä¾‹åˆ—è¡¨
gcloud compute instances list

# åœæ­¢å®ä¾‹
gcloud compute instances stop my-instance --zone us-central1-a

# å¯åŠ¨å®ä¾‹
gcloud compute instances start my-instance --zone us-central1-a

# é‡ç½®å®ä¾‹
gcloud compute instances reset my-instance --zone us-central1-a

# åˆ é™¤å®ä¾‹
gcloud compute instances delete my-instance --zone us-central1-a
```

### 2.3 å®ä¾‹é«˜çº§é…ç½®

#### å…ƒæ•°æ®

å®ä¾‹å…ƒæ•°æ®åˆ†ä¸ºä¸¤ç±»ï¼š

**é¡¹ç›®çº§å…ƒæ•°æ®**ï¼š
- åº”ç”¨äºé¡¹ç›®ä¸­æ‰€æœ‰å®ä¾‹
- å¸¸ç”¨äºSSHå¯†é’¥ã€é»˜è®¤å€¼ç­‰å…¨å±€é…ç½®

**å®ä¾‹çº§å…ƒæ•°æ®**ï¼š
- ä»…åº”ç”¨äºç‰¹å®šå®ä¾‹
- å¸¸ç”¨äºå¯åŠ¨è„šæœ¬ã€é…ç½®å‚æ•°ç­‰

```bash
# åˆ›å»ºå®ä¾‹æ—¶è®¾ç½®å…ƒæ•°æ®
gcloud compute instances create my-instance \
  --metadata startup-script='#!/bin/bash\napt-get update\napt-get install -y nginx'

# æ·»åŠ æˆ–æ›´æ–°å…ƒæ•°æ®
gcloud compute instances add-metadata my-instance \
  --metadata-from-file startup-script=setup.sh

# æŸ¥çœ‹å®ä¾‹å…ƒæ•°æ®
gcloud compute instances describe my-instance \
  --format='flattened(metadata)'
```

#### å¯åŠ¨è„šæœ¬

å¯åŠ¨è„šæœ¬åœ¨å®ä¾‹å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œå¯ç”¨äºï¼š

- å®‰è£…è½¯ä»¶åŒ…
- é…ç½®æœåŠ¡
- åˆå§‹åŒ–åº”ç”¨æ•°æ®

```bash
#!/bin/bash
# startup-script.sh

# æ›´æ–°ç³»ç»Ÿ
apt-get update -y

# å®‰è£…nginx
apt-get install -y nginx

# åˆ›å»ºè‡ªå®šä¹‰é¡µé¢
cat <<EOF > /var/www/html/index.html
<!DOCTYPE html>
<html>
<head><title>Auto-configured by startup script</title></head>
<body>
<h1>Hello from instance $(hostname)</h1>
<p>IP address: $(curl -s ifconfig.me)</p>
<p>Started at $(date)</p>
</body>
</html>
EOF

# å¯åŠ¨nginxæœåŠ¡
systemctl enable nginx
systemctl start nginx
```

### 2.4 å®ä¾‹ç»„ä¸è´Ÿè½½å‡è¡¡

#### å®ä¾‹ç»„

å®ä¾‹ç»„æ˜¯å¤šä¸ªå®ä¾‹çš„é›†åˆï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼š

**éæ‰˜ç®¡å®ä¾‹ç»„**ï¼š
- å¯ä»¥åŒ…å«ä¸åŒæœºå™¨ç±»å‹çš„å®ä¾‹
- æ‰‹åŠ¨æ·»åŠ /ç§»é™¤å®ä¾‹

**æ‰˜ç®¡å®ä¾‹ç»„**ï¼š
- å®ä¾‹é…ç½®ä¸€è‡´
- è‡ªåŠ¨æ›¿æ¢ä¸å¥åº·çš„å®ä¾‹
- æ”¯æŒè‡ªåŠ¨æ‰©ç¼©å®¹

```bash
# åˆ›å»ºå®ä¾‹æ¨¡æ¿
gcloud compute instance-templates create webapp-template \
  --machine-type e2-medium \
  --image-family debian-11 \
  --image-project debian-cloud \
  --tags http-server \
  --metadata startup-script='#!/bin/bash\napt-get update\napt-get install -y nginx'

# åˆ›å»ºæ‰˜ç®¡å®ä¾‹ç»„
gcloud compute instance-groups managed create webapp-group \
  --template webapp-template \
  --size 3 \
  --zone us-central1-a

# è®¾ç½®è‡ªåŠ¨æ‰©ç¼©å®¹
gcloud compute instance-groups managed set-autoscaling webapp-group \
  --zone us-central1-a \
  --max-num-replicas 10 \
  --target-cpu-utilization 0.75
```

#### è´Ÿè½½å‡è¡¡

GCPæä¾›å¤šç§è´Ÿè½½å‡è¡¡å™¨ï¼š

| è´Ÿè½½å‡è¡¡å™¨ç±»å‹ | é€‚ç”¨åœºæ™¯ |
|---------------|----------|
| **å…¨å±€å¤–éƒ¨HTTP(S)è´Ÿè½½å‡è¡¡** | å…¨çƒå†…å®¹åˆ†å‘ï¼ŒHTTP/HTTPSåº”ç”¨ |
| **åŒºåŸŸå¤–éƒ¨HTTP(S)è´Ÿè½½å‡è¡¡** | åŒºåŸŸå†…å®¹åˆ†å‘ï¼Œæˆæœ¬ä¼˜åŒ– |
| **å¤–éƒ¨TCP/UDPè´Ÿè½½å‡è¡¡** | éHTTPæµé‡ï¼Œæ¸¸æˆï¼ŒIoT |
| **å†…éƒ¨TCP/UDPè´Ÿè½½å‡è¡¡** | å†…éƒ¨æœåŠ¡æµé‡åˆ†å¸ƒ |
| **å†…éƒ¨HTTP(S)è´Ÿè½½å‡è¡¡** | å†…éƒ¨Webåº”ç”¨ï¼Œå¾®æœåŠ¡ |

---

## 3. Google Kubernetes Engine(GKE)

### 3.1 KubernetesåŸºç¡€

Kubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚

#### æ ¸å¿ƒæ¦‚å¿µ

- **Pod**ï¼šæœ€å°çš„éƒ¨ç½²å•å…ƒï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨
- **Deployment**ï¼šç®¡ç†Podçš„å‰¯æœ¬æ•°é‡å’Œæ›´æ–°ç­–ç•¥
- **Service**ï¼šä¸ºPodæä¾›ç¨³å®šçš„ç½‘ç»œè®¿é—®æ¥å£
- **Namespace**ï¼šé€»è¾‘éš”ç¦»ä¸åŒç¯å¢ƒçš„èµ„æº

```mermaid
graph TB
    subgraph "GKEé›†ç¾¤"
        A[Control Plane] --> B[Master Node]
        A --> C[etcd]
        A --> D[API Server]
        A --> E[Scheduler]
        A --> F[Controller Manager]
    end
    
    subgraph "Worker Nodes"
        G[Node 1] --> H[Pod 1]
        G --> I[Pod 2]
        J[Node 2] --> K[Pod 3]
        J --> L[Pod 4]
    end
    
    A --> G
    A --> J
```

### 3.2 GKEé›†ç¾¤ç®¡ç†

#### é›†ç¾¤ç±»å‹

GKEæä¾›ä¸¤ç§é›†ç¾¤ç±»å‹ï¼š

**æ ‡å‡†é›†ç¾¤**ï¼š
- å®Œå…¨æ§åˆ¶åº•å±‚èŠ‚ç‚¹
- å¯ä»¥è‡ªå®šä¹‰èŠ‚ç‚¹é…ç½®
- é€‚åˆéœ€è¦ç‰¹å®šé…ç½®çš„åœºæ™¯

**Autopiloté›†ç¾¤**ï¼š
- Googleç®¡ç†èŠ‚ç‚¹åŸºç¡€è®¾æ–½
- æŒ‰Podä½¿ç”¨ä»˜è´¹
- è‡ªåŠ¨ä¼˜åŒ–èµ„æºåˆ†é…å’Œå®‰å…¨æ€§

#### åˆ›å»ºé›†ç¾¤

```bash
# åˆ›å»ºæ ‡å‡†GKEé›†ç¾¤
gcloud container clusters create my-cluster \
  --region us-central1 \
  --num-nodes 3 \
  --node-locations us-central1-a,us-central1-b,us-central1-c

# åˆ›å»ºAutopilot GKEé›†ç¾¤
gcloud container clusters create-auto my-autopilot-cluster \
  --region us-central1

# è·å–é›†ç¾¤å‡­è¯
gcloud container clusters get-credentials my-cluster \
  --region us-central1
```

#### èŠ‚ç‚¹æ± ç®¡ç†

èŠ‚ç‚¹æ± æ˜¯å…·æœ‰ç›¸åŒé…ç½®çš„èŠ‚ç‚¹é›†åˆï¼š

```bash
# åˆ›å»ºèŠ‚ç‚¹æ± 
gcloud container node-pools create high-memory-pool \
  --cluster my-cluster \
  --region us-central1 \
  --machine-type n2-highmem-4 \
  --num-nodes 2

# æŸ¥çœ‹èŠ‚ç‚¹æ± 
gcloud container node-pools list \
  --cluster my-cluster \
  --region us-central1

# è°ƒæ•´èŠ‚ç‚¹æ± å¤§å°
gcloud container clusters resize my-cluster \
  --region us-central1 \
  --node-pool high-memory-pool \
  --num-nodes 3
```

### 3.3 åº”ç”¨éƒ¨ç½²ä¸ç®¡ç†

#### éƒ¨ç½²åº”ç”¨

ä½¿ç”¨Deploymentéƒ¨ç½²åº”ç”¨ï¼š

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-deployment
  labels:
    app: webapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: gcr.io/PROJECT_ID/webapp:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 512Mi
```

```bash
# éƒ¨ç½²åº”ç”¨
kubectl apply -f deployment.yaml

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get deployments
kubectl get pods

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
kubectl describe deployment webapp-deployment
```

#### æš´éœ²æœåŠ¡

ä½¿ç”¨Serviceæš´éœ²åº”ç”¨ï¼š

```yaml
# service.yaml
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
spec:
  selector:
    app: webapp
  type: ClusterIP  # ClusterIP, NodePort, LoadBalancer
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
```

```bash
# åˆ›å»ºæœåŠ¡
kubectl apply -f service.yaml

# æŸ¥çœ‹æœåŠ¡
kubectl get services

# æŸ¥çœ‹ç«¯ç‚¹
kubectl get endpoints webapp-service
```

### 3.4 é«˜çº§åŠŸèƒ½

#### è‡ªåŠ¨æ‰©ç¼©å®¹

GKEæ”¯æŒå¤šç§è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹å¼ï¼š

```yaml
# hpa.yaml - æ°´å¹³Podè‡ªåŠ¨æ‰©ç¼©å®¹
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: webapp-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: webapp-deployment
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

```bash
# åº”ç”¨HPA
kubectl apply -f hpa.yaml

# æŸ¥çœ‹HPAçŠ¶æ€
kubectl get hpa
```

#### é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹

```bash
# å¯ç”¨é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹
gcloud container clusters update my-cluster \
  --region us-central1 \
  --enable-autoscaling \
  --min-nodes 1 \
  --max-nodes 10 \
  --autoscaling-profile balanced
```

---

## 4. Cloud Runæ— æœåŠ¡å™¨å®¹å™¨

### 4.1 Cloud RunåŸºç¡€

Cloud Runæ˜¯GCPçš„æ— æœåŠ¡å™¨å®¹å™¨è®¡ç®—æœåŠ¡ï¼Œè®©æ‚¨èƒ½å¤Ÿè¿è¡Œå®¹å™¨è€Œæ— éœ€ç®¡ç†åº•å±‚åŸºç¡€è®¾æ–½ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **æ— æœåŠ¡å™¨**ï¼šæ— éœ€ç®¡ç†æœåŠ¡å™¨æˆ–é›†ç¾¤
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šä»0åˆ°Nå®ä¾‹è‡ªåŠ¨æ‰©å±•
- **æŒ‰ä½¿ç”¨ä»˜è´¹**ï¼šä»…å¯¹å®é™…è¯·æ±‚å¤„ç†æ—¶é—´ä»˜è´¹
- **å®¹å™¨å‹å¥½**ï¼šæ”¯æŒä»»ä½•å®¹å™¨åŒ–åº”ç”¨
- **æµé‡ç®¡ç†**ï¼šæ”¯æŒé€æ­¥æµé‡åˆ‡æ¢

#### ä½¿ç”¨åœºæ™¯

Cloud Runç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

- **Web APIå’Œå¾®æœåŠ¡**
- **äº‹ä»¶é©±åŠ¨çš„åå°ä»»åŠ¡**
- **æ•°æ®å¤„ç†å’Œè½¬æ¢**
- **CI/CDæµæ°´çº¿ä¸­çš„ä»»åŠ¡**
- **ä½æµé‡åˆ°ä¸­æµé‡çš„Webåº”ç”¨**

### 4.2 éƒ¨ç½²Cloud RunæœåŠ¡

#### å®¹å™¨åŒ–åº”ç”¨

åˆ›å»ºä¸€ä¸ªç®€å•çš„Webåº”ç”¨ï¼š

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 8080

CMD ["node", "server.js"]
```

```javascript
// server.js
const express = require('express');
const app = express();
const port = process.env.PORT || 8080;

app.get('/', (req, res) => {
  const name = process.env.NAME || 'World';
  res.send(`Hello ${name}!`);
});

app.listen(port, () => {
  console.log(`Server listening on port ${port}`);
});
```

#### æ„å»ºå’Œéƒ¨ç½²

```bash
# è®¾ç½®é¡¹ç›®å˜é‡
export PROJECT_ID=$(gcloud config get-value project)
export SERVICE_NAME=helloworld-nodejs

# æ„å»ºå®¹å™¨é•œåƒ
gcloud builds submit \
  --tag gcr.io/${PROJECT_ID}/${SERVICE_NAME}:v1 \
  .

# éƒ¨ç½²åˆ°Cloud Run
gcloud run deploy ${SERVICE_NAME} \
  --image gcr.io/${PROJECT_ID}/${SERVICE_NAME}:v1 \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --max-instances 10
```

### 4.3 Cloud Runé…ç½®

#### æœåŠ¡é…ç½®é€‰é¡¹

```bash
# æ›´æ–°æœåŠ¡é…ç½®
gcloud run services update ${SERVICE_NAME} \
  --region us-central1 \
  --memory 512Mi \
  --cpu 1 \
  --timeout 5m \
  --min-instances 0 \
  --max-instances 100 \
  --concurrency 80 \
  --set-env-vars NAME=CloudRun

# æŸ¥çœ‹æœåŠ¡è¯¦æƒ…
gcloud run services describe ${SERVICE_NAME} \
  --region us-central1 \
  --format='table(spec.template.spec.containers[0].image, status.url)'
```

#### ç¯å¢ƒå˜é‡ä¸å¯†é’¥

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
gcloud run services update ${SERVICE_NAME} \
  --region us-central1 \
  --set-env-vars NODE_ENV=production,API_KEY=my-secret-key

# ä½¿ç”¨Secret Managerä¸­çš„å¯†é’¥
gcloud run services update ${SERVICE_NAME} \
  --region us-central1 \
  --set-secrets=DB_PASSWORD=my-db-secret:latest
```

### 4.4 æµé‡ç®¡ç†

#### æµé‡åˆ†é…

Cloud Runæ”¯æŒåœ¨å¤šä¸ªç‰ˆæœ¬ä¹‹é—´åˆ†é…æµé‡ï¼š

```bash
# éƒ¨ç½²æ–°ç‰ˆæœ¬
gcloud run deploy ${SERVICE_NAME} \
  --image gcr.io/${PROJECT_ID}/${SERVICE_NAME}:v2 \
  --region us-central1 \
  --no-traffic

# åˆ†é…æµé‡åˆ°æ–°ç‰ˆæœ¬
gcloud run services update-traffic ${SERVICE_NAME} \
  --region us-central1 \
  --to-revisions ${SERVICE_NAME}-v1=90,${SERVICE_NAME}-v2=10
```

#### é€æ­¥æµé‡åˆ‡æ¢

```bash
# è®¾ç½®è‡ªåŠ¨é€æ­¥æµé‡åˆ†é…
gcloud run services update-traffic ${SERVICE_NAME} \
  --region us-central1 \
  --to-revisions ${SERVICE_NAME}-v2=100 \
  -- gradual
```

---

## 5. Cloud Functionsäº‹ä»¶é©±åŠ¨å‡½æ•°

### 5.1 Cloud FunctionsåŸºç¡€

Cloud Functionsæ˜¯GCPçš„äº‹ä»¶é©±åŠ¨ã€æ— æœåŠ¡å™¨è®¡ç®—å¹³å°ï¼Œè®©æ‚¨èƒ½å¤Ÿè¿è¡Œä»£ç è€Œæ— éœ€ç®¡ç†æœåŠ¡å™¨ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **äº‹ä»¶é©±åŠ¨**ï¼šå“åº”äº‘æœåŠ¡äº‹ä»¶è§¦å‘
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº
- **æŒ‰è°ƒç”¨ä»˜è´¹**ï¼šä»…å¯¹å®é™…è°ƒç”¨æ¬¡æ•°å’Œæ‰§è¡Œæ—¶é—´ä»˜è´¹
- **è¯­è¨€æ”¯æŒ**ï¼šNode.js, Python, Go, Java, .NET, Ruby
- **å¤šè§¦å‘å™¨**ï¼šHTTPã€Pub/Subã€Firestoreã€Cloud Storageç­‰

#### ä½¿ç”¨åœºæ™¯

Cloud Functionséå¸¸é€‚åˆï¼š

- **Webhookså’ŒHTTP API**
- **æ•°æ®å¤„ç†å’Œè½¬æ¢**
- **IoTæ•°æ®å¤„ç†**
- **æ–‡ä»¶ä¸Šä¼ å¤„ç†**
- **å®æ—¶æ•°æ®åº“è§¦å‘å™¨**

### 5.2 å‡½æ•°ç±»å‹ä¸è§¦å‘å™¨

#### å‡½æ•°ç±»å‹

Cloud Functionsæ”¯æŒä¸¤ç§å‡½æ•°ç±»å‹ï¼š

```javascript
// HTTPå‡½æ•° - é€šè¿‡HTTPè¯·æ±‚è§¦å‘
exports.httpFunction = (req, res) => {
  res.send('Hello from HTTP Cloud Function!');
};

// åå°å‡½æ•° - é€šè¿‡äº‹ä»¶è§¦å‘
exports.backgroundFunction = (event, context) => {
  const message = event.data;
  console.log(`Received message: ${message}`);
  return 'Success';
};
```

#### å¸¸è§è§¦å‘å™¨

| è§¦å‘å™¨ç±»å‹ | äº‹ä»¶ç¤ºä¾‹ | ä½¿ç”¨åœºæ™¯ |
|------------|----------|----------|
| **HTTP** | HTTPè¯·æ±‚ | Web APIï¼ŒWebhook |
| **Pub/Sub** | æ¶ˆæ¯å‘å¸ƒ | å¼‚æ­¥æ¶ˆæ¯å¤„ç† |
| **Cloud Storage** | æ–‡ä»¶ä¸Šä¼ /åˆ é™¤ | å›¾åƒå¤„ç†ï¼Œæ•°æ®åˆ†æ |
| **Firestore** | æ–‡æ¡£åˆ›å»º/æ›´æ–°/åˆ é™¤ | æ•°æ®åŒæ­¥ï¼Œä¸šåŠ¡é€»è¾‘ |
| **Firebase Auth** | ç”¨æˆ·åˆ›å»º/åˆ é™¤ | ç”¨æˆ·ç®¡ç†ï¼Œæ¬¢è¿é‚®ä»¶ |

### 5.3 å‡½æ•°å¼€å‘ä¸éƒ¨ç½²

#### Node.jsç¤ºä¾‹

```javascript
// index.js
const functions = require('@google-cloud/functions-framework');

// HTTPå‡½æ•°ç¤ºä¾‹
functions.http('helloHttp', (req, res) => {
  const name = req.query.name || 'World';
  res.send(`Hello ${name}!`);
});

// Pub/Subå‡½æ•°ç¤ºä¾‹
functions.cloudEvent('helloPubSub', (cloudEvent) => {
  const base64name = cloudEvent.data.message.data;
  const name = Buffer.from(base64name, 'base64').toString();
  console.log(`Hello ${name}!`);
});

// Cloud Storageå‡½æ•°ç¤ºä¾‹
functions.cloudEvent('helloGCS', (cloudEvent) => {
  const file = cloudEvent.subject;
  console.log(`File created: ${file}`);
});
```

```json
// package.json
{
  "name": "gcf-hello",
  "version": "0.0.1",
  "dependencies": {
    "@google-cloud/functions-framework": "^3.0.0"
  }
}
```

#### éƒ¨ç½²å‡½æ•°

```bash
# éƒ¨ç½²HTTPå‡½æ•°
gcloud functions deploy helloHttp \
  --runtime nodejs18 \
  --trigger-http \
  --allow-unauthenticated \
  --region us-central1

# éƒ¨ç½²Pub/Subå‡½æ•°
gcloud functions deploy helloPubSub \
  --runtime nodejs18 \
  --trigger-topic my-topic \
  --region us-central1

# éƒ¨ç½²Cloud Storageå‡½æ•°
gcloud functions deploy helloGCS \
  --runtime nodejs18 \
  --trigger-resource my-bucket \
  --trigger-event google.storage.object.finalize \
  --region us-central1
```

### 5.4 é«˜çº§åŠŸèƒ½

#### ç¯å¢ƒé…ç½®

```bash
# éƒ¨ç½²æ—¶è®¾ç½®ç¯å¢ƒå˜é‡
gcloud functions deploy helloHttp \
  --runtime nodejs18 \
  --trigger-http \
  --set-env-vars NODE_ENV=production,API_KEY=my-key \
  --region us-central1

# ä½¿ç”¨Secret Managerä¸­çš„å¯†é’¥
gcloud functions deploy helloHttp \
  --runtime nodejs18 \
  --trigger-http \
  --set-secrets DB_PASSWORD=my-db-secret:latest \
  --region us-central1
```

#### èµ„æºé…ç½®

```bash
# éƒ¨ç½²æ—¶é…ç½®èµ„æº
gcloud functions deploy helloHttp \
  --runtime nodejs18 \
  --trigger-http \
  --memory 512MB \
  --timeout 60s \
  --max-instances 10 \
  --region us-central1
```

---

## 6. å®éªŒï¼šéƒ¨ç½²å¤šæœåŠ¡åº”ç”¨

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç»¼åˆå®éªŒï¼Œå®è·µæœ¬ç« å­¦ä¹ çš„å¤šç§è®¡ç®—æœåŠ¡ã€‚

### å®éªŒç›®æ ‡

é€šè¿‡æœ¬å®éªŒï¼Œæ‚¨å°†ï¼š

1. ä½¿ç”¨Compute Engineéƒ¨ç½²æ•°æ®åº“æœåŠ¡å™¨
2. ä½¿ç”¨GKEéƒ¨ç½²å®¹å™¨åŒ–Webåº”ç”¨
3. ä½¿ç”¨Cloud Runéƒ¨ç½²APIæœåŠ¡
4. ä½¿ç”¨Cloud Functionså¤„ç†æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
5. é…ç½®æœåŠ¡é—´é€šä¿¡å’Œè´Ÿè½½å‡è¡¡

### å®éªŒæ¶æ„

æˆ‘ä»¬å°†éƒ¨ç½²ä¸€ä¸ªç®€å•çš„åšå®¢ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

```mermaid
graph TB
    subgraph "å¤–éƒ¨ç”¨æˆ·"
        A[ç”¨æˆ·] --> B[è´Ÿè½½å‡è¡¡å™¨]
    end
    
    subgraph "GCPèµ„æº"
        B --> C[Cloud Run APIæœåŠ¡]
        B --> D[GKE Webåº”ç”¨]
        
        C --> E[Cloud Functions]
        C --> F[Compute Engine æ•°æ®åº“]
        
        D --> C
        D --> F
        
        G[Cloud Storage] --> E
    end
```

### å‰ææ¡ä»¶

- å·²åˆ›å»ºGCPé¡¹ç›®å’Œè®¡è´¹è´¦æˆ·
- å·²å®‰è£…gcloud CLIå’Œkubectl
- å·²å¯ç”¨å¿…è¦çš„GCP API

### å®éªŒæ­¥éª¤

#### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“æœåŠ¡å™¨

ä½¿ç”¨Compute Engineåˆ›å»ºPostgreSQLæ•°æ®åº“æœåŠ¡å™¨ï¼š

```bash
# è®¾ç½®å˜é‡
export PROJECT_ID=$(gcloud config get-value project)
export ZONE=us-central1-a

# åˆ›å»ºæ•°æ®åº“å®ä¾‹
gcloud compute instances create blog-db \
  --machine-type e2-medium \
  --image-family debian-11 \
  --image-project debian-cloud \
  --tags db-server \
  --zone ${ZONE} \
  --metadata startup-script='#!/bin/bash
    apt-get update
    apt-get install -y postgresql postgresql-contrib
    sudo -u postgres createdb blogdb
    sudo -u postgres psql -c "CREATE USER bloguser WITH PASSWORD \\"blogpassword\\";"
    sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE blogdb TO bloguser;"
    echo "host all all 0.0.0.0/0 md5" >> /etc/postgresql/13/main/pg_hba.conf
    echo "listen_addresses = '\''*'\''" >> /etc/postgresql/13/main/postgresql.conf
    systemctl restart postgresql
  '

# åˆ›å»ºé˜²ç«å¢™è§„åˆ™
gcloud compute firewall-rules create allow-db \
  --allow tcp:5432 \
  --source-tags web-server \
  --description "Allow PostgreSQL access from web servers"

# è·å–æ•°æ®åº“å®ä¾‹IP
export DB_IP=$(gcloud compute instances describe blog-db \
  --zone ${ZONE} \
  --format='get(networkInterfaces[0].networkIP)')

echo "Database IP: ${DB_IP}"
```

#### æ­¥éª¤2ï¼šåˆ›å»ºGKEé›†ç¾¤å¹¶éƒ¨ç½²Webåº”ç”¨

```bash
# åˆ›å»ºGKEé›†ç¾¤
gcloud container clusters create blog-cluster \
  --region us-central1 \
  --num-nodes 2

# è·å–é›†ç¾¤å‡­è¯
gcloud container clusters get-credentials blog-cluster \
  --region us-central1

# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace blog

# åˆ›å»ºæ•°æ®åº“è¿æ¥é…ç½®
cat <<EOF > db-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: db-config
  namespace: blog
data:
  DB_HOST: "${DB_IP}"
  DB_NAME: "blogdb"
  DB_USER: "bloguser"
EOF

kubectl apply -f db-config.yaml

# åˆ›å»ºæ•°æ®åº“å¯†ç Secret
kubectl create secret generic db-secret \
  --from-literal=DB_PASSWORD="blogpassword" \
  --namespace=blog
```

åˆ›å»ºWebåº”ç”¨Deploymentï¼š

```yaml
# web-app.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: blog-webapp
  namespace: blog
  labels:
    app: blog-webapp
spec:
  replicas: 2
  selector:
    matchLabels:
      app: blog-webapp
  template:
    metadata:
      labels:
        app: blog-webapp
    spec:
      containers:
      - name: blog-webapp
        image: gcr.io/${PROJECT_ID}/blog-webapp:v1
        ports:
        - containerPort: 8080
        envFrom:
        - configMapRef:
            name: db-config
        - secretRef:
            name: db-secret
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 512Mi
---
apiVersion: v1
kind: Service
metadata:
  name: blog-webapp-service
  namespace: blog
spec:
  selector:
    app: blog-webapp
  type: ClusterIP
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
EOF

kubectl apply -f web-app.yaml
```

#### æ­¥éª¤3ï¼šåˆ›å»ºCloud Run APIæœåŠ¡

```bash
# åˆ›å»ºAPIæœåŠ¡ç›®å½•
mkdir -p blog-api
cd blog-api

# åˆ›å»ºç®€å•APIåº”ç”¨
cat <<EOF > index.js
const express = require('express');
const { Pool } = require('pg');
const app = express();
app.use(express.json());

const pool = new Pool({
  host: process.env.DB_HOST,
  database: process.env.DB_NAME,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  port: 5432,
});

app.get('/api/posts', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM posts ORDER BY created_at DESC');
    res.json(result.rows);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Database error' });
  }
});

app.post('/api/posts', async (req, res) => {
  const { title, content } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO posts (title, content) VALUES ($1, $2) RETURNING *',
      [title, content]
    );
    res.status(201).json(result.rows[0]);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Database error' });
  }
});

const port = process.env.PORT || 8080;
app.listen(port, () => {
  console.log(\`API server listening on port \${port}\`);
});
EOF

cat <<EOF > package.json
{
  "name": "blog-api",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "pg": "^8.7.1"
  }
}
EOF

cat <<EOF > Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 8080
CMD ["node", "index.js"]
EOF

# æ„å»ºå’Œéƒ¨ç½²
gcloud builds submit \
  --tag gcr.io/${PROJECT_ID}/blog-api:v1 .

gcloud run deploy blog-api \
  --image gcr.io/${PROJECT_ID}/blog-api:v1 \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --set-env-vars DB_HOST=${DB_IP},DB_NAME=blogdb,DB_USER=bloguser \
  --set-secrets DB_PASSWORD=db-secret:latest
```

#### æ­¥éª¤4ï¼šåˆ›å»ºCloud Functionså¤„ç†æ–‡ä»¶ä¸Šä¼ 

```bash
# åˆ›å»ºå‡½æ•°ç›®å½•
mkdir -p image-processor
cd image-processor

cat <<EOF > index.js
const { Storage } = require('@google-cloud/storage');
const sharp = require('sharp');
const storage = new Storage();

exports.processImage = async (event, context) => {
  const filename = event.name;
  const bucketName = event.bucket;
  const bucket = storage.bucket(bucketName);
  
  // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡æ–‡ä»¶
  if (!filename.match(/\.(jpg|jpeg|png|gif)$/i)) {
    console.log('Not an image file, skipping');
    return;
  }
  
  const tempFilePath = `/tmp/${filename}`;
  const thumbnailFilename = `thumbnails/${filename}`;
  
  // ä¸‹è½½åŸæ–‡ä»¶
  await bucket.file(filename).download({destination: tempFilePath});
  
  // ç”Ÿæˆç¼©ç•¥å›¾
  await sharp(tempFilePath)
    .resize(300, 300)
    .toBuffer()
    .then(buffer => {
      return bucket.file(thumbnailFilename).save(buffer);
    });
  
  console.log(`Thumbnail created: ${thumbnailFilename}`);
};
EOF

cat <<EOF > package.json
{
  "name": "image-processor",
  "version": "1.0.0",
  "dependencies": {
    "@google-cloud/storage": "^5.8.5",
    "sharp": "^0.29.3"
  }
}
EOF

# åˆ›å»ºå­˜å‚¨æ¡¶
gsutil mb gs://${PROJECT_ID}-blog-images

# éƒ¨ç½²å‡½æ•°
gcloud functions deploy processImage \
  --runtime nodejs18 \
  --trigger-resource ${PROJECT_ID}-blog-images \
  --trigger-event google.storage.object.finalize \
  --region us-central1
```

#### æ­¥éª¤5ï¼šåˆ›å»ºå…¨å±€è´Ÿè½½å‡è¡¡å™¨

```bash
# è·å–Cloud RunæœåŠ¡URL
API_URL=$(gcloud run services describe blog-api \
  --region us-central1 \
  --format='value(status.url)')

# åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨é…ç½®
cat <<EOF > lb-config.yaml
apiVersion: v1
kind: Service
metadata:
  name: blog-frontend-lb
  namespace: blog
  annotations:
    cloud.google.com/load-balancer-type: "Global"
spec:
  selector:
    app: blog-webapp
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 8080
---
apiVersion: networking.gke.io/v1beta1
kind: FrontendConfig
metadata:
  name: blog-frontend-config
  namespace: blog
spec:
  redirectToHttps:
    enabled: true
---
apiVersion: networking.gke.io/v1
kind: ManagedCertificate
metadata:
  name: blog-ssl-cert
  namespace: blog
spec:
  domains:
    - blog.example.com
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: blog-ingress
  namespace: blog
  annotations:
    kubernetes.io/ingress.global-static-ip-name: "blog-static-ip"
    networking.gke.io/managed-certificates: "blog-ssl-cert"
    networking.gke.io/v1beta1.FrontendConfig: "blog-frontend-config"
spec:
  rules:
  - host: blog.example.com
    http:
      paths:
      - path: /api/*
        backend:
          serviceName: blog-api
          servicePort: 80
      - path: /*
        backend:
          serviceName: blog-frontend-lb
          servicePort: 80
EOF

kubectl apply -f lb-config.yaml
```

#### æ­¥éª¤6ï¼šæµ‹è¯•åº”ç”¨

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
kubectl get pods -n blog
kubectl get services -n blog
gcloud run services describe blog-api --region us-central1

# è·å–è´Ÿè½½å‡è¡¡å™¨IP
kubectl get ingress blog-ingress -n blog -o yaml

# æµ‹è¯•API
curl ${API_URL}/api/posts

# ä¸Šä¼ å›¾ç‰‡æµ‹è¯•å¤„ç†å‡½æ•°
echo "Hello World" > test.txt
gsutil cp test.txt gs://${PROJECT_ID}-blog-images/
gsutil ls gs://${PROJECT_ID}-blog-images/thumbnails/
```

#### æ­¥éª¤7ï¼šæ¸…ç†èµ„æº

```bash
# åˆ é™¤GKEèµ„æº
kubectl delete namespace blog
gcloud container clusters delete blog-cluster --region us-central1

# åˆ é™¤Cloud RunæœåŠ¡
gcloud run services delete blog-api --region us-central1

# åˆ é™¤Cloud Functions
gcloud functions delete processImage --region us-central1

# åˆ é™¤å­˜å‚¨æ¡¶
gsutil rm -r gs://${PROJECT_ID}-blog-images

# åˆ é™¤Compute Engineå®ä¾‹
gcloud compute instances delete blog-db --zone ${ZONE}
gcloud compute firewall-rules delete allow-db
```

### å®éªŒæ€»ç»“

é€šè¿‡è¿™ä¸ªç»¼åˆå®éªŒï¼Œæ‚¨å·²ç»ï¼š

1. **ä½¿ç”¨Compute Engine** åˆ›å»ºäº†æ•°æ®åº“æœåŠ¡å™¨
2. **ä½¿ç”¨GKE** éƒ¨ç½²äº†å®¹å™¨åŒ–Webåº”ç”¨
3. **ä½¿ç”¨Cloud Run** éƒ¨ç½²äº†APIæœåŠ¡
4. **ä½¿ç”¨Cloud Functions** åˆ›å»ºäº†äº‹ä»¶é©±åŠ¨çš„å›¾ç‰‡å¤„ç†æœåŠ¡
5. **é…ç½®äº†è´Ÿè½½å‡è¡¡** å®ç°æœåŠ¡é—´é€šä¿¡

è¿™ä¸ªå®éªŒå±•ç¤ºäº†GCPå„ç§è®¡ç®—æœåŠ¡å¦‚ä½•ååŒå·¥ä½œï¼Œæ„å»ºå®Œæ•´çš„åº”ç”¨æ¶æ„ã€‚

---

## ğŸ“š æœ¬ç« å°ç»“

æœ¬ç« æˆ‘ä»¬å­¦ä¹ äº†ï¼š

1. **GCPè®¡ç®—æœåŠ¡æ¦‚è§ˆ**ï¼šå„ç§æœåŠ¡çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯
2. **Compute Engineè¯¦è§£**ï¼šè™šæ‹Ÿæœºåˆ›å»ºã€é…ç½®å’Œç®¡ç†
3. **Google Kubernetes Engine(GKE)**ï¼šå®¹å™¨ç¼–æ’å’Œåº”ç”¨éƒ¨ç½²
4. **Cloud Runæ— æœåŠ¡å™¨å®¹å™¨**ï¼šæ— æœåŠ¡å™¨å®¹å™¨åŒ–åº”ç”¨
5. **Cloud Functionsäº‹ä»¶é©±åŠ¨å‡½æ•°**ï¼šäº‹ä»¶é©±åŠ¨ä»£ç æ‰§è¡Œ
6. **ç»¼åˆå®éªŒ**ï¼šå¤šæœåŠ¡æ¶æ„å®æˆ˜

### ğŸ¯ å…³é”®çŸ¥è¯†ç‚¹å›é¡¾

- **Compute Engine** æä¾›å®Œå…¨æ§åˆ¶çš„è™šæ‹Ÿæœºï¼Œé€‚åˆéœ€è¦è‡ªå®šä¹‰é…ç½®çš„åœºæ™¯
- **GKE** æ˜¯æ‰˜ç®¡KubernetesæœåŠ¡ï¼Œé€‚åˆå®¹å™¨åŒ–åº”ç”¨å’Œå¾®æœåŠ¡æ¶æ„
- **Cloud Run** æ˜¯æ— æœåŠ¡å™¨å®¹å™¨æœåŠ¡ï¼Œé€‚åˆè½»é‡çº§å®¹å™¨å’Œäº‹ä»¶é©±åŠ¨åº”ç”¨
- **Cloud Functions** æ˜¯äº‹ä»¶é©±åŠ¨å‡½æ•°æœåŠ¡ï¼Œé€‚åˆç®€å•ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å¤„ç†
- **é€‰æ‹©è®¡ç®—æœåŠ¡** éœ€è¦è€ƒè™‘åº”ç”¨ç±»å‹ã€è¿ç»´éœ€æ±‚ã€æ‰©å±•æ€§å’Œæˆæœ¬ç­‰å› ç´ 

### ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å¯ä»¥ï¼š

1. æ·±å…¥å®è·µå„ç§è®¡ç®—æœåŠ¡çš„é«˜çº§åŠŸèƒ½
2. æ¢ç´¢æœåŠ¡é—´çš„é›†æˆå’Œé€šä¿¡æ¨¡å¼
3. ç»§ç»­å­¦ä¹ ä¸‹ä¸€ç« "å­˜å‚¨ä¸æ•°æ®åº“æœåŠ¡"
4. å°è¯•å®Œæˆ[åŸºæœ¬è®¡ç®—ç¤ºä¾‹](./code/basic-compute/)ã€[GKEé›†ç¾¤ç¤ºä¾‹](./code/gke-cluster/)å’Œ[Cloud Runåº”ç”¨ç¤ºä¾‹](./code/cloud-run-app/)ä¸­çš„æ›´å¤šå®éªŒ

---

## ğŸ“– å»¶ä¼¸é˜…è¯»

- [Compute Engine æ–‡æ¡£](https://cloud.google.com/compute/docs)
- [Google Kubernetes Engine æ–‡æ¡£](https://cloud.google.com/kubernetes-engine/docs)
- [Cloud Run æ–‡æ¡£](https://cloud.google.com/run/docs)
- [Cloud Functions æ–‡æ¡£](https://cloud.google.com/functions/docs)
- [GCP è®¡ç®—äº§å“é€‰æ‹©æŒ‡å—](https://cloud.google.com/products/compute)

---

**ğŸ’¡ æç¤ºï¼šåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€éœ€è¦ç»“åˆå¤šç§è®¡ç®—æœåŠ¡ã€‚ç†è§£å„æœåŠ¡çš„ä¼˜ç¼ºç‚¹ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„æœåŠ¡ï¼Œæ˜¯äº‘æ¶æ„è®¾è®¡çš„å…³é”®ã€‚**