# ç¬¬3ç« ï¼šå­˜å‚¨ä¸æ•°æ®åº“æœåŠ¡

## ğŸ“š æœ¬ç« å¯¼å­¦

æ•°æ®å’Œå­˜å‚¨æ˜¯ä»»ä½•åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒç»„ä»¶ã€‚Google Cloud Platformæä¾›äº†ä¸°å¯Œçš„å­˜å‚¨å’Œæ•°æ®åº“æœåŠ¡ï¼Œæ»¡è¶³ä¸åŒè§„æ¨¡ã€æ€§èƒ½å’Œä¸€è‡´æ€§éœ€æ±‚çš„åº”ç”¨åœºæ™¯ã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç»GCPçš„å­˜å‚¨å’Œæ•°æ®åº“æœåŠ¡ï¼Œå¸®åŠ©æ‚¨é€‰æ‹©æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆã€‚

### ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- ç†è§£GCPå­˜å‚¨æœåŠ¡çš„åˆ†ç±»å’Œé€‚ç”¨åœºæ™¯
- æŒæ¡Cloud Storageçš„ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µ
- å­¦ä¼šé€‰æ‹©å’Œä½¿ç”¨åˆé€‚çš„GCPæ•°æ®åº“æœåŠ¡
- æŒæ¡æ•°æ®è¿ç§»å’Œå¤‡ä»½æ¢å¤ç­–ç•¥
- äº†è§£æ•°æ®å®‰å…¨æ€§å’Œåˆè§„æ€§ç®¡ç†
- èƒ½å¤Ÿæ ¹æ®åº”ç”¨éœ€æ±‚è®¾è®¡åˆç†çš„å­˜å‚¨æ¶æ„

### ğŸ“– æœ¬ç« å†…å®¹æ¦‚è§ˆ

1. [GCPå­˜å‚¨æœåŠ¡æ¦‚è§ˆ](#1-gcpå­˜å‚¨æœåŠ¡æ¦‚è§ˆ)
2. [Cloud Storageè¯¦è§£](#2-cloud-storageè¯¦è§£)
3. [Cloud SQLä¸Cloud Spanner](#3-cloud-sqlä¸cloud-spanner)
4. [NoSQLä¸å¤§æ•°æ®å­˜å‚¨](#4-nosqlä¸å¤§æ•°æ®å­˜å‚¨)
5. [æ•°æ®è¿ç§»ä¸ç®¡ç†](#5-æ•°æ®è¿ç§»ä¸ç®¡ç†)
6. [å®éªŒï¼šæ„å»ºå¤šå±‚æ•°æ®æ¶æ„](#6-å®éªŒæ„å»ºå¤šå±‚æ•°æ®æ¶æ„)

---

## 1. GCPå­˜å‚¨æœåŠ¡æ¦‚è§ˆ

### 1.1 å­˜å‚¨æœåŠ¡åˆ†ç±»

GCPæä¾›äº†å¤šç§å­˜å‚¨æœåŠ¡ï¼Œå¯ä»¥æ ¹æ®æ•°æ®ç±»å‹ã€è®¿é—®æ¨¡å¼ã€ä¸€è‡´æ€§éœ€æ±‚ç­‰å› ç´ è¿›è¡Œé€‰æ‹©ï¼š

```mermaid
graph TB
    A[GCPå­˜å‚¨æœåŠ¡] --> B[å¯¹è±¡å­˜å‚¨]
    A --> C[æ–‡ä»¶å­˜å‚¨]
    A --> D[å—å­˜å‚¨]
    A --> E[æ•°æ®åº“æœåŠ¡]
    
    B --> B1[Cloud Storage]
    
    C --> C1[Filestore]
    
    D --> D1[Persistent Disk]
    
    E --> E1[å…³ç³»å‹æ•°æ®åº“]
    E --> E2[NoSQLæ•°æ®åº“]
    
    E1 --> E11[Cloud SQL]
    E1 --> E12[Cloud Spanner]
    
    E2 --> E21[Firestore]
    E2 --> E22[Bigtable]
```

### 1.2 å­˜å‚¨é€‰æ‹©æŒ‡å—

å¦‚ä½•æ ¹æ®ä¸åŒéœ€æ±‚é€‰æ‹©åˆé€‚çš„å­˜å‚¨æœåŠ¡ï¼š

| æœåŠ¡ç±»å‹ | æ•°æ®æ¨¡å‹ | é€‚ç”¨åœºæ™¯ | ç‰¹æ€§ |
|----------|----------|----------|------|
| **Cloud Storage** | å¯¹è±¡å­˜å‚¨ | éç»“æ„åŒ–æ•°æ®ï¼Œå†…å®¹åˆ†å‘ | é«˜å¯ç”¨æ€§ï¼Œå…¨çƒåˆ†å‘ |
| **Persistent Disk** | å—å­˜å‚¨ | è™šæ‹Ÿæœºå­˜å‚¨ï¼Œæ•°æ®åº“å­˜å‚¨ | ä½å»¶è¿Ÿï¼Œé«˜æ€§èƒ½ |
| **Filestore** | æ–‡ä»¶å­˜å‚¨ | å…±äº«æ–‡ä»¶ç³»ç»Ÿï¼Œåº”ç”¨æ•°æ® | NFSåè®®ï¼Œæ˜“äºé›†æˆ |
| **Cloud SQL** | å…³ç³»å‹æ•°æ®åº“ | äº‹åŠ¡æ€§æ•°æ®ï¼Œä¼ ç»Ÿåº”ç”¨ | MySQL, PostgreSQL, SQL Server |
| **Cloud Spanner** | åˆ†å¸ƒå¼å…³ç³»å‹ | å¤§è§„æ¨¡äº‹åŠ¡æ€§æ•°æ® | å…¨çƒä¸€è‡´æ€§ï¼Œæ°´å¹³æ‰©å±• |
| **Firestore** | æ–‡æ¡£æ•°æ®åº“ | å®æ—¶åŒæ­¥ï¼Œç§»åŠ¨åº”ç”¨ | å®æ—¶ç›‘å¬ï¼Œç¦»çº¿æ”¯æŒ |
| **Bigtable** | å®½åˆ—å­˜å‚¨ | å¤§è§„æ¨¡æ—¶åºæ•°æ® | é«˜ååé‡ï¼Œä½å»¶è¿Ÿ |

### 1.3 æ€§èƒ½ä¸æˆæœ¬è€ƒè™‘

é€‰æ‹©å­˜å‚¨æœåŠ¡æ—¶éœ€è¦å¹³è¡¡æ€§èƒ½å’Œæˆæœ¬ï¼š

| å­˜å‚¨ç±»åˆ« | æ€§èƒ½ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| **é«˜é¢‘è®¿é—®å­˜å‚¨** | æœ€é«˜ | æœ€é«˜ | é¢‘ç¹è®¿é—®çš„æ´»è·ƒæ•°æ® |
| **æ ‡å‡†å­˜å‚¨** | é«˜ | ä¸­ç­‰ | å¸¸è§„è®¿é—®æ•°æ® |
| **è¿‘çº¿å­˜å‚¨** | ä¸­ç­‰ | ä½ | ä¸é¢‘ç¹è®¿é—®æ•°æ® |
| **å†·çº¿å­˜å‚¨** | ä½ | å¾ˆä½ | å½’æ¡£æ•°æ®ï¼Œå¶å°”è®¿é—® |
| **å½’æ¡£å­˜å‚¨** | æœ€ä½ | æœ€ä½ | é•¿æœŸå½’æ¡£ï¼Œæå°‘è®¿é—® |

---

## 2. Cloud Storageè¯¦è§£

### 2.1 Cloud StorageåŸºç¡€

Cloud Storageæ˜¯GCPçš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œé€‚ç”¨äºå­˜å‚¨å’Œè®¿é—®ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **é«˜å¯ç”¨æ€§**ï¼š99.999999999%(11ä¸ª9)æŒä¹…æ€§ä¿è¯
- **å…¨çƒæ‰©å±•**ï¼šå¯åœ¨å…¨çƒå¤šä¸ªä½ç½®å­˜å‚¨æ•°æ®
- **å¤šç§å­˜å‚¨ç±»åˆ«**ï¼šæ ¹æ®è®¿é—®é¢‘ç‡ä¼˜åŒ–æˆæœ¬
- **ç»Ÿä¸€å‘½åç©ºé—´**ï¼šå…¨çƒå”¯ä¸€çš„å¯¹è±¡åç§°
- **å¼ºå¤§çš„å®‰å…¨æ€§**ï¼šåŠ å¯†ã€èº«ä»½éªŒè¯ã€è®¿é—®æ§åˆ¶

#### å­˜å‚¨æ¡¶ä¸å¯¹è±¡

Cloud Storageçš„åŸºæœ¬æ•°æ®æ¨¡å‹ï¼š

```mermaid
graph TB
    A[é¡¹ç›®] --> B[å­˜å‚¨æ¡¶]
    B --> C[å¯¹è±¡1]
    B --> D[å¯¹è±¡2]
    B --> E[å¯¹è±¡3]
    B --> F[å¯¹è±¡N]
    
    B --> G[æ–‡ä»¶å¤¹ç»“æ„]
    G --> H[å­æ–‡ä»¶å¤¹1]
    G --> I[å­æ–‡ä»¶å¤¹2]
    H --> J[å¯¹è±¡A]
    H --> K[å¯¹è±¡B]
```

**å­˜å‚¨æ¡¶**ï¼š
- å­˜å‚¨æ¡¶æ˜¯Cloud Storageçš„åŸºæœ¬å®¹å™¨
- å…¨å±€å”¯ä¸€å‘½å
- åŒ…å«å¯¹è±¡å’Œæ–‡ä»¶å¤¹ç»“æ„

**å¯¹è±¡**ï¼š
- å¯¹è±¡æ˜¯å­˜å‚¨çš„åŸºæœ¬å•å…ƒ
- åŒ…å«æ•°æ®å’Œå…ƒæ•°æ®
- å¤§å°å¯ä»å‡ å­—èŠ‚åˆ°5TB

### 2.2 å­˜å‚¨ç±»åˆ«

Cloud Storageæä¾›å¤šç§å­˜å‚¨ç±»åˆ«ä»¥æ»¡è¶³ä¸åŒéœ€æ±‚ï¼š

#### æ ‡å‡†å­˜å‚¨(Standard)

- **é€‚ç”¨åœºæ™¯**ï¼šé¢‘ç¹è®¿é—®çš„æ•°æ®
- **ç‰¹ç‚¹**ï¼šä½å»¶è¿Ÿï¼Œé«˜å¯ç”¨æ€§
- **ä»·æ ¼**ï¼šè¾ƒé«˜
- **ä½¿ç”¨æ¡ˆä¾‹**ï¼šWebå†…å®¹ã€åª’ä½“æµã€äº¤äº’å¼å·¥ä½œè´Ÿè½½

```bash
# åˆ›å»ºæ ‡å‡†å­˜å‚¨æ¡¶
gsutil mb -l us-central1 -p your-project-id gs://standard-bucket
```

#### è¿‘çº¿å­˜å‚¨(Nearline)

- **é€‚ç”¨åœºæ™¯**ï¼šæ¯æœˆè®¿é—®å°‘äºä¸€æ¬¡çš„æ•°æ®
- **ç‰¹ç‚¹**ï¼šä½å­˜å‚¨æˆæœ¬ï¼Œè®¿é—®è´¹ç”¨ç¨é«˜
- **ä½¿ç”¨æ¡ˆä¾‹**ï¼šæ•°æ®å¤‡ä»½ã€é•¿æœŸå½’æ¡£

```bash
# åˆ›å»ºè¿‘çº¿å­˜å‚¨æ¡¶
gsutil mb -l us-central1 -p your-project-id -c nearline gs://nearline-bucket
```

#### å†·çº¿å­˜å‚¨(Coldline)

- **é€‚ç”¨åœºæ™¯**ï¼šæ¯å­£åº¦è®¿é—®å°‘äºä¸€æ¬¡çš„æ•°æ®
- **ç‰¹ç‚¹**ï¼šæ›´ä½çš„å­˜å‚¨æˆæœ¬ï¼Œæ›´é«˜çš„è®¿é—®è´¹ç”¨
- **ä½¿ç”¨æ¡ˆä¾‹**ï¼šç¾éš¾æ¢å¤ã€åˆè§„æ€§æ•°æ®å­˜å‚¨

#### å½’æ¡£å­˜å‚¨(Archive)

- **é€‚ç”¨åœºæ™¯**ï¼šæ¯å¹´è®¿é—®å°‘äºä¸€æ¬¡çš„æ•°æ®
- **ç‰¹ç‚¹**ï¼šæœ€ä½çš„å­˜å‚¨æˆæœ¬ï¼Œæœ€é«˜çš„è®¿é—®è´¹ç”¨å’Œæ¢å¤æ—¶é—´
- **ä½¿ç”¨æ¡ˆä¾‹**ï¼šé•¿æœŸæ•°å­—ä¿å­˜ã€åˆè§„æ€§å½’æ¡£

### 2.3 å­˜å‚¨ä½ç½®å’Œè®¿é—®æ§åˆ¶

#### å­˜å‚¨ä½ç½®ç±»å‹

Cloud Storageæ”¯æŒå¤šç§å­˜å‚¨ä½ç½®ï¼š

| ä½ç½®ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|----------|------|------|
| **å¤šåŒºåŸŸ** | æ•°æ®åœ¨å¤šä¸ªåœ°ç†ä½ç½®å†—ä½™å­˜å‚¨ | `us`, `europe`, `asia` |
| **åŒåŒºåŸŸ** | æ•°æ®åœ¨ä¸¤ä¸ªç‰¹å®šåŒºåŸŸå†—ä½™å­˜å‚¨ | `us-central1`, `europe-west1` |
| **å•åŒºåŸŸ** | æ•°æ®åœ¨å•ä¸ªåŒºåŸŸå­˜å‚¨ | `us-central1`, `europe-west1` |
| **åŒºåŸŸçº§** | ç±»ä¼¼å•åŒºåŸŸï¼Œä½†å…·æœ‰ä¸åŒçš„æŒä¹…æ€§ä¿è¯ | `us-central1` |

```bash
# åˆ›å»ºä¸åŒä½ç½®çš„å­˜å‚¨æ¡¶
gsutil mb -l us -p your-project-id gs://multi-regional-bucket
gsutil mb -l US-CENTRAL1 -p your-project-id gs://regional-bucket
gsutil mb -l NAM4 -p your-project-id gs://dual-regional-bucket
```

#### è®¿é—®æ§åˆ¶æ¨¡å‹

Cloud Storageæä¾›ä¸¤ç§è®¿é—®æ§åˆ¶æ¨¡å‹ï¼š

**ç»Ÿä¸€èµ„æºçº§è®¿é—®**ï¼ˆIAMï¼‰ï¼š
- åŸºäºIAMæƒé™çš„è®¿é—®æ§åˆ¶
- æ¨èçš„æ–°æ–¹å¼
- æä¾›æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶

**ç»†ç²’åº¦è®¿é—®æ§åˆ¶**ï¼ˆACLï¼‰ï¼š
- åŸºäºå¯¹è±¡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨
- ä¼ ç»Ÿæ–¹å¼
- æ›´é€‚åˆéœ€è¦ç²¾ç»†å¯¹è±¡çº§æ§åˆ¶çš„åœºæ™¯

```bash
# ä½¿ç”¨IAMæƒé™æˆäºˆè®¿é—®æƒé™
gsutil iam ch user:example@example.com:objectViewer gs://your-bucket

# ä½¿ç”¨ACLæˆäºˆè®¿é—®æƒé™
gsutil acl ch -u example@example.com:R gs://your-bucket
```

### 2.4 é«˜çº§åŠŸèƒ½

#### ç”Ÿå‘½å‘¨æœŸç®¡ç†

è‡ªåŠ¨ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œä¼˜åŒ–æˆæœ¬ï¼š

```json
{
  "lifecycle": {
    "rule": [
      {
        "action": {"type": "Delete"},
        "condition": {
          "age": 365,
          "isLive": true
        }
      },
      {
        "action": {"type": "SetStorageClass", "storageClass": "COLDLINE"},
        "condition": {
          "age": 90,
          "matchesStorageClass": ["STANDARD", "NEARLINE"]
        }
      }
    ]
  }
}
```

```bash
# åº”ç”¨ç”Ÿå‘½å‘¨æœŸç­–ç•¥
gsutil lifecycle set lifecycle.json gs://your-bucket
```

#### å¯¹è±¡ç‰ˆæœ¬æ§åˆ¶

å¯ç”¨å¯¹è±¡ç‰ˆæœ¬æ§åˆ¶ä»¥ä¿æŠ¤æ•°æ®å…å—æ„å¤–åˆ é™¤æˆ–è¦†ç›–ï¼š

```bash
# å¯ç”¨ç‰ˆæœ¬æ§åˆ¶
gsutil versioning set on gs://your-bucket

# ç¦ç”¨ç‰ˆæœ¬æ§åˆ¶
gsutil versioning set off gs://your-bucket
```

#### å¯¹è±¡é”å®š

å®ç°ä¸å¯å˜å­˜å‚¨ï¼ˆWORMï¼‰ä»¥æ»¡è¶³åˆè§„æ€§è¦æ±‚ï¼š

```bash
# å¯ç”¨å¯¹è±¡é”å®šï¼ˆæ— æ³•ç¦ç”¨ï¼‰
gsutil retention set 30d gs://your-bucket

# è®¾ç½®äº‹ä»¶ä¿ç•™æ—¶é—´
gsutil retention event set gs://your-bucket/object-name
```

---

## 3. Cloud SQLä¸Cloud Spanner

### 3.1 Cloud SQLè¯¦è§£

Cloud SQLæ˜¯GCPçš„æ‰˜ç®¡å…³ç³»å‹æ•°æ®åº“æœåŠ¡ï¼Œæ”¯æŒMySQLã€PostgreSQLå’ŒSQL Serverã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **å®Œå…¨æ‰˜ç®¡**ï¼šè‡ªåŠ¨å¤‡ä»½ã€è¡¥ä¸ã€é«˜å¯ç”¨æ€§é…ç½®
- **é«˜å¯ç”¨æ€§**ï¼šä¸»ä»å¤åˆ¶ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»
- **è‡ªåŠ¨å¤‡ä»½**ï¼šæ—¶é—´ç‚¹æ¢å¤èƒ½åŠ›
- **æ‰©å±•æ€§**ï¼šå‚ç›´æ‰©å±•å’Œåªè¯»å‰¯æœ¬
- **å®‰å…¨æ€§**ï¼šç½‘ç»œéš”ç¦»ã€æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶

#### æ•°æ®åº“å¼•æ“æ”¯æŒ

| å¼•æ“ | ç‰ˆæœ¬æ”¯æŒ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|
| **MySQL** | 5.6, 5.7, 8.0 | Webåº”ç”¨ï¼Œé€šç”¨æ•°æ®å­˜å‚¨ |
| **PostgreSQL** | 9.6, 10, 11, 12, 13, 14 | é«˜çº§æŸ¥è¯¢ï¼Œæ•°æ®åˆ†æ |
| **SQL Server** | 2017, 2019 | ä¼ä¸šåº”ç”¨ï¼ŒWindowsç”Ÿæ€ |

#### åˆ›å»ºCloud SQLå®ä¾‹

```bash
# åˆ›å»ºMySQLå®ä¾‹
gcloud sql instances create my-mysql-instance \
  --database-version=MYSQL_8_0 \
  --tier=db-n1-standard-2 \
  --region=us-central1 \
  --storage-size=100GB \
  --storage-type=SSD \
  --backup-start-time=02:00

# åˆ›å»ºPostgreSQLå®ä¾‹
gcloud sql instances create my-postgres-instance \
  --database-version=POSTGRES_14 \
  --tier=db-n1-standard-2 \
  --region=us-central1 \
  --storage-size=100GB \
  --storage-type=SSD \
  --backup-start-time=03:00
```

#### é«˜å¯ç”¨æ€§é…ç½®

```bash
# å¯ç”¨é«˜å¯ç”¨æ€§ï¼ˆåˆ›å»ºå®ä¾‹æ—¶ï¼‰
gcloud sql instances create my-ha-instance \
  --tier=db-n1-standard-2 \
  --region=us-central1 \
  --availability-type=REGIONAL

# ç°æœ‰å®ä¾‹å¯ç”¨é«˜å¯ç”¨æ€§
gcloud sql instances patch my-instance \
  --availability-type=REGIONAL
```

#### åªè¯»å‰¯æœ¬

```bash
# åˆ›å»ºåªè¯»å‰¯æœ¬
gcloud sql instances create my-replica \
  --master-instance-name=my-mysql-instance \
  --tier=db-n1-standard-2 \
  --region=us-central1

# åˆ—å‡ºå®ä¾‹åŠå…¶å‰¯æœ¬
gcloud sql instances list --filter='masterInstanceName=my-mysql-instance'
```

### 3.2 Cloud Spannerè¯¦è§£

Cloud Spanneræ˜¯GCPçš„å…¨çƒåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œæä¾›å¼ºä¸€è‡´æ€§å’Œæ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **å…¨çƒåˆ†å¸ƒ**ï¼šæ•°æ®å¯åœ¨å…¨çƒå¤šä¸ªåŒºåŸŸå¤åˆ¶
- **å¼ºä¸€è‡´æ€§**ï¼šå¤–éƒ¨ä¸€è‡´æ€§ä¿è¯
- **æ°´å¹³æ‰©å±•**ï¼šè‡ªåŠ¨åˆ†ç‰‡å’Œè´Ÿè½½å‡è¡¡
- **SQLæ¥å£**ï¼šç†Ÿæ‚‰çš„å…³ç³»å‹æ•°æ®åº“æ¥å£
- **ACIDäº‹åŠ¡**ï¼šå®Œæ•´çš„äº‹åŠ¡æ”¯æŒ

#### ä½¿ç”¨åœºæ™¯

Cloud Spannerç‰¹åˆ«é€‚åˆï¼š

- å…¨çƒåˆ†å¸ƒå¼åº”ç”¨
- é‡‘èäº¤æ˜“ç³»ç»Ÿ
- å®æ—¶åˆ†æå·¥ä½œè´Ÿè½½
- éœ€è¦å¼ºä¸€è‡´æ€§çš„é«˜å¹¶å‘åº”ç”¨

#### åˆ›å»ºCloud Spannerå®ä¾‹

```bash
# åˆ›å»ºSpannerå®ä¾‹
gcloud spanner instances create my-spanner-instance \
  --config=regional-us-central1 \
  --description="My Spanner Instance" \
  --nodes=3

# åˆ›å»ºæ•°æ®åº“
gcloud spanner databases create my-database \
  --instance=my-spanner-instance

# åˆ›å»ºè¡¨
gcloud spanner databases ddl update my-database \
  --instance=my-spanner-instance \
  --ddl="CREATE TABLE Singers (
    SingerId INT64 NOT NULL,
    FirstName STRING(1024),
    LastName STRING(1024),
    SingerInfo BYTES(MAX),
  ) PRIMARY KEY (SingerId)"
```

#### æ•°æ®æ“ä½œ

```bash
# æ’å…¥æ•°æ®
gcloud spanner rows insert \
  --instance=my-spanner-instance \
  --database=my-database \
  --table=Singers \
  --data='SingerId=1,FirstName=Marc,LastName=Richards'

# æŸ¥è¯¢æ•°æ®
gcloud spanner databases execute-sql my-database \
  --instance=my-spanner-instance \
  --sql="SELECT * FROM Singers WHERE SingerId = 1"
```

---

## 4. NoSQLä¸å¤§æ•°æ®å­˜å‚¨

### 4.1 Firestoreè¯¦è§£

Firestoreæ˜¯GCPçš„NoSQLæ–‡æ¡£æ•°æ®åº“ï¼Œä¸“ä¸ºç§»åŠ¨å’ŒWebåº”ç”¨è®¾è®¡ï¼Œæä¾›å®æ—¶æ•°æ®åŒæ­¥å’Œç¦»çº¿æ”¯æŒã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **å®æ—¶ç›‘å¬**ï¼šæ•°æ®å˜æ›´è‡ªåŠ¨æ¨é€ç»™å®¢æˆ·ç«¯
- **ç¦»çº¿æ”¯æŒ**ï¼šåº”ç”¨å¯åœ¨ç¦»çº¿çŠ¶æ€ä¸‹ç»§ç»­å·¥ä½œ
- **è‡ªåŠ¨æ‰©å±•**ï¼šæ— éœ€ç®¡ç†æœåŠ¡å™¨æˆ–åˆ†ç‰‡
- **å®‰å…¨è§„åˆ™**ï¼šç»†ç²’åº¦çš„æ•°æ®è®¿é—®æ§åˆ¶
- **å¤šåŒºåŸŸå¤åˆ¶**ï¼šæ•°æ®åœ¨å¤šä¸ªåŒºåŸŸè‡ªåŠ¨å¤åˆ¶

#### æ•°æ®æ¨¡å‹

Firestoreä½¿ç”¨æ–‡æ¡£-é›†åˆæ•°æ®æ¨¡å‹ï¼š

```mermaid
graph TB
    A[æ•°æ®åº“] --> B[é›†åˆ]
    A --> C[é›†åˆ]
    
    B --> D[æ–‡æ¡£1]
    B --> E[æ–‡æ¡£2]
    B --> F[æ–‡æ¡£3]
    
    D --> G[å­—æ®µ]
    D --> H[å­é›†åˆ]
    
    H --> I[å­æ–‡æ¡£1]
    H --> J[å­æ–‡æ¡£2]
```

#### åˆ›å»ºå’Œé…ç½®Firestore

```bash
# åˆ›å»ºFirestoreæ•°æ®åº“
gcloud firestore databases create \
  --region=us-central1 \
  --type=Native

# è®¾ç½®ç´¢å¼•
cat > firestore.indexes.json <<EOF
{
  "indexes": [
    {
      "collectionGroup": "posts",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "author",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "timestamp",
          "order": "DESCENDING"
        }
      ]
    }
  ],
  "fieldOverrides": []
}
EOF

gcloud firestore indexes composite create \
  --database=your-database-id \
  --collection-group=posts \
  --field-config=field=author,order=ASCENDING \
  --field-config=field=timestamp,order=DESCENDING
```

### 4.2 Bigtableè¯¦è§£

Bigtableæ˜¯GCPçš„å®½åˆ—NoSQLæ•°æ®åº“ï¼Œä¸“ä¸ºå¤§è§„æ¨¡æ•°æ®è®¾è®¡ï¼Œæä¾›é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **é«˜æ€§èƒ½**ï¼šä½å»¶è¿Ÿè¯»å†™æ“ä½œ
- **å¤§è§„æ¨¡**ï¼šPBçº§æ•°æ®å­˜å‚¨èƒ½åŠ›
- **é«˜å¯ç”¨æ€§**ï¼šè‡ªåŠ¨å¤åˆ¶å’Œæ•…éšœè½¬ç§»
- **çµæ´»çš„Schema**ï¼šåŠ¨æ€åˆ—æ—è®¾è®¡
- **Hadoopå…¼å®¹**ï¼šä¸Hadoopç”Ÿæ€ç³»ç»Ÿé›†æˆ

#### ä½¿ç”¨åœºæ™¯

Bigtableç‰¹åˆ«é€‚åˆï¼š

- æ—¶é—´åºåˆ—æ•°æ®
- IoTæ•°æ®åˆ†æ
- é‡‘èæ•°æ®åˆ†æ
- å®æ—¶åˆ†æç³»ç»Ÿ
- åœ°ç†ç©ºé—´æ•°æ®

#### åˆ›å»ºBigtableå®ä¾‹

```bash
# åˆ›å»ºBigtableå®ä¾‹
gcloud bigtable instances create my-bt-instance \
  --cluster=bt-cluster \
  --cluster-zone=us-central1-a \
  --display-name="My Bigtable Instance" \
  --instance-type=DEVELOPMENT \
  --description="Development instance"

# åˆ›å»ºè¡¨
cbt -instance=my-bt-instance createtable my-table

# åˆ›å»ºåˆ—æ—
cbt -instance=my-bt-instance createfamily my-table cf1
cbt -instance=my-bt-instance createfamily my-table cf2
```

#### æ•°æ®æ“ä½œ

```bash
# æ’å…¥æ•°æ®
cbt -instance=my-bt-instance set my-table r1 cf1:col1=value1
cbt -instance=my-bt-instance set my-table r1 cf2:col2=value2

# è¯»å–æ•°æ®
cbt -instance=my-bt-instance read my-table

# åˆ é™¤æ•°æ®
cbt -instance=my-bt-instance deleterow my-table r1
```

---

## 5. æ•°æ®è¿ç§»ä¸ç®¡ç†

### 5.1 æ•°æ®è¿ç§»ç­–ç•¥

å°†æ•°æ®è¿ç§»åˆ°GCPæ—¶ï¼Œéœ€è¦æ ¹æ®æ•°æ®ç±»å‹ã€å¤§å°å’Œè¿ç§»çª—å£é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼š

#### è¿ç§»å·¥å…·é€‰æ‹©

| å·¥å…· | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|------|----------|------|
| **Storage Transfer Service** | å¯¹è±¡å­˜å‚¨è¿ç§» | å®šæœŸä¼ è¾“ï¼Œè‡ªåŠ¨è°ƒåº¦ |
| **Transfer Appliance** | å¤§è§„æ¨¡ç‰©ç†è¿ç§» | PBçº§æ•°æ®ï¼Œç¦»çº¿ä¼ è¾“ |
| **Database Migration Service** | æ•°æ®åº“è¿ç§» | æŒç»­å¤åˆ¶ï¼Œæœ€å°åœæœºæ—¶é—´ |
| **gsutil** | ç®€å•å¯¹è±¡è¿ç§» | å‘½ä»¤è¡Œå·¥å…·ï¼Œé€‚åˆå°è§„æ¨¡æ•°æ® |
| **Dataflow** | å¤æ‚æ•°æ®è½¬æ¢ | ETLå¤„ç†ï¼Œæ•°æ®è½¬æ¢ |

#### è¿ç§»æ­¥éª¤

1. **è¯„ä¼°é˜¶æ®µ**
   - è¯†åˆ«æ•°æ®ç±»å‹å’Œå¤§å°
   - è¯„ä¼°ç½‘ç»œå¸¦å®½å’Œè¿ç§»æ—¶é—´
   - é€‰æ‹©åˆé€‚çš„è¿ç§»å·¥å…·
   - è§„åˆ’è¿ç§»çª—å£å’Œå›æ»šç­–ç•¥

2. **å‡†å¤‡é˜¶æ®µ**
   - è®¾ç½®æºå’Œç›®æ ‡å­˜å‚¨
   - é…ç½®ç½‘ç»œè¿æ¥
   - æµ‹è¯•å°è§„æ¨¡è¿ç§»
   - å‡†å¤‡ç›‘æ§å’Œå‘Šè­¦

3. **æ‰§è¡Œé˜¶æ®µ**
   - å¼€å§‹åˆå§‹æ•°æ®ä¼ è¾“
   - ç›‘æ§ä¼ è¾“è¿›åº¦å’Œé”™è¯¯
   - æ‰§è¡Œå¢é‡åŒæ­¥
   - æ‰§è¡Œæœ€ç»ˆåˆ‡æ¢

4. **éªŒè¯é˜¶æ®µ**
   - éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§
   - æµ‹è¯•åº”ç”¨ç¨‹åºåŠŸèƒ½
   - ç›‘æ§æ€§èƒ½æŒ‡æ ‡
   - æ¸…ç†æ—§ç¯å¢ƒèµ„æº

### 5.2 å¤‡ä»½ä¸æ¢å¤

#### Cloud Storageå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > backup.sh <<EOF
#!/bin/bash
DATE=\$(date +%Y%m%d)
BUCKET=gs://my-backup-bucket
SOURCE_DIR=/path/to/important/data

# åˆ›å»ºå‹ç¼©å¤‡ä»½
tar -czf /tmp/backup-\${DATE}.tar.gz \$SOURCE_DIR

# ä¸Šä¼ åˆ°Cloud Storage
gsutil cp /tmp/backup-\${DATE}.tar.gz \$BUCKET/backups/

# è®¾ç½®ç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼ˆä¿ç•™30å¤©ï¼‰
gsutil lifecycle set lifecycle.json \$BUCKET

echo "Backup completed: \$BUCKET/backups/backup-\${DATE}.tar.gz"
EOF

chmod +x backup.sh

# åˆ›å»ºç”Ÿå‘½å‘¨æœŸé…ç½®
cat > lifecycle.json <<EOF
{
  "rule": [
    {
      "action": {"type": "Delete"},
      "condition": {
        "age": 30
      }
    }
  ]
}
EOF
```

#### Cloud SQLå¤‡ä»½

```bash
# åˆ›å»ºæŒ‰éœ€å¤‡ä»½
gcloud sql backups create \
  --instance=my-mysql-instance \
  --description="Manual backup before deployment"

# åˆ—å‡ºå¤‡ä»½
gcloud sql backups list --instance=my-mysql-instance

# æ¢å¤å¤‡ä»½
gcloud sql backups restore BACKUP_ID \
  --restore-instance=my-restored-instance
```

### 5.3 æ•°æ®å®‰å…¨ç®¡ç†

#### åŠ å¯†ç­–ç•¥

```bash
# åˆ›å»ºå®¢æˆ·ç®¡ç†çš„åŠ å¯†å¯†é’¥
gcloud kms keyrings create my-key-ring --location=us-central1
gcloud kms keys create my-key --keyring=my-key-ring \
  --location=us-central1 --purpose=encryption

# ä½¿ç”¨å®¢æˆ·ç®¡ç†çš„å¯†é’¥åˆ›å»ºå­˜å‚¨æ¡¶
gsutil kms encryption -k projects/my-project/locations/us-central1/keyRings/my-key-ring/cryptoKeys/my-key \
  gs://my-encrypted-bucket
```

#### è®¿é—®æ§åˆ¶

```bash
# è®¾ç½®IAMç­–ç•¥
gsutil iam ch serviceAccount:my-service-account@my-project.iam.gserviceaccount.com:objectViewer \
  gs://my-sensitive-data-bucket

# è®¾ç½®ç»Ÿä¸€çš„å­˜å‚¨æ¡¶ç­–ç•¥
cat > bucket-policy.json <<EOF
{
  "bindings": [
    {
      "role": "roles/storage.objectViewer",
      "members": [
        "serviceAccount:data-reader@my-project.iam.gserviceaccount.com"
      ]
    },
    {
      "role": "roles/storage.objectAdmin",
      "members": [
        "serviceAccount:data-admin@my-project.iam.gserviceaccount.com"
      ]
    }
  ]
}
EOF

gsutil iam set bucket-policy.json gs://my-secured-bucket
```

---

## 6. å®éªŒï¼šæ„å»ºå¤šå±‚æ•°æ®æ¶æ„

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç»¼åˆå®éªŒï¼Œå®è·µæœ¬ç« å­¦ä¹ çš„å­˜å‚¨å’Œæ•°æ®åº“æœåŠ¡ã€‚

### å®éªŒç›®æ ‡

é€šè¿‡æœ¬å®éªŒï¼Œæ‚¨å°†ï¼š

1. ä½¿ç”¨Cloud Storageæ„å»ºå¤šå±‚çº§å­˜å‚¨ç³»ç»Ÿ
2. éƒ¨ç½²Cloud SQLæ•°æ®åº“å¹¶é…ç½®é«˜å¯ç”¨æ€§
3. ä½¿ç”¨Firestoreå­˜å‚¨åº”ç”¨å…ƒæ•°æ®
4. è®¾ç½®è‡ªåŠ¨æ•°æ®å¤‡ä»½å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
5. é…ç½®æ•°æ®è®¿é—®æ§åˆ¶å’Œå®‰å…¨æ€§

### å®éªŒæ¶æ„

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿçš„å¤šå±‚æ•°æ®æ¶æ„ï¼š

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A[Webåº”ç”¨] --> B[APIæœåŠ¡]
    end
    
    subgraph "ç¼“å­˜å±‚"
        C[Memorystore] --> D[Redisç¼“å­˜]
    end
    
    subgraph "æ•°æ®å±‚"
        E[Cloud SQL] --> F[ç”¨æˆ·å’Œå†…å®¹æ•°æ®]
        G[Firestore] --> H[å…ƒæ•°æ®å’Œé…ç½®]
        I[Cloud Storage] --> J[åª’ä½“æ–‡ä»¶]
        I --> K[é™æ€èµ„æº]
        I --> L[å¤‡ä»½å­˜æ¡£]
    end
    
    A --> C
    B --> C
    A --> E
    B --> E
    A --> G
    B --> G
    A --> I
    B --> I
```

### å‰ææ¡ä»¶

- å·²åˆ›å»ºGCPé¡¹ç›®å’Œè®¡è´¹è´¦æˆ·
- å·²å¯ç”¨å¿…è¦çš„GCP API
- å·²å®‰è£…gcloud CLI

### å®éªŒæ­¥éª¤

#### æ­¥éª¤1ï¼šåˆ›å»ºCloud Storageå¤šå±‚çº§å­˜å‚¨

```bash
# è®¾ç½®å˜é‡
export PROJECT_ID=$(gcloud config get-value project)

# åˆ›å»ºæ ‡å‡†å­˜å‚¨æ¡¶ï¼ˆç”¨äºé¢‘ç¹è®¿é—®çš„åª’ä½“æ–‡ä»¶ï¼‰
gsutil mb -l us-central1 -p ${PROJECT_ID} gs://blog-media-standard

# åˆ›å»ºè¿‘çº¿å­˜å‚¨æ¡¶ï¼ˆç”¨äºä¸é¢‘ç¹è®¿é—®çš„å†å²æ•°æ®ï¼‰
gsutil mb -l us-central1 -p ${PROJECT_ID} -c nearline gs://blog-media-nearline

# åˆ›å»ºå†·çº¿å­˜å‚¨æ¡¶ï¼ˆç”¨äºé•¿æœŸå½’æ¡£æ•°æ®ï¼‰
gsutil mb -l us-central1 -p ${PROJECT_ID} -c coldline gs://blog-media-coldline

# åˆ›å»ºå¤‡ä»½å­˜å‚¨æ¡¶
gsutil mb -l us-central1 -p ${PROJECT_ID} gs://blog-backups

# è®¾ç½®æ ‡å‡†å­˜å‚¨æ¡¶çš„ç”Ÿå‘½å‘¨æœŸç­–ç•¥
cat > standard-lifecycle.json <<EOF
{
  "lifecycle": {
    "rule": [
      {
        "action": {"type": "SetStorageClass", "storageClass": "NEARLINE"},
        "condition": {
          "age": 30,
          "matchesStorageClass": ["STANDARD"]
        }
      },
      {
        "action": {"type": "SetStorageClass", "storageClass": "COLDLINE"},
        "condition": {
          "age": 90,
          "matchesStorageClass": ["NEARLINE"]
        }
      }
    ]
  }
}
EOF

gsutil lifecycle set standard-lifecycle.json gs://blog-media-standard

# è®¾ç½®å¤‡ä»½å­˜å‚¨æ¡¶çš„ç”Ÿå‘½å‘¨æœŸç­–ç•¥
cat > backup-lifecycle.json <<EOF
{
  "lifecycle": {
    "rule": [
      {
        "action": {"type": "Delete"},
        "condition": {
          "age": 365,
          "isLive": true
        }
      }
    ]
  }
}
EOF

gsutil lifecycle set backup-lifecycle.json gs://blog-backups

# å¯ç”¨ç‰ˆæœ¬æ§åˆ¶ä¿æŠ¤åª’ä½“æ–‡ä»¶
gsutil versioning set on gs://blog-media-standard
gsutil versioning set on gs://blog-media-nearline
```

#### æ­¥éª¤2ï¼šéƒ¨ç½²Cloud SQLæ•°æ®åº“

```bash
# åˆ›å»ºMySQLæ•°æ®åº“å®ä¾‹ï¼ˆä¸»å®ä¾‹ï¼‰
gcloud sql instances create blog-db-primary \
  --database-version=MYSQL_8_0 \
  --tier=db-n1-standard-2 \
  --region=us-central1 \
  --storage-size=100GB \
  --storage-type=SSD \
  --backup-start-time=02:00 \
  --retained-backups-count=7 \
  --enable-bin-log \
  --availability-type=REGIONAL

# åˆ›å»ºåªè¯»å‰¯æœ¬
gcloud sql instances create blog-db-replica \
  --master-instance-name=blog-db-primary \
  --tier=db-n1-standard-1 \
  --region=us-central1

# åˆ›å»ºæ•°æ®åº“
gcloud sql databases create blog_db --instance blog-db-primary

# åˆ›å»ºæ•°æ®åº“ç”¨æˆ·
gcloud sql users create blog_user --instance blog-db-primary --password=secure_password

# å¯¼å…¥ç¤ºä¾‹æ•°æ®
wget https://example.com/blog_dump.sql
gcloud sql import sql blog_db gs://bucket-name/blog_dump.sql --instance blog-db-primary
```

#### æ­¥éª¤3ï¼šè®¾ç½®Firestoreæ•°æ®åº“

```bash
# åˆ›å»ºFirestoreæ•°æ®åº“
gcloud firestore databases create \
  --region=us-central1 \
  --type=Native

# åˆ›å»ºé›†åˆå’Œæ–‡æ¡£
cat > init_firestore.py <<EOF
from google.cloud import firestore

# åˆå§‹åŒ–Firestoreå®¢æˆ·ç«¯
db = firestore.Client()

# åˆ›å»ºç”¨æˆ·é›†åˆå’Œç¤ºä¾‹ç”¨æˆ·
users_ref = db.collection(u'users')
users_ref.add({
    u'name': u'John Doe',
    u'email': u'john.doe@example.com',
    u'role': u'editor',
    u'created_at': firestore.SERVER_TIMESTAMP
})

# åˆ›å»ºé…ç½®é›†åˆå’Œç¤ºä¾‹é…ç½®
config_ref = db.collection(u'config')
config_ref.document(u'site_settings').set({
    u'site_name': u'My Blog',
    u'theme': u'default',
    u'language': u'en',
    u'max_upload_size': 10485760,  # 10MB
    u'updated_at': firestore.SERVER_TIMESTAMP
})

print("Firestore initialized successfully")
EOF

python init_firestore.py
```

#### æ­¥éª¤4ï¼šé…ç½®æ•°æ®è®¿é—®æ§åˆ¶

```bash
# åˆ›å»ºæœåŠ¡è´¦æˆ·
gcloud iam service-accounts create blog-app \
  --display-name="Blog Application Service Account"

# æˆäºˆCloud Storageè®¿é—®æƒé™
gsutil iam ch serviceAccount:blog-app@${PROJECT_ID}.iam.gserviceaccount.com:objectViewer \
  gs://blog-media-standard
gsutil iam ch serviceAccount:blog-app@${PROJECT_ID}.iam.gserviceaccount.com:objectViewer \
  gs://blog-media-nearline

# æˆäºˆCloud SQLè®¿é—®æƒé™
gcloud sql users set-password blog-app --instance blog-db-primary \
  --password=secure_app_password --host='%'

# æˆäºˆFirestoreè®¿é—®æƒé™
gcloud projects add-iam-policy-binding ${PROJECT_ID} \
  --member="serviceAccount:blog-app@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="roles/datastore.user"
```

#### æ­¥éª¤5ï¼šè®¾ç½®è‡ªåŠ¨å¤‡ä»½å’Œç›‘æ§

```bash
# åˆ›å»ºæ•°æ®å¤‡ä»½è„šæœ¬
cat > backup_data.sh <<EOF
#!/bin/bash

PROJECT_ID=\$(gcloud config get-value project)
DATE=\$(date +%Y%m%d_%H%M%S)

echo "Starting backup process at \$(date)"

# å¤‡ä»½Cloud SQLæ•°æ®åº“
echo "Creating Cloud SQL backup..."
gcloud sql backups create --instance blog-db-primary \
  --description "Scheduled backup on \${DATE}"

# å¤‡ä»½Cloud Storageä¸­çš„å…³é”®æ•°æ®
echo "Archiving important files to backup bucket..."
gsutil -m cp -r gs://blog-media-standard/uploads/\${DATE} gs://blog-backups/

# å¤‡ä»½Firestoreæ•°æ®
echo "Exporting Firestore data..."
gcloud firestore export gs://blog-backups/firestore-\${DATE} \
  --async

echo "Backup process completed"
EOF

chmod +x backup_data.sh

# åˆ›å»ºCloud Schedulerä½œä¸šæ‰§è¡Œå®šæœŸå¤‡ä»½
gcloud scheduler jobs create http blog-backup-job \
  --schedule="0 2 * * *" \
  --http-method=POST \
  --uri=https://us-central1-${PROJECT_ID}.cloudfunctions.net/backupData \
  --time-zone="America/New_York" \
  --description="Daily blog data backup"

# åˆ›å»ºç›‘æ§å‘Šè­¦
gcloud monitoring alert-policies create \
  --notification-channels=[EMAIL_NOTIFICATION_CHANNEL_ID] \
  --condition-display-name="Cloud SQL storage usage high" \
  --condition-filter='metric.type="cloudsql.googleapis.com/database/storage/usage" AND resource.type="cloudsql_database"' \
  --condition-threshold-value=80 \
  --condition-threshold-comparison=COMPARISON_GT \
  --condition-duration=300s
```

#### æ­¥éª¤6ï¼šåˆ›å»ºæ•°æ®è®¿é—®åº”ç”¨ç¨‹åº

```javascript
// app.js - Node.jsåº”ç”¨ç¨‹åºç¤ºä¾‹
const express = require('express');
const { Storage } = require('@google-cloud/storage');
const { Firestore } = require('@google-cloud/firestore');
const mysql = require('mysql2/promise');
const app = express();

// åˆå§‹åŒ–GCPå®¢æˆ·ç«¯
const storage = new Storage();
const firestore = new Firestore();
const mediaBucket = storage.bucket('blog-media-standard');

// æ•°æ®åº“è¿æ¥é…ç½®
const dbConfig = {
  host: process.env.DB_HOST || 'localhost',
  user: process.env.DB_USER || 'blog_user',
  password: process.env.DB_PASSWORD,
  database: 'blog_db'
};

// è·å–æ–‡ç« åˆ—è¡¨
app.get('/api/posts', async (req, res) => {
  try {
    const connection = await mysql.createConnection(dbConfig);
    const [rows] = await connection.execute(
      'SELECT p.*, u.name as author_name FROM posts p JOIN users u ON p.author_id = u.id ORDER BY p.created_at DESC'
    );
    await connection.end();
    res.json(rows);
  } catch (error) {
    console.error('Error fetching posts:', error);
    res.status(500).json({ error: 'Database error' });
  }
});

// ä¸Šä¼ åª’ä½“æ–‡ä»¶
app.post('/api/upload', async (req, res) => {
  try {
    if (!req.files || Object.keys(req.files).length === 0) {
      return res.status(400).json({ error: 'No files were uploaded.' });
    }

    const uploadedFile = req.files.file;
    const fileName = `${Date.now()}-${uploadedFile.name}`;
    const file = mediaBucket.file(fileName);

    await file.save(uploadedFile.data, {
      metadata: { contentType: uploadedFile.mimetype },
      resumable: false
    });

    const fileUrl = `https://storage.googleapis.com/${mediaBucket.name}/${fileName}`;
    res.json({ url: fileUrl });
  } catch (error) {
    console.error('Error uploading file:', error);
    res.status(500).json({ error: 'Upload error' });
  }
});

// è·å–ç«™ç‚¹é…ç½®
app.get('/api/config', async (req, res) => {
  try {
    const doc = await firestore.collection('config').doc('site_settings').get();
    if (!doc.exists) {
      return res.status(404).json({ error: 'Configuration not found' });
    }
    res.json(doc.data());
  } catch (error) {
    console.error('Error fetching config:', error);
    res.status(500).json({ error: 'Firestore error' });
  }
});

const PORT = process.env.PORT || 8080;
app.listen(PORT, () => {
  console.log(`Blog API server listening on port ${PORT}`);
});
```

#### æ­¥éª¤7ï¼šæµ‹è¯•å’ŒéªŒè¯

```bash
# æµ‹è¯•Cloud Storage
echo "Test content" > test.txt
gsutil cp test.txt gs://blog-media-standard/
gsutil ls gs://blog-media-standard/

# æµ‹è¯•Cloud SQLè¿æ¥
gcloud sql connect blog-db-primary --user=blog_user

# æµ‹è¯•Firestore
python -c "
from google.cloud import firestore
db = firestore.Client()
docs = db.collection(u'config').stream()
for doc in docs:
    print(f'{doc.id} => {doc.to_dict()}')
"

# æ£€æŸ¥å¤‡ä»½ç­–ç•¥
gsutil lifecycle get gs://blog-media-standard
gcloud sql backups list --instance blog-db-primary
```

#### æ­¥éª¤8ï¼šæ¸…ç†èµ„æº

```bash
# åˆ é™¤Cloud SQLå®ä¾‹
gcloud sql instances delete blog-db-primary --cascade
gcloud sql instances delete blog-db-replica

# åˆ é™¤å­˜å‚¨æ¡¶
gsutil -m rm -r gs://blog-media-standard
gsutil -m rm -r gs://blog-media-nearline
gsutil -m rm -r gs://blog-media-coldline
gsutil -m rm -r gs://blog-backups

# åˆ é™¤Firestoreæ•°æ®åº“ï¼ˆä¸å¯é€†ï¼Œè°¨æ…æ“ä½œï¼‰
gcloud firestore databases delete --instance=default

# åˆ é™¤æœåŠ¡è´¦æˆ·
gcloud iam service-accounts delete blog-app@${PROJECT_ID}.iam.gserviceaccount.com
```

### å®éªŒæ€»ç»“

é€šè¿‡è¿™ä¸ªå®éªŒï¼Œæ‚¨å·²ç»ï¼š

1. **æ„å»ºäº†å¤šå±‚çº§å­˜å‚¨ç³»ç»Ÿ**ï¼Œä½¿ç”¨ä¸åŒå­˜å‚¨ç±»åˆ«ä¼˜åŒ–æˆæœ¬
2. **éƒ¨ç½²äº†é«˜å¯ç”¨Cloud SQLæ•°æ®åº“**ï¼Œé…ç½®äº†åªè¯»å‰¯æœ¬å’Œè‡ªåŠ¨å¤‡ä»½
3. **è®¾ç½®äº†Firestoreæ•°æ®åº“**ï¼Œå­˜å‚¨åº”ç”¨å…ƒæ•°æ®å’Œé…ç½®ä¿¡æ¯
4. **é…ç½®äº†è®¿é—®æ§åˆ¶**ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ€§
5. **å®ç°äº†è‡ªåŠ¨å¤‡ä»½ç­–ç•¥**ï¼Œä¿æŠ¤å…³é”®æ•°æ®

è¿™ä¸ªå®éªŒå±•ç¤ºäº†å¦‚ä½•æ ¹æ®æ•°æ®ç‰¹æ€§å’Œè®¿é—®æ¨¡å¼ï¼Œé€‰æ‹©åˆé€‚çš„GCPå­˜å‚¨æœåŠ¡æ„å»ºå®Œæ•´çš„æ•°æ®æ¶æ„ã€‚

---

## ğŸ“š æœ¬ç« å°ç»“

æœ¬ç« æˆ‘ä»¬å­¦ä¹ äº†ï¼š

1. **GCPå­˜å‚¨æœåŠ¡æ¦‚è§ˆ**ï¼šä¸åŒå­˜å‚¨æœåŠ¡çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯
2. **Cloud Storageè¯¦è§£**ï¼šå¯¹è±¡å­˜å‚¨ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œè®¿é—®æ§åˆ¶
3. **Cloud SQLä¸Cloud Spanner**ï¼šå…³ç³»å‹æ•°æ®åº“æœåŠ¡
4. **NoSQLä¸å¤§æ•°æ®å­˜å‚¨**ï¼šFirestoreå’ŒBigtable
5. **æ•°æ®è¿ç§»ä¸ç®¡ç†**ï¼šæ•°æ®è¿ç§»ç­–ç•¥ã€å¤‡ä»½æ¢å¤å’Œå®‰å…¨ç®¡ç†
6. **ç»¼åˆå®éªŒ**ï¼šæ„å»ºå¤šå±‚æ•°æ®æ¶æ„

### ğŸ¯ å…³é”®çŸ¥è¯†ç‚¹å›é¡¾

- **Cloud Storage** æ˜¯å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œé€‚åˆéç»“æ„åŒ–æ•°æ®å’Œå¤šå±‚çº§å­˜å‚¨
- **Cloud SQL** æ˜¯æ‰˜ç®¡å…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒMySQLã€PostgreSQLå’ŒSQL Server
- **Cloud Spanner** æ˜¯å…¨çƒåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œæä¾›å¼ºä¸€è‡´æ€§å’Œæ°´å¹³æ‰©å±•
- **Firestore** æ˜¯æ–‡æ¡£æ•°æ®åº“ï¼Œä¸“ä¸ºå®æ—¶åº”ç”¨å’Œç§»åŠ¨åº”ç”¨è®¾è®¡
- **Bigtable** æ˜¯å®½åˆ—NoSQLæ•°æ®åº“ï¼Œé€‚åˆå¤§è§„æ¨¡æ—¶åºæ•°æ®
- **æ•°æ®è¿ç§»** éœ€è¦æ ¹æ®æ•°æ®ç‰¹æ€§å’Œè¿ç§»çª—å£é€‰æ‹©åˆé€‚çš„ç­–ç•¥å’Œå·¥å…·

### ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å¯ä»¥ï¼š

1. æ·±å…¥å®è·µå„ç§å­˜å‚¨æœåŠ¡çš„é«˜çº§åŠŸèƒ½
2. æ¢ç´¢æ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ æœåŠ¡çš„é›†æˆ
3. ç»§ç»­å­¦ä¹ ä¸‹ä¸€ç« "ç½‘ç»œä¸å®‰å…¨æœåŠ¡"
4. å°è¯•å®Œæˆ[å­˜å‚¨æ¡¶ç¤ºä¾‹](./code/storage-buckets/)å’Œ[æ•°æ®åº“ç¤ºä¾‹](./code/database-setup/)ä¸­çš„æ›´å¤šå®éªŒ

---

## ğŸ“– å»¶ä¼¸é˜…è¯»

- [Cloud Storage æ–‡æ¡£](https://cloud.google.com/storage/docs)
- [Cloud SQL æ–‡æ¡£](https://cloud.google.com/sql/docs)
- [Cloud Spanner æ–‡æ¡£](https://cloud.google.com/spanner/docs)
- [Firestore æ–‡æ¡£](https://cloud.google.com/firestore/docs)
- [Bigtable æ–‡æ¡£](https://cloud.google.com/bigtable/docs)

---

**ğŸ’¡ æç¤ºï¼šè®¾è®¡æ•°æ®æ¶æ„æ—¶ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘æ•°æ®ç±»å‹ã€è®¿é—®æ¨¡å¼ã€ä¸€è‡´æ€§è¦æ±‚ã€æˆæœ¬å’Œå®‰å…¨æ€§ç­‰å› ç´ ã€‚æ²¡æœ‰ä¸€ç§å­˜å‚¨æ–¹æ¡ˆé€‚åˆæ‰€æœ‰åœºæ™¯ï¼Œåˆç†é€‰æ‹©å’Œç»„åˆä¸åŒæœåŠ¡æ˜¯å…³é”®ã€‚**