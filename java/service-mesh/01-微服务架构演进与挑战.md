# 01-å¾®æœåŠ¡æ¶æ„æ¼”è¿›ä¸æŒ‘æˆ˜

## ğŸ“š æœ¬ç« æ¦‚è¿°

æœ¬ç« å°†ç³»ç»Ÿä»‹ç»å¾®æœåŠ¡æ¶æ„çš„æ¼”è¿›å†ç¨‹ã€æ ¸å¿ƒæ¦‚å¿µä»¥åŠåœ¨å®é™…åº”ç”¨ä¸­é¢ä¸´çš„æŒ‘æˆ˜ï¼Œä¸ºç†è§£ Service Mesh çš„å¿…è¦æ€§å¥ å®šåŸºç¡€ã€‚

## ğŸ•°ï¸ æ¶æ„æ¼”è¿›å†ç¨‹

### 1.1 å•ä½“æ¶æ„æ—¶ä»£

#### 1.1.1 å•ä½“æ¶æ„ç‰¹ç‚¹
- **å•ä¸€ä»£ç åº“**: æ‰€æœ‰åŠŸèƒ½æ¨¡å—é›†ä¸­åœ¨ä¸€ä¸ªåº”ç”¨ä¸­
- **ç»Ÿä¸€éƒ¨ç½²**: æ•´ä¸ªåº”ç”¨ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œéƒ¨ç½²
- **å…±äº«æ•°æ®åº“**: æ‰€æœ‰æ¨¡å—è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“
- **æŠ€æœ¯æ ˆç»Ÿä¸€**: ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯æ¡†æ¶å’Œè¯­è¨€

#### 1.1.2 å•ä½“æ¶æ„ä¼˜åŠ¿
```java
// å•ä½“åº”ç”¨ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ
public class EcommerceApplication {
    // ç”¨æˆ·ç®¡ç†æ¨¡å—
    public class UserService { /* ... */ }
    
    // å•†å“ç®¡ç†æ¨¡å—
    public class ProductService { /* ... */ }
    
    // è®¢å•ç®¡ç†æ¨¡å—
    public class OrderService { /* ... */ }
    
    // æ”¯ä»˜ç®¡ç†æ¨¡å—
    public class PaymentService { /* ... */ }
}
```

**ä¼˜ç‚¹ï¼š**
- å¼€å‘ç®€å•ï¼Œæ˜“äºç†è§£
- éƒ¨ç½²è¿ç»´ç®€å•
- äº‹åŠ¡ä¸€è‡´æ€§å®¹æ˜“ä¿è¯
- æŠ€æœ¯æ ˆç»Ÿä¸€ï¼Œå­¦ä¹ æˆæœ¬ä½

#### 1.1.3 å•ä½“æ¶æ„æŒ‘æˆ˜
- **ä»£ç è†¨èƒ€**: ä»£ç åº“è¶Šæ¥è¶Šå¤§ï¼Œéš¾ä»¥ç»´æŠ¤
- **æŠ€æœ¯å€ºåŠ¡**: æŠ€æœ¯æ ˆéš¾ä»¥å‡çº§
- **æ‰©å±•å›°éš¾**: æ— æ³•æŒ‰æ¨¡å—è¿›è¡Œæ‰©å±•
- **å›¢é˜Ÿåä½œ**: å¤šäººå¼€å‘å®¹æ˜“å†²çª

### 1.2 SOA æ¶æ„æ—¶ä»£

#### 1.2.1 SOA æ ¸å¿ƒæ¦‚å¿µ
- **æœåŠ¡åŒ–**: å°†ä¸šåŠ¡åŠŸèƒ½å°è£…ä¸ºæœåŠ¡
- **æ¾è€¦åˆ**: æœåŠ¡ä¹‹é—´é€šè¿‡æ ‡å‡†æ¥å£é€šä¿¡
- **å¯é‡ç”¨**: æœåŠ¡å¯ä»¥è¢«å¤šä¸ªåº”ç”¨è°ƒç”¨
- **æ ‡å‡†åŒ–**: ä½¿ç”¨æ ‡å‡†åè®®ï¼ˆSOAPã€WSDLï¼‰

#### 1.2.2 SOA æ¶æ„å®ç°
```xml
<!-- SOAP Web Service ç¤ºä¾‹ -->
<wsdl:definitions>
    <wsdl:service name="UserService">
        <wsdl:port binding="tns:UserServiceSoapBinding" name="UserServicePort">
            <soap:address location="http://example.com/userservice"/>
        </wsdl:port>
    </wsdl:service>
</wsdl:definitions>
```

**SOA æ¶æ„ç»„æˆï¼š**
- **ESB (ä¼ä¸šæœåŠ¡æ€»çº¿)**: æœåŠ¡ç¼–æ’å’Œæ¶ˆæ¯è·¯ç”±
- **æœåŠ¡æ³¨å†Œä¸­å¿ƒ**: æœåŠ¡å‘ç°å’Œç®¡ç†
- **æœåŠ¡æ²»ç†**: ç›‘æ§ã€å®‰å…¨ã€é™æµç­‰

#### 1.2.3 SOA æ¶æ„é—®é¢˜
- **å¤æ‚æ€§é«˜**: ESB æˆä¸ºå•ç‚¹æ•…éšœå’Œæ€§èƒ½ç“¶é¢ˆ
- **åè®®ç¬¨é‡**: SOAP/XML åè®®å¼€é”€å¤§
- **éƒ¨ç½²å¤æ‚**: éœ€è¦ä¸“é—¨çš„ä¸­é—´ä»¶æ”¯æŒ
- **çµæ´»æ€§å·®**: éš¾ä»¥é€‚åº”å¿«é€Ÿå˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚

### 1.3 å¾®æœåŠ¡æ¶æ„æ—¶ä»£

#### 1.3.1 å¾®æœåŠ¡æ ¸å¿ƒåŸåˆ™
```
1. å•ä¸€èŒè´£åŸåˆ™ï¼šæ¯ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½
2. å›´ç»•ä¸šåŠ¡èƒ½åŠ›ç»„ç»‡ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†æœåŠ¡è¾¹ç•Œ
3. äº§å“è€Œéé¡¹ç›®æ€ç»´ï¼šå›¢é˜Ÿå¯¹æœåŠ¡å…¨ç”Ÿå‘½å‘¨æœŸè´Ÿè´£
4. æ™ºèƒ½ç«¯ç‚¹ä¸å“‘ç®¡é“ï¼šæœåŠ¡è‡ªèº«åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œé€šä¿¡ç®€å•
5. å»ä¸­å¿ƒåŒ–æ²»ç†ï¼šå›¢é˜Ÿè‡ªä¸»é€‰æ‹©æŠ€æœ¯æ ˆ
6. å»ä¸­å¿ƒåŒ–æ•°æ®ç®¡ç†ï¼šæ¯ä¸ªæœåŠ¡æ‹¥æœ‰è‡ªå·±çš„æ•°æ®å­˜å‚¨
7. åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–ï¼šCI/CDã€ç›‘æ§ã€éƒ¨ç½²è‡ªåŠ¨åŒ–
8. å®¹é”™è®¾è®¡ï¼šæœåŠ¡éœ€è¦å…·å¤‡æ•…éšœéš”ç¦»èƒ½åŠ›
9. æ¼”è¿›å¼è®¾è®¡ï¼šæ¶æ„å¯ä»¥éšæ—¶é—´æ¼”è¿›
```

#### 1.3.2 å¾®æœåŠ¡æ¶æ„ç¤ºä¾‹
```yaml
# ç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åˆ’åˆ†
services:
  user-service:      # ç”¨æˆ·æœåŠ¡
    database: user_db
    tech-stack: Spring Boot + MySQL
    
  product-service:   # å•†å“æœåŠ¡
    database: product_db  
    tech-stack: Node.js + MongoDB
    
  order-service:     # è®¢å•æœåŠ¡
    database: order_db
    tech-stack: Go + PostgreSQL
    
  payment-service:   # æ”¯ä»˜æœåŠ¡
    database: payment_db
    tech-stack: Python + Redis
```

#### 1.3.3 å¾®æœåŠ¡ä¼˜åŠ¿
- **æŠ€æœ¯å¼‚æ„æ€§**: ä¸åŒæœåŠ¡å¯ä»¥ä½¿ç”¨æœ€é€‚åˆçš„æŠ€æœ¯æ ˆ
- **å¼¹æ€§æ‰©å±•**: å¯ä»¥æŒ‰éœ€æ‰©å±•å•ä¸ªæœåŠ¡
- **ç‹¬ç«‹éƒ¨ç½²**: æœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
- **æ•…éšœéš”ç¦»**: å•ä¸ªæœåŠ¡æ•…éšœä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ
- **å›¢é˜Ÿè‡ªæ²»**: å°å›¢é˜Ÿè´Ÿè´£å®Œæ•´çš„æœåŠ¡ç”Ÿå‘½å‘¨æœŸ

## ğŸ”§ å¾®æœåŠ¡æŠ€æœ¯æ ˆ

### 2.1 æœåŠ¡å¼€å‘æ¡†æ¶

#### 2.1.1 Java å¾®æœåŠ¡æ¡†æ¶
```java
// Spring Boot å¾®æœåŠ¡ç¤ºä¾‹
@SpringBootApplication
@EnableEurekaClient
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}

@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(user);
    }
}
```

**ä¸»æµ Java å¾®æœåŠ¡æ¡†æ¶ï¼š**
- **Spring Boot/Cloud**: ç”Ÿæ€å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒ
- **Micronaut**: å¯åŠ¨å¿«ï¼Œå†…å­˜å ç”¨ä½
- **Quarkus**: äº‘åŸç”Ÿä¼˜åŒ–ï¼ŒGraalVM æ”¯æŒ
- **Helidon**: Oracle å‡ºå“ï¼Œè½»é‡çº§

#### 2.1.2 æœåŠ¡é€šä¿¡æŠ€æœ¯
```java
// REST API é€šä¿¡
@FeignClient(name = "product-service")
public interface ProductServiceClient {
    
    @GetMapping("/api/products/{id}")
    Product getProduct(@PathVariable("id") Long id);
    
    @PostMapping("/api/products")
    Product createProduct(@RequestBody Product product);
}

// å¼‚æ­¥æ¶ˆæ¯é€šä¿¡
@KafkaListener(topics = "order-events")
public void handleOrderEvent(OrderEvent event) {
    // å¤„ç†è®¢å•äº‹ä»¶
    orderService.processOrder(event);
}
```

**é€šä¿¡æ–¹å¼å¯¹æ¯”ï¼š**
| é€šä¿¡æ–¹å¼ | åè®® | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|---------|------|----------|--------|
| åŒæ­¥è°ƒç”¨ | HTTP/REST | å®æ—¶æ€§è¦æ±‚é«˜ | ç®€å•ç›´è§‚ï¼Œä½†å­˜åœ¨è€¦åˆ |
| å¼‚æ­¥æ¶ˆæ¯ | Kafka/RabbitMQ | è§£è€¦ã€å‰Šå³°å¡«è°· | é«˜å¯ç”¨ï¼Œä½†å¤æ‚åº¦é«˜ |
| RPCè°ƒç”¨ | gRPC/Thrift | é«˜æ€§èƒ½å†…éƒ¨è°ƒç”¨ | æ€§èƒ½å¥½ï¼Œä½†è·¨è¯­è¨€æ”¯æŒæœ‰é™ |

### 2.2 æœåŠ¡æ²»ç†ç»„ä»¶

#### 2.2.1 æœåŠ¡å‘ç°ä¸æ³¨å†Œ
```yaml
# Eureka æœåŠ¡æ³¨å†Œé…ç½®
eureka:
  client:
    service-url:
      defaultZone: http://eureka-server:8761/eureka/
  instance:
    instance-id: ${spring.application.name}:${spring.application.instance_id:${random.value}}
    prefer-ip-address: true
```

**æœåŠ¡å‘ç°æ–¹æ¡ˆï¼š**
- **å®¢æˆ·ç«¯å‘ç°**: Eureka, Consul
- **æœåŠ¡å™¨ç«¯å‘ç°**: Nginx, HAProxy
- **DNS å‘ç°**: Kubernetes Service

#### 2.2.2 é…ç½®ç®¡ç†
```java
// Spring Cloud Config é…ç½®ç®¡ç†
@RefreshScope
@RestController
public class ConfigController {
    
    @Value("${feature.toggle.new-payment:false}")
    private boolean newPaymentFeature;
    
    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        return Map.of("newPaymentFeature", newPaymentFeature);
    }
}
```

**é…ç½®ç®¡ç†å·¥å…·ï¼š**
- **Spring Cloud Config**: Git åç«¯ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°
- **Consul**: KV å­˜å‚¨ï¼ŒæœåŠ¡å‘ç°é›†æˆ
- **Apollo**: æºç¨‹å¼€æºï¼ŒåŠŸèƒ½ä¸°å¯Œ
- **Nacos**: é˜¿é‡Œå¼€æºï¼Œé…ç½®+æœåŠ¡å‘ç°

#### 2.2.3 ç†”æ–­ä¸é™æµ
```java
// Hystrix ç†”æ–­å™¨é…ç½®
@HystrixCommand(
    fallbackMethod = "fallbackGetUser",
    commandProperties = {
        @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "20"),
        @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds", value = "5000")
    }
)
public User getUser(Long id) {
    return userServiceClient.getUser(id);
}

public User fallbackGetUser(Long id) {
    return User.builder()
        .id(id)
        .name("é»˜è®¤ç”¨æˆ·")
        .build();
}
```

**ç†”æ–­é™æµå·¥å…·ï¼š**
- **Hystrix**: Netflix å¼€æºï¼ŒåŠŸèƒ½å®Œå–„
- **Resilience4j**: è½»é‡çº§ï¼Œå‡½æ•°å¼ç¼–ç¨‹
- **Sentinel**: é˜¿é‡Œå¼€æºï¼Œæµé‡æ§åˆ¶ç²¾ç»†

## âš ï¸ å¾®æœåŠ¡æ¶æ„æŒ‘æˆ˜

### 3.1 ç½‘ç»œé€šä¿¡å¤æ‚æ€§

#### 3.1.1 æœåŠ¡é—´é€šä¿¡é—®é¢˜
```java
// æœåŠ¡è°ƒç”¨é“¾ç¤ºä¾‹
public class OrderService {
    
    public Order createOrder(OrderRequest request) {
        // 1. éªŒè¯ç”¨æˆ·
        User user = userService.getUser(request.getUserId());
        
        // 2. éªŒè¯å•†å“åº“å­˜
        Product product = productService.getProduct(request.getProductId());
        
        // 3. åˆ›å»ºè®¢å•
        Order order = orderRepository.save(new Order(user, product));
        
        // 4. æ‰£å‡åº“å­˜
        inventoryService.deductStock(request.getProductId(), request.getQuantity());
        
        // 5. å‘é€é€šçŸ¥
        notificationService.sendOrderCreated(order);
        
        return order;
    }
}
```

**é€šä¿¡æŒ‘æˆ˜ï¼š**
- **ç½‘ç»œå»¶è¿Ÿ**: æœåŠ¡é—´è°ƒç”¨å¢åŠ å»¶è¿Ÿ
- **æœåŠ¡å‘ç°**: åŠ¨æ€ç¯å¢ƒä¸‹æœåŠ¡å®šä½å›°éš¾
- **è´Ÿè½½å‡è¡¡**: æµé‡åˆ†å‘ç­–ç•¥å¤æ‚
- **æ•…éšœä¼ æ’­**: å•ä¸ªæœåŠ¡æ•…éšœå¯èƒ½å¼•å‘é›ªå´©æ•ˆåº”

#### 3.1.2 åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜
```java
// åˆ†å¸ƒå¼äº‹åŠ¡ç¤ºä¾‹ - Saga æ¨¡å¼
@Transactional
public void createOrderWithSaga(OrderRequest request) {
    try {
        // é˜¶æ®µ1: å°è¯•æ“ä½œ
        orderService.createOrder(request);
        inventoryService.reserveStock(request.getProductId(), request.getQuantity());
        
        // é˜¶æ®µ2: ç¡®è®¤æ“ä½œ
        paymentService.processPayment(request);
        inventoryService.confirmStockDeduction(request.getProductId(), request.getQuantity());
        
    } catch (Exception e) {
        // è¡¥å¿æ“ä½œ
        orderService.cancelOrder(request.getOrderId());
        inventoryService.releaseStock(request.getProductId(), request.getQuantity());
        throw e;
    }
}
```

**äº‹åŠ¡æŒ‘æˆ˜ï¼š**
- **CAP å®šç†**: ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§éš¾ä»¥å…¼å¾—
- **äº‹åŠ¡åè°ƒ**: åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒå¤æ‚
- **æ•°æ®ä¸€è‡´æ€§**: æœ€ç»ˆä¸€è‡´æ€§å¸¦æ¥ä¸šåŠ¡å¤æ‚åº¦

### 3.2 æœåŠ¡æ²»ç†å¤æ‚æ€§

#### 3.2.1 é…ç½®ç®¡ç†æŒ‘æˆ˜
```yaml
# å¾®æœåŠ¡é…ç½®ç¤ºä¾‹ - ç¯å¢ƒå·®å¼‚åŒ–
---
# å¼€å‘ç¯å¢ƒ
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/dev_db
    username: dev_user
    password: dev_pass
  
---
# æµ‹è¯•ç¯å¢ƒ  
spring:
  datasource:
    url: jdbc:mysql://test-db:3306/test_db
    username: test_user
    password: test_pass

---
# ç”Ÿäº§ç¯å¢ƒ
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/prod_db
    username: prod_user
    password: ${DB_PASSWORD}
```

**é…ç½®æŒ‘æˆ˜ï¼š**
- **ç¯å¢ƒå·®å¼‚åŒ–**: ä¸åŒç¯å¢ƒé…ç½®ç®¡ç†å¤æ‚
- **åŠ¨æ€é…ç½®**: è¿è¡Œæ—¶é…ç½®æ›´æ–°å›°éš¾
- **é…ç½®å®‰å…¨**: æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€å¯†é’¥ï¼‰å®‰å…¨ç®¡ç†
- **é…ç½®ç‰ˆæœ¬**: é…ç½®ä¸ä»£ç ç‰ˆæœ¬åŒæ­¥é—®é¢˜

#### 3.2.2 ç›‘æ§ä¸å¯è§‚æµ‹æ€§
```java
// åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç¤ºä¾‹
@RestController
public class OrderController {
    
    private final Tracer tracer;
    
    @GetMapping("/orders/{id}")
    public Order getOrder(@PathVariable Long id) {
        Span span = tracer.nextSpan().name("getOrder").start();
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(span)) {
            span.tag("order.id", id.toString());
            
            // ä¸šåŠ¡é€»è¾‘
            Order order = orderService.findById(id);
            
            span.finish();
            return order;
        }
    }
}
```

**ç›‘æ§æŒ‘æˆ˜ï¼š**
- **é“¾è·¯è¿½è¸ª**: åˆ†å¸ƒå¼è°ƒç”¨é“¾è·¯éš¾ä»¥è¿½è¸ª
- **æŒ‡æ ‡æ”¶é›†**: å¤šæœåŠ¡æŒ‡æ ‡èšåˆå›°éš¾
- **æ—¥å¿—èšåˆ**: åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†å’Œåˆ†æ
- **æ€§èƒ½åˆ†æ**: ç«¯åˆ°ç«¯æ€§èƒ½ç“¶é¢ˆå®šä½

### 3.3 å®‰å…¨ä¸åˆè§„æŒ‘æˆ˜

#### 3.3.1 æœåŠ¡é—´å®‰å…¨é€šä¿¡
```java
// JWT Token è®¤è¯ç¤ºä¾‹
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                   HttpServletResponse response, 
                                   FilterChain filterChain) {
        
        String token = extractToken(request);
        if (token != null && jwtUtil.validateToken(token)) {
            Authentication auth = jwtUtil.getAuthentication(token);
            SecurityContextHolder.getContext().setAuthentication(auth);
        }
        
        filterChain.doFilter(request, response);
    }
}
```

**å®‰å…¨æŒ‘æˆ˜ï¼š**
- **èº«ä»½è®¤è¯**: æœåŠ¡é—´èº«ä»½éªŒè¯æœºåˆ¶
- **æˆæƒæ§åˆ¶**: ç»†ç²’åº¦è®¿é—®æƒé™ç®¡ç†
- **é€šä¿¡åŠ å¯†**: æœåŠ¡é—´æ•°æ®ä¼ è¾“å®‰å…¨
- **è¯ä¹¦ç®¡ç†**: TLS/SSL è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### 3.3.2 åˆè§„æ€§è¦æ±‚
```yaml
# å®‰å…¨ç­–ç•¥é…ç½®ç¤ºä¾‹
security:
  policies:
    - name: "data-encryption"
      rule: "æ‰€æœ‰æ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†ä¼ è¾“"
    - name: "access-logging"
      rule: "æ‰€æœ‰APIè®¿é—®å¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—"
    - name: "data-retention"
      rule: "ç”¨æˆ·æ•°æ®ä¿ç•™æœŸé™ä¸è¶…è¿‡6ä¸ªæœˆ"
```

**åˆè§„æŒ‘æˆ˜ï¼š**
- **æ•°æ®éšç§**: GDPRã€CCPA ç­‰æ•°æ®ä¿æŠ¤æ³•è§„
- **å®¡è®¡è¦æ±‚**: æ“ä½œæ—¥å¿—è®°å½•å’Œå®¡è®¡è¿½è¸ª
- **å®‰å…¨æ ‡å‡†**: SOC2ã€ISO27001 ç­‰å®‰å…¨è®¤è¯
- **è·¨å¢ƒæ•°æ®ä¼ è¾“**: ä¸åŒå›½å®¶åœ°åŒºçš„æ•°æ®ä¼ è¾“é™åˆ¶

## ğŸ¯ Service Mesh çš„è¯ç”Ÿ

### 4.1 ä¼ ç»Ÿå¾®æœåŠ¡æ²»ç†çš„é—®é¢˜

#### 4.1.1 å®¢æˆ·ç«¯åº“çš„å±€é™æ€§
```java
// ä¼ ç»Ÿå¾®æœåŠ¡æ²»ç† - å®¢æˆ·ç«¯åº“æ–¹å¼
@Service
public class OrderService {
    
    @Autowired
    private UserServiceClient userServiceClient;  // Feign Client
    
    @HystrixCommand(fallbackMethod = "fallbackGetUser")  // ç†”æ–­å™¨
    public User getUser(Long userId) {
        return userServiceClient.getUser(userId);
    }
    
    @Autowired
    private MeterRegistry meterRegistry;  // æŒ‡æ ‡æ”¶é›†
    
    public void recordMetric() {
        meterRegistry.counter("order.created").increment();
    }
}
```

**å®¢æˆ·ç«¯åº“é—®é¢˜ï¼š**
- **æŠ€æœ¯æ ˆç»‘å®š**: ä¸ç‰¹å®šæ¡†æ¶å¼ºè€¦åˆ
- **ç‰ˆæœ¬ç®¡ç†**: åº“ç‰ˆæœ¬å‡çº§å›°éš¾
- **å¤šè¯­è¨€æ”¯æŒ**: ä¸åŒè¯­è¨€éœ€è¦å®ç°ç›¸åŒé€»è¾‘
- **é…ç½®åˆ†æ•£**: æ²»ç†é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡ä¸­

#### 4.1.2 åŸºç¡€è®¾æ–½å±‚æŠ½è±¡çš„å¿…è¦æ€§
```
ä¼ ç»Ÿæ–¹å¼ï¼š
åº”ç”¨ä»£ç  + æ²»ç†é€»è¾‘ï¼ˆç†”æ–­ã€é™æµã€ç›‘æ§ç­‰ï¼‰
â†“
Service Mesh æ–¹å¼ï¼š
åº”ç”¨ä»£ç ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼‰
â†“
Sidecar ä»£ç†ï¼ˆç»Ÿä¸€æ²»ç†é€»è¾‘ï¼‰
â†“
åŸºç¡€è®¾æ–½å±‚
```

### 4.2 Service Mesh çš„æ ¸å¿ƒä»·å€¼

#### 4.2.1 å…³æ³¨ç‚¹åˆ†ç¦»
```yaml
# Service Mesh æ¶æ„ä¸‹çš„æœåŠ¡é…ç½®
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: order-service
spec:
  hosts:
  - order-service
  http:
  - route:
    - destination:
        host: order-service
        subset: v1
      weight: 90
    - destination:
        host: order-service
        subset: v2
      weight: 10
  # ç†”æ–­é…ç½®
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 10
        maxRequestsPerConnection: 10
```

**å…³æ³¨ç‚¹åˆ†ç¦»ä¼˜åŠ¿ï¼š**
- **ä¸šåŠ¡å¼€å‘**: ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°
- **åŸºç¡€è®¾æ–½**: ç”±ä¸“é—¨çš„è¿ç»´å›¢é˜Ÿè´Ÿè´£
- **æŠ€æœ¯æ— å…³**: åº”ç”¨ä¸æ²»ç†æŠ€æœ¯æ ˆè§£è€¦
- **ç»Ÿä¸€æ²»ç†**: æ•´ä¸ªç³»ç»Ÿçš„ç»Ÿä¸€ç­–ç•¥ç®¡ç†

#### 4.2.2 ç»Ÿä¸€çš„æœåŠ¡æ²»ç†å¹³é¢
```
æ§åˆ¶å¹³é¢ (Control Plane)
â”œâ”€â”€ æœåŠ¡å‘ç° (Pilot)
â”œâ”€â”€ é…ç½®ç®¡ç† (Galley)
â”œâ”€â”€ å®‰å…¨ç­–ç•¥ (Citadel)
â””â”€â”€ é¥æµ‹æ•°æ® (Mixer)

æ•°æ®å¹³é¢ (Data Plane)
â”œâ”€â”€ Sidecar ä»£ç† (Envoy)
â”œâ”€â”€ æµé‡ç®¡ç†
â”œâ”€â”€ å®‰å…¨é€šä¿¡
â””â”€â”€ å¯è§‚æµ‹æ€§
```

## ğŸ“Š æ€»ç»“ä¸å±•æœ›

### 5.1 æœ¬ç« è¦ç‚¹å›é¡¾

1. **æ¶æ„æ¼”è¿›**: ä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›å†ç¨‹
2. **å¾®æœåŠ¡ä¼˜åŠ¿**: æŠ€æœ¯å¼‚æ„ã€å¼¹æ€§æ‰©å±•ã€ç‹¬ç«‹éƒ¨ç½²
3. **æ²»ç†æŒ‘æˆ˜**: ç½‘ç»œé€šä¿¡ã€æœåŠ¡å‘ç°ã€ç›‘æ§ã€å®‰å…¨
4. **Service Mesh ä»·å€¼**: å…³æ³¨ç‚¹åˆ†ç¦»ã€ç»Ÿä¸€æ²»ç†å¹³é¢

### 5.2 å®è·µå»ºè®®

#### 5.2.1 å¾®æœåŠ¡æ‹†åˆ†åŸåˆ™
```
é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD) æŒ‡å¯¼æœåŠ¡æ‹†åˆ†ï¼š
1. è¯†åˆ«æ ¸å¿ƒé¢†åŸŸå’Œå­é¢†åŸŸ
2. å®šä¹‰é™ç•Œä¸Šä¸‹æ–‡ (Bounded Context)
3. æ ¹æ®ä¸šåŠ¡èƒ½åŠ›åˆ’åˆ†æœåŠ¡è¾¹ç•Œ
4. é¿å…è¿‡åº¦æ‹†åˆ†ï¼Œä¿æŒæœåŠ¡å†…èšæ€§
```

#### 5.2.2 æŠ€æœ¯é€‰å‹è€ƒè™‘å› ç´ 
```
æŠ€æœ¯é€‰å‹ checklistï¼š
âœ… å›¢é˜ŸæŠ€æœ¯æ ˆç†Ÿæ‚‰åº¦
âœ… ç¤¾åŒºç”Ÿæ€å’Œæˆç†Ÿåº¦
âœ… æ€§èƒ½å’Œèµ„æºæ¶ˆè€—
âœ… è¿ç»´å¤æ‚åº¦å’Œæˆæœ¬
âœ… å®‰å…¨æ€§å’Œåˆè§„è¦æ±‚
âœ… é•¿æœŸç»´æŠ¤å’Œå‡çº§è·¯å¾„
```

### 5.3 ä¸‹ä¸€ç« é¢„å‘Š

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Service Mesh çš„æ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„ï¼š
- Service Mesh çš„å®šä¹‰å’Œæ ¸å¿ƒç»„ä»¶
- æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„èŒè´£åˆ’åˆ†
- ä¸»æµ Service Mesh äº§å“æ¶æ„å¯¹æ¯”
- Sidecar æ¨¡å¼çš„å·¥ä½œåŸç†å’Œä¼˜åŠ¿

---

**ç»§ç»­å­¦ä¹ **: [02-Service-Meshæ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„](02-Service-Meshæ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„.md)

---

*æœ¬ç« å†…å®¹å¸®åŠ©æ‚¨ç†è§£å¾®æœåŠ¡æ¶æ„çš„æ¼”è¿›å’ŒæŒ‘æˆ˜ï¼Œä¸ºå­¦ä¹  Service Mesh æŠ€æœ¯æ‰“ä¸‹åšå®åŸºç¡€ã€‚å»ºè®®ç»“åˆå®é™…é¡¹ç›®ç»éªŒè¿›è¡Œæ€è€ƒå’Œå®è·µã€‚*