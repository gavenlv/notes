# ç¬¬8ç« ï¼šæ ‡å‡†åº“ä¸å¸¸ç”¨æ¨¡å—

> **å­¦ä¹ æ—¶é•¿**: 6-7å°æ—¶  
> **éš¾åº¦**: â­â­â­  
> **å‰ç½®çŸ¥è¯†**: ç¬¬1-7ç« 

## æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« å,ä½ å°†èƒ½å¤Ÿ:

- âœ… ä½¿ç”¨datetimeå¤„ç†æ—¥æœŸæ—¶é—´
- âœ… æŒæ¡reæ­£åˆ™è¡¨è¾¾å¼
- âœ… å¤„ç†JSONå’ŒCSVæ•°æ®
- âœ… ä½¿ç”¨collectionsé«˜çº§æ•°æ®ç»“æ„
- âœ… ç†è§£itertoolsè¿­ä»£å·¥å…·
- âœ… ä½¿ç”¨syså’Œosç³»ç»Ÿäº¤äº’

---

## 8.1 datetimeæ¨¡å—

### 8.1.1 æ—¥æœŸä¸æ—¶é—´

```python
from datetime import datetime, date, time, timedelta

# è·å–å½“å‰æ—¶é—´
now = datetime.now()
print(now)  # 2024-01-15 10:30:45.123456

# è·å–å½“å‰æ—¥æœŸ
today = date.today()
print(today)  # 2024-01-15

# åˆ›å»ºç‰¹å®šæ—¥æœŸæ—¶é—´
dt = datetime(2024, 1, 15, 10, 30, 45)
d = date(2024, 1, 15)
t = time(10, 30, 45)

# è®¿é—®å±æ€§
print(now.year)    # 2024
print(now.month)   # 1
print(now.day)     # 15
print(now.hour)    # 10
print(now.minute)  # 30
print(now.second)  # 45

# æ˜ŸæœŸ(0=å‘¨ä¸€, 6=å‘¨æ—¥)
print(today.weekday())     # 0
print(today.isoweekday())  # 1 (1=å‘¨ä¸€)
```

### 8.1.2 æ ¼å¼åŒ–

```python
from datetime import datetime

now = datetime.now()

# strftime - datetimeè½¬å­—ç¬¦ä¸²
print(now.strftime("%Y-%m-%d"))              # 2024-01-15
print(now.strftime("%Yå¹´%mæœˆ%dæ—¥"))          # 2024å¹´01æœˆ15æ—¥
print(now.strftime("%H:%M:%S"))              # 10:30:45
print(now.strftime("%Y-%m-%d %H:%M:%S"))     # 2024-01-15 10:30:45
print(now.strftime("%A, %B %d, %Y"))         # Monday, January 15, 2024

# strptime - å­—ç¬¦ä¸²è½¬datetime
dt_str = "2024-01-15 10:30:45"
dt = datetime.strptime(dt_str, "%Y-%m-%d %H:%M:%S")
print(dt)

# ISOæ ¼å¼
print(now.isoformat())  # 2024-01-15T10:30:45.123456
```

### 8.1.3 æ—¶é—´è®¡ç®—

```python
from datetime import datetime, timedelta

now = datetime.now()

# timedelta - æ—¶é—´é—´éš”
one_day = timedelta(days=1)
one_week = timedelta(weeks=1)
one_hour = timedelta(hours=1)

# æ—¶é—´åŠ å‡
tomorrow = now + one_day
yesterday = now - one_day
next_week = now + one_week

print(f"æ˜å¤©: {tomorrow}")
print(f"æ˜¨å¤©: {yesterday}")

# è®¡ç®—æ—¶é—´å·®
birthday = datetime(2024, 12, 25)
delta = birthday - now
print(f"è·ç¦»ç”Ÿæ—¥è¿˜æœ‰ {delta.days} å¤©")

# å¤æ‚è®¡ç®—
future = now + timedelta(days=100, hours=5, minutes=30)
print(future)
```

---

## 8.2 æ­£åˆ™è¡¨è¾¾å¼(reæ¨¡å—)

### 8.2.1 åŸºæœ¬åŒ¹é…

```python
import re

# æŸ¥æ‰¾
text = "Hello Python 3.11"
match = re.search(r'Python', text)
if match:
    print("æ‰¾åˆ°äº†!")
    print(f"ä½ç½®: {match.start()}-{match.end()}")

# åŒ¹é…(ä»å¼€å¤´)
text = "Python is great"
match = re.match(r'Python', text)
print(match.group())  # Python

# å®Œå…¨åŒ¹é…
text = "Python"
match = re.fullmatch(r'Python', text)
print(match is not None)  # True

# æŸ¥æ‰¾æ‰€æœ‰
text = "Python 3.11, Python 3.10, Python 2.7"
matches = re.findall(r'Python \d+\.\d+', text)
print(matches)  # ['Python 3.11', 'Python 3.10', 'Python 2.7']

# åˆ†å‰²
text = "apple,banana;orange:grape"
fruits = re.split(r'[,;:]', text)
print(fruits)  # ['apple', 'banana', 'orange', 'grape']

# æ›¿æ¢
text = "Hello World"
new_text = re.sub(r'World', 'Python', text)
print(new_text)  # Hello Python
```

### 8.2.2 å…ƒå­—ç¬¦

```python
import re

# . - ä»»æ„å­—ç¬¦(é™¤æ¢è¡Œ)
print(re.findall(r'h.t', 'hat hit hot'))  # ['hat', 'hit', 'hot']

# ^ - å¼€å¤´
print(re.match(r'^Hello', 'Hello World'))  # Match

# $ - ç»“å°¾
print(re.search(r'World$', 'Hello World'))  # Match

# * - 0æ¬¡æˆ–å¤šæ¬¡
print(re.findall(r'ab*', 'a ab abb abbb'))  # ['a', 'ab', 'abb', 'abbb']

# + - 1æ¬¡æˆ–å¤šæ¬¡
print(re.findall(r'ab+', 'a ab abb'))  # ['ab', 'abb']

# ? - 0æ¬¡æˆ–1æ¬¡
print(re.findall(r'ab?', 'a ab abb'))  # ['a', 'ab', 'ab']

# {n} - æ°å¥½næ¬¡
print(re.findall(r'a{3}', 'aa aaa aaaa'))  # ['aaa', 'aaa']

# {n,m} - nåˆ°mæ¬¡
print(re.findall(r'a{2,3}', 'a aa aaa aaaa'))  # ['aa', 'aaa', 'aaa']

# [] - å­—ç¬¦é›†
print(re.findall(r'[aeiou]', 'hello'))  # ['e', 'o']

# [^] - é
print(re.findall(r'[^aeiou]', 'hello'))  # ['h', 'l', 'l']

# \d - æ•°å­— [0-9]
print(re.findall(r'\d+', 'abc123xyz456'))  # ['123', '456']

# \w - å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ [a-zA-Z0-9_]
print(re.findall(r'\w+', 'hello_world 123'))  # ['hello_world', '123']

# \s - ç©ºç™½å­—ç¬¦
print(re.split(r'\s+', 'hello  world\t\npython'))  # ['hello', 'world', 'python']
```

### 8.2.3 åˆ†ç»„

```python
import re

# æ•è·ç»„()
text = "2024-01-15"
match = re.match(r'(\d{4})-(\d{2})-(\d{2})', text)
print(match.group(0))  # 2024-01-15 (æ•´ä¸ªåŒ¹é…)
print(match.group(1))  # 2024
print(match.group(2))  # 01
print(match.group(3))  # 15
print(match.groups())  # ('2024', '01', '15')

# å‘½åç»„(?P<name>)
text = "Name: Alice, Age: 25"
match = re.search(r'Name: (?P<name>\w+), Age: (?P<age>\d+)', text)
print(match.group('name'))  # Alice
print(match.group('age'))   # 25

# éæ•è·ç»„(?:)
text = "http://www.example.com"
match = re.match(r'(?:http|https)://(?P<domain>[\w.]+)', text)
print(match.group('domain'))  # www.example.com
```

### 8.2.4 å®ç”¨ç¤ºä¾‹

```python
import re

# éªŒè¯é‚®ç®±
def is_valid_email(email):
    pattern = r'^[\w\.-]+@[\w\.-]+\.\w+$'
    return re.match(pattern, email) is not None

print(is_valid_email('user@example.com'))  # True
print(is_valid_email('invalid.email'))     # False

# éªŒè¯æ‰‹æœºå·
def is_valid_phone(phone):
    pattern = r'^1[3-9]\d{9}$'
    return re.match(pattern, phone) is not None

print(is_valid_phone('13812345678'))  # True

# æå–URL
text = "Visit https://www.python.org and http://github.com"
urls = re.findall(r'https?://[\w./]+', text)
print(urls)

# æå–ä»·æ ¼
text = "Price: $19.99, Discount: $5.50"
prices = re.findall(r'\$(\d+\.\d{2})', text)
print(prices)  # ['19.99', '5.50']
```

---

## 8.3 JSONå¤„ç†

```python
import json

# Pythonå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²
data = {
    "name": "Alice",
    "age": 25,
    "city": "Beijing",
    "hobbies": ["reading", "coding"]
}

# dumps - è½¬ä¸ºå­—ç¬¦ä¸²
json_str = json.dumps(data, indent=2, ensure_ascii=False)
print(json_str)

# dump - å†™å…¥æ–‡ä»¶
with open('data.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=2, ensure_ascii=False)

# JSONå­—ç¬¦ä¸²è½¬Pythonå¯¹è±¡
json_str = '{"name": "Bob", "age": 30}'
obj = json.loads(json_str)
print(obj['name'])  # Bob

# ä»æ–‡ä»¶è¯»å–
with open('data.json', 'r', encoding='utf-8') as f:
    obj = json.load(f)
    print(obj)

# è‡ªå®šä¹‰å¯¹è±¡åºåˆ—åŒ–
from datetime import datetime

class Student:
    def __init__(self, name, birth_date):
        self.name = name
        self.birth_date = birth_date

def student_encoder(obj):
    if isinstance(obj, Student):
        return {
            'name': obj.name,
            'birth_date': obj.birth_date.isoformat()
        }
    raise TypeError(f"Object of type {type(obj)} is not JSON serializable")

student = Student("Alice", datetime(2000, 1, 15))
json_str = json.dumps(student, default=student_encoder)
print(json_str)
```

---

## 8.4 CSVå¤„ç†

```python
import csv

# å†™å…¥CSV
data = [
    ['Name', 'Age', 'City'],
    ['Alice', 25, 'Beijing'],
    ['Bob', 30, 'Shanghai'],
    ['Charlie', 35, 'Guangzhou']
]

with open('data.csv', 'w', newline='', encoding='utf-8') as f:
    writer = csv.writer(f)
    writer.writerows(data)

# è¯»å–CSV
with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.reader(f)
    for row in reader:
        print(row)

# ä½¿ç”¨å­—å…¸
with open('data.csv', 'w', newline='', encoding='utf-8') as f:
    fieldnames = ['Name', 'Age', 'City']
    writer = csv.DictWriter(f, fieldnames=fieldnames)
    
    writer.writeheader()
    writer.writerow({'Name': 'Alice', 'Age': 25, 'City': 'Beijing'})
    writer.writerow({'Name': 'Bob', 'Age': 30, 'City': 'Shanghai'})

# è¯»å–ä¸ºå­—å…¸
with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        print(f"{row['Name']}, {row['Age']}å², æ¥è‡ª{row['City']}")
```

---

## 8.5 collectionsæ¨¡å—

```python
from collections import Counter, defaultdict, deque, namedtuple, OrderedDict

# Counter - è®¡æ•°å™¨
words = ['apple', 'banana', 'apple', 'orange', 'banana', 'apple']
counter = Counter(words)
print(counter)  # Counter({'apple': 3, 'banana': 2, 'orange': 1})
print(counter.most_common(2))  # [('apple', 3), ('banana', 2)]

# defaultdict - é»˜è®¤å­—å…¸
dd = defaultdict(list)
dd['fruits'].append('apple')
dd['fruits'].append('banana')
print(dd['fruits'])  # ['apple', 'banana']
print(dd['vegetables'])  # [] (è‡ªåŠ¨åˆ›å»ºç©ºåˆ—è¡¨)

# deque - åŒç«¯é˜Ÿåˆ—
dq = deque([1, 2, 3])
dq.append(4)      # å³ç«¯æ·»åŠ 
dq.appendleft(0)  # å·¦ç«¯æ·»åŠ 
print(dq)  # deque([0, 1, 2, 3, 4])
dq.pop()          # å³ç«¯åˆ é™¤
dq.popleft()      # å·¦ç«¯åˆ é™¤

# namedtuple - å‘½åå…ƒç»„
Point = namedtuple('Point', ['x', 'y'])
p = Point(10, 20)
print(p.x, p.y)  # 10 20
print(p[0], p[1])  # 10 20

Student = namedtuple('Student', 'name age grade')
s = Student('Alice', 20, 'A')
print(s.name)  # Alice

# OrderedDict - æœ‰åºå­—å…¸(Python 3.7+æ™®é€šdictä¹Ÿæœ‰åº)
from collections import OrderedDict
od = OrderedDict()
od['a'] = 1
od['b'] = 2
od['c'] = 3
```

---

## 8.6 itertoolsæ¨¡å—

```python
import itertools

# count - æ— é™è®¡æ•°
# for i in itertools.count(10, 2):
#     if i > 20:
#         break
#     print(i)  # 10, 12, 14, 16, 18, 20

# cycle - å¾ªç¯
# for i, item in enumerate(itertools.cycle(['A', 'B', 'C'])):
#     if i >= 6:
#         break
#     print(item)  # A B C A B C

# repeat - é‡å¤
print(list(itertools.repeat('A', 3)))  # ['A', 'A', 'A']

# chain - è¿æ¥
list1 = [1, 2, 3]
list2 = [4, 5, 6]
print(list(itertools.chain(list1, list2)))  # [1, 2, 3, 4, 5, 6]

# combinations - ç»„åˆ
print(list(itertools.combinations([1, 2, 3], 2)))
# [(1, 2), (1, 3), (2, 3)]

# permutations - æ’åˆ—
print(list(itertools.permutations([1, 2, 3], 2)))
# [(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)]

# product - ç¬›å¡å°”ç§¯
print(list(itertools.product([1, 2], ['a', 'b'])))
# [(1, 'a'), (1, 'b'), (2, 'a'), (2, 'b')]

# groupby - åˆ†ç»„
data = [('A', 1), ('A', 2), ('B', 3), ('B', 4)]
for key, group in itertools.groupby(data, key=lambda x: x[0]):
    print(f"{key}: {list(group)}")
# A: [('A', 1), ('A', 2)]
# B: [('B', 3), ('B', 4)]
```

---

## 8.7 å…¶ä»–å®ç”¨æ¨¡å—

### 8.7.1 sysæ¨¡å—

```python
import sys

# å‘½ä»¤è¡Œå‚æ•°
print(sys.argv)  # ['script.py', 'arg1', 'arg2']

# Pythonç‰ˆæœ¬
print(sys.version)
print(sys.version_info)

# é€€å‡ºç¨‹åº
# sys.exit(0)

# æ ‡å‡†è¾“å…¥è¾“å‡º
sys.stdout.write("Hello\n")
# line = sys.stdin.readline()

# æ¨¡å—æœç´¢è·¯å¾„
print(sys.path)
```

### 8.7.2 randomæ¨¡å—

```python
import random

# éšæœºæ•´æ•°
print(random.randint(1, 10))

# éšæœºæµ®ç‚¹æ•°
print(random.random())  # 0-1
print(random.uniform(1, 10))  # 1-10

# éšæœºé€‰æ‹©
colors = ['red', 'green', 'blue']
print(random.choice(colors))

# éšæœºæŠ½æ ·
print(random.sample([1, 2, 3, 4, 5], 3))

# æ‰“ä¹±
numbers = [1, 2, 3, 4, 5]
random.shuffle(numbers)
print(numbers)

# è®¾ç½®ç§å­(å¯é‡ç°)
random.seed(42)
print(random.random())  # æ¯æ¬¡éƒ½ä¸€æ ·
```

### 8.7.3 urllibæ¨¡å—

```python
from urllib import request, parse

# ä¸‹è½½ç½‘é¡µ
# response = request.urlopen('https://www.python.org')
# html = response.read().decode('utf-8')
# print(html)

# URLç¼–ç 
params = {'name': 'å¼ ä¸‰', 'age': 25}
encoded = parse.urlencode(params)
print(encoded)  # name=%E5%BC%A0%E4%B8%89&age=25

# URLè§£ç 
decoded = parse.parse_qs(encoded)
print(decoded)
```

---

## 8.8 å®éªŒ:ç½‘ç»œçˆ¬è™«

```python
"""
ç®€å•ç½‘ç»œçˆ¬è™«
åŠŸèƒ½:
- ä¸‹è½½ç½‘é¡µ
- è§£æé“¾æ¥
- ä¿å­˜å†…å®¹
"""

import re
import json
from urllib import request
from urllib.parse import urljoin, urlparse

class SimpleCrawler:
    def __init__(self):
        self.visited = set()
    
    def fetch(self, url):
        """è·å–ç½‘é¡µå†…å®¹"""
        try:
            response = request.urlopen(url, timeout=10)
            html = response.read().decode('utf-8')
            return html
        except Exception as e:
            print(f"é”™è¯¯: {e}")
            return None
    
    def extract_links(self, html, base_url):
        """æå–æ‰€æœ‰é“¾æ¥"""
        # ç®€å•çš„é“¾æ¥æå–
        pattern = r'href=["\']([^"\']+)["\']'
        links = re.findall(pattern, html)
        
        # è½¬ä¸ºç»å¯¹URL
        absolute_links = []
        for link in links:
            absolute_url = urljoin(base_url, link)
            absolute_links.append(absolute_url)
        
        return absolute_links
    
    def save(self, url, html):
        """ä¿å­˜ç½‘é¡µ"""
        # ç”Ÿæˆæ–‡ä»¶å
        parsed = urlparse(url)
        filename = parsed.netloc.replace('.', '_') + '.html'
        
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(html)
        
        print(f"âœ“ å·²ä¿å­˜: {filename}")

# ä½¿ç”¨(ç¤ºä¾‹,éœ€è¦å®é™…URL)
# crawler = SimpleCrawler()
# html = crawler.fetch('https://www.python.org')
# if html:
#     links = crawler.extract_links(html, 'https://www.python.org')
#     crawler.save('https://www.python.org', html)
```

---

## 8.9 è¯¾åç»ƒä¹ 

### ç»ƒä¹ 1: æ—¥å¿—åˆ†æ

è¯»å–æ—¥å¿—æ–‡ä»¶,ç»Ÿè®¡:
- æ¯å°æ—¶çš„è®¿é—®é‡
- æœ€å¸¸è®¿é—®çš„URL
- é”™è¯¯ç‡

### ç»ƒä¹ 2: æ•°æ®è½¬æ¢

å®ç°CSVå’ŒJSONæ ¼å¼äº’è½¬å·¥å…·ã€‚

### ç»ƒä¹ 3: æ–‡æœ¬åˆ†æ

åˆ†ææ–‡æœ¬æ–‡ä»¶:
- è¯é¢‘ç»Ÿè®¡
- æœ€é•¿å•è¯
- å¹³å‡å•è¯é•¿åº¦

---

## 8.10 æœ¬ç« å°ç»“

### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | ç”¨é€” | å…³é”®åŠŸèƒ½ |
|------|------|----------|
| **datetime** | æ—¥æœŸæ—¶é—´ | now(), strftime(), timedelta |
| **re** | æ­£åˆ™è¡¨è¾¾å¼ | search(), findall(), sub() |
| **json** | JSONå¤„ç† | dumps(), loads() |
| **csv** | CSVå¤„ç† | reader(), writer() |
| **collections** | æ•°æ®ç»“æ„ | Counter, deque, defaultdict |
| **itertools** | è¿­ä»£å·¥å…· | combinations, permutations |

### ä¸‹ä¸€ç« é¢„å‘Š

**ç¬¬9ç«  - æ•°æ®å¤„ç†(NumPy/Pandas)**,å°†å­¦ä¹ :
- ğŸ”¢ NumPyæ•°ç»„è®¡ç®—
- ğŸ“Š Pandasæ•°æ®åˆ†æ
- ğŸ“ˆ æ•°æ®æ¸…æ´—ä¸è½¬æ¢
- ğŸ’¾ æ•°æ®å¯¼å…¥å¯¼å‡º

---

[â† ä¸Šä¸€ç« ](./7-æ–‡ä»¶æ“ä½œä¸å¼‚å¸¸å¤„ç†.md) | [è¿”å›ç›®å½•](./README.md) | [ä¸‹ä¸€ç« : æ•°æ®å¤„ç† â†’](./9-æ•°æ®å¤„ç†.md)
