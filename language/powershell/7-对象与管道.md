# ç¬¬7ç« ï¼šå¯¹è±¡ä¸ç®¡é“

> **å­¦ä¹ æ—¶é•¿**: 7-8å°æ—¶  
> **éš¾åº¦**: â­â­â­â­â­  
> **å‰ç½®çŸ¥è¯†**: ç¬¬1-6ç«   
> **é‡è¦ç¨‹åº¦**: â­â­â­â­â­ (PowerShellæœ€æ ¸å¿ƒç« èŠ‚)

## æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« å,ä½ å°†èƒ½å¤Ÿ:

- âœ… æ·±åˆ»ç†è§£PowerShellçš„å¯¹è±¡æ¨¡å‹
- âœ… æŒæ¡å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•
- âœ… ç²¾é€šç®¡é“æ“ä½œå’Œå¯¹è±¡ä¼ é€’
- âœ… åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡
- âœ… ä½¿ç”¨Where-Object/Select-Object/ForEach-Object
- âœ… ç†è§£å¯¹è±¡vsæ–‡æœ¬çš„å·®å¼‚

---

## 7.1 PowerShellå¯¹è±¡åŸºç¡€

### 7.1.1 ä»€ä¹ˆæ˜¯å¯¹è±¡?

**PowerShellçš„æ ¸å¿ƒ: ä¸€åˆ‡çš†å¯¹è±¡**

```powershell
# Linux Shell: ä¼ é€’æ–‡æœ¬
# ls -l | grep "txt"
# è¾“å‡º: æ–‡æœ¬å­—ç¬¦ä¸²

# PowerShell: ä¼ é€’å¯¹è±¡
Get-ChildItem | Where-Object {$_.Extension -eq ".txt"}
# è¾“å‡º: æ–‡ä»¶å¯¹è±¡(FileInfo)
```

**å¯¹è±¡çš„ç»„æˆ**:

```powershell
# è·å–ä¸€ä¸ªå¯¹è±¡
$file = Get-Item "C:\Windows\notepad.exe"

# å¯¹è±¡ç±»å‹
$file.GetType()
# TypeName: System.IO.FileInfo

# å¯¹è±¡æœ‰å±æ€§
$file.Name          # notepad.exe
$file.Length        # æ–‡ä»¶å¤§å°
$file.CreationTime  # åˆ›å»ºæ—¶é—´

# å¯¹è±¡æœ‰æ–¹æ³•
$file.Delete()      # åˆ é™¤æ–‡ä»¶
$file.CopyTo()      # å¤åˆ¶æ–‡ä»¶
$file.MoveTo()      # ç§»åŠ¨æ–‡ä»¶
```

### 7.1.2 æ¢ç´¢å¯¹è±¡ç»“æ„

**ä½¿ç”¨Get-Member**:

```powershell
# æŸ¥çœ‹å¯¹è±¡æˆå‘˜
Get-Process | Get-Member

# è¾“å‡º:
# TypeName: System.Diagnostics.Process
#
# Name              MemberType     Definition
# ----              ----------     ----------
# Kill              Method         void Kill()
# Start             Method         bool Start()
# WaitForExit       Method         void WaitForExit()
# ...
# CPU               Property       double CPU {get;}
# Id                Property       int Id {get;}
# ProcessName       Property       string ProcessName {get;}
# ...

# ä»…æŸ¥çœ‹å±æ€§
Get-Process | Get-Member -MemberType Property

# ä»…æŸ¥çœ‹æ–¹æ³•
Get-Process | Get-Member -MemberType Method

# æŸ¥çœ‹ç‰¹å®šå¯¹è±¡
$process = Get-Process -Id $PID
$process | Get-Member
```

**å¯¹è±¡ç±»å‹å±‚æ¬¡**:

```powershell
# æ‰€æœ‰å¯¹è±¡éƒ½ç»§æ‰¿è‡ªSystem.Object
$string = "Hello"
$string.GetType().BaseType
# System.Object

# ç±»å‹ç»§æ‰¿
$date = Get-Date
$date.GetType().FullName
# System.DateTime

$date.GetType().BaseType
# System.ValueType

$date.GetType().BaseType.BaseType
# System.Object
```

---

## 7.2 å¯¹è±¡å±æ€§

### 7.2.1 è®¿é—®å±æ€§

```powershell
# ç‚¹ç¬¦å·è®¿é—®
$process = Get-Process -Name "powershell" | Select-Object -First 1
$process.Name
$process.Id
$process.CPU
$process.WorkingSet

# è®¿é—®åµŒå¥—å±æ€§
$file = Get-Item "C:\Windows\notepad.exe"
$file.VersionInfo.FileVersion
$file.VersionInfo.CompanyName

# å±æ€§é“¾
Get-Process | Select-Object -First 1 | 
    ForEach-Object { $_.MainModule.FileName }
```

### 7.2.2 è®¡ç®—å±æ€§

```powershell
# æ·»åŠ è®¡ç®—å±æ€§
Get-Process | Select-Object Name, Id,
    @{Name="MemoryMB"; Expression={$_.WorkingSet / 1MB}},
    @{Name="CPURounded"; Expression={[Math]::Round($_.CPU, 2)}}

# ç®€åŒ–å†™æ³•
Get-Process | Select-Object Name,
    @{N="MemoryMB"; E={$_.WS / 1MB}}

# æ ¼å¼åŒ–è®¡ç®—å±æ€§
Get-ChildItem | Select-Object Name,
    @{N="SizeMB"; E={"{0:N2}" -f ($_.Length / 1MB)}},
    @{N="Modified"; E={$_.LastWriteTime.ToString("yyyy-MM-dd")}}

# æ¡ä»¶è®¡ç®—å±æ€§
Get-Process | Select-Object Name,
    @{N="Status"; E={
        if ($_.Responding) {"Running"} else {"NotResponding"}
    }}
```

### 7.2.3 åŠ¨æ€å±æ€§

```powershell
# æ·»åŠ å±æ€§åˆ°å¯¹è±¡
$obj = New-Object PSObject
$obj | Add-Member -MemberType NoteProperty -Name "Name" -Value "Alice"
$obj | Add-Member -MemberType NoteProperty -Name "Age" -Value 30

# è®¿é—®åŠ¨æ€å±æ€§
$obj.Name  # Alice
$obj.Age   # 30

# æ·»åŠ æ–¹æ³•
$obj | Add-Member -MemberType ScriptMethod -Name "GetInfo" -Value {
    "Name: $($this.Name), Age: $($this.Age)"
}

$obj.GetInfo()  # Name: Alice, Age: 30
```

---

## 7.3 å¯¹è±¡æ–¹æ³•

### 7.3.1 è°ƒç”¨æ–¹æ³•

```powershell
# åŸºæœ¬æ–¹æ³•è°ƒç”¨
$string = "Hello World"
$string.ToUpper()        # HELLO WORLD
$string.ToLower()        # hello world
$string.Replace("World", "PowerShell")  # Hello PowerShell

# å¸¦å‚æ•°çš„æ–¹æ³•
$string.Substring(0, 5)  # Hello
$string.Split(" ")       # @("Hello", "World")

# æ–¹æ³•é“¾
$string.ToUpper().Replace("WORLD", "PS").Substring(0, 8)
# HELLO PS

# é™æ€æ–¹æ³•
[Math]::Sqrt(16)         # 4
[Math]::Pow(2, 10)       # 1024
[System.IO.Path]::GetFileName("C:\Test\file.txt")  # file.txt

# DateTimeæ–¹æ³•
$date = Get-Date
$date.AddDays(7)         # 7å¤©å
$date.AddHours(-2)       # 2å°æ—¶å‰
$date.ToString("yyyy-MM-dd")  # æ ¼å¼åŒ–
```

### 7.3.2 å¸¸ç”¨å¯¹è±¡æ–¹æ³•

**Stringå¯¹è±¡**:

```powershell
$text = "  PowerShell  "

# ä¿®å‰ª
$text.Trim()             # "PowerShell"
$text.TrimStart()        # "PowerShell  "
$text.TrimEnd()          # "  PowerShell"

# æ£€æŸ¥
$text.Contains("Shell")  # True
$text.StartsWith("Pow")  # True
$text.EndsWith("ell")    # True

# æŸ¥æ‰¾
$text.IndexOf("Shell")   # 7
$text.LastIndexOf("e")   # 11

# åˆ†å‰²å’Œè¿æ¥
$text.Split("e")         # @("  Pow", "rSh", "ll  ")
[string]::Join(",", @("a", "b", "c"))  # "a,b,c"
```

**Arrayå¯¹è±¡**:

```powershell
$arr = 1, 2, 3, 4, 5

# æ’åº
[array]::Sort($arr)
[array]::Reverse($arr)

# æŸ¥æ‰¾
[array]::IndexOf($arr, 3)      # 2
[array]::LastIndexOf($arr, 3)  # 2

# å¤åˆ¶
$copy = [array]::Copy($arr, 3)  # å¤åˆ¶å‰3ä¸ªå…ƒç´ 
```

**DateTimeå¯¹è±¡**:

```powershell
$date = Get-Date

# æ—¥æœŸè¿ç®—
$date.AddDays(1)
$date.AddMonths(-1)
$date.AddYears(1)

# æ—¥æœŸæ¯”è¾ƒ
$date1 = Get-Date "2024-01-01"
$date2 = Get-Date "2024-12-31"
$date1.CompareTo($date2)  # -1 (å°äº)

# æ ¼å¼åŒ–
$date.ToString("yyyy-MM-dd")
$date.ToString("HH:mm:ss")
$date.ToString("dddd, MMMM dd, yyyy")
```

---

## 7.4 åˆ›å»ºè‡ªå®šä¹‰å¯¹è±¡

### 7.4.1 PSCustomObject

```powershell
# æœ€ç®€å•çš„æ–¹å¼
$person = [PSCustomObject]@{
    Name = "Alice"
    Age = 30
    City = "Beijing"
}

# è®¿é—®å±æ€§
$person.Name  # Alice
$person.Age   # 30

# åˆ›å»ºå¯¹è±¡æ•°ç»„
$people = @(
    [PSCustomObject]@{Name="Alice"; Age=30; City="Beijing"}
    [PSCustomObject]@{Name="Bob"; Age=25; City="Shanghai"}
    [PSCustomObject]@{Name="Charlie"; Age=35; City="Guangzhou"}
)

# ä½¿ç”¨å¯¹è±¡æ•°ç»„
$people | Where-Object {$_.Age -gt 25}
$people | Select-Object Name, City
$people | Sort-Object Age
```

### 7.4.2 æœ‰åºå¯¹è±¡

```powershell
# ä¿æŒå±æ€§é¡ºåº
$person = [PSCustomObject][ordered]@{
    FirstName = "Alice"
    LastName = "Wang"
    Age = 30
    Email = "alice@example.com"
}

# å±æ€§é¡ºåºä¸å®šä¹‰é¡ºåºä¸€è‡´
$person | Format-List
```

### 7.4.3 ä½¿ç”¨New-Object

```powershell
# åˆ›å»ºPSObject
$obj = New-Object PSObject -Property @{
    Name = "Alice"
    Age = 30
}

# æ·»åŠ å±æ€§
$obj | Add-Member -MemberType NoteProperty -Name "City" -Value "Beijing"

# æ·»åŠ æ–¹æ³•
$obj | Add-Member -MemberType ScriptMethod -Name "Greet" -Value {
    "Hello, I'm $($this.Name) from $($this.City)"
}

$obj.Greet()  # Hello, I'm Alice from Beijing

# æ·»åŠ å±æ€§é›†
$obj | Add-Member -MemberType ScriptProperty -Name "Info" -Value {
    "$($this.Name), Age: $($this.Age)"
}

$obj.Info  # Alice, Age: 30
```

### 7.4.4 ç±»å®šä¹‰(PowerShell 5+)

```powershell
# å®šä¹‰ç±»
class Person {
    [string]$Name
    [int]$Age
    [string]$City
    
    # æ„é€ å‡½æ•°
    Person([string]$name, [int]$age) {
        $this.Name = $name
        $this.Age = $age
    }
    
    # æ–¹æ³•
    [string]GetInfo() {
        return "$($this.Name), $($this.Age) years old"
    }
    
    # æ–¹æ³•é‡è½½
    [void]SetCity([string]$city) {
        $this.City = $city
    }
}

# åˆ›å»ºå®ä¾‹
$person = [Person]::new("Alice", 30)
$person.SetCity("Beijing")
$person.GetInfo()  # Alice, 30 years old

# ç»§æ‰¿
class Employee : Person {
    [string]$Department
    [double]$Salary
    
    Employee([string]$name, [int]$age, [string]$dept) : base($name, $age) {
        $this.Department = $dept
    }
    
    [string]GetInfo() {
        return "$($this.Name), $($this.Department)"
    }
}

$emp = [Employee]::new("Bob", 28, "IT")
$emp.GetInfo()  # Bob, IT
```

---

## 7.5 ç®¡é“æ·±å…¥

### 7.5.1 ç®¡é“å·¥ä½œåŸç†

```powershell
# ç®¡é“ä¼ é€’å¯¹è±¡
Get-Process | 
    Where-Object {$_.CPU -gt 10} | 
    Sort-Object CPU -Descending |
    Select-Object -First 5 Name, CPU

# æ¯ä¸ªå‘½ä»¤:
# 1. æ¥æ”¶å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºå¯¹è±¡
# 2. å¤„ç†å¯¹è±¡
# 3. è¾“å‡ºå¯¹è±¡ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤

# æŸ¥çœ‹ç®¡é“ä¸­çš„å¯¹è±¡
Get-Process | ForEach-Object {
    Write-Host "Processing: $($_.Name), Type: $($_.GetType().Name)"
}
```

### 7.5.2 ç®¡é“å˜é‡$_

```powershell
# $_ ä»£è¡¨å½“å‰ç®¡é“å¯¹è±¡
1..10 | ForEach-Object {
    $_ * 2
}

# è®¿é—®å¯¹è±¡å±æ€§
Get-Process | ForEach-Object {
    "Process: $($_.Name), ID: $($_.Id)"
}

# å¤æ‚å¤„ç†
Get-ChildItem | ForEach-Object {
    [PSCustomObject]@{
        Name = $_.Name
        SizeMB = [Math]::Round($_.Length / 1MB, 2)
        Type = $_.Extension
        Modified = $_.LastWriteTime
    }
}

# $PSItem (PowerShell 3+)
Get-Process | Where-Object {$PSItem.CPU -gt 10}
# ç­‰åŒäº
Get-Process | Where-Object {$_.CPU -gt 10}
```

---

## 7.6 Where-Object (è¿‡æ»¤)

### 7.6.1 åŸºæœ¬è¿‡æ»¤

```powershell
# å®Œæ•´è¯­æ³•
Get-Process | Where-Object {$_.CPU -gt 10}

# ç®€åŒ–è¯­æ³•(PowerShell 3+)
Get-Process | Where-Object CPU -GT 10

# åˆ«å
Get-Process | ? {$_.CPU -gt 10}
Get-Process | where {$_.CPU -gt 10}
```

### 7.6.2 é«˜çº§è¿‡æ»¤

```powershell
# å¤šæ¡ä»¶
Get-Process | Where-Object {
    ($_.CPU -gt 10) -and ($_.WorkingSet -gt 100MB)
}

# å¤æ‚æ¡ä»¶
Get-ChildItem | Where-Object {
    ($_.Extension -eq ".txt") -or 
    ($_.Extension -eq ".log") -and 
    ($_.Length -gt 1MB)
}

# ä½¿ç”¨æ–¹æ³•
Get-Process | Where-Object {
    $_.ProcessName.StartsWith("win")
}

# æ­£åˆ™åŒ¹é…
Get-Service | Where-Object {
    $_.Name -match "^Win"
}

# é›†åˆåŒ…å«
$allowed = @("Running", "Stopped")
Get-Service | Where-Object {
    $allowed -contains $_.Status
}
```

### 7.6.3 ç®€åŒ–è¯­æ³•

```powershell
# ç­‰äº
Get-Service | Where-Object Status -EQ "Running"

# ä¸ç­‰äº
Get-Service | Where-Object Status -NE "Stopped"

# å¤§äº
Get-Process | Where-Object CPU -GT 10

# å°äº
Get-Process | Where-Object Id -LT 1000

# åŒ…å«
Get-Process | Where-Object Name -Like "win*"

# åŒ¹é…
Get-Service | Where-Object Name -Match "^Win"

# åœ¨é›†åˆä¸­
Get-Service | Where-Object Status -In "Running", "Paused"

# ä¸åœ¨é›†åˆä¸­
Get-Service | Where-Object Status -NotIn "Stopped"
```

---

## 7.7 Select-Object (é€‰æ‹©)

### 7.7.1 é€‰æ‹©å±æ€§

```powershell
# é€‰æ‹©ç‰¹å®šå±æ€§
Get-Process | Select-Object Name, Id, CPU

# å‰Nä¸ªå¯¹è±¡
Get-Process | Select-Object -First 5

# åNä¸ªå¯¹è±¡
Get-Process | Select-Object -Last 5

# è·³è¿‡Nä¸ªå¯¹è±¡
Get-Process | Select-Object -Skip 10

# è·³è¿‡Nä¸ªåå–Mä¸ª
Get-Process | Select-Object -Skip 5 -First 10

# å»é‡
Get-Process | Select-Object ProcessName -Unique
```

### 7.7.2 è®¡ç®—å±æ€§

```powershell
# é‡å‘½åå±æ€§
Get-Process | Select-Object Name,
    @{Name="ProcessID"; Expression={$_.Id}}

# è®¡ç®—æ–°å±æ€§
Get-Process | Select-Object Name,
    @{N="MemoryMB"; E={[Math]::Round($_.WS/1MB, 2)}},
    @{N="CPUSec"; E={[Math]::Round($_.CPU, 2)}}

# æ¡ä»¶å±æ€§
Get-Service | Select-Object Name,
    @{N="State"; E={
        if ($_.Status -eq "Running") {"âœ“ Active"}
        else {"âœ— Inactive"}
    }}

# å¤æ‚è®¡ç®—
Get-ChildItem | Select-Object Name,
    @{N="Size"; E={
        if ($_.Length -gt 1GB) {"{0:N2} GB" -f ($_.Length/1GB)}
        elseif ($_.Length -gt 1MB) {"{0:N2} MB" -f ($_.Length/1MB)}
        elseif ($_.Length -gt 1KB) {"{0:N2} KB" -f ($_.Length/1KB)}
        else {"{0} bytes" -f $_.Length}
    }}
```

### 7.7.3 å±•å¼€å±æ€§

```powershell
# é»˜è®¤è¿”å›å¯¹è±¡
Get-Process | Select-Object -First 1 Name
# è¿”å›: @{Name="powershell"}

# å±•å¼€è¿”å›å€¼
Get-Process | Select-Object -First 1 -ExpandProperty Name
# è¿”å›: "powershell"

# å®é™…åº”ç”¨
$processNames = Get-Process | Select-Object -ExpandProperty Name
$processNames -is [Array]  # True
$processNames[0]           # å­—ç¬¦ä¸²,ä¸æ˜¯å¯¹è±¡
```

---

## 7.8 ForEach-Object (éå†)

### 7.8.1 åŸºæœ¬éå†

```powershell
# å®Œæ•´è¯­æ³•
1..5 | ForEach-Object {
    $_ * 2
}

# åˆ«å
1..5 | % {$_ * 2}
1..5 | foreach {$_ * 2}

# è®¿é—®å±æ€§
Get-Process | ForEach-Object {
    "$($_.Name) - $($_.Id)"
}
```

### 7.8.2 Begin/Process/End

```powershell
# ä¸‰é˜¶æ®µå¤„ç†
1..10 | ForEach-Object -Begin {
    Write-Host "=== Starting ===" -ForegroundColor Cyan
    $sum = 0
    $count = 0
} -Process {
    $sum += $_
    $count++
    Write-Host "Processing $_"
} -End {
    Write-Host "=== Completed ===" -ForegroundColor Green
    Write-Host "Count: $count"
    Write-Host "Sum: $sum"
    Write-Host "Average: $($sum/$count)"
}
```

### 7.8.3 å¤æ‚å¤„ç†

```powershell
# å¯¹è±¡è½¬æ¢
Get-Process | ForEach-Object {
    [PSCustomObject]@{
        Name = $_.Name
        Id = $_.Id
        MemoryMB = [Math]::Round($_.WS / 1MB, 2)
        CPUSeconds = [Math]::Round($_.CPU, 2)
        Status = if ($_.Responding) {"Running"} else {"NotResponding"}
    }
} | Where-Object {$_.MemoryMB -gt 100} |
    Sort-Object MemoryMB -Descending |
    Format-Table -AutoSize

# è°ƒç”¨æ–¹æ³•
Get-ChildItem *.txt | ForEach-Object {
    $_.MoveTo("$($_.DirectoryName)\backup\$($_.Name)")
}

# å¹¶è¡Œå¤„ç†(PowerShell 7+)
1..10 | ForEach-Object -Parallel {
    Start-Sleep -Seconds 1
    "Processed $_"
} -ThrottleLimit 5
```

---

## 7.9 å®éªŒ:å¯¹è±¡æ“ä½œç»¼åˆåº”ç”¨

### å®éªŒ1: è¿›ç¨‹åˆ†æå™¨

```powershell
<#
.SYNOPSIS
    è¿›ç¨‹åˆ†æå’Œç›‘æ§å·¥å…·
.DESCRIPTION
    ä½¿ç”¨å¯¹è±¡æ“ä½œåˆ†æç³»ç»Ÿè¿›ç¨‹
#>

function Get-ProcessAnalysis {
    [CmdletBinding()]
    param(
        [int]$TopCount = 10,
        [ValidateSet("CPU", "Memory", "Handles")]
        [string]$SortBy = "CPU"
    )
    
    Write-Host "`n=== Process Analysis ===" -ForegroundColor Cyan
    
    # æ”¶é›†è¿›ç¨‹ä¿¡æ¯
    $processes = Get-Process | Where-Object {$_.CPU -gt 0} | ForEach-Object {
        [PSCustomObject]@{
            Name = $_.ProcessName
            Id = $_.Id
            CPU = [Math]::Round($_.CPU, 2)
            MemoryMB = [Math]::Round($_.WorkingSet / 1MB, 2)
            Handles = $_.HandleCount
            Threads = $_.Threads.Count
            StartTime = try {$_.StartTime} catch {"N/A"}
            Responding = $_.Responding
            Status = if ($_.Responding) {"âœ“ Running"} else {"âœ— Hung"}
        }
    }
    
    # ç»Ÿè®¡ä¿¡æ¯
    $totalProcesses = $processes.Count
    $totalCPU = ($processes | Measure-Object -Property CPU -Sum).Sum
    $totalMemoryMB = ($processes | Measure-Object -Property MemoryMB -Sum).Sum
    $notResponding = ($processes | Where-Object {-not $_.Responding}).Count
    
    Write-Host "`nSystem Summary:" -ForegroundColor Yellow
    Write-Host "  Total Processes: $totalProcesses"
    Write-Host "  Total CPU: $([Math]::Round($totalCPU, 2))s"
    Write-Host "  Total Memory: $([Math]::Round($totalMemoryMB, 2)) MB"
    Write-Host "  Not Responding: $notResponding"
    
    # æ’åºå’Œæ˜¾ç¤ºTopè¿›ç¨‹
    $sortProperty = switch ($SortBy) {
        "CPU" { "CPU" }
        "Memory" { "MemoryMB" }
        "Handles" { "Handles" }
    }
    
    Write-Host "`nTop $TopCount by $SortBy`:" -ForegroundColor Yellow
    $processes | 
        Sort-Object $sortProperty -Descending | 
        Select-Object -First $TopCount |
        Format-Table -AutoSize
    
    # é—®é¢˜è¿›ç¨‹
    $problemProcesses = $processes | Where-Object {
        ($_.CPU -gt 50) -or 
        ($_.MemoryMB -gt 500) -or 
        (-not $_.Responding)
    }
    
    if ($problemProcesses) {
        Write-Host "`nâš  Problem Processes:" -ForegroundColor Red
        $problemProcesses | Format-Table Name, CPU, MemoryMB, Status -AutoSize
    }
}

# è¿è¡Œåˆ†æ
Get-ProcessAnalysis -TopCount 10 -SortBy Memory
```

### å®éªŒ2: æ–‡ä»¶ç³»ç»Ÿåˆ†æå™¨

```powershell
<#
.SYNOPSIS
    æ–‡ä»¶ç³»ç»Ÿåˆ†æå·¥å…·
.DESCRIPTION
    åˆ†æç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»Ÿè®¡
#>

function Get-DirectoryAnalysis {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory=$true)]
        [string]$Path,
        
        [switch]$Recursive,
        [switch]$IncludeHidden
    )
    
    Write-Host "`n=== Directory Analysis: $Path ===" -ForegroundColor Cyan
    
    # è·å–æ–‡ä»¶
    $params = @{
        Path = $Path
        File = $true
    }
    if ($Recursive) { $params.Recurse = $true }
    if ($IncludeHidden) { $params.Force = $true }
    
    $files = Get-ChildItem @params | ForEach-Object {
        [PSCustomObject]@{
            Name = $_.Name
            Extension = $_.Extension
            SizeMB = [Math]::Round($_.Length / 1MB, 2)
            SizeBytes = $_.Length
            Created = $_.CreationTime
            Modified = $_.LastWriteTime
            IsReadOnly = $_.IsReadOnly
            FullPath = $_.FullName
        }
    }
    
    if (-not $files) {
        Write-Warning "No files found in $Path"
        return
    }
    
    # æ€»ä½“ç»Ÿè®¡
    $totalFiles = $files.Count
    $totalSizeMB = ($files | Measure-Object -Property SizeMB -Sum).Sum
    $totalSizeGB = [Math]::Round($totalSizeMB / 1024, 2)
    
    Write-Host "`nOverall Statistics:" -ForegroundColor Yellow
    Write-Host "  Total Files: $totalFiles"
    Write-Host "  Total Size: $totalSizeGB GB ($totalSizeMB MB)"
    Write-Host "  Average Size: $([Math]::Round($totalSizeMB/$totalFiles, 2)) MB"
    
    # æŒ‰æ‰©å±•åç»Ÿè®¡
    Write-Host "`nBy Extension:" -ForegroundColor Yellow
    $files | Group-Object Extension | ForEach-Object {
        $ext = if ($_.Name) {$_.Name} else {"(no extension)"}
        $count = $_.Count
        $sizeMB = [Math]::Round(($_.Group | Measure-Object -Property SizeMB -Sum).Sum, 2)
        $percent = [Math]::Round($count / $totalFiles * 100, 2)
        
        [PSCustomObject]@{
            Extension = $ext
            Count = $count
            Percentage = "$percent%"
            SizeMB = $sizeMB
        }
    } | Sort-Object Count -Descending | Format-Table -AutoSize
    
    # æœ€å¤§æ–‡ä»¶
    Write-Host "`nTop 5 Largest Files:" -ForegroundColor Yellow
    $files | 
        Sort-Object SizeBytes -Descending | 
        Select-Object -First 5 Name, SizeMB, Modified |
        Format-Table -AutoSize
    
    # æœ€æ–°æ–‡ä»¶
    Write-Host "`nTop 5 Most Recent Files:" -ForegroundColor Yellow
    $files | 
        Sort-Object Modified -Descending | 
        Select-Object -First 5 Name, SizeMB, Modified |
        Format-Table -AutoSize
}

# ä½¿ç”¨ç¤ºä¾‹
Get-DirectoryAnalysis -Path "C:\Windows\System32" -TopCount 20
```

### å®éªŒ3: æ•°æ®è½¬æ¢ç®¡é“

```powershell
<#
.SYNOPSIS
    CSVæ•°æ®å¤„ç†ç®¡é“
.DESCRIPTION
    æ¼”ç¤ºå¤æ‚çš„å¯¹è±¡è½¬æ¢å’Œè¿‡æ»¤
#>

# ç¤ºä¾‹æ•°æ®
$salesData = @"
Date,Product,Quantity,Price,Region
2024-01-01,Laptop,5,800,North
2024-01-01,Mouse,20,15,North
2024-01-02,Keyboard,10,50,South
2024-01-02,Laptop,3,800,East
2024-01-03,Monitor,8,300,West
2024-01-03,Mouse,15,15,South
2024-01-04,Laptop,7,800,North
2024-01-04,Keyboard,12,50,East
"@ | ConvertFrom-Csv

# æ•°æ®å¤„ç†ç®¡é“
$analysis = $salesData | 
    # 1. æ·»åŠ è®¡ç®—å­—æ®µ
    ForEach-Object {
        $_ | Add-Member -MemberType NoteProperty -Name "Total" -Value ([int]$_.Quantity * [int]$_.Price) -PassThru
        $_ | Add-Member -MemberType NoteProperty -Name "ParsedDate" -Value ([datetime]$_.Date) -PassThru
    } |
    # 2. è¿‡æ»¤æ•°æ®
    Where-Object {$_.Total -gt 100} |
    # 3. æŒ‰äº§å“åˆ†ç»„
    Group-Object Product |
    # 4. è®¡ç®—æ¯ä¸ªäº§å“çš„ç»Ÿè®¡
    ForEach-Object {
        $group = $_
        [PSCustomObject]@{
            Product = $group.Name
            TotalQuantity = ($group.Group | Measure-Object -Property Quantity -Sum).Sum
            TotalRevenue = ($group.Group | Measure-Object -Property Total -Sum).Sum
            AvgPrice = [Math]::Round(($group.Group | Measure-Object -Property Price -Average).Average, 2)
            OrderCount = $group.Count
            Regions = ($group.Group | Select-Object -ExpandProperty Region -Unique) -join ", "
        }
    } |
    # 5. æ’åº
    Sort-Object TotalRevenue -Descending

# æ˜¾ç¤ºç»“æœ
Write-Host "`n=== Sales Analysis ===" -ForegroundColor Cyan
$analysis | Format-Table -AutoSize

# æ€»ä½“ç»Ÿè®¡
$totalRevenue = ($analysis | Measure-Object -Property TotalRevenue -Sum).Sum
Write-Host "`nTotal Revenue: `$$totalRevenue" -ForegroundColor Green
```

---

## 7.10 è¯¾åç»ƒä¹ 

### ç»ƒä¹ 1: å¯¹è±¡æ¢ç´¢

æ¢ç´¢ä»¥ä¸‹å¯¹è±¡:
1. Get-Serviceçš„å¯¹è±¡ç»“æ„
2. Get-EventLogçš„å±æ€§å’Œæ–¹æ³•
3. åˆ›å»ºè‡ªå®šä¹‰å¯¹è±¡è¡¨ç¤ºå­¦ç”Ÿä¿¡æ¯

### ç»ƒä¹ 2: ç®¡é“ç»ƒä¹ 

ä½¿ç”¨ç®¡é“å®Œæˆ:
1. æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„10ä¸ªè¿›ç¨‹
2. ç»Ÿè®¡ä¸åŒæ‰©å±•åæ–‡ä»¶çš„æ•°é‡
3. æŒ‰å¤§å°æ’åºå¹¶æ˜¾ç¤ºå‰20ä¸ªæ–‡ä»¶

### ç»ƒä¹ 3: æ•°æ®å¤„ç†

å¼€å‘:
1. æ—¥å¿—åˆ†æå·¥å…·(è§£ææ—¥å¿—æ–‡ä»¶)
2. CSVæ•°æ®è½¬æ¢å™¨
3. ç³»ç»Ÿå¥åº·æ£€æŸ¥æŠ¥å‘Š

---

## 7.11 æœ¬ç« å°ç»“

### æ ¸å¿ƒæ¦‚å¿µ

âœ… **å¯¹è±¡æ¨¡å‹**: ä¸€åˆ‡çš†å¯¹è±¡,å¯¹è±¡æœ‰å±æ€§å’Œæ–¹æ³•

âœ… **ç®¡é“**: ä¼ é€’å¯¹è±¡è€Œéæ–‡æœ¬

âœ… **å¯¹è±¡æ“ä½œ**: Get-Member, Select-Object, Where-Object

âœ… **è‡ªå®šä¹‰å¯¹è±¡**: PSCustomObject, Class

### å…³é”®å‘½ä»¤

```powershell
# æ¢ç´¢å¯¹è±¡
Get-Member
$obj.Property
$obj.Method()

# ç®¡é“æ“ä½œ
Where-Object {condition}
Select-Object Property1, Property2
ForEach-Object {action}

# åˆ›å»ºå¯¹è±¡
[PSCustomObject]@{Property=Value}
New-Object PSObject
[ClassName]::new()
```

### PowerShell vs Linux Shell

| ç‰¹æ€§ | PowerShell | Linux Shell |
|------|-----------|-------------|
| ä¼ é€’å†…å®¹ | .NETå¯¹è±¡ | æ–‡æœ¬ |
| æ•°æ®è®¿é—® | å±æ€§/æ–¹æ³• | æ–‡æœ¬è§£æ |
| ç±»å‹å®‰å…¨ | å¼ºç±»å‹ | å¼±ç±»å‹ |
| å¯é æ€§ | é«˜ | ä¸­ |

### ä¸‹ä¸€ç« é¢„å‘Š

**ç¬¬8ç«  - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ**,å°†å­¦ä¹ :
- ğŸ“ æ–‡ä»¶å’Œç›®å½•æ“ä½œ
- ğŸ” æ–‡ä»¶æœç´¢å’Œè¿‡æ»¤
- ğŸ“ æ–‡ä»¶å†…å®¹å¤„ç†
- ğŸ” æƒé™ç®¡ç†

---

[â† ä¸Šä¸€ç« ](./6-å‡½æ•°ä¸è„šæœ¬.md) | [è¿”å›ç›®å½•](./README.md) | [ä¸‹ä¸€ç« : æ–‡ä»¶ç³»ç»Ÿæ“ä½œ â†’](./8-æ–‡ä»¶ç³»ç»Ÿæ“ä½œ.md)
