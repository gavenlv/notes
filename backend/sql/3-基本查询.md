# 第3章：SQL基本查询

## 3.1 SELECT语句基础

### 什么是SELECT语句？

SELECT语句是SQL中最基本也是最常用的语句，用于从数据库中检索数据。它允许你指定要检索的列、从哪个表检索以及如何过滤和排序结果。

### 基本语法

```sql
SELECT column1, column2, ...
FROM table_name
[WHERE condition]
[ORDER BY column1, column2, ...]
[LIMIT number];
```

### 选择所有列

使用星号(*)可以选择表中的所有列：

```sql
SELECT * FROM table_name;
```

**示例**：
```sql
-- 查询employees表中的所有列
SELECT * FROM employees;

-- 查询departments表中的所有列
SELECT * FROM departments;
```

### 选择特定列

指定列名可以选择特定的列：

```sql
SELECT column1, column2, ... FROM table_name;
```

**示例**：
```sql
-- 只查询员工的姓名和职位
SELECT name, position FROM employees;

-- 查询部门的名称和位置
SELECT name, location FROM departments;
```

### 使用列别名

使用AS关键字可以为列指定别名，使结果更易读：

```sql
SELECT column_name AS alias_name FROM table_name;
```

**示例**：
```sql
-- 为列指定别名
SELECT name AS '员工姓名', position AS '职位', salary AS '薪资' FROM employees;

-- AS关键字可以省略
SELECT name '员工姓名', position '职位', salary '薪资' FROM employees;
```

### 实验验证

让我们创建一个示例数据库并插入一些数据：

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS company_demo CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE company_demo;

-- 创建部门表
CREATE TABLE departments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    manager_id INT,
    location VARCHAR(100),
    budget DECIMAL(12, 2)
);

-- 创建员工表
CREATE TABLE employees (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    age INT,
    gender VARCHAR(10),
    department_id INT,
    position VARCHAR(50),
    salary DECIMAL(10, 2),
    hire_date DATE,
    email VARCHAR(100),
    phone VARCHAR(20),
    is_active BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (department_id) REFERENCES departments(id)
);

-- 插入部门数据
INSERT INTO departments (name, location, budget) VALUES
('技术部', '北京', 1000000.00),
('市场部', '上海', 800000.00),
('人事部', '广州', 500000.00),
('财务部', '深圳', 600000.00);

-- 插入员工数据
INSERT INTO employees (name, age, gender, department_id, position, salary, hire_date, email, phone) VALUES
('张三', 30, '男', 1, '高级工程师', 15000.00, '2020-01-15', 'zhangsan@example.com', '13800138001'),
('李四', 28, '女', 1, '工程师', 12000.00, '2020-03-20', 'lisi@example.com', '13800138002'),
('王五', 35, '男', 2, '市场经理', 18000.00, '2019-06-10', 'wangwu@example.com', '13800138003'),
('赵六', 25, '女', 2, '市场专员', 8000.00, '2021-02-28', 'zhaoliu@example.com', '13800138004'),
('钱七', 32, '男', 3, '人事经理', 16000.00, '2019-11-05', 'qianqi@example.com', '13800138005'),
('孙八', 27, '女', 3, '人事专员', 9000.00, '2020-07-12', 'sunba@example.com', '13800138006'),
('周九', 40, '男', 4, '财务经理', 20000.00, '2018-09-15', 'zhoujiu@example.com', '13800138007'),
('吴十', 29, '女', 4, '会计', 10000.00, '2020-05-20', 'wushi@example.com', '13800138008');
```

现在，让我们执行一些基本的SELECT查询：

```sql
-- 查询所有员工的所有信息
SELECT * FROM employees;

-- 查询员工的姓名、职位和薪资
SELECT name, position, salary FROM employees;

-- 使用别名查询
SELECT name AS '姓名', position AS '职位', salary AS '薪资' FROM employees;
```

## 3.2 WHERE子句

### 什么是WHERE子句？

WHERE子句用于过滤记录，只返回满足指定条件的记录。它是SQL查询中最常用的子句之一。

### 基本语法

```sql
SELECT column1, column2, ...
FROM table_name
WHERE condition;
```

### 比较运算符

WHERE子句中可以使用以下比较运算符：

| 运算符 | 描述 |
|--------|------|
| = | 等于 |
| <> 或 != | 不等于 |
| > | 大于 |
| < | 小于 |
| >= | 大于等于 |
| <= | 小于等于 |

**示例**：
```sql
-- 查询薪资大于12000的员工
SELECT name, position, salary FROM employees WHERE salary > 12000;

-- 查询年龄小于30的员工
SELECT name, age, position FROM employees WHERE age < 30;

-- 查询职位为'工程师'的员工
SELECT name, position, department_id FROM employees WHERE position = '工程师';

-- 查询部门ID不等于1的员工
SELECT name, department_id FROM employees WHERE department_id <> 1;
```

### 逻辑运算符

WHERE子句中可以使用以下逻辑运算符：

| 运算符 | 描述 |
|--------|------|
| AND | 与，两个条件都为真时结果为真 |
| OR | 或，两个条件中至少一个为真时结果为真 |
| NOT | 非，取反 |

**示例**：
```sql
-- 查询薪资大于12000且年龄小于35的员工
SELECT name, age, salary FROM employees WHERE salary > 12000 AND age < 35;

-- 查询部门ID为1或2的员工
SELECT name, department_id FROM employees WHERE department_id = 1 OR department_id = 2;

-- 查询部门ID不为1的员工（使用NOT）
SELECT name, department_id FROM employees WHERE NOT department_id = 1;

-- 复合条件：查询薪资大于10000且（部门ID为1或2）的员工
SELECT name, salary, department_id FROM employees 
WHERE salary > 10000 AND (department_id = 1 OR department_id = 2);
```

### BETWEEN运算符

BETWEEN运算符用于选择给定范围内的值：

```sql
SELECT column1, column2, ...
FROM table_name
WHERE column_name BETWEEN value1 AND value2;
```

**示例**：
```sql
-- 查询年龄在25到30之间的员工
SELECT name, age FROM employees WHERE age BETWEEN 25 AND 30;

-- 查询薪资在10000到15000之间的员工
SELECT name, salary FROM employees WHERE salary BETWEEN 10000 AND 15000;

-- 查询入职日期在2020年之间的员工
SELECT name, hire_date FROM employees WHERE hire_date BETWEEN '2020-01-01' AND '2020-12-31';
```

### IN运算符

IN运算符用于选择给定列表中的值：

```sql
SELECT column1, column2, ...
FROM table_name
WHERE column_name IN (value1, value2, ...);
```

**示例**：
```sql
-- 查询部门ID为1、2或3的员工
SELECT name, department_id FROM employees WHERE department_id IN (1, 2, 3);

-- 查询职位为'工程师'或'市场专员'的员工
SELECT name, position FROM employees WHERE position IN ('工程师', '市场专员');

-- 使用NOT IN
SELECT name, department_id FROM employees WHERE department_id NOT IN (1, 2);
```

### LIKE运算符

LIKE运算符用于在WHERE子句中进行模式匹配，常用于搜索字符串中的特定模式。

| 通配符 | 描述 |
|--------|------|
| % | 替代零个或多个字符 |
| _ | 替代单个字符 |

**示例**：
```sql
-- 查询姓名以'张'开头的员工
SELECT name FROM employees WHERE name LIKE '张%';

-- 查询姓名以'三'结尾的员工
SELECT name FROM employees WHERE name LIKE '%三';

-- 查询姓名包含'五'的员工
SELECT name FROM employees WHERE name LIKE '%五%';

-- 查询姓名第二个字为'五'的员工
SELECT name FROM employees WHERE name LIKE '_五%';

-- 查询姓名为三个字且第二个字为'五'的员工
SELECT name FROM employees WHERE name LIKE '_五_';

-- 使用NOT LIKE
SELECT name FROM employees WHERE name NOT LIKE '张%';
```

### IS NULL运算符

IS NULL运算符用于测试NULL值：

```sql
SELECT column1, column2, ...
FROM table_name
WHERE column_name IS NULL;

-- 或者
WHERE column_name IS NOT NULL;
```

**示例**：
```sql
-- 假设我们有一个可能有NULL值的列
-- 查询phone为NULL的员工
SELECT name, phone FROM employees WHERE phone IS NULL;

-- 查询phone不为NULL的员工
SELECT name, phone FROM employees WHERE phone IS NOT NULL;
```

### 实验验证

让我们使用WHERE子句进行一些查询：

```sql
-- 查询薪资大于12000的员工
SELECT name, position, salary FROM employees WHERE salary > 12000;

-- 查询年龄在25到30之间的员工
SELECT name, age, position FROM employees WHERE age BETWEEN 25 AND 30;

-- 查询部门ID为1或2的员工
SELECT name, department_id FROM employees WHERE department_id IN (1, 2);

-- 查询姓名以'张'开头的员工
SELECT name, position FROM employees WHERE name LIKE '张%';

-- 查询薪资大于10000且（部门ID为1或2）的员工
SELECT name, salary, department_id FROM employees 
WHERE salary > 10000 AND (department_id = 1 OR department_id = 2);
```

## 3.3 ORDER BY子句

### 什么是ORDER BY子句？

ORDER BY子句用于对结果集进行排序，可以按一个或多个列进行排序，并指定升序（ASC）或降序（DESC）。

### 基本语法

```sql
SELECT column1, column2, ...
FROM table_name
ORDER BY column1 [ASC|DESC], column2 [ASC|DESC], ...;
```

### 升序和降序排序

- ASC：升序（默认）
- DESC：降序

**示例**：
```sql
-- 按薪资升序排序（默认）
SELECT name, salary FROM employees ORDER BY salary;

-- 按薪资降序排序
SELECT name, salary FROM employees ORDER BY salary DESC;

-- 按年龄升序排序
SELECT name, age FROM employees ORDER BY age ASC;
```

### 多列排序

可以按多个列进行排序，排序顺序按列的指定顺序执行：

```sql
-- 先按部门ID升序，再按薪资降序排序
SELECT name, department_id, salary FROM employees ORDER BY department_id, salary DESC;

-- 先按职位升序，再按年龄降序排序
SELECT name, position, age FROM employees ORDER BY position, age DESC;
```

### 按列位置排序

可以使用列的位置（从1开始）而不是列名进行排序：

```sql
-- 按第一列（name）排序
SELECT name, age, salary FROM employees ORDER BY 1;

-- 按第三列（salary）降序排序
SELECT name, age, salary FROM employees ORDER BY 3 DESC;
```

### 实验验证

让我们使用ORDER BY子句进行一些查询：

```sql
-- 按薪资升序排序
SELECT name, position, salary FROM employees ORDER BY salary;

-- 按薪资降序排序
SELECT name, position, salary FROM employees ORDER BY salary DESC;

-- 先按部门ID升序，再按薪资降序排序
SELECT name, department_id, salary FROM employees ORDER BY department_id, salary DESC;

-- 按职位升序，再按年龄降序排序
SELECT name, position, age FROM employees ORDER BY position, age DESC;
```

## 3.4 LIMIT子句

### 什么是LIMIT子句？

LIMIT子句用于限制查询结果的数量，常用于分页查询或只获取结果集的前几条记录。

### 基本语法

```sql
SELECT column1, column2, ...
FROM table_name
LIMIT number;

-- 或者用于分页
SELECT column1, column2, ...
FROM table_name
LIMIT offset, count;
```

### 限制结果数量

```sql
-- 只获取前5条记录
SELECT name, position, salary FROM employees LIMIT 5;

-- 获取薪资最高的3名员工
SELECT name, position, salary FROM employees ORDER BY salary DESC LIMIT 3;
```

### 分页查询

LIMIT可以接受两个参数，第一个参数是偏移量（offset），第二个参数是要获取的记录数（count）：

```sql
-- 获取第2页的记录，每页3条记录（跳过前3条，取接下来的3条）
SELECT name, position, salary FROM employees LIMIT 3, 3;

-- 获取第3页的记录，每页2条记录（跳过前4条，取接下来的2条）
SELECT name, position, salary FROM employees LIMIT 4, 2;
```

### 实验验证

让我们使用LIMIT子句进行一些查询：

```sql
-- 获取前3名员工
SELECT name, position, salary FROM employees LIMIT 3;

-- 获取薪资最高的3名员工
SELECT name, position, salary FROM employees ORDER BY salary DESC LIMIT 3;

-- 分页查询：第1页，每页3条记录
SELECT name, position, salary FROM employees LIMIT 0, 3;

-- 分页查询：第2页，每页3条记录
SELECT name, position, salary FROM employees LIMIT 3, 3;
```

## 3.5 数据处理与转换

### 字符串函数

SQL提供了多种字符串函数来处理和转换字符串数据：

| 函数 | 描述 | 示例 |
|------|------|------|
| CONCAT() | 连接字符串 | CONCAT(name, '(', position, ')') |
| UPPER() | 转换为大写 | UPPER(name) |
| LOWER() | 转换为小写 | LOWER(name) |
| LENGTH() | 返回字符串长度 | LENGTH(name) |
| SUBSTRING() | 提取子字符串 | SUBSTRING(name, 1, 2) |
| TRIM() | 去除首尾空格 | TRIM(name) |
| REPLACE() | 替换字符串中的字符 | REPLACE(name, '张', '王') |

**示例**：
```sql
-- 连接字符串
SELECT CONCAT(name, '(', position, ')') AS '员工信息' FROM employees;

-- 转换为大写
SELECT UPPER(name) AS '大写姓名' FROM employees;

-- 获取姓名长度
SELECT name, LENGTH(name) AS '姓名长度' FROM employees;

-- 提取子字符串（从第1个字符开始，取2个字符）
SELECT name, SUBSTRING(name, 1, 2) AS '姓氏' FROM employees;

-- 替换字符串
SELECT REPLACE(name, '张', '王') AS '替换后姓名' FROM employees;
```

### 数值函数

SQL提供了多种数值函数来处理和转换数值数据：

| 函数 | 描述 | 示例 |
|------|------|------|
| ABS() | 返回绝对值 | ABS(salary) |
| CEIL() | 向上取整 | CEIL(salary/1000) |
| FLOOR() | 向下取整 | FLOOR(salary/1000) |
| ROUND() | 四舍五入 | ROUND(salary/1000, 2) |
| MOD() | 返回余数 | MOD(age, 10) |
| POW() | 幂运算 | POW(2, 3) |

**示例**：
```sql
-- 计算年薪（月薪*12）
SELECT name, salary, salary * 12 AS '年薪' FROM employees;

-- 计算薪资的千位数
SELECT name, salary, FLOOR(salary/1000) AS '薪资千位数' FROM employees;

-- 计算薪资的百分比（相对于最高薪资）
SELECT name, salary, ROUND(salary / (SELECT MAX(salary) FROM employees) * 100, 2) AS '薪资百分比' FROM employees;

-- 计算年龄除以10的余数
SELECT name, age, MOD(age, 10) AS '年龄余数' FROM employees;
```

### 日期时间函数

SQL提供了多种日期时间函数来处理和转换日期时间数据：

| 函数 | 描述 | 示例 |
|------|------|------|
| NOW() | 返回当前日期和时间 | NOW() |
| CURDATE() | 返回当前日期 | CURDATE() |
| CURTIME() | 返回当前时间 | CURTIME() |
| YEAR() | 返回年份 | YEAR(hire_date) |
| MONTH() | 返回月份 | MONTH(hire_date) |
| DAY() | 返回日期 | DAY(hire_date) |
| DATE_FORMAT() | 格式化日期 | DATE_FORMAT(hire_date, '%Y-%m-%d') |
| DATEDIFF() | 计算日期差 | DATEDIFF(NOW(), hire_date) |

**示例**：
```sql
-- 获取当前日期和时间
SELECT NOW() AS '当前日期时间', CURDATE() AS '当前日期', CURTIME() AS '当前时间';

-- 提取年、月、日
SELECT name, hire_date, YEAR(hire_date) AS '入职年份', 
       MONTH(hire_date) AS '入职月份', DAY(hire_date) AS '入职日期' 
FROM employees;

-- 计算工作天数
SELECT name, hire_date, DATEDIFF(NOW(), hire_date) AS '工作天数' FROM employees;

-- 格式化日期
SELECT name, DATE_FORMAT(hire_date, '%Y年%m月%d日') AS '格式化入职日期' FROM employees;
```

### 条件表达式

SQL提供了条件表达式来实现类似编程语言中的if-else逻辑：

#### CASE语句

```sql
-- 简单CASE表达式
CASE column_name
    WHEN value1 THEN result1
    WHEN value2 THEN result2
    ...
    ELSE result
END

-- 搜索CASE表达式
CASE
    WHEN condition1 THEN result1
    WHEN condition2 THEN result2
    ...
    ELSE result
END
```

**示例**：
```sql
-- 使用简单CASE表达式
SELECT name, position,
    CASE position
        WHEN '高级工程师' THEN '技术专家'
        WHEN '工程师' THEN '技术人员'
        WHEN '市场经理' THEN '管理人员'
        ELSE '其他人员'
    END AS '人员类别'
FROM employees;

-- 使用搜索CASE表达式
SELECT name, salary,
    CASE
        WHEN salary >= 15000 THEN '高薪'
        WHEN salary >= 10000 THEN '中薪'
        ELSE '普通薪资'
    END AS '薪资等级'
FROM employees;
```

#### IF函数

```sql
IF(condition, value_if_true, value_if_false)
```

**示例**：
```sql
-- 使用IF函数
SELECT name, salary,
    IF(salary >= 12000, '高薪', '普通薪资') AS '薪资等级'
FROM employees;
```

#### IFNULL函数

```sql
IFNULL(value1, value2)
```

如果value1不为NULL，则返回value1；否则返回value2。

**示例**：
```sql
-- 使用IFNULL函数
SELECT name, phone, IFNULL(phone, '未提供') AS '联系电话' FROM employees;
```

### 实验验证

让我们使用这些函数进行一些查询：

```sql
-- 字符串函数示例
SELECT CONCAT(name, '(', position, ')') AS '员工信息' FROM employees;

-- 数值函数示例
SELECT name, salary, salary * 12 AS '年薪' FROM employees;

-- 日期时间函数示例
SELECT name, hire_date, DATEDIFF(NOW(), hire_date) AS '工作天数' FROM employees;

-- 条件表达式示例
SELECT name, salary,
    CASE
        WHEN salary >= 15000 THEN '高薪'
        WHEN salary >= 10000 THEN '中薪'
        ELSE '普通薪资'
    END AS '薪资等级'
FROM employees;
```

## 3.6 本章小结

本章介绍了SQL的基本查询，包括：

1. **SELECT语句基础**：选择所有列、特定列和使用列别名
2. **WHERE子句**：使用比较运算符、逻辑运算符、BETWEEN、IN、LIKE和IS NULL进行数据过滤
3. **ORDER BY子句**：按单列或多列进行升序或降序排序
4. **LIMIT子句**：限制查询结果的数量和实现分页
5. **数据处理与转换**：使用字符串函数、数值函数、日期时间函数和条件表达式处理数据

通过本章的学习，您应该能够：

- 编写基本的SELECT查询
- 使用WHERE子句过滤数据
- 对查询结果进行排序
- 限制查询结果的数量
- 使用各种函数处理和转换数据

## 3.7 思考题

1. WHERE和HAVING有什么区别？
2. BETWEEN运算符和比较运算符组合（如age >= 25 AND age <= 30）有什么区别？
3. LIKE运算符中的%和_有什么区别？
4. ORDER BY子句中，如果同时指定了多列，排序的顺序是怎样的？
5. LIMIT子句的两个参数分别代表什么？如何实现分页查询？

## 3.8 下章预告

在第4章中，我们将学习SQL的高级查询，包括：

- GROUP BY子句和聚合函数
- HAVING子句
- 连接查询（JOIN）
- 子查询
- 集合运算（UNION、INTERSECT、EXCEPT）

---

*继续学习，掌握SQL查询的更多高级技巧！*