# ç¬¬5ç« ï¼šæ¨¡æ¿å­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²å¢å¼º

## 5.1 æ¨¡æ¿å­—ç¬¦ä¸²åŸºç¡€

### 5.1.1 ä»€ä¹ˆæ˜¯æ¨¡æ¿å­—ç¬¦ä¸²

æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆTemplate Literalsï¼‰æ˜¯ES6å¼•å…¥çš„ä¸€ç§æ–°çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼Œä½¿ç”¨åå¼•å·ï¼ˆ`` ` ``ï¼‰è€Œä¸æ˜¯å•å¼•å·æˆ–åŒå¼•å·æ¥å®šä¹‰å­—ç¬¦ä¸²ã€‚æ¨¡æ¿å­—ç¬¦ä¸²æä¾›äº†æ›´å¼ºå¤§ã€æ›´çµæ´»çš„å­—ç¬¦ä¸²å¤„ç†èƒ½åŠ›ã€‚

```javascript
// ä¼ ç»Ÿå­—ç¬¦ä¸²
const traditionalString = 'Hello, world!';

// æ¨¡æ¿å­—ç¬¦ä¸²
const templateString = `Hello, world!`;

console.log(traditionalString); // "Hello, world!"
console.log(templateString);   // "Hello, world!"
```

### 5.1.2 å¤šè¡Œå­—ç¬¦ä¸²

æ¨¡æ¿å­—ç¬¦ä¸²æœ€ç›´è§‚çš„ä¼˜åŠ¿æ˜¯å¯ä»¥è½»æ¾åˆ›å»ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ¢è¡Œç¬¦æˆ–å­—ç¬¦ä¸²è¿æ¥ã€‚

```javascript
// ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸æ¨èï¼‰
const multiLineTraditional = 'Line 1\n' +
                            'Line 2\n' +
                            'Line 3';

// ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²
const multiLineTemplate = `Line 1
Line 2
Line 3`;

console.log(multiLineTemplate);
// è¾“å‡ºï¼š
// Line 1
// Line 2
// Line 3
```

### 5.1.3 å­—ç¬¦ä¸²æ’å€¼

æ¨¡æ¿å­—ç¬¦ä¸²å…è®¸åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥è¡¨è¾¾å¼ï¼Œä½¿ç”¨`${expression}`è¯­æ³•ã€‚è¿™ä½¿å¾—å­—ç¬¦ä¸²æ‹¼æ¥æ›´åŠ ç›´è§‚å’Œç®€æ´ã€‚

```javascript
const name = 'Alice';
const age = 30;

// ä¼ ç»Ÿå­—ç¬¦ä¸²æ‹¼æ¥
const traditionalGreeting = 'Hello, my name is ' + name + ' and I am ' + age + ' years old.';

// æ¨¡æ¿å­—ç¬¦ä¸²æ’å€¼
const templateGreeting = `Hello, my name is ${name} and I am ${age} years old.`;

console.log(traditionalGreeting); // "Hello, my name is Alice and I am 30 years old."
console.log(templateGreeting);     // "Hello, my name is Alice and I am 30 years old."
```

### 5.1.4 è¡¨è¾¾å¼è®¡ç®—

æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„`${}`ä¸ä»…å¯ä»¥åŒ…å«å˜é‡ï¼Œè¿˜å¯ä»¥åŒ…å«ä»»ä½•æœ‰æ•ˆçš„JavaScriptè¡¨è¾¾å¼ã€‚

```javascript
const price = 19.99;
const quantity = 3;
const tax = 0.08;

// è®¡ç®—è¡¨è¾¾å¼
const total = `Total: $${(price * quantity * (1 + tax)).toFixed(2)}`;
console.log(total); // "Total: $64.77"

// ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼
const isLoggedIn = true;
const greeting = `Welcome ${isLoggedIn ? 'back' : 'guest'}!`;
console.log(greeting); // "Welcome back!"

// è°ƒç”¨å‡½æ•°
function formatName(first, last) {
  return `${last}, ${first}`;
}
const fullName = formatName('John', 'Doe');
const formalGreeting = `Dear ${fullName},`;
console.log(formalGreeting); // "Dear Doe, John,"
```

## 5.2 æ ‡ç­¾æ¨¡æ¿

### 5.2.1 æ ‡ç­¾æ¨¡æ¿åŸºç¡€

æ ‡ç­¾æ¨¡æ¿æ˜¯ä¸€ç§æ›´é«˜çº§çš„æ¨¡æ¿å­—ç¬¦ä¸²å½¢å¼ï¼Œå®ƒå…è®¸ä½ é€šè¿‡ä¸€ä¸ªå‡½æ•°ï¼ˆæ ‡ç­¾å‡½æ•°ï¼‰æ¥å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²ã€‚æ ‡ç­¾å‡½æ•°æ¥æ”¶æ¨¡æ¿å­—ç¬¦ä¸²çš„å„ä¸ªéƒ¨åˆ†å’Œæ’å€¼è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ã€‚

```javascript
function simpleTag(strings, ...values) {
  console.log('Strings:', strings);
  console.log('Values:', values);
  return 'Tagged result';
}

const name = 'Alice';
const age = 30;

const result = simpleTag`My name is ${name} and I am ${age} years old.`;
// è¾“å‡ºï¼š
// Strings: ["My name is ", " and I am ", " years old."]
// Values: ["Alice", 30]

console.log(result); // "Tagged result"
```

### 5.2.2 è‡ªå®šä¹‰æ ‡ç­¾å‡½æ•°

æ ‡ç­¾å‡½æ•°å¯ä»¥ç”¨äºå„ç§å­—ç¬¦ä¸²å¤„ç†åœºæ™¯ï¼Œå¦‚è½¬ä¹‰HTMLã€æœ¬åœ°åŒ–ã€æ ¼å¼åŒ–ç­‰ã€‚

```javascript
// HTMLè½¬ä¹‰æ ‡ç­¾
function html(strings, ...values) {
  let result = '';
  for (let i = 0; i < values.length; i++) {
    // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
    const escaped = String(values[i])
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
    
    result += strings[i] + escaped;
  }
  result += strings[strings.length - 1];
  return result;
}

const userInput = '<script>alert("XSS")</script>';
const safeHtml = html`<div>${userInput}</div>`;
console.log(safeHtml);
// è¾“å‡º: <div>&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;</div>

// å¤§å†™è½¬æ¢æ ‡ç­¾
function uppercase(strings, ...values) {
  let result = '';
  for (let i = 0; i < values.length; i++) {
    result += strings[i] + String(values[i]).toUpperCase();
  }
  result += strings[strings.length - 1];
  return result;
}

const message = uppercase`Hello ${'world'} and ${'javascript'}!`;
console.log(message); // "Hello WORLD and JAVASCRIPT!"
```

### 5.2.3 é«˜çº§æ ‡ç­¾æ¨¡æ¿åº”ç”¨

```javascript
// æœ¬åœ°åŒ–æ ‡ç­¾
function i18n(strings, ...values) {
  // ç®€å•çš„æœ¬åœ°åŒ–æ¨¡æ‹Ÿ
  const locale = 'zh-CN';
  const translations = {
    'zh-CN': {
      'Hello': 'ä½ å¥½',
      'Welcome to': 'æ¬¢è¿æ¥åˆ°',
      'Thank you for': 'æ„Ÿè°¢æ‚¨'
    }
  };
  
  let result = '';
  for (let i = 0; i < values.length; i++) {
    // ç¿»è¯‘å­—ç¬¦ä¸²éƒ¨åˆ†
    let translatedPart = strings[i];
    for (const [english, chinese] of Object.entries(translations[locale])) {
      translatedPart = translatedPart.replace(new RegExp(english, 'g'), chinese);
    }
    result += translatedPart + values[i];
  }
  
  // å¤„ç†æœ€åä¸€ä¸ªå­—ç¬¦ä¸²éƒ¨åˆ†
  let lastPart = strings[strings.length - 1];
  for (const [english, chinese] of Object.entries(translations[locale])) {
    lastPart = lastPart.replace(new RegExp(english, 'g'), chinese);
  }
  result += lastPart;
  
  return result;
}

const localizedGreeting = i18n`Hello ${'Alice'}, Welcome to ${'JavaScript'}! Thank you for ${'learning'}.`;
console.log(localizedGreeting); // "ä½ å¥½Alice, æ¬¢è¿æ¥åˆ°JavaScript! æ„Ÿè°¢æ‚¨learning."

// SQLæŸ¥è¯¢æ„å»ºæ ‡ç­¾
function sql(strings, ...values) {
  // ç®€å•çš„SQLå‚æ•°åŒ–æŸ¥è¯¢æ¨¡æ‹Ÿ
  let result = strings[0];
  for (let i = 0; i < values.length; i++) {
    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥ä½¿ç”¨é€‚å½“çš„å‚æ•°åŒ–æŸ¥è¯¢æ–¹æ³•
    result += `'${String(values[i]).replace(/'/g, "''")}'${strings[i + 1]}`;
  }
  return result;
}

const tableName = 'users';
const userId = 5;
const query = sql`SELECT * FROM ${tableName} WHERE id = ${userId}`;
console.log(query); // "SELECT * FROM 'users' WHERE id = '5'"
```

## 5.3 å­—ç¬¦ä¸²æ–°å¢æ–¹æ³•

### 5.3.1 includes()æ–¹æ³•

`includes()`æ–¹æ³•ç”¨äºåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚

```javascript
const sentence = 'The quick brown fox jumps over the lazy dog';

console.log(sentence.includes('fox'));      // true
console.log(sentence.includes('cat'));      // false
console.log(sentence.includes('The'));     // true
console.log(sentence.includes('the', 10));  // trueï¼Œä»ç´¢å¼•10å¼€å§‹æœç´¢
console.log(sentence.includes('the', 20));  // falseï¼Œä»ç´¢å¼•20å¼€å§‹æœç´¢
```

### 5.3.2 startsWith()å’ŒendsWith()æ–¹æ³•

`startsWith()`å’Œ`endsWith()`æ–¹æ³•åˆ†åˆ«ç”¨äºåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šå­—ç¬¦ä¸²å¼€å¤´æˆ–ç»“å°¾ã€‚

```javascript
const filename = 'document.pdf';

console.log(filename.startsWith('document'));  // true
console.log(filename.startsWith('image'));     // false
console.log(filename.endsWith('.pdf'));        // true
console.log(filename.endsWith('.doc'));        // false

// å¯ä»¥æŒ‡å®šèµ·å§‹ä½ç½®
const longString = 'Hello world, welcome to JavaScript';
console.log(longString.startsWith('world', 6));    // trueï¼Œä»ç´¢å¼•6å¼€å§‹æ£€æŸ¥
console.log(longString.endsWith('JavaScript', longString.length)); // true
```

### 5.3.3 repeat()æ–¹æ³•

`repeat()`æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤æŒ‡å®šæ¬¡æ•°ã€‚

```javascript
const star = '*';
console.log(star.repeat(5));     // "*****"
console.log('abc'.repeat(3));    // "abcabcabc"
console.log('test'.repeat(0));   // ""

// åº”ç”¨ï¼šåˆ›å»ºåˆ†éš”çº¿
console.log('='.repeat(30));    // "=============================="

// åº”ç”¨ï¼šå¡«å……å­—ç¬¦ä¸²
function padLeft(str, width, fillChar = ' ') {
  if (str.length >= width) return str;
  const fillCount = width - str.length;
  return fillChar.repeat(fillCount) + str;
}

console.log(padLeft('42', 5, '0'));  // "00042"
console.log(padLeft('hello', 10, '-')); // "-----hello"
```

### 5.3.4 padStart()å’ŒpadEnd()æ–¹æ³•ï¼ˆES2017ï¼‰

`padStart()`å’Œ`padEnd()`æ–¹æ³•ç”¨äºåœ¨å­—ç¬¦ä¸²çš„å¼€å¤´æˆ–ç»“å°¾å¡«å……å­—ç¬¦ï¼Œä½¿å­—ç¬¦ä¸²è¾¾åˆ°æŒ‡å®šé•¿åº¦ã€‚

```javascript
// padStart() - åœ¨å¼€å¤´å¡«å……
console.log('42'.padStart(5, '0'));        // "00042"
console.log('abc'.padStart(10, '*'));      // "*******abc"
console.log('test'.padStart(8));           // "    test" (é»˜è®¤ä½¿ç”¨ç©ºæ ¼)

// padEnd() - åœ¨ç»“å°¾å¡«å……
console.log('42'.padEnd(5, '0'));          // "42000"
console.log('abc'.padEnd(10, '*'));        // "abc*******"
console.log('test'.padEnd(8));             // "test    " (é»˜è®¤ä½¿ç”¨ç©ºæ ¼)

// åº”ç”¨ï¼šæ ¼å¼åŒ–è¾“å‡º
const items = [
  { id: 1, name: 'Apple', price: 1.99 },
  { id: 10, name: 'Banana', price: 0.99 },
  { id: 100, name: 'Cherry', price: 2.99 }
];

console.log('ID'.padEnd(6) + 'Name'.padEnd(10) + 'Price');
console.log('-'.repeat(25));
items.forEach(item => {
  console.log(
    String(item.id).padEnd(6) + 
    item.name.padEnd(10) + 
    '$' + item.price.toFixed(2)
  );
});
// è¾“å‡ºï¼š
// ID    Name      Price
// -------------------------
// 1     Apple     $1.99
// 10    Banana    $0.99
// 100   Cherry    $2.99
```

### 5.3.5 trimStart()å’ŒtrimEnd()æ–¹æ³•ï¼ˆES2019ï¼‰

`trimStart()`å’Œ`trimEnd()`æ–¹æ³•åˆ†åˆ«ç”¨äºåˆ é™¤å­—ç¬¦ä¸²å¼€å¤´æˆ–ç»“å°¾çš„ç©ºç™½å­—ç¬¦ã€‚

```javascript
const paddedString = '   hello world   ';

console.log(`[${paddedString.trim()}]`);        // "[hello world]" (åˆ é™¤ä¸¤ç«¯ç©ºç™½)
console.log(`[${paddedString.trimStart()}]`);   // "[hello world   ]" (åˆ é™¤å¼€å¤´ç©ºç™½)
console.log(`[${paddedString.trimEnd()}]`);     // "[   hello world]" (åˆ é™¤ç»“å°¾ç©ºç™½)

// å…¼å®¹æ€§åˆ«å
console.log(paddedString.trimLeft() === paddedString.trimStart()); // true
console.log(paddedString.trimRight() === paddedString.trimEnd());  // true
```

## 5.4 Unicodeæ”¯æŒå¢å¼º

### 5.4.1 Unicodeç ç‚¹è½¬ä¹‰

ES6æä¾›äº†æ–°çš„Unicodeè½¬ä¹‰åºåˆ—ï¼Œä½¿ç”¨`\u{ç ç‚¹}`è¯­æ³•è¡¨ç¤ºUnicodeå­—ç¬¦ï¼Œå¯ä»¥è¡¨ç¤ºè¶…è¿‡0xFFFFçš„å­—ç¬¦ã€‚

```javascript
// åŸºæœ¬Unicodeå­—ç¬¦
console.log('\u0041'); // "A"

// ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤ºUnicodeç ç‚¹
console.log('\u{41}');  // "A"

// è¡¨ç¤ºè¶…è¿‡0xFFFFçš„å­—ç¬¦
console.log('\u{1F600}'); // "ğŸ˜€" (ç¬‘è„¸è¡¨æƒ…)
console.log('\u{1F603}'); // "ğŸ˜ƒ" (å¤§ç¬‘è¡¨æƒ…)
console.log('\u{1F4A9}'); // "ğŸ’©" (ä¾¿ä¾¿è¡¨æƒ…)

// ä½¿ç”¨String.fromCodePoint()
console.log(String.fromCodePoint(0x1F600)); // "ğŸ˜€"
console.log(String.fromCodePoint(0x41, 0x42, 0x43)); // "ABC"
```

### 5.4.2 codePointAt()æ–¹æ³•

`codePointAt()`æ–¹æ³•è¿”å›å­—ç¬¦ä¸²ä¸­æŒ‡å®šä½ç½®çš„å­—ç¬¦çš„Unicodeç ç‚¹ã€‚

```javascript
const emoji = 'ğŸ˜€'; // ç¬‘è„¸è¡¨æƒ…

console.log(emoji.length);        // 2 (åœ¨UTF-16ä¸­å ç”¨ä¸¤ä¸ªä»£ç å•å…ƒ)
console.log(emoji.charCodeAt(0)); // 55357 (é«˜ä»£ç†é¡¹)
console.log(emoji.charCodeAt(1)); // 56832 (ä½ä»£ç†é¡¹)
console.log(emoji.codePointAt(0)); // 128512 (å®Œæ•´çš„Unicodeç ç‚¹)

// å¤„ç†åŒ…å«ä»£ç†å¯¹çš„å­—ç¬¦ä¸²
const text = 'Hello ğŸ˜€ World';
console.log(text.codePointAt(6)); // 128512 (ç¬‘è„¸è¡¨æƒ…çš„ç ç‚¹)
console.log(text.codePointAt(7)); // 56832 (ä½ä»£ç†é¡¹)
```

### 5.4.3 å­—ç¬¦ä¸²éå†ä¸for...of

ES6çš„`for...of`å¾ªç¯å¯ä»¥æ­£ç¡®éå†åŒ…å«Unicodeä»£ç†å¯¹çš„å­—ç¬¦ä¸²ã€‚

```javascript
const text = 'Hi ğŸ˜€!';

// ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸æ­£ç¡®ï¼‰
console.log('ä½¿ç”¨forå¾ªç¯:');
for (let i = 0; i < text.length; i++) {
  console.log(text[i]);
}
// è¾“å‡º:
// H
// i
//  
// ï¿½
// ï¿½
// !

// ä½¿ç”¨for...ofï¼ˆæ­£ç¡®ï¼‰
console.log('ä½¿ç”¨for...of:');
for (const char of text) {
  console.log(char);
}
// è¾“å‡º:
// H
// i
//  
// ğŸ˜€
// !

// ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼ˆæ­£ç¡®ï¼‰
console.log([...text]); // ["H", "i", " ", "ğŸ˜€", "!"]

// ä½¿ç”¨Array.fromï¼ˆæ­£ç¡®ï¼‰
console.log(Array.from(text)); // ["H", "i", " ", "ğŸ˜€", "!"]
```

### 5.4.4 normalize()æ–¹æ³•

`normalize()`æ–¹æ³•ç”¨äºUnicodeå­—ç¬¦ä¸²çš„æ ‡å‡†åŒ–ï¼Œå¯ä»¥æ¯”è¾ƒä¸åŒç¼–ç å½¢å¼çš„ç›¸åŒå­—ç¬¦ã€‚

```javascript
// ä¸åŒç¼–ç å½¢å¼çš„ç›¸åŒå­—ç¬¦
const str1 = '\u00E9'; // "Ã©" (ç»„åˆå½¢å¼)
const str2 = 'e\u0301'; // "e" + "Â´" (åˆ†è§£å½¢å¼)

console.log(str1 === str2); // false
console.log(str1.length);   // 1
console.log(str2.length);   // 2

// æ ‡å‡†åŒ–åæ¯”è¾ƒ
console.log(str1.normalize() === str2.normalize()); // true

// æ ‡å‡†åŒ–å½¢å¼
console.log(str1.normalize('NFC')); // NFC (Normalization Form C)
console.log(str1.normalize('NFD')); // NFD (Normalization Form D)
console.log(str1.normalize('NFKC')); // NFKC (Normalization Form KC)
console.log(str1.normalize('NFKD')); // NFKD (Normalization Form KD)
```

## 5.5 å®é™…åº”ç”¨åœºæ™¯

### 5.5.1 HTMLæ¨¡æ¿ç”Ÿæˆ

```javascript
// ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ç”ŸæˆHTML
function generateUserCard(user) {
  return `
    <div class="user-card">
      <img src="${user.avatar}" alt="${user.name}" class="avatar">
      <div class="user-info">
        <h3>${user.name}</h3>
        <p>${user.email}</p>
        <p>Member since: ${new Date(user.joinDate).toLocaleDateString()}</p>
        <div class="status ${user.isActive ? 'active' : 'inactive'}">
          ${user.isActive ? 'Active' : 'Inactive'}
        </div>
      </div>
    </div>
  `;
}

const user = {
  name: 'John Doe',
  email: 'john@example.com',
  avatar: 'https://example.com/avatar.jpg',
  joinDate: '2020-01-15',
  isActive: true
};

document.body.innerHTML = generateUserCard(user);
```

### 5.5.2 SQLæŸ¥è¯¢æ„å»º

```javascript
// å®‰å…¨çš„SQLæŸ¥è¯¢æ„å»º
function buildQuery(table, conditions = {}, fields = '*', limit = null) {
  let query = `SELECT ${fields} FROM ${table}`;
  
  if (Object.keys(conditions).length > 0) {
    const whereClause = Object.entries(conditions)
      .map(([key, value]) => `${key} = '${value}'`)
      .join(' AND ');
    query += ` WHERE ${whereClause}`;
  }
  
  if (limit) {
    query += ` LIMIT ${limit}`;
  }
  
  return query;
}

// ä½¿ç”¨ç¤ºä¾‹
const query1 = buildQuery('users', { status: 'active', age: 25 }, 'id, name, email');
console.log(query1); // "SELECT id, name, email FROM users WHERE status = 'active' AND age = '25'"

const query2 = buildQuery('products', {}, '*', 10);
console.log(query2); // "SELECT * FROM products LIMIT 10"
```

### 5.5.3 å›½é™…åŒ–ä¸æœ¬åœ°åŒ–

```javascript
// ç®€å•çš„å›½é™…åŒ–å®ç°
const i18n = {
  en: {
    greeting: 'Hello, {name}!',
    farewell: 'Goodbye, {name}!',
    items: '{count} items'
  },
  zh: {
    greeting: 'ä½ å¥½ï¼Œ{name}ï¼',
    farewell: 'å†è§ï¼Œ{name}ï¼',
    items: '{count} ä»¶å•†å“'
  }
};

function translate(key, locale = 'en', params = {}) {
  const template = i18n[locale][key] || i18n.en[key] || key;
  
  return template.replace(/{(\w+)}/g, (match, param) => {
    return params[param] !== undefined ? params[param] : match;
  });
}

// ä½¿ç”¨ç¤ºä¾‹
console.log(translate('greeting', 'en', { name: 'Alice' })); // "Hello, Alice!"
console.log(translate('greeting', 'zh', { name: 'Alice' })); // "ä½ å¥½ï¼ŒAliceï¼"
console.log(translate('items', 'en', { count: 5 })); // "5 items"
console.log(translate('items', 'zh', { count: 5 })); // "5 ä»¶å•†å“"
```

### 5.5.4 æ—¥å¿—è®°å½•ä¸è°ƒè¯•

```javascript
// ç»“æ„åŒ–æ—¥å¿—è®°å½•
function log(level, message, data = {}) {
  const timestamp = new Date().toISOString();
  const dataStr = Object.keys(data).length > 0 
    ? `\nData: ${JSON.stringify(data, null, 2)}` 
    : '';
  
  console.log(`[${timestamp}] [${level.toUpperCase()}] ${message}${dataStr}`);
}

// ä½¿ç”¨ç¤ºä¾‹
log('info', 'User logged in', { userId: 123, ip: '192.168.1.1' });
log('error', 'Database connection failed', { error: 'Connection timeout', retries: 3 });

// è°ƒè¯•è¾…åŠ©å‡½æ•°
function debug(name, value) {
  console.log(`DEBUG [${name}]:`, value);
  return value;
}

// åœ¨ä»£ç ä¸­ä½¿ç”¨
const result = debug('calculation', complexCalculation());
```

### 5.5.5 åŠ¨æ€æ ·å¼ç”Ÿæˆ

```javascript
// åŠ¨æ€ç”ŸæˆCSSæ ·å¼
function generateCSS(theme) {
  return `
    .button {
      background-color: ${theme.primaryColor};
      color: ${theme.textColor};
      border-radius: ${theme.borderRadius}px;
      padding: ${theme.padding}px;
    }
    
    .button:hover {
      background-color: ${theme.hoverColor};
    }
    
    .card {
      background-color: ${theme.cardBackground};
      border: 1px solid ${theme.borderColor};
      box-shadow: 0 2px 4px rgba(0, 0, 0, ${theme.shadowOpacity});
    }
  `;
}

const darkTheme = {
  primaryColor: '#4a90e2',
  textColor: '#ffffff',
  borderRadius: 4,
  padding: 10,
  hoverColor: '#357abd',
  cardBackground: '#2c3e50',
  borderColor: '#34495e',
  shadowOpacity: 0.3
};

// å°†ç”Ÿæˆçš„CSSæ·»åŠ åˆ°é¡µé¢
const styleElement = document.createElement('style');
styleElement.textContent = generateCSS(darkTheme);
document.head.appendChild(styleElement);
```

## 5.6 å®è·µç»ƒä¹ 

### 5.6.1 ç»ƒä¹ 1ï¼šæ¨¡æ¿å­—ç¬¦ä¸²åº”ç”¨

ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ç”¨æˆ·ä¿¡æ¯å¹¶ç”Ÿæˆæ ¼å¼åŒ–çš„ç”¨æˆ·ç®€ä»‹ï¼š

```javascript
// ç”¨æˆ·ä¿¡æ¯å¯¹è±¡
const user = {
  name: 'Alice Johnson',
  age: 28,
  occupation: 'Web Developer',
  hobbies: ['coding', 'reading', 'hiking'],
  joined: '2020-05-15'
};

// åˆ›å»ºå‡½æ•°generateUserProfileï¼Œä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ç”Ÿæˆç”¨æˆ·ç®€ä»‹
// è¦æ±‚åŒ…å«ï¼š
// 1. ç”¨æˆ·åå’Œå¹´é¾„
// 2. èŒä¸š
// 3. çˆ±å¥½åˆ—è¡¨
// 4. åŠ å…¥æ—¥æœŸï¼ˆæ ¼å¼åŒ–ä¸ºæ˜“è¯»å½¢å¼ï¼‰
// 5. æ ¹æ®å¹´é¾„æ˜¾ç¤ºä¸åŒæ¶ˆæ¯ï¼ˆ18å²ä»¥ä¸‹æ˜¾ç¤º"å¹´è½»ç”¨æˆ·"ï¼Œ18-30æ˜¾ç¤º"é’å¹´ç”¨æˆ·"ï¼Œ30ä»¥ä¸Šæ˜¾ç¤º"æˆç†Ÿç”¨æˆ·"ï¼‰
```

### 5.6.2 ç»ƒä¹ 2ï¼šæ ‡ç­¾æ¨¡æ¿åº”ç”¨

åˆ›å»ºä¸€ä¸ªæ ‡ç­¾æ¨¡æ¿å‡½æ•°`currency`ï¼Œç”¨äºæ ¼å¼åŒ–è´§å¸å€¼ï¼š

```javascript
// è¦æ±‚ï¼š
// 1. æ¥æ”¶è´§å¸å€¼å’Œè´§å¸ä»£ç 
// 2. æ ¹æ®è´§å¸ä»£ç æ·»åŠ é€‚å½“çš„è´§å¸ç¬¦å·
// 3. æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒä½åˆ†éš”ç¬¦ï¼‰
// 4. å¤„ç†å°æ•°ä½æ•°

// ä½¿ç”¨ç¤ºä¾‹ï¼š
// const price = currency`Price: ${19.99} USD`;
// console.log(price); // "Price: $19.99"

// const euroPrice = currency`Price: ${1234.567} EUR`;
// console.log(euroPrice); // "Price: â‚¬1,234.57"
```

### 5.6.3 ç»ƒä¹ 3ï¼šå­—ç¬¦ä¸²æ–¹æ³•åº”ç”¨

ä½¿ç”¨ES6å­—ç¬¦ä¸²æ–¹æ³•å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

```javascript
// 1. æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶ï¼ˆjpg, png, gifï¼‰
function isImageFile(filename) {
  // å®ç°è¿™ä¸ªå‡½æ•°
}

// 2. ç”Ÿæˆå›ºå®šé•¿åº¦çš„IDï¼Œä¸è¶³é•¿åº¦åœ¨å‰é¢è¡¥0
function generateId(id, length = 8) {
  // å®ç°è¿™ä¸ªå‡½æ•°
}

// 3. ä»URLä¸­æå–åŸŸå
function extractDomain(url) {
  // å®ç°è¿™ä¸ªå‡½æ•°
}

// æµ‹è¯•ç”¨ä¾‹
console.log(isImageFile('photo.jpg')); // true
console.log(isImageFile('document.pdf')); // false
console.log(generateId(123, 6)); // "000123"
console.log(extractDomain('https://www.example.com/path/page')); // "www.example.com"
```

## 5.7 æœ€ä½³å®è·µ

### 5.7.1 æ¨¡æ¿å­—ç¬¦ä¸²ä½¿ç”¨å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²**ï¼šåœ¨éœ€è¦å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²è€Œä¸æ˜¯å­—ç¬¦ä¸²è¿æ¥
2. **ä¿æŒç®€æ´**ï¼šé¿å…åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­æ”¾å…¥è¿‡äºå¤æ‚çš„è¡¨è¾¾å¼
3. **é€‚å½“æ¢è¡Œ**ï¼šå¯¹äºé•¿æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œé€‚å½“æ¢è¡Œæé«˜å¯è¯»æ€§
4. **è€ƒè™‘å®‰å…¨æ€§**ï¼šåœ¨ç”ŸæˆHTMLæ—¶ï¼Œè€ƒè™‘ä½¿ç”¨æ ‡ç­¾æ¨¡æ¿è¿›è¡Œè½¬ä¹‰

```javascript
// å¥½çš„å®è·µ
const message = `Hello ${name}, you have ${count} new messages.`;

// é¿å…è¿‡äºå¤æ‚çš„è¡¨è¾¾å¼
const badExample = `The result is ${a > b ? (c * d / e).toFixed(2) : 'N/A'}`;

// æ›´å¥½çš„æ–¹å¼
const result = a > b ? (c * d / e).toFixed(2) : 'N/A';
const goodExample = `The result is ${result}`;
```

### 5.7.2 å­—ç¬¦ä¸²æ–¹æ³•ä½¿ç”¨å»ºè®®

1. **ä½¿ç”¨includes()ä»£æ›¿indexOf()**ï¼šå½“åªéœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ—¶ï¼Œä½¿ç”¨`includes()`æ›´ç›´è§‚
2. **åˆç†ä½¿ç”¨startsWith()å’ŒendsWith()**ï¼šæ£€æŸ¥å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾æ›´æ¸…æ™°
3. **æ³¨æ„æ€§èƒ½**ï¼šå¯¹äºå¤§é‡å­—ç¬¦ä¸²æ“ä½œï¼Œè€ƒè™‘æ€§èƒ½å½±å“
4. **å¤„ç†Unicode**ï¼šå¤„ç†åŒ…å«éASCIIå­—ç¬¦çš„å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨é€‚å½“çš„æ–¹æ³•

```javascript
// å¥½çš„å®è·µ
const text = 'Hello world';
if (text.includes('world')) {
  // å¤„ç†é€»è¾‘
}

// æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
if (filename.endsWith('.jpg') || filename.endsWith('.png')) {
  // å¤„ç†å›¾ç‰‡æ–‡ä»¶
}

// å¤„ç†Unicodeå­—ç¬¦
for (const char of text) {
  // æ­£ç¡®å¤„ç†æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬ä»£ç†å¯¹
}
```

### 5.7.3 æ ‡ç­¾æ¨¡æ¿ä½¿ç”¨å»ºè®®

1. **ç”¨äºç‰¹å®šé¢†åŸŸ**ï¼šæ ‡ç­¾æ¨¡æ¿é€‚åˆç”¨äºç‰¹å®šé¢†åŸŸï¼Œå¦‚HTMLã€SQLã€å›½é™…åŒ–ç­‰
2. **å‘½åæ¸…æ™°**ï¼šæ ‡ç­¾å‡½æ•°ååº”è¯¥æ¸…æ™°è¡¨è¾¾å…¶ç”¨é€”
3. **æ–‡æ¡£è¯´æ˜**ï¼šä¸ºè‡ªå®šä¹‰æ ‡ç­¾å‡½æ•°æä¾›æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜
4. **è€ƒè™‘å®‰å…¨æ€§**ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥æ—¶ï¼Œè€ƒè™‘å®‰å…¨æ€§é—®é¢˜

```javascript
// å¥½çš„å®è·µ
// HTMLè½¬ä¹‰æ ‡ç­¾
function html(strings, ...values) {
  // å®ç°HTMLè½¬ä¹‰é€»è¾‘
}

// SQLæŸ¥è¯¢æ ‡ç­¾
function sql(strings, ...values) {
  // å®ç°å‚æ•°åŒ–æŸ¥è¯¢é€»è¾‘
}

// æœ¬åœ°åŒ–æ ‡ç­¾
function i18n(strings, ...values) {
  // å®ç°æœ¬åœ°åŒ–é€»è¾‘
}
```

## 5.8 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 5.8.1 æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„åå¼•å·é—®é¢˜

**é—®é¢˜**ï¼šåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­éœ€è¦åŒ…å«åå¼•å·å­—ç¬¦

```javascript
// é”™è¯¯æ–¹å¼
const wrong = `This contains a backtick: ` here`;

// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨è½¬ä¹‰å­—ç¬¦
const correct1 = `This contains a backtick: \` here`;

// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥
const correct2 = `This contains a backtick: ` + '`' + ` here`;
```

### 5.8.2 æ ‡ç­¾æ¨¡æ¿ä¸­çš„å‚æ•°å¤„ç†

**é—®é¢˜**ï¼šæ ‡ç­¾æ¨¡æ¿ä¸­çš„å€¼å‚æ•°å¯èƒ½åŒ…å«éœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—ç¬¦

```javascript
// é—®é¢˜ï¼šSQLæ³¨å…¥é£é™©
function unsafeSql(strings, ...values) {
  let result = strings[0];
  for (let i = 0; i < values.length; i++) {
    result += `'${values[i]}'${strings[i + 1]}`; // ä¸å®‰å…¨
  }
  return result;
}

// è§£å†³æ–¹æ¡ˆï¼šå‚æ•°åŒ–æŸ¥è¯¢æˆ–è½¬ä¹‰
function safeSql(strings, ...values) {
  let result = strings[0];
  for (let i = 0; i < values.length; i++) {
    // è½¬ä¹‰å•å¼•å·
    const escaped = String(values[i]).replace(/'/g, "''");
    result += `'${escaped}'${strings[i + 1]}`;
  }
  return result;
}
```

### 5.8.3 Unicodeå­—ç¬¦å¤„ç†é—®é¢˜

**é—®é¢˜**ï¼šå¤„ç†åŒ…å«ä»£ç†å¯¹çš„Unicodeå­—ç¬¦æ—¶å‡ºç°é—®é¢˜

```javascript
// é—®é¢˜ï¼šä½¿ç”¨charAt()æˆ–charCodeAt()å¤„ç†ä»£ç†å¯¹
const emoji = 'ğŸ˜€';
console.log(emoji.charAt(0)); // "" (ç©ºå­—ç¬¦ä¸²)
console.log(emoji.charCodeAt(0)); // 55357 (é«˜ä»£ç†é¡¹)

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨for...ofæˆ–Array.from()
for (const char of emoji) {
  console.log(char); // "ğŸ˜€"
}

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨codePointAt()
console.log(emoji.codePointAt(0)); // 128512 (å®Œæ•´ç ç‚¹)
```

### 5.8.4 æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜

**é—®é¢˜**ï¼šæŸäº›ES6å­—ç¬¦ä¸²æ–¹æ³•åœ¨æ—§æµè§ˆå™¨ä¸­ä¸æ”¯æŒ

```javascript
// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨polyfill
// ä¾‹å¦‚ï¼Œä¸ºString.prototype.includesæ·»åŠ polyfill
if (!String.prototype.includes) {
  String.prototype.includes = function(search, start) {
    if (typeof start !== 'number') {
      start = 0;
    }
    
    if (start + search.length > this.length) {
      return false;
    } else {
      return this.indexOf(search, start) !== -1;
    }
  };
}

// æˆ–è€…ä½¿ç”¨Babelç­‰è½¬è¯‘å·¥å…·
```

## 5.9 æ€»ç»“

ES6å¼•å…¥çš„å­—ç¬¦ä¸²å¢å¼ºåŠŸèƒ½æå¤§åœ°æå‡äº†JavaScriptå¤„ç†å­—ç¬¦ä¸²çš„èƒ½åŠ›ï¼š

1. **æ¨¡æ¿å­—ç¬¦ä¸²**æä¾›äº†æ›´ç›´è§‚ã€æ›´å¼ºå¤§çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼Œæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²å’Œè¡¨è¾¾å¼æ’å€¼
2. **æ ‡ç­¾æ¨¡æ¿**æ‰©å±•äº†å­—ç¬¦ä¸²å¤„ç†çš„å¯èƒ½æ€§ï¼Œé€‚ç”¨äºå„ç§ç‰¹å®šé¢†åŸŸçš„å­—ç¬¦ä¸²å¤„ç†
3. **æ–°å¢å­—ç¬¦ä¸²æ–¹æ³•**å¦‚`includes()`ã€`startsWith()`ã€`endsWith()`ç­‰ç®€åŒ–äº†å¸¸è§çš„å­—ç¬¦ä¸²æ“ä½œ
4. **Unicodeæ”¯æŒå¢å¼º**ä½¿JavaScriptèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å›½é™…åŒ–å’Œç‰¹æ®Šå­—ç¬¦
5. **å­—ç¬¦ä¸²å¡«å……æ–¹æ³•**å¦‚`padStart()`å’Œ`padEnd()`ç®€åŒ–äº†æ ¼å¼åŒ–è¾“å‡º

è¿™äº›ç‰¹æ€§ä¸ä»…æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œç®€æ´æ€§ï¼Œè¿˜å‡å°‘äº†è®¸å¤šå¸¸è§çš„æ ·æ¿ä»£ç ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨è¿™äº›å­—ç¬¦ä¸²å¢å¼ºåŠŸèƒ½å¯ä»¥ç¼–å†™å‡ºæ›´åŠ ç°ä»£ã€ç®€æ´å’Œå¯ç»´æŠ¤çš„JavaScriptä»£ç ã€‚æ— è®ºæ˜¯ç”ŸæˆHTMLã€æ„å»ºSQLæŸ¥è¯¢ï¼Œè¿˜æ˜¯å¤„ç†å›½é™…åŒ–ï¼ŒES6çš„å­—ç¬¦ä¸²å¢å¼ºåŠŸèƒ½éƒ½æä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚