<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第10章：ES6+新特性与最佳实践 - 演示</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background-color: #4a6bdf;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            opacity: 0.8;
            font-size: 1.1rem;
        }
        
        nav {
            background-color: #f1f3f7;
            padding: 15px 20px;
            border-bottom: 1px solid #e1e5eb;
        }
        
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 8px 15px;
            background-color: #e1e5eb;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .nav-btn:hover {
            background-color: #d1d5db;
        }
        
        .nav-btn.active {
            background-color: #4a6bdf;
            color: white;
        }
        
        main {
            padding: 20px;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h2 {
            color: #4a6bdf;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1e5eb;
        }
        
        .demo-container {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f9fafb;
            border: 1px solid #e1e5eb;
        }
        
        .demo-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #4a6bdf;
        }
        
        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .result {
            background-color: #e8f4fd;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .result-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #0c5460;
        }
        
        button {
            padding: 8px 15px;
            background-color: #4a6bdf;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #3a5bcf;
        }
        
        input, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .todo-app {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .todo-form {
            display: flex;
            margin-bottom: 20px;
        }
        
        .todo-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 16px;
        }
        
        .todo-button {
            padding: 10px 15px;
            background-color: #4a6bdf;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .todo-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background-color: #f1f3f7;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .filter-btn.active {
            background-color: #4a6bdf;
            color: white;
            border-color: #4a6bdf;
        }
        
        .todo-list {
            list-style: none;
        }
        
        .todo-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #888;
        }
        
        .todo-checkbox {
            margin-right: 10px;
        }
        
        .todo-text {
            flex: 1;
        }
        
        .todo-delete {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .todo-stats {
            margin-top: 15px;
            text-align: center;
            color: #666;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4a6bdf;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
        }
        
        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .loading-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4a6bdf;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            max-width: 300px;
            z-index: 1001;
        }
        
        .error-message.visible {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>第10章：ES6+新特性与最佳实践</h1>
            <p class="subtitle">探索现代JavaScript的高级特性和最佳实践</p>
        </header>
        
        <nav>
            <div class="nav-buttons">
                <button class="nav-btn active" data-section="es2016-es2022">ES2016-ES2022新特性</button>
                <button class="nav-btn" data-section="performance">性能优化技巧</button>
                <button class="nav-btn" data-section="best-practices">代码风格与最佳实践</button>
                <button class="nav-btn" data-section="todo-app">待办事项应用</button>
                <button class="nav-btn" data-section="common-issues">常见问题与解决方案</button>
            </div>
        </nav>
        
        <main>
            <!-- ES2016-ES2022新特性 -->
            <section id="es2016-es2022" class="section active">
                <h2>ES2016-ES2022新特性演示</h2>
                
                <div class="demo-container">
                    <h3 class="demo-title">Array.prototype.includes()</h3>
                    <div class="code-block">
const fruits = ['apple', 'banana', 'orange'];
console.log(fruits.includes('banana')); // true
console.log(fruits.includes('grape')); // false
                    </div>
                    <button id="test-includes">测试 includes()</button>
                    <div id="includes-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="includes-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">指数运算符 (**)</h3>
                    <div class="code-block">
console.log(2 ** 3); // 8
let x = 2;
x **= 3;
console.log(x); // 8
                    </div>
                    <button id="test-exponent">测试指数运算符</button>
                    <div id="exponent-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="exponent-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">可选链操作符 (?.)</h3>
                    <div class="code-block">
const user = {
    name: '张三',
    address: {
        city: '北京'
    }
};

const city = user?.address?.city;
console.log(city); // '北京'

const zipCode = user?.address?.zipCode;
console.log(zipCode); // undefined
                    </div>
                    <button id="test-optional-chaining">测试可选链操作符</button>
                    <div id="optional-chaining-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="optional-chaining-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">空值合并运算符 (??)</h3>
                    <div class="code-block">
const settings = {
    port: 0,
    timeout: null,
    retries: undefined
};

const port = settings.port ?? 3000;
console.log(port); // 0 (0不是null或undefined)

const timeout = settings.timeout ?? 5000;
console.log(timeout); // 5000 (null触发默认值)
                    </div>
                    <button id="test-nullish-coalescing">测试空值合并运算符</button>
                    <div id="nullish-coalescing-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="nullish-coalescing-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">Array.prototype.at()</h3>
                    <div class="code-block">
const arr = ['a', 'b', 'c', 'd', 'e'];
console.log(arr.at(0)); // 'a'
console.log(arr.at(2)); // 'c'
console.log(arr.at(-1)); // 'e' (最后一个元素)
console.log(arr.at(-2)); // 'd' (倒数第二个元素)
                    </div>
                    <button id="test-array-at">测试 Array.at()</button>
                    <div id="array-at-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="array-at-output"></div>
                    </div>
                </div>
            </section>
            
            <!-- 性能优化技巧 -->
            <section id="performance" class="section">
                <h2>性能优化技巧演示</h2>
                
                <div class="demo-container">
                    <h3 class="demo-title">防抖 (Debounce)</h3>
                    <p>防抖函数会延迟执行，在指定时间内没有新触发才执行。适用于搜索框输入等场景。</p>
                    <input type="text" id="search-input" placeholder="输入搜索内容..." style="width: 100%; padding: 10px;">
                    <div id="search-result" class="result" style="display: none; margin-top: 10px;">
                        <div class="result-title">搜索结果:</div>
                        <div id="search-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">节流 (Throttle)</h3>
                    <p>节流函数会固定时间间隔执行，适用于滚动事件、窗口大小调整等高频事件。</p>
                    <div style="height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                        <div style="height: 1000px; background: linear-gradient(to bottom, #f1f3f7, #e1e5eb);">
                            滚动此区域查看节流效果
                        </div>
                    </div>
                    <div id="scroll-result" class="result" style="display: none; margin-top: 10px;">
                        <div class="result-title">滚动事件触发次数:</div>
                        <div id="scroll-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">批量DOM操作</h3>
                    <p>使用文档片段(DocumentFragment)进行批量DOM操作，减少重排和重绘。</p>
                    <button id="create-elements">创建1000个元素</button>
                    <div id="elements-container" style="margin-top: 10px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;"></div>
                </div>
            </section>
            
            <!-- 代码风格与最佳实践 -->
            <section id="best-practices" class="section">
                <h2>代码风格与最佳实践演示</h2>
                
                <div class="demo-container">
                    <h3 class="demo-title">解构赋值</h3>
                    <div class="code-block">
const user = {
    name: '张三',
    age: 30,
    email: 'zhangsan@example.com',
    address: {
        city: '北京',
        street: '朝阳区'
    }
};

// 对象解构
const { name, age, email } = user;
console.log(name, age, email);

// 嵌套解构
const { address: { city, street } } = user;
console.log(city, street);
                    </div>
                    <button id="test-destructuring">测试解构赋值</button>
                    <div id="destructuring-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="destructuring-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">展开运算符</h3>
                    <div class="code-block">
// 数组展开
const arr1 = [1, 2, 3];
const arr2 = [4, 5, 6];
const combined = [...arr1, ...arr2];
console.log(combined); // [1, 2, 3, 4, 5, 6]

// 对象展开
const obj1 = { a: 1, b: 2 };
const obj2 = { b: 3, c: 4 };
const merged = { ...obj1, ...obj2 };
console.log(merged); // { a: 1, b: 3, c: 4 }
                    </div>
                    <button id="test-spread">测试展开运算符</button>
                    <div id="spread-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="spread-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">函数式编程</h3>
                    <div class="code-block">
const numbers = [1, 2, 3, 4, 5];

// 使用map、filter和reduce
const doubled = numbers.map(n => n * 2);
const evenNumbers = numbers.filter(n => n % 2 === 0);
const sum = numbers.reduce((acc, n) => acc + n, 0);

console.log('原数组:', numbers);
console.log('翻倍:', doubled);
console.log('偶数:', evenNumbers);
console.log('总和:', sum);
                    </div>
                    <button id="test-functional">测试函数式编程</button>
                    <div id="functional-result" class="result" style="display: none;">
                        <div class="result-title">运行结果:</div>
                        <div id="functional-output"></div>
                    </div>
                </div>
            </section>
            
            <!-- 待办事项应用 -->
            <section id="todo-app" class="section">
                <h2>现代化待办事项应用</h2>
                
                <div class="todo-app">
                    <form id="add-todo-form" class="todo-form">
                        <input type="text" id="todo-input" class="todo-input" placeholder="添加新的待办事项..." required>
                        <button type="submit" class="todo-button">添加</button>
                    </form>
                    
                    <div class="todo-filters">
                        <button class="filter-btn active" data-filter="all">全部</button>
                        <button class="filter-btn" data-filter="active">待完成</button>
                        <button class="filter-btn" data-filter="completed">已完成</button>
                    </div>
                    
                    <ul id="todo-list" class="todo-list"></ul>
                    
                    <div id="todo-stats" class="todo-stats"></div>
                </div>
            </section>
            
            <!-- 常见问题与解决方案 -->
            <section id="common-issues" class="section">
                <h2>常见问题与解决方案演示</h2>
                
                <div class="demo-container">
                    <h3 class="demo-title">异步操作问题</h3>
                    <p>使用async/await避免回调地狱，使异步代码更易读和维护。</p>
                    <button id="test-async">测试异步操作</button>
                    <div id="async-result" class="result" style="display: none;">
                        <div class="result-title">异步操作结果:</div>
                        <div id="async-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">this绑定问题</h3>
                    <p>使用箭头函数或bind方法解决this指向不明确的问题。</p>
                    <button id="test-this-binding">测试this绑定</button>
                    <div id="this-binding-result" class="result" style="display: none;">
                        <div class="result-title">this绑定测试结果:</div>
                        <div id="this-binding-output"></div>
                    </div>
                </div>
                
                <div class="demo-container">
                    <h3 class="demo-title">内存泄漏问题</h3>
                    <p>提供清理方法，移除事件监听器和定时器，避免内存泄漏。</p>
                    <button id="create-component">创建组件</button>
                    <button id="destroy-component" disabled>销毁组件</button>
                    <div id="component-status" class="result" style="display: none; margin-top: 10px;">
                        <div class="result-title">组件状态:</div>
                        <div id="component-output"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>
    
    <div class="error-message" id="error-message"></div>
    
    <script>
        // 导航功能
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const sectionId = btn.dataset.section;
                
                // 更新按钮状态
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // 显示对应内容
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');
            });
        });
        
        // 结果显示函数
        function showResult(resultId, outputId, content) {
            const resultElement = document.getElementById(resultId);
            const outputElement = document.getElementById(outputId);
            
            outputElement.textContent = content;
            resultElement.style.display = 'block';
        }
        
        // ES2016-ES2022新特性演示
        
        // Array.prototype.includes()
        document.getElementById('test-includes').addEventListener('click', () => {
            const fruits = ['apple', 'banana', 'orange'];
            const result1 = fruits.includes('banana');
            const result2 = fruits.includes('grape');
            const result3 = [NaN].includes(NaN);
            
            showResult('includes-result', 'includes-output', 
                `fruits.includes('banana'): ${result1}\n` +
                `fruits.includes('grape'): ${result2}\n` +
                `[NaN].includes(NaN): ${result3}`
            );
        });
        
        // 指数运算符
        document.getElementById('test-exponent').addEventListener('click', () => {
            const result1 = 2 ** 3;
            let x = 2;
            x **= 3;
            const result2 = x;
            
            showResult('exponent-result', 'exponent-output', 
                `2 ** 3 = ${result1}\n` +
                `let x = 2; x **= 3; x = ${result2}`
            );
        });
        
        // 可选链操作符
        document.getElementById('test-optional-chaining').addEventListener('click', () => {
            const user = {
                name: '张三',
                address: {
                    city: '北京'
                }
            };
            
            const city = user?.address?.city;
            const zipCode = user?.address?.zipCode;
            
            showResult('optional-chaining-result', 'optional-chaining-output', 
                `user?.address?.city: ${city}\n` +
                `user?.address?.zipCode: ${zipCode}`
            );
        });
        
        // 空值合并运算符
        document.getElementById('test-nullish-coalescing').addEventListener('click', () => {
            const settings = {
                port: 0,
                timeout: null,
                retries: undefined
            };
            
            const port = settings.port ?? 3000;
            const timeout = settings.timeout ?? 5000;
            const retries = settings.retries ?? 3;
            
            showResult('nullish-coalescing-result', 'nullish-coalescing-output', 
                `settings.port ?? 3000: ${port}\n` +
                `settings.timeout ?? 5000: ${timeout}\n` +
                `settings.retries ?? 3: ${retries}`
            );
        });
        
        // Array.prototype.at()
        document.getElementById('test-array-at').addEventListener('click', () => {
            const arr = ['a', 'b', 'c', 'd', 'e'];
            const result1 = arr.at(0);
            const result2 = arr.at(2);
            const result3 = arr.at(-1);
            const result4 = arr.at(-2);
            
            showResult('array-at-result', 'array-at-output', 
                `arr.at(0): ${result1}\n` +
                `arr.at(2): ${result2}\n` +
                `arr.at(-1): ${result3}\n` +
                `arr.at(-2): ${result4}`
            );
        });
        
        // 性能优化技巧演示
        
        // 防抖
        function debounce(func, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        }
        
        const debouncedSearch = debounce((query) => {
            showResult('search-result', 'search-output', `搜索: "${query}"`);
        }, 300);
        
        document.getElementById('search-input').addEventListener('input', (e) => {
            if (e.target.value.trim()) {
                debouncedSearch(e.target.value);
            } else {
                document.getElementById('search-result').style.display = 'none';
            }
        });
        
        // 节流
        function throttle(func, interval) {
            let lastTime = 0;
            return function(...args) {
                const now = Date.now();
                if (now - lastTime >= interval) {
                    func.apply(this, args);
                    lastTime = now;
                }
            };
        }
        
        let scrollCount = 0;
        const throttledScroll = throttle(() => {
            scrollCount++;
            showResult('scroll-result', 'scroll-output', `滚动事件触发次数: ${scrollCount}`);
        }, 200);
        
        document.querySelector('#performance .demo-container:nth-child(2) > div').addEventListener('scroll', throttledScroll);
        
        // 批量DOM操作
        document.getElementById('create-elements').addEventListener('click', () => {
            const container = document.getElementById('elements-container');
            container.innerHTML = '';
            
            // 创建文档片段
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < 1000; i++) {
                const element = document.createElement('div');
                element.textContent = `元素 ${i + 1}`;
                element.style.padding = '5px';
                element.style.borderBottom = '1px solid #eee';
                fragment.appendChild(element);
            }
            
            // 一次性添加到DOM
            container.appendChild(fragment);
        });
        
        // 代码风格与最佳实践演示
        
        // 解构赋值
        document.getElementById('test-destructuring').addEventListener('click', () => {
            const user = {
                name: '张三',
                age: 30,
                email: 'zhangsan@example.com',
                address: {
                    city: '北京',
                    street: '朝阳区'
                }
            };
            
            // 对象解构
            const { name, age, email } = user;
            
            // 嵌套解构
            const { address: { city, street } } = user;
            
            showResult('destructuring-result', 'destructuring-output', 
                `解构: name = ${name}, age = ${age}, email = ${email}\n` +
                `嵌套解构: city = ${city}, street = ${street}`
            );
        });
        
        // 展开运算符
        document.getElementById('test-spread').addEventListener('click', () => {
            // 数组展开
            const arr1 = [1, 2, 3];
            const arr2 = [4, 5, 6];
            const combined = [...arr1, ...arr2];
            
            // 对象展开
            const obj1 = { a: 1, b: 2 };
            const obj2 = { b: 3, c: 4 };
            const merged = { ...obj1, ...obj2 };
            
            showResult('spread-result', 'spread-output', 
                `数组展开: [${arr1}] + [${arr2}] = [${combined}]\n` +
                `对象展开: ${JSON.stringify(obj1)} + ${JSON.stringify(obj2)} = ${JSON.stringify(merged)}`
            );
        });
        
        // 函数式编程
        document.getElementById('test-functional').addEventListener('click', () => {
            const numbers = [1, 2, 3, 4, 5];
            
            // 使用map、filter和reduce
            const doubled = numbers.map(n => n * 2);
            const evenNumbers = numbers.filter(n => n % 2 === 0);
            const sum = numbers.reduce((acc, n) => acc + n, 0);
            
            showResult('functional-result', 'functional-output', 
                `原数组: [${numbers}]\n` +
                `翻倍: [${doubled}]\n` +
                `偶数: [${evenNumbers}]\n` +
                `总和: ${sum}`
            );
        });
        
        // 待办事项应用
        class TodoApp {
            constructor() {
                this.todos = JSON.parse(localStorage.getItem('todos')) || [];
                this.filter = 'all'; // all, active, completed
                this.nextId = this.todos.length > 0 ? Math.max(...this.todos.map(t => parseInt(t.id))) + 1 : 1;
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.render();
            }
            
            bindEvents() {
                document.querySelector('#add-todo-form').addEventListener('submit', this.handleAddTodo.bind(this));
                document.querySelector('.todo-filters').addEventListener('click', this.handleFilterChange.bind(this));
            }
            
            handleAddTodo(event) {
                event.preventDefault();
                const input = document.querySelector('#todo-input');
                const text = input.value.trim();
                
                if (!text) return;
                
                const todo = {
                    id: this.nextId++,
                    text,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                this.todos = [...this.todos, todo];
                this.saveTodos();
                this.render();
                
                input.value = '';
            }
            
            handleToggleTodo(id) {
                this.todos = this.todos.map(todo =>
                    todo.id === id ? { ...todo, completed: !todo.completed } : todo
                );
                this.saveTodos();
                this.render();
            }
            
            handleDeleteTodo(id) {
                this.todos = this.todos.filter(todo => todo.id !== id);
                this.saveTodos();
                this.render();
            }
            
            handleFilterChange(event) {
                if (event.target.tagName !== 'BUTTON') return;
                
                this.filter = event.target.dataset.filter;
                this.updateFilterButtons();
                this.render();
            }
            
            getFilteredTodos() {
                switch (this.filter) {
                    case 'active':
                        return this.todos.filter(todo => !todo.completed);
                    case 'completed':
                        return this.todos.filter(todo => todo.completed);
                    default:
                        return this.todos;
                }
            }
            
            render() {
                const todoList = document.querySelector('#todo-list');
                const filteredTodos = this.getFilteredTodos();
                
                todoList.innerHTML = '';
                
                if (filteredTodos.length === 0) {
                    todoList.innerHTML = '<li class="empty-message">没有待办事项</li>';
                    return;
                }
                
                filteredTodos.forEach(todo => {
                    const todoItem = document.createElement('li');
                    todoItem.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                    todoItem.innerHTML = `
                        <input type="checkbox" ${todo.completed ? 'checked' : ''} data-id="${todo.id}" class="todo-checkbox">
                        <span class="todo-text">${todo.text}</span>
                        <button class="todo-delete" data-id="${todo.id}">删除</button>
                    `;
                    
                    todoItem.querySelector('.todo-checkbox').addEventListener('change', () => {
                        this.handleToggleTodo(todo.id);
                    });
                    
                    todoItem.querySelector('.todo-delete').addEventListener('click', () => {
                        this.handleDeleteTodo(todo.id);
                    });
                    
                    todoList.appendChild(todoItem);
                });
                
                this.updateStats();
            }
            
            updateStats() {
                const total = this.todos.length;
                const completed = this.todos.filter(todo => todo.completed).length;
                const active = total - completed;
                
                document.querySelector('#todo-stats').textContent = 
                    `总计: ${total} | 待完成: ${active} | 已完成: ${completed}`;
            }
            
            updateFilterButtons() {
                document.querySelectorAll('.filter-btn').forEach(button => {
                    button.classList.toggle('active', button.dataset.filter === this.filter);
                });
            }
            
            saveTodos() {
                localStorage.setItem('todos', JSON.stringify(this.todos));
            }
        }
        
        // 初始化待办事项应用
        const todoApp = new TodoApp();
        
        // 常见问题与解决方案演示
        
        // 异步操作问题
        document.getElementById('test-async').addEventListener('click', async () => {
            const output = document.getElementById('async-output');
            output.textContent = '开始异步操作...';
            
            try {
                // 模拟异步操作
                const step1 = await new Promise(resolve => {
                    setTimeout(() => resolve('步骤1完成'), 500);
                });
                
                output.textContent += '\n' + step1;
                
                const step2 = await new Promise(resolve => {
                    setTimeout(() => resolve('步骤2完成'), 500);
                });
                
                output.textContent += '\n' + step2;
                
                const step3 = await new Promise(resolve => {
                    setTimeout(() => resolve('步骤3完成'), 500);
                });
                
                output.textContent += '\n' + step3;
                output.textContent += '\n\n所有异步操作完成！';
            } catch (error) {
                output.textContent += '\n\n异步操作失败: ' + error.message;
            }
            
            showResult('async-result', 'async-output', output.textContent);
        });
        
        // this绑定问题
        document.getElementById('test-this-binding').addEventListener('click', () => {
            const obj = {
                name: '张三',
                greet: function() {
                    const result1 = `Hello, ${this.name}`;
                    
                    // 使用箭头函数
                    setTimeout(() => {
                        const result2 = `Goodbye, ${this.name}`;
                        showResult('this-binding-result', 'this-binding-output', 
                            `${result1}\n${result2}`
                        );
                    }, 100);
                }
            };
            
            obj.greet();
        });
        
        // 内存泄漏问题
        let component = null;
        
        class Component {
            constructor() {
                this.data = new Array(100).fill(0);
                
                // 绑定方法并保存引用
                this.handleResize = this.handleResize.bind(this);
                this.updateData = this.updateData.bind(this);
                
                // 添加事件监听器
                window.addEventListener('resize', this.handleResize);
                
                // 设置定时器
                this.timer = setInterval(this.updateData, 1000);
                
                this.logStatus('组件已创建');
            }
            
            handleResize() {
                this.logStatus('处理窗口大小变化');
            }
            
            updateData() {
                this.logStatus('更新数据');
            }
            
            logStatus(message) {
                const output = document.getElementById('component-output');
                output.textContent += '\n' + new Date().toLocaleTimeString() + ': ' + message;
                
                // 自动滚动到底部
                output.scrollTop = output.scrollHeight;
            }
            
            // 提供清理方法
            destroy() {
                // 移除事件监听器
                window.removeEventListener('resize', this.handleResize);
                
                // 清除定时器
                clearInterval(this.timer);
                
                // 清空数据
                this.data = null;
                
                this.logStatus('组件已销毁');
            }
        }
        
        document.getElementById('create-component').addEventListener('click', () => {
            if (component) {
                component.destroy();
            }
            
            component = new Component();
            document.getElementById('create-component').disabled = true;
            document.getElementById('destroy-component').disabled = false;
            
            showResult('component-status', 'component-output', '');
        });
        
        document.getElementById('destroy-component').addEventListener('click', () => {
            if (component) {
                component.destroy();
                component = null;
                
                document.getElementById('create-component').disabled = false;
                document.getElementById('destroy-component').disabled = true;
            }
        });
    </script>
</body>
</html>