<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第8章 - CSS性能优化与调试</title>
    <style>
        /* === 全局重置和基础样式 === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* 根变量定义 */
        :root {
            --color-primary: #3498db;
            --color-secondary: #2ecc71;
            --color-accent: #e74c3c;
            --color-text: #333;
            --color-text-light: #666;
            --color-background: #f9f9f9;
            --color-card: #ffffff;
            --color-border: #ddd;
            --color-success: #27ae60;
            --color-warning: #f39c12;
            --color-danger: #e74c3c;
            --color-info: #3498db;
            --border-radius: 8px;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
        }
        
        /* 基础排版 */
        html {
            font-size: 16px;
            line-height: 1.5;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--color-text);
            background-color: var(--color-background);
            padding: var(--spacing-lg);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--color-card);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }
        
        h1 {
            color: var(--color-primary);
            font-size: 2.5rem;
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }
        
        h2 {
            color: var(--color-primary);
            font-size: 1.875rem;
            margin: var(--spacing-2xl) 0 var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-border);
        }
        
        h3 {
            color: var(--color-secondary);
            font-size: 1.5rem;
            margin: var(--spacing-xl) 0 var(--spacing-md);
        }
        
        h4 {
            color: var(--color-text);
            font-size: 1.25rem;
            margin: var(--spacing-lg) 0 var(--spacing-sm);
        }
        
        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text-light);
        }
        
        .section {
            margin-bottom: var(--spacing-2xl);
        }
        
        .demo-box {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-sm);
            transition: box-shadow var(--transition-normal);
        }
        
        .demo-box:hover {
            box-shadow: var(--shadow-md);
        }
        
        .code-example {
            background-color: #f4f4f4;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            margin: var(--spacing-md) 0;
            white-space: pre-wrap;
            line-height: 1.4;
        }
        
        /* === 1. CSS 性能优化基础 === */
        /* 选择器性能比较示例 */
        .selector-performance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .selector-card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            transition: all var(--transition-normal);
        }
        
        .selector-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .selector-card h4 {
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .selector-card .performance-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
        }
        
        .performance-badge.fast {
            background-color: #e6f7ed;
            color: #1890ff;
        }
        
        .performance-badge.medium {
            background-color: #fff7e6;
            color: #fa8c16;
        }
        
        .performance-badge.slow {
            background-color: #fff1f0;
            color: #ff4d4f;
        }
        
        /* === 2. 重排与重绘优化 === */
        .repaint-demo {
            margin: var(--spacing-lg) 0;
        }
        
        .demo-elements {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            margin: var(--spacing-md) 0;
        }
        
        .demo-box-item {
            width: 100px;
            height: 100px;
            background-color: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-normal);
        }
        
        .demo-box-item.repaint-only {
            /* 仅触发重绘的样式 */
        }
        
        .demo-box-item.repaint-only:hover {
            background-color: var(--color-secondary);
            opacity: 0.8;
        }
        
        .demo-box-item.reflow {
            /* 触发重排和重绘的样式 */
        }
        
        .demo-box-item.reflow:hover {
            width: 120px;
            height: 120px;
            margin: 0 10px;
        }
        
        .demo-actions {
            margin: var(--spacing-md) 0;
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-lg);
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition-fast);
            text-decoration: none;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        .btn-secondary {
            background-color: var(--color-secondary);
        }
        
        .btn-secondary:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: var(--color-warning);
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        /* === 3. 渲染性能可视化 === */
        .performance-chart {
            display: flex;
            height: 200px;
            margin: var(--spacing-lg) 0;
            gap: var(--spacing-sm);
            align-items: flex-end;
        }
        
        .chart-bar {
            flex: 1;
            background-color: var(--color-primary);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height var(--transition-normal);
        }
        
        .chart-bar-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--color-text);
            white-space: nowrap;
        }
        
        /* === 4. CSS 优化技术演示 === */
        .optimization-techniques {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .technique-card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            transition: all var(--transition-normal);
        }
        
        .technique-card:hover {
            box-shadow: var(--shadow-md);
        }
        
        .technique-card h4 {
            color: var(--color-success);
            margin-bottom: var(--spacing-sm);
        }
        
        .technique-card .technique-badge {
            display: inline-block;
            padding: 4px 8px;
            background-color: #e6f7ff;
            color: var(--color-info);
            border-radius: 4px;
            font-size: 0.875rem;
            margin-bottom: var(--spacing-md);
        }
        
        /* === 5. CSS 调试工具演示 === */
        .debug-tools {
            margin: var(--spacing-lg) 0;
        }
        
        .debug-panel {
            background-color: #f0f0f0;
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin: var(--spacing-md) 0;
        }
        
        .debug-item {
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }
        
        .debug-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .debug-item h5 {
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
            font-size: 1.1rem;
        }
        
        /* === 6. 实际性能案例演示 === */
        .performance-test-area {
            background-color: #f5f5f5;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius);
            margin: var(--spacing-lg) 0;
        }
        
        .test-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .test-box {
            background-color: var(--color-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }
        
        .test-box h4 {
            color: var(--color-text);
            margin-bottom: var(--spacing-md);
        }
        
        .result-display {
            background-color: #fafafa;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            min-height: 80px;
            margin-top: var(--spacing-md);
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
        }
        
        /* === 7. CSS 最佳实践示例 === */
        .best-practices {
            counter-reset: practice;
        }
        
        .practice-item {
            margin-bottom: var(--spacing-lg);
            padding-left: var(--spacing-xl);
            position: relative;
        }
        
        .practice-item::before {
            counter-increment: practice;
            content: counter(practice);
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            background-color: var(--color-primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .practice-item h4 {
            color: var(--color-text);
            margin-bottom: var(--spacing-sm);
        }
        
        .practice-item code {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        
        /* === 8. CSS 工具推荐 === */
        .css-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .tool-card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            transition: all var(--transition-normal);
        }
        
        .tool-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .tool-card h4 {
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .tool-card .tool-type {
            display: inline-block;
            padding: 4px 8px;
            background-color: #f0f0f0;
            color: var(--color-text-light);
            border-radius: 4px;
            font-size: 0.875rem;
            margin-bottom: var(--spacing-md);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-lg);
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .selector-performance,
            .optimization-techniques,
            .test-container,
            .css-tools {
                grid-template-columns: 1fr;
            }
        }
        
        /* 额外的CSS优化示例样式 */
        .performance-tip {
            background-color: #e6f7ff;
            padding: var(--spacing-md);
            border-left: 4px solid var(--color-primary);
            margin: var(--spacing-md) 0;
            font-size: 0.95rem;
        }
        
        .warning {
            background-color: #fff7e6;
            padding: var(--spacing-md);
            border-left: 4px solid var(--color-warning);
            margin: var(--spacing-md) 0;
            font-size: 0.95rem;
        }
        
        .highlight {
            background-color: #f6ffed;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        /* 高效的动画性能类 */
        .optimized-animation {
            will-change: transform, opacity;
            backface-visibility: hidden;
            perspective: 1000px;
        }
        
        /* CSS变量性能优化 */
        .theme-light {
            --color-bg: #ffffff;
            --color-text: #333333;
        }
        
        .theme-dark {
            --color-bg: #121212;
            --color-text: #f0f0f0;
        }
        
        /* 高效的选择器示例 */
        .card {
            /* 比 .container .card 更高效 */
        }
        
        .card-header {
            /* 比 .card .header 更高效 */
        }
        
        /* 避免的低效选择器 */
        /* 以下是不推荐的写法示例 */
        /* div.card {} */
        /* .container > div > .card {} */
        /* .card * {} */
    </style>
</head>
<body>
    <div class="container">
        <h1>第8章 - CSS性能优化与调试</h1>
        
        <div class="section">
            <h2>1. CSS 性能优化基础</h2>
            <p>CSS 性能优化是前端开发中至关重要的一环。良好的 CSS 性能可以显著提升页面加载速度、交互流畅度和用户体验。</p>
            <p>主要关注点：</p>
            <ul>
                <li>选择器效率</li>
                <li>重排与重绘</li>
                <li>CSS 文件大小优化</li>
                <li>渲染性能优化</li>
            </ul>
            <div class="demo-box">
                <h3>选择器性能比较</h3>
                <p>CSS 选择器的性能从高到低排序：</p>
                
                <div class="selector-performance">
                    <div class="selector-card">
                        <span class="performance-badge fast">最快</span>
                        <h4>ID 选择器 (#id)</h4>
                        <p>性能最佳，因为 ID 在页面中是唯一的，浏览器可以直接定位。</p>
                        <div class="code-example">#header {
    color: var(--color-primary);
}</div>
                    </div>
                    <div class="selector-card">
                        <span class="performance-badge fast">非常快</span>
                        <h4>类选择器 (.class)</h4>
                        <p>性能优秀，现代浏览器对类选择器有特别的优化。</p>
                        <div class="code-example">.card {
    border-radius: var(--border-radius);
}</div>
                    </div>
                    <div class="selector-card">
                        <span class="performance-badge medium">中等</span>
                        <h4>元素选择器 (element)</h4>
                        <p>性能良好，但需要遍历特定类型的所有元素。</p>
                        <div class="code-example">p {
    line-height: 1.6;
}</div>
                    </div>
                    <div class="selector-card">
                        <span class="performance-badge slow">较慢</span>
                        <h4>伪类和属性选择器</h4>
                        <p>性能较低，因为需要额外的条件判断。</p>
                        <div class="code-example">a:hover {
    color: var(--color-secondary);
}

input[type="text"] {
    border: 1px solid var(--color-border);
}</div>
                    </div>
                    <div class="selector-card">
                        <span class="performance-badge slow">最慢</span>
                        <h4>后代和通用选择器</h4>
                        <p>性能最差，需要遍历大量元素。</p>
                        <div class="code-example">div p {
    margin-bottom: var(--spacing-md);
}

* {
    box-sizing: border-box;
}</div>
                    </div>
                </div>
                <div class="performance-tip">
                    <strong>性能提示：</strong>避免使用过于复杂的选择器，优先使用类选择器，保持选择器的简洁性。
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>2. 重排与重绘优化</h2>
            <p>浏览器渲染过程中的两个关键概念：</p>
            <ul>
                <li><strong>重排 (Reflow)：</strong>当元素的尺寸、位置、结构发生变化时，浏览器需要重新计算元素的几何属性并重新布局。</li>
                <li><strong>重绘 (Repaint)：</strong>当元素的视觉属性（如颜色、背景、透明度）发生变化，但几何属性未变时，浏览器只需重新绘制元素的视觉效果。</li>
            </ul>
            <p>重排的开销远大于重绘，优化重排是提升性能的关键。</p>
            <div class="demo-box">
                <h3>重排与重绘演示</h3>
                <p>尝试将鼠标悬停在下面的方块上，观察不同的性能影响：</p>
                <div class="demo-elements">
                    <div class="demo-box-item repaint-only">仅重绘
                        <small style="display: block; font-size: 0.75rem; margin-top: 4px;">颜色/透明度变化</small>
                    </div>
                    <div class="demo-box-item repaint-only">仅重绘
                        <small style="display: block; font-size: 0.75rem; margin-top: 4px;">颜色/透明度变化</small>
                    </div>
                    <div class="demo-box-item repaint-only">仅重绘
                        <small style="display: block; font-size: 0.75rem; margin-top: 4px;">颜色/透明度变化</small>
                    </div>
                    <div class="demo-box-item reflow">触发重排
                        <small style="display: block; font-size: 0.75rem; margin-top: 4px;">尺寸/位置变化</small>
                    </div>
                    <div class="demo-box-item reflow">触发重排
                        <small style="display: block; font-size: 0.75rem; margin-top: 4px;">尺寸/位置变化</small>
                    </div>
                </div>
                <div class="demo-actions">
                    <button class="btn btn-secondary" id="batch-update-btn">批量更新DOM（优化）</button>
                    <button class="btn btn-warning" id="naive-update-btn">逐个更新DOM（低效）</button>
                </div>
                <div class="result-display" id="performance-result">性能测试结果将显示在这里...</div>
            </div>
            <div class="demo-box">
                <h3>重排触发因素</h3>
                <ul>
                    <li>改变元素的尺寸（width, height, padding, margin）</li>
                    <li>改变元素的位置（top, left, right, bottom, transform）</li>
                    <li>改变元素的内容（text, images）</li>
                    <li>添加或删除DOM元素</li>
                    <li>修改CSS类</li>
                    <li>浏览器窗口大小调整</li>
                    <li>计算offsetWidth、offsetHeight等几何属性</li>
                </ul>
                <h3>重排优化策略</h3>
                <ul>
                    <li>批量操作DOM元素（使用DocumentFragment）</li>
                    <li>使用CSS类批量修改样式，而不是直接修改样式属性</li>
                    <li>避免频繁读取几何属性，使用缓存变量存储计算结果</li>
                    <li>使用绝对定位或固定定位将元素移出文档流</li>
                    <li>使用CSS transforms和opacity进行动画（触发GPU加速）</li>
                    <li>减少使用table布局（table会触发复杂的重排）</li>
                    <li>使用requestAnimationFrame优化动画性能</li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <h2>3. 渲染性能可视化</h2>
            <p>了解不同CSS操作对渲染性能的影响，有助于我们进行有针对性的优化。</p>
            <div class="demo-box">
                <h3>CSS操作性能对比图</h3>
                <div class="performance-chart">
                    <div class="chart-bar" style="height: 20%;">
                        <span class="chart-bar-label">修改颜色/透明度
                            (轻量级)</span>
                    </div>
                    <div class="chart-bar" style="height: 40%;">
                        <span class="chart-bar-label">使用Transform
                            (中等)</span>
                    </div>
                    <div class="chart-bar" style="height: 70%;">
                        <span class="chart-bar-label">修改位置
                            (重量级)</span>
                    </div>
                    <div class="chart-bar" style="height: 90%;">
                        <span class="chart-bar-label">修改尺寸
                            (重量级)</span>
                    </div>
                    <div class="chart-bar" style="height: 100%;">
                        <span class="chart-bar-label">改变布局
                            (极重量级)</span>
                    </div>
                </div>
                <p style="text-align: center; color: var(--color-text-light); font-size: 0.9rem; margin-top: var(--spacing-md);">
                    图表高度表示相对性能开销，越高表示开销越大
                </p>
            </div>
            <div class="demo-box">
                <h3>GPU加速与渲染层</h3>
                <p>利用GPU加速可以显著提升动画性能。以下属性会触发GPU加速，创建新的渲染层：</p>
                <ul>
                    <li><code>transform: translateZ(0)</code> 或 <code>translate3d(0, 0, 0)</code></li>
                    <li><code>perspective: 1000</code></li>
                    <li><code>backface-visibility: hidden</code></li>
                    <li><code>opacity</code> 动画（当与其他属性同时使用时）</li>
                </ul>
                <p>使用GPU加速的示例：</p>
                <div class="code-example">/* 创建硬件加速的渲染层 */
.accelerated {
    transform: translateZ(0);
    /* 或 */
    will-change: transform;
}

/* 高性能动画 */
@keyframes smoothMove {
    from {
        transform: translateX(0);
    }
    to {
        transform: translateX(100px);
    }
}

.animated-element {
    animation: smoothMove 1s ease-in-out infinite alternate;
    will-change: transform;
}</div>
                <p class="warning">
                    <strong>注意：</strong>不要过度使用GPU加速，因为每个渲染层都会消耗额外的内存。
                </p>
            </div>
        </div>
        
        <div class="section">
            <h2>4. CSS 文件优化技术</h2>
            <p>优化CSS文件大小和加载策略，可以显著提升页面加载性能。</p>
            <div class="demo-box">
                <h3>CSS 优化技术清单</h3>
                <div class="optimization-techniques">
                    <div class="technique-card">
                        <span class="technique-badge">文件压缩</span>
                        <h4>CSS压缩</h4>
                        <p>移除空格、注释和不必要的字符，减小文件体积。</p>
                    </div>
                    <div class="technique-card">
                        <span class="technique-badge">选择器优化</span>
                        <h4>简化选择器</h4>
                        <p>使用更简单、更高效的选择器，避免复杂的嵌套。</p>
                    </div>
                    <div class="technique-card">
                        <span class="technique-badge">代码复用</span>
                        <h4>CSS变量和混合</h4>
                        <p>使用CSS变量和预处理器的混合器提高代码复用率。</p>
                    </div>
                    <div class="technique-card">
                        <span class="technique-badge">移除冗余</span>
                        <h4>删除未使用的CSS</h4>
                        <p>分析并移除项目中未使用的CSS代码。</p>
                    </div>
                    <div class="technique-card">
                        <span class="technique-badge">加载优化</span>
                        <h4>关键CSS内联</h4>
                        <p>将首屏渲染所需的CSS内联到HTML中。</p>
                    </div>
                    <div class="technique-card">
                        <span class="technique-badge">模块化</span>
                        <h4>CSS模块化</h4>
                        <p>使用CSS模块或BEM等方法组织CSS代码。</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>5. CSS 调试技术</h2>
            <p>高效的调试技术可以帮助我们快速定位和解决CSS问题。</p>
            <div class="demo-box">
                <h3>浏览器开发工具</h3>
                <div class="debug-panel">
                    <div class="debug-item">
                        <h5>Elements面板</h5>
                        <p>检查和修改HTML元素及其样式，实时预览效果。</p>
                    </div>
                    <div class="debug-item">
                        <h5>Styles面板</h5>
                        <p>查看和编辑元素的CSS规则，包括继承和覆盖关系。</p>
                    </div>
                    <div class="debug-item">
                        <h5>Computed面板</h5>
                        <p>查看元素最终计算出的样式值。</p>
                    </div>
                    <div class="debug-item">
                        <h5>Layout面板</h5>
                        <p>可视化网格和弹性布局，帮助调试布局问题。</p>
                    </div>
                    <div class="debug-item">
                        <h5>Performance面板</h5>
                        <p>分析CSS性能问题，包括重排和重绘。</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>6. 实际性能案例演示</h2>
            <p>通过实际案例演示CSS性能优化的效果。</p>
            <div class="performance-test-area">
                <h3>DOM操作性能对比</h3>
                <div class="test-container">
                    <div class="test-box">
                        <h4>优化的批量DOM操作</h4>
                        <button class="btn" id="optimized-dom-btn">执行优化操作</button>
                        <div class="result-display" id="optimized-result">结果将显示在这里...</div>
                    </div>
                    <div class="test-box">
                        <h4>未优化的DOM操作</h4>
                        <button class="btn btn-warning" id="unoptimized-dom-btn">执行未优化操作</button>
                        <div class="result-display" id="unoptimized-result">结果将显示在这里...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>7. CSS 最佳实践</h2>
            <p>遵循CSS最佳实践可以编写高性能、可维护的CSS代码。</p>
            <div class="demo-box">
                <h3>CSS性能最佳实践</h3>
                <div class="best-practices">
                    <div class="practice-item">
                        <h4>使用高效的选择器</h4>
                        <p>优先使用类选择器，避免过度嵌套和复杂选择器。</p>
                    </div>
                    <div class="practice-item">
                        <h4>避免使用@import</h4>
                        <p>使用link标签替代@import，避免阻塞渲染。</p>
                    </div>
                    <div class="practice-item">
                        <h4>使用CSS变量</h4>
                        <p>使用CSS变量管理主题和通用样式值。</p>
                    </div>
                    <div class="practice-item">
                        <h4>优化动画性能</h4>
                        <p>使用transform和opacity进行动画，触发GPU加速。</p>
                    </div>
                    <div class="practice-item">
                        <h4>减少重排</h4>
                        <p>批量修改样式，避免频繁读写DOM属性。</p>
                    </div>
                    <div class="practice-item">
                        <h4>使用预处理器</h4>
                        <p>使用Sass/Less等预处理器提高开发效率。</p>
                    </div>
                    <div class="practice-item">
                        <h4>文件压缩</h4>
                        <p>使用工具压缩CSS文件，减小文件体积。</p>
                    </div>
                    <div class="practice-item">
                        <h4>内联关键CSS</h4>
                        <p>将首屏渲染所需的关键CSS内联到HTML中，减少渲染阻塞。</p>
                    </div>
                    <div class="practice-item">
                        <h4>异步加载非关键CSS</h4>
                        <p>使用preload或媒体查询实现非首屏CSS的异步加载。</p>
                    </div>
                    <div class="practice-item">
                        <h4>使用CSS模块或CSS-in-JS避免全局污染</h4>
                        <p>通过局部作用域避免CSS冲突，提高代码可维护性。</p>
                    </div>
                    <div class="practice-item">
                        <h4>使用内容分发网络（CDN）</h4>
                        <p>通过CDN分发CSS文件，提高加载速度和可用性。</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>8. CSS 性能优化工具推荐</h2>
            <p>以下是一些常用的CSS性能优化和调试工具：</p>
            <div class="css-tools">
                <div class="tool-card">
                    <span class="tool-type">性能分析工具</span>
                    <h4>Chrome DevTools</h4>
                    <p>浏览器内置的性能分析工具，可以分析渲染性能、资源加载等。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">CSS压缩工具</span>
                    <h4>CSSNano</h4>
                    <p>专业的CSS压缩工具，移除冗余代码并优化选择器。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">CSS压缩工具</span>
                    <h4>CleanCSS</h4>
                    <p>高效的CSS压缩器，提供多种压缩级别和优化选项。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">未使用CSS检测</span>
                    <h4>PurgeCSS</h4>
                    <p>分析HTML和JavaScript，移除未使用的CSS代码。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">CSS Lint工具</span>
                    <h4>Stylelint</h4>
                    <p>现代CSS Linter，可以检测代码问题并强制执行最佳实践。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">CSS预处理器</span>
                    <h4>Sass/Less/Stylus</h4>
                    <p>提供变量、混合器等高级特性，帮助组织和优化CSS代码。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">性能监控工具</span>
                    <h4>Lighthouse</h4>
                    <p>Google的开源工具，可以分析网站性能并提供优化建议。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">在线分析工具</span>
                    <h4>WebPageTest</h4>
                    <p>提供详细的网页加载性能分析，包括首屏时间、资源加载等。</p>
                </div>
                <div class="tool-card">
                    <span class="tool-type">构建工具插件</span>
                    <h4>webpack/css-loader</h4>
                    <p>在构建过程中自动处理和优化CSS文件。</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        // CSS性能优化与调试的JavaScript交互功能
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 批量更新DOM优化演示
            const batchUpdateBtn = document.getElementById('batch-update-btn');
            const naiveUpdateBtn = document.getElementById('naive-update-btn');
            const performanceResult = document.getElementById('performance-result');
            
            // 优化的批量DOM更新函数
            function optimizedBatchUpdate() {
                const startTime = performance.now();
                
                // 创建文档片段，减少重排次数
                const fragment = document.createDocumentFragment();
                
                // 在文档片段中创建多个元素
                for (let i = 0; i < 100; i++) {
                    const div = document.createElement('div');
                    div.textContent = `Item ${i + 1}`;
                    div.style.cssText = 'padding: 4px; margin: 2px; background: #f0f0f0; border-radius: 4px;';
                    fragment.appendChild(div);
                }
                
                // 一次性添加到DOM，只触发一次重排
                const demoContainer = document.createElement('div');
                demoContainer.appendChild(fragment);
                
                // 临时显示结果
                performanceResult.textContent = `批量更新完成！\n执行时间: ${(performance.now() - startTime).toFixed(2)}ms`;
                
                // 3秒后清除结果
                setTimeout(() => {
                    performanceResult.textContent = '性能测试结果将显示在这里...';
                }, 3000);
            }
            
            // 未优化的逐个DOM更新函数
            function naiveUpdate() {
                const startTime = performance.now();
                
                // 每次循环都直接操作DOM，触发多次重排
                const demoContainer = document.createElement('div');
                
                for (let i = 0; i < 100; i++) {
                    const div = document.createElement('div');
                    div.textContent = `Item ${i + 1}`;
                    div.style.cssText = 'padding: 4px; margin: 2px; background: #f0f0f0; border-radius: 4px;';
                    demoContainer.appendChild(div);
                    // 模拟直接添加到DOM
                }
                
                // 显示结果
                performanceResult.textContent = `逐个更新完成！\n执行时间: ${(performance.now() - startTime).toFixed(2)}ms`;
                
                // 3秒后清除结果
                setTimeout(() => {
                    performanceResult.textContent = '性能测试结果将显示在这里...';
                }, 3000);
            }
            
            // 添加事件监听器
            if (batchUpdateBtn) batchUpdateBtn.addEventListener('click', optimizedBatchUpdate);
            if (naiveUpdateBtn) naiveUpdateBtn.addEventListener('click', naiveUpdate);
            
            // 2. 性能测试对比演示
            const optimizedDomBtn = document.getElementById('optimized-dom-btn');
            const unoptimizedDomBtn = document.getElementById('unoptimized-dom-btn');
            const optimizedResult = document.getElementById('optimized-result');
            const unoptimizedResult = document.getElementById('unoptimized-result');
            
            // 优化的DOM操作
            function runOptimizedTest() {
                const startTime = performance.now();
                
                // 1. 缓存DOM引用
                const demoBoxes = document.querySelectorAll('.demo-box-item');
                
                // 2. 批量读取样式
                const computedStyles = [];
                for (let i = 0; i < demoBoxes.length; i++) {
                    computedStyles.push(window.getComputedStyle(demoBoxes[i]));
                }
                
                // 3. 使用CSS类批量修改样式
                demoBoxes.forEach(box => {
                    box.classList.add('optimized-animation');
                });
                
                // 4. 使用requestAnimationFrame优化动画
                requestAnimationFrame(() => {
                    const endTime = performance.now();
                    optimizedResult.textContent = `优化操作完成！\n执行时间: ${(endTime - startTime).toFixed(2)}ms\nDOM操作效率高，重排次数少`;
                    
                    // 3秒后重置
                    setTimeout(() => {
                        demoBoxes.forEach(box => {
                            box.classList.remove('optimized-animation');
                        });
                        optimizedResult.textContent = '结果将显示在这里...';
                    }, 3000);
                });
            }
            
            // 未优化的DOM操作
            function runUnoptimizedTest() {
                const startTime = performance.now();
                
                // 1. 重复查询DOM
                for (let i = 0; i < 5; i++) {
                    const demoBoxes = document.querySelectorAll('.demo-box-item');
                    
                    // 2. 读写样式交替进行，触发多次重排
                    demoBoxes.forEach(box => {
                        // 读取样式
                        const width = box.offsetWidth;
                        
                        // 立即写入样式
                        box.style.width = (width + 10) + 'px';
                        
                        // 再次读取样式
                        const height = box.offsetHeight;
                        
                        // 再次写入样式
                        box.style.height = (height + 10) + 'px';
                    });
                }
                
                const endTime = performance.now();
                unoptimizedResult.textContent = `未优化操作完成！\n执行时间: ${(endTime - startTime).toFixed(2)}ms\nDOM操作效率低，重排次数多`;
                
                // 3秒后重置
                setTimeout(() => {
                    const demoBoxes = document.querySelectorAll('.demo-box-item');
                    demoBoxes.forEach(box => {
                        box.style.width = '100px';
                        box.style.height = '100px';
                    });
                    unoptimizedResult.textContent = '结果将显示在这里...';
                }, 3000);
            }
            
            // 添加事件监听器
            if (optimizedDomBtn) optimizedDomBtn.addEventListener('click', runOptimizedTest);
            if (unoptimizedDomBtn) unoptimizedDomBtn.addEventListener('click', runUnoptimizedTest);
            
            // 3. 性能监控函数
            function monitorPerformance() {
                // 模拟性能监控
                console.log('CSS性能监控已启动');
                
                // 这里可以添加实际的性能监控代码
                // 例如使用Performance API或Web Vitals
            }
            
            // 启动性能监控
            monitorPerformance();
            
            // 4. 重绘与重排演示增强
            const demoElements = document.querySelectorAll('.demo-box-item');
            demoElements.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    // 记录进入时间，用于演示性能差异
                    this.dataset.enterTime = performance.now();
                });
                
                element.addEventListener('mouseleave', function() {
                    const enterTime = parseFloat(this.dataset.enterTime);
                    const leaveTime = performance.now();
                    const duration = leaveTime - enterTime;
                    
                    // 仅在控制台显示，不影响用户体验
                    console.log(`元素类型: ${this.classList.contains('reflow') ? '重排' : '仅重绘'}, 悬停时间: ${duration.toFixed(2)}ms`);
                });
            });
            
            // 5. 添加性能提示交互
            const performanceTips = document.querySelectorAll('.performance-tip');
            performanceTips.forEach(tip => {
                tip.addEventListener('click', function() {
                    this.style.backgroundColor = '#d1f0ff';
                    setTimeout(() => {
                        this.style.backgroundColor = '#e6f7ff';
                    }, 1000);
                });
            });
        });
    </script>
</body>
</html>