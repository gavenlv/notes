# 第4章：对象与数组

## 1. 对象基础

### 1.1 什么是对象

在JavaScript中，对象是一种复合数据类型，它允许你存储多个值和更复杂的实体。对象是键值对的集合，其中键是字符串（或Symbol），值可以是任何数据类型，包括其他对象。

```javascript
// 对象的基本结构
const person = {
  name: "张三",
  age: 28,
  isStudent: false,
  greet: function() {
    return "你好，我是" + this.name;
  }
};

// 访问对象属性
console.log(person.name);        // "张三" - 点表示法
console.log(person['age']);      // 28 - 方括号表示法
console.log(person.greet());     // "你好，我是张三"
```

### 1.2 对象的创建方式

#### 1.2.1 对象字面量

```javascript
// 简单对象字面量
const emptyObject = {};

// 带属性和方法的对象字面量
const car = {
  brand: "特斯拉",
  model: "Model 3",
  year: 2023,
  start: function() {
    console.log(`${this.brand} ${this.model} 启动了！`);
  },
  // ES6简写方法
  stop() {
    console.log(`${this.brand} ${this.model} 停止了。`);
  }
};
```

#### 1.2.2 使用构造函数

```javascript
// 构造函数模式
function Person(name, age, job) {
  this.name = name;
  this.age = age;
  this.job = job;
  this.introduce = function() {
    return `我是${this.name}，今年${this.age}岁，职业是${this.job}。`;
  };
}

// 创建新实例
const person1 = new Person("李四", 30, "工程师");
const person2 = new Person("王五", 25, "设计师");

console.log(person1.introduce()); // 我是李四，今年30岁，职业是工程师。
```

#### 1.2.3 使用Object.create()

```javascript
// 创建一个原型对象
const personPrototype = {
  greet: function() {
    return `你好，我是${this.firstName} ${this.lastName}`;
  },
  getAge: function() {
    const today = new Date();
    const birthDate = new Date(this.birthYear);
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDifference = today.getMonth() - birthDate.getMonth();
    
    if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
      age--;
    }
    
    return age;
  }
};

// 使用Object.create创建新对象
const john = Object.create(personPrototype);
john.firstName = "约翰";
john.lastName = "史密斯";
john.birthYear = 1990;

console.log(john.greet());   // 你好，我是约翰 史密斯
console.log(john.getAge());  // 根据当前年份计算的年龄
```

### 1.3 对象属性的操作

#### 1.3.1 属性的访问

```javascript
const user = {
  username: "zhangsan",
  "user-email": "zhangsan@example.com",
  123: "数字键"
};

// 点表示法 - 当属性名是有效的标识符时使用
console.log(user.username); // "zhangsan"

// 方括号表示法 - 适用于任何属性名
console.log(user["user-email"]); // "zhangsan@example.com"
console.log(user[123]); // "数字键"

// 使用变量访问属性
const propName = "username";
console.log(user[propName]); // "zhangsan"
```

#### 1.3.2 属性的添加和修改

```javascript
const book = {
  title: "JavaScript高级程序设计",
  author: "尼古拉斯·泽卡斯"
};

// 添加新属性
book.year = 2019;
book.publisher = "人民邮电出版社";

// 修改现有属性
book.title = "JavaScript高级程序设计（第4版）";

// 使用方括号添加特殊属性名
book["ISBN-13"] = "978-7-115-51766-1";

console.log(book);
```

#### 1.3.3 属性的删除

```javascript
const product = {
  id: 1001,
  name: "手机",
  price: 2999,
  category: "电子产品",
  description: "最新款智能手机"
};

// 删除属性
delete product.description;
console.log("description" in product); // false

// 尝试删除不存在的属性不会报错
delete product.weight; // 静默失败

// 注意：不能删除继承的属性
delete product.toString; // 无效，因为toString是继承的
```

#### 1.3.4 属性的枚举

```javascript
const car = {
  brand: "比亚迪",
  model: "汉",
  year: 2022,
  color: "红色"
};

// for...in循环 - 遍历可枚举属性（包括继承的）
for (const prop in car) {
  console.log(prop + ": " + car[prop]);
}

// Object.keys() - 返回自身可枚举属性的数组
const keys = Object.keys(car);
console.log(keys); // ["brand", "model", "year", "color"]

// Object.values() - 返回自身可枚举属性值的数组
const values = Object.values(car);
console.log(values); // ["比亚迪", "汉", 2022, "红色"]

// Object.entries() - 返回自身可枚举属性的键值对数组
const entries = Object.entries(car);
console.log(entries); // [["brand", "比亚迪"], ["model", "汉"], ...]
```

### 1.4 属性的特性

每个属性都有一些特性（特性描述符），包括：

```javascript
const person = {};

// 定义属性并指定特性
Object.defineProperty(person, "name", {
  value: "李四",
  writable: false,    // 是否可修改
  enumerable: true,   // 是否可枚举（是否出现在for...in循环中）
  configurable: true  // 是否可删除或修改其特性
});

// 尝试修改属性（因为writable为false，所以不会成功）
person.name = "王五";
console.log(person.name); // "李四"

// 查看属性的特性
const descriptor = Object.getOwnPropertyDescriptor(person, "name");
console.log(descriptor);
/*
{
  value: "李四",
  writable: false,
  enumerable: true,
  configurable: true
}
*/

// 定义多个属性
Object.defineProperties(person, {
  age: {
    value: 30,
    writable: false,    // 不可修改
    enumerable: true,   // 可枚举
    configurable: false // 不可删除或修改特性
  },
  id: {
    value: 12345,
    enumerable: false,  // 不可枚举
    configurable: false
  }
});

// 使用getters和setters
const employee = {
  _name: "员工",  // 下划线表示"私有"属性
  _salary: 5000,
  
  get name() {
    return this._name;
  },
  
  set name(newName) {
    if (typeof newName === "string" && newName.length > 0) {
      this._name = newName;
    }
  },
  
  get salary() {
    return `¥${this._salary.toLocaleString()}`;
  },
  
  set salary(newSalary) {
    if (typeof newSalary === "number" && newSalary >= 0) {
      this._salary = newSalary;
    }
  }
};

console.log(employee.name);    // "员工"
employee.name = "张三";
console.log(employee.name);    // "张三"

console.log(employee.salary);  // "¥5,000"
employee.salary = 6000;
console.log(employee.salary);  // "¥6,000"
```

## 2. 对象方法

### 2.1 常用对象方法

#### 2.1.1 Object静态方法

```javascript
const source = {
  a: 1,
  b: 2,
  c: 3
};

// Object.assign() - 复制对象
const target = { d: 4 };
const result = Object.assign(target, source);
console.log(result); // {d: 4, a: 1, b: 2, c: 3}

// 注意：这是浅拷贝
const sourceObj = {
  a: 1,
  b: {
    c: 2
  }
};
const targetObj = Object.assign({}, sourceObj);
targetObj.b.c = 3;
console.log(sourceObj.b.c); // 3 (原始对象也被修改了)

// Object.is() - 比较两个值是否相等
console.log(Object.is(100, 100)); // true
console.log(Object.is("foo", "foo")); // true
console.log(Object.is({}, {})); // false
console.log(Object.is(+0, -0)); // false (与===不同)
console.log(Object.is(NaN, NaN)); // true (与===不同)

// Object.freeze() - 冻结对象（不能添加、删除或修改属性）
const frozen = {
  prop: "值"
};
Object.freeze(frozen);
frozen.prop = "新值"; // 静默失败
frozen.newProp = "新属性"; // 静默失败
console.log(frozen); // {prop: "值"}

// Object.seal() - 密封对象（不能添加或删除属性，但可以修改现有属性）
const sealed = {
  prop: "值"
};
Object.seal(sealed);
sealed.prop = "新值"; // 可以修改
sealed.newProp = "新属性"; // 静默失败
delete sealed.prop; // 静默失败
console.log(sealed); // {prop: "新值"}

// Object.create() - 创建新对象，使用现有对象作为原型
const personProto = {
  greet: function() {
    return `你好，我是${this.name}`;
  }
};

const person = Object.create(personProto);
person.name = "赵六";
console.log(person.greet()); // "你好，我是赵六"
```

## 3. 数组基础

### 3.1 什么是数组

数组是有序的数据集合，可以存储不同类型的值。在JavaScript中，数组是动态的，可以随时添加或删除元素。

```javascript
// 创建数组
const fruits = ["苹果", "香蕉", "橙子"];
const mixedArray = [1, "字符串", true, null, undefined, {a: 1}, [1, 2, 3]];
const emptyArray = [];

// 数组是有序的，每个元素都有索引（从0开始）
console.log(fruits[0]); // "苹果"
console.log(fruits[1]); // "香蕉"
console.log(fruits[2]); // "橙子"

// 获取数组长度
console.log(fruits.length); // 3
```

### 3.2 数组的创建方式

#### 3.2.1 数组字面量

```javascript
// 空数组
const empty = [];

// 带初始值的数组
const numbers = [1, 2, 3, 4, 5];
const mixed = [1, "二", true, null];

// 包含表达式的数组
const arr = [
  1 + 2,
  "hello" + " world",
  true ? "yes" : "no"
];
console.log(arr); // [3, "hello world", "yes"]
```

#### 3.2.2 Array构造函数

```javascript
// 使用Array构造函数
const arr1 = new Array(); // 空数组
const arr2 = new Array(3); // 长度为3的空数组 [empty × 3]
const arr3 = new Array(1, 2, 3); // [1, 2, 3]

// 注意：当只有一个参数且为数字时，表示数组长度
const arr4 = new Array(5); // [empty × 5]
console.log(arr4.length); // 5

// 多个参数表示数组元素
const arr5 = new Array(5, 10, 15); // [5, 10, 15]
```

#### 3.2.3 Array.of()和Array.from()

```javascript
// Array.of() - 总是返回参数值组成的数组
const arr1 = Array.of(5); // [5]
const arr2 = Array.of(1, 2, 3); // [1, 2, 3]

// Array.from() - 从类数组对象或可迭代对象创建数组
// 从字符串创建数组
const str = "hello";
const chars = Array.from(str); // ["h", "e", "l", "l", "o"]

// 从arguments对象创建数组
function createArray() {
  return Array.from(arguments);
}
const argsArray = createArray(1, 2, 3, 4); // [1, 2, 3, 4]

// 从类数组对象创建数组
const arrayLike = {
  0: "a",
  1: "b",
  2: "c",
  length: 3
};
const arr3 = Array.from(arrayLike); // ["a", "b", "c"]

// 使用映射函数
const numbers = [1, 2, 3, 4];
const doubled = Array.from(numbers, x => x * 2); // [2, 4, 6, 8]
```

### 3.3 数组的访问和修改

#### 3.3.1 访问数组元素

```javascript
const colors = ["红", "绿", "蓝"];

// 使用索引访问
console.log(colors[0]); // "红"
console.log(colors[1]); // "绿"
console.log(colors[2]); // "蓝"

// 访问不存在的索引返回undefined
console.log(colors[3]); // undefined

// 使用负数索引（需要先创建方法）
Array.prototype.get = function(index) {
  if (index >= 0) {
    return this[index];
  } else {
    return this[this.length + index];
  }
};

console.log(colors.get(-1)); // "蓝" (最后一个元素)
console.log(colors.get(-2)); // "绿" (倒数第二个元素)
```

#### 3.3.2 修改数组元素

```javascript
const pets = ["狗", "猫", "鸟"];

// 通过索引修改
pets[1] = "仓鼠";
console.log(pets); // ["狗", "仓鼠", "鸟"]

// 通过length属性添加元素
pets[pets.length] = "鱼";
console.log(pets); // ["狗", "仓鼠", "鸟", "鱼"]

// 增加数组长度会创建空位
pets.length = 6;
console.log(pets); // ["狗", "仓鼠", "鸟", "鱼", <2 empty items>]
console.log(pets[4]); // undefined

// 减少数组长度会截断数组
pets.length = 3;
console.log(pets); // ["狗", "仓鼠", "鸟"]
```

## 4. 数组方法

### 4.1 添加和删除元素

```javascript
const arr = ["a", "b", "c"];

// push() - 在数组末尾添加元素
arr.push("d");
console.log(arr); // ["a", "b", "c", "d"]

// push可以添加多个元素
arr.push("e", "f");
console.log(arr); // ["a", "b", "c", "d", "e", "f"]

// pop() - 删除并返回数组末尾的元素
const lastElement = arr.pop();
console.log(lastElement); // "f"
console.log(arr); // ["a", "b", "c", "d", "e"]

// unshift() - 在数组开头添加元素
arr.unshift("x");
console.log(arr); // ["x", "a", "b", "c", "d", "e"]

// unshift可以添加多个元素
arr.unshift("y", "z");
console.log(arr); // ["y", "z", "x", "a", "b", "c", "d", "e"]

// shift() - 删除并返回数组开头的元素
const firstElement = arr.shift();
console.log(firstElement); // "y"
console.log(arr); // ["z", "x", "a", "b", "c", "d", "e"]

// splice() - 在数组中间添加/删除元素
const months = ["一月", "二月", "四月", "五月"];

// 在索引2处添加一个元素
months.splice(2, 0, "三月");
console.log(months); // ["一月", "二月", "三月", "四月", "五月"]

// 删除索引1处的元素
months.splice(1, 1);
console.log(months); // ["一月", "三月", "四月", "五月"]

// 替换元素
months.splice(1, 2, "二月", "三月", "四月");
console.log(months); // ["一月", "二月", "三月", "四月", "五月"]
```

### 4.2 查找和过滤

```javascript
const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// find() - 返回第一个满足条件的元素
const evenNumber = numbers.find(num => num % 2 === 0);
console.log(evenNumber); // 2

// findIndex() - 返回第一个满足条件的元素的索引
const evenIndex = numbers.findIndex(num => num % 2 === 0);
console.log(evenIndex); // 1

// indexOf() - 返回指定元素的第一个索引
console.log(numbers.indexOf(5)); // 4
console.log(numbers.indexOf(11)); // -1 (不存在)

// lastIndexOf() - 返回指定元素的最后一个索引
const duplicates = [1, 2, 3, 2, 4, 2, 5];
console.log(duplicates.indexOf(2)); // 1
console.log(duplicates.lastIndexOf(2)); // 5

// includes() - 检查数组是否包含某个元素
console.log(numbers.includes(5)); // true
console.log(numbers.includes(11)); // false

// filter() - 返回所有满足条件的元素组成的新数组
const evenNumbers = numbers.filter(num => num % 2 === 0);
console.log(evenNumbers); // [2, 4, 6, 8, 10]

const largeNumbers = numbers.filter(num => num > 5);
console.log(largeNumbers); // [6, 7, 8, 9, 10]
```

### 4.3 转换方法

```javascript
const numbers = [1, 2, 3, 4, 5];

// map() - 对每个元素执行函数，返回新数组
const doubled = numbers.map(num => num * 2);
console.log(doubled); // [2, 4, 6, 8, 10]

// map返回包含对象的新数组
const users = [
  {id: 1, name: "张三", age: 25},
  {id: 2, name: "李四", age: 30},
  {id: 3, name: "王五", age: 35}
];

const userNames = users.map(user => user.name);
console.log(userNames); // ["张三", "李四", "王五"]

const userDetails = users.map(user => ({
  id: user.id,
  fullName: user.name,
  isAdult: user.age >= 18
}));
console.log(userDetails);
// [{id: 1, fullName: "张三", isAdult: true}, ...]

// reduce() - 将数组减少为单个值
const sum = numbers.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
console.log(sum); // 15

// 使用reduce找出最大值
const max = numbers.reduce((max, current) => current > max ? current : max);
console.log(max); // 5

// 使用reduce对数组元素进行分组
const people = [
  {name: "小明", department: "技术部"},
  {name: "小红", department: "人事部"},
  {name: "小刚", department: "技术部"},
  {name: "小丽", department: "财务部"},
  {name: "小华", department: "人事部"}
];

const groupedByDepartment = people.reduce((result, person) => {
  const dept = person.department;
  if (!result[dept]) {
    result[dept] = [];
  }
  result[dept].push(person.name);
  return result;
}, {});

console.log(groupedByDepartment);
// {
//   "技术部": ["小明", "小刚"],
//   "人事部": ["小红", "小华"],
//   "财务部": ["小丽"]
// }
```

## 5. 对象与数组的实际应用

### 5.1 数据结构操作

```javascript
// 使用对象和数组创建更复杂的数据结构
const company = {
  name: "科技创新公司",
  founded: 2010,
  employees: [
    {
      id: 1,
      name: "张三",
      position: "前端开发",
      department: "技术部",
      skills: ["HTML", "CSS", "JavaScript", "React"],
      contact: {
        email: "zhangsan@example.com",
        phone: "138-0000-0001"
      }
    },
    {
      id: 2,
      name: "李四",
      position: "后端开发",
      department: "技术部",
      skills: ["Node.js", "Python", "数据库"],
      contact: {
        email: "lisi@example.com",
        phone: "138-0000-0002"
      }
    }
  ],
  departments: [
    {
      name: "技术部",
      manager: "王经理",
      budget: 500000
    },
    {
      name: "市场部",
      manager: "赵经理",
      budget: 300000
    }
  ]
};

// 复杂数据结构的操作
// 获取所有技术部员工
const techEmployees = company.employees.filter(
  employee => employee.department === "技术部"
);

// 获取所有技能并去重
const allSkills = company.employees
  .flatMap(employee => employee.skills)
  .filter((skill, index, self) => self.indexOf(skill) === index);

// 计算每个部门的员工数量
const departmentCounts = company.employees.reduce((result, employee) => {
  result[employee.department] = (result[employee.department] || 0) + 1;
  return result;
}, {});

console.log("技术部员工:", techEmployees);
console.log("所有技能:", allSkills);
console.log("部门员工数量:", departmentCounts);
```

## 6. 最佳实践

### 6.1 对象使用的最佳实践

1. **使用有意义的属性名**
   ```javascript
   // 好的做法
   const user = {
     firstName: "约翰",
     lastName: "史密斯",
     birthDate: new Date(1990, 5, 15)
   };
   
   // 不好的做法
   const u = {
     fn: "约翰",
     ln: "史密斯",
     bd: new Date(1990, 5, 15)
   };
   ```

2. **使用简洁的对象方法**
   ```javascript
   // ES6简写方法
   const calculator = {
     add(a, b) {
       return a + b;
     },
     
     subtract(a, b) {
       return a - b;
     }
   };
   ```

3. **使用计算属性名**
   ```javascript
   const prop = 'name';
   const value = '张三';
   
   const obj = {
     [prop]: value  // 计算属性名
   };
   ```

### 6.2 数组使用的最佳实践

1. **使用扩展运算符代替concat**
   ```javascript
   // 传统方式
   const newArray = array1.concat(array2);
   
   // 现代方式
   const newArray = [...array1, ...array2];
   ```

2. **使用Array.from代替slice**
   ```javascript
   // 转换类数组对象
   const arrayLike = {0: 'a', 1: 'b', 2: 'c', length: 3};
   const array = Array.from(arrayLike);
   ```

3. **使用includes代替indexOf检查元素是否存在**
   ```javascript
   // 传统方式
   if (array.indexOf(item) !== -1) { /*...*/ }
   
   // 现代方式
   if (array.includes(item)) { /*...*/ }
   ```

## 7. 总结

本章我们深入学习了JavaScript中的对象和数组，这是两种最基本和最重要的数据结构。

对象作为键值对集合，适合表示结构化数据。我们学习了多种创建对象的方式，如何操作对象属性，以及如何使用对象的各种方法。

数组作为有序集合，适合表示列表数据。我们学习了数组的各种创建方式，以及如何使用数组的方法来添加、删除、查找、转换和遍历数组元素。

掌握了对象和数组的使用，你就掌握了JavaScript数据处理的基础，这对于开发复杂的应用程序至关重要。在下一章中，我们将学习DOM操作和事件处理，这将使我们能够创建交互式的网页应用。