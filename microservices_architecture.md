# 微服务架构核心技术要点总结

## 1. 服务注册与发现

### 核心组件
- **Eureka**: Netflix开源的服务发现组件，遵循AP原则
- **Consul**: HashiCorp开源，支持CP和AP模式
- **Nacos**: 阿里巴巴开源，同时支持CP和AP
- **Zookeeper**: Apache项目，遵循CP原则

### 机制原理
- 服务启动时自动向注册中心注册自身信息
- 通过心跳机制维持服务状态
- 客户端或API网关从注册中心获取服务实例列表
- 实现服务间的动态发现和调用

## 2. 负载均衡

### 实现方式
- **客户端负载均衡**: Ribbon、Spring Cloud LoadBalancer
- **服务端负载均衡**: Nginx、Spring Cloud Gateway内置支持
- **服务网格负载均衡**: Istio、Linkerd

### 策略算法
- 轮询(Round Robin)
- 加权轮询(Weighted Round Robin)
- 随机(Random)
- 最少连接(Least Connections)
- 哈希一致性(Consistent Hash)

## 3. 熔断器与限流降级

### 主流组件
- **Hystrix**: Netflix开源，线程池/信号量隔离
- **Sentinel**: 阿里巴巴开源，基于响应时间/异常比例的熔断
- **Resilience4j**: 轻量级容错库，适用于函数式编程

### 核心机制
- 熔断: 故障隔离，防止雪崩效应
- 降级: 返回默认值或缓存数据，保障核心功能
- 限流: 控制请求速率，保护系统资源

## 4. 配置管理

### 核心组件
- **Spring Cloud Config**: 集中化配置管理
- **Apollo**: 携程开源，配置实时推送
- **Nacos**: 阿里巴巴开源，配置动态刷新

### 功能特性
- 外部化配置，统一管理
- 环境隔离(dev/test/prod)
- 配置动态刷新
- 版本管理和回滚

## 5. 安全认证与授权

### 认证机制
- **OAuth2**: 标准授权协议，支持第三方登录
- **JWT**: 无状态令牌，减少数据库查询
- **SSO**: 单点登录，一次登录多处访问

### 授权模型
- **RBAC**: 基于角色的访问控制
- **Spring Security**: 企业级安全框架
- **API网关安全**: 统一鉴权入口

## 6. 分布式事务

### 理论基础
- **CAP理论**: 一致性、可用性、分区容忍性只能满足其二
- **BASE理论**: 基本可用、软状态、最终一致性

### 解决方案
- **2PC**: 两阶段提交，强一致性但同步阻塞
- **3PC**: 三阶段提交，降低阻塞范围
- **TCC**: Try-Confirm-Cancel，业务层面补偿
- **Saga**: 长事务解决方案，正向操作+补偿操作
- **消息队列**: 基于可靠消息的最终一致性

## 7. API网关

### 核心组件
- **Spring Cloud Gateway**: 基于WebFlux的响应式网关
- **Zuul**: Netflix开源的网关组件
- **Kong**: 基于Nginx的高性能API网关

### 核心功能
- 请求路由和负载均衡
- 身份验证和权限控制
- 限流和熔断降级
- 请求/响应转换
- 日志和监控

## 8. 监控与追踪

### 链路追踪
- **Sleuth**: Spring Cloud分布式追踪解决方案
- **Zipkin**: Twitter开源的分布式追踪系统
- **SkyWalking**: Apache顶级项目，APM解决方案
- **Jaeger**: Uber开源，云原生追踪系统
- **OpenTelemetry**: CNCF项目，统一可观测性标准

### 监控指标
- 调用链路可视化
- 性能瓶颈分析
- 故障定位和诊断
- 实时监控和告警

## 9. 消息队列

### 主流MQ
- **Kafka**: LinkedIn开源，高吞吐量、低延迟
- **RocketMQ**: 阿里巴巴开源，支持事务消息
- **RabbitMQ**: 基于Erlang，功能丰富
- **ActiveMQ**: Apache项目，支持JMS规范

### 应用场景
- 系统解耦
- 削峰填谷
- 异步处理
- 数据同步

## 10. 缓存策略

### 缓存类型
- **本地缓存**: Caffeine、Ehcache
- **分布式缓存**: Redis、Memcached

### 多级缓存
- 本地缓存 + 分布式缓存组合
- 提升访问速度，减轻后端压力

### 经典问题
- 缓存穿透: 查询不存在数据
- 缓存击穿: 热点数据过期瞬间大量请求
- 缓存雪崩: 大量缓存同时失效

## 11. 数据库设计

### 扩展方案
- **读写分离**: 主库写入，从库读取
- **分库分表**: 水平拆分，解决大数据量问题
- **主从复制**: 数据冗余，提高可用性

### 中间件
- **ShardingSphere**: 轻量级数据库中间件
- **MyCat**: 独立的数据库代理服务

## 12. 服务网格

### 核心组件
- **Istio**: Google/IBM开源，功能全面
- **Linkerd**: Buoyant开源，轻量级服务网格
- **Envoy**: Lyft开源，高性能代理

### 核心功能
- 流量管理
- 安全通信
- 可观测性
- 故障恢复

## 13. 弹性伸缩与自愈

### Kubernetes机制
- **HPA**: Horizontal Pod Autoscaler，水平扩缩容
- **VPA**: Vertical Pod Autoscaler，垂直扩缩容
- **Cluster Autoscaler**: 集群节点自动伸缩

### 健康检查
- **Liveness Probe**: 存活探针，判断容器是否运行
- **Readiness Probe**: 就绪探针，判断容器是否准备好接收请求
- **Startup Probe**: 启动探针，判断应用是否已启动

## 14. 契约测试

### 测试方式
- **消费者驱动契约(CDC)**: 从消费者角度定义契约
- **提供者驱动契约**: 从提供者角度验证契约

### 工具框架
- **Pact**: 契约测试框架
- **Spring Cloud Contract**: Spring生态契约测试工具

## 15. 无状态设计与会话管理

### 设计原则
- 服务实例不保存会话状态
- 通过外部存储共享会话数据

### 会话管理
- **Redis Session**: 分布式会话共享
- **JWT Token**: 无状态令牌，自包含用户信息
- **Sticky Session**: 会话粘性，请求路由到同一实例

## 16. 部署策略

### 发布方式
- **蓝绿部署**: 零宕机部署，流量切换
- **金丝雀发布**: 灰度发布，逐步替换
- **滚动更新**: 逐个替换实例
- **A/B测试**: 对比不同版本效果

这些技术要点构成了微服务架构的核心体系，通过合理选择和组合这些技术，可以构建高可用、可扩展、易维护的分布式系统。