# 第1章：YAML基础入门

## 1.1 什么是YAML？

YAML（YAML Ain't Markup Language）是一种人类友好的数据序列化语言，常用于配置文件、数据交换等场景。YAML的设计目标是让数据易于人类阅读和编写，同时也易于计算机解析和生成。

### 1.1.1 YAML的历史

YAML最初于2001年发布，其名称经历了多次变化：
- 最初称为"Yet Another Markup Language"
- 后来改为"YAML Ain't Markup Language"，强调它不是标记语言而是数据语言

### 1.1.2 YAML的特点

- **人类可读**：YAML使用简洁的语法，易于人类阅读和理解
- **数据序列化**：可以将复杂的数据结构序列化为文本格式
- **语言无关**：几乎所有编程语言都有YAML解析器
- **支持注释**：可以添加注释，提高可读性
- **简洁明了**：使用缩进表示层次结构，无需额外的标记符号

## 1.2 YAML的应用场景

YAML广泛应用于以下场景：

### 1.2.1 配置文件

许多应用程序和框架使用YAML作为配置文件格式：

```yaml
# 应用配置示例
app:
  name: "MyApplication"
  version: "1.0.0"
  debug: true
  
database:
  host: "localhost"
  port: 5432
  name: "mydb"
  user: "admin"
  password: "secret"
```

### 1.2.2 容器编排

Docker Compose和Kubernetes使用YAML定义服务：

```yaml
# Docker Compose示例
version: '3'
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
  db:
    image: postgres:latest
    environment:
      POSTGRES_PASSWORD: example
```

### 1.2.3 CI/CD流水线

GitHub Actions、GitLab CI等使用YAML定义工作流：

```yaml
# GitHub Actions示例
name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Run tests
      run: npm test
```

## 1.3 YAML基本语法

### 1.3.1 缩进

YAML使用空格缩进表示层级关系，**不使用Tab字符**。通常使用2个空格作为缩进单位：

```yaml
# 正确的缩进
parent:
  child1: value1
  child2:
    grandchild: value2
```

### 1.3.2 注释

YAML使用`#`符号表示注释，注释从`#`开始到行尾：

```yaml
# 这是一个注释
key: value  # 行尾注释

# 多行注释
# 第二行注释
# 第三行注释
another_key: another_value
```

### 1.3.3 键值对

YAML的基本结构是键值对，使用冒号和空格分隔：

```yaml
key: value
name: John Doe
age: 30
```

### 1.3.4 文档分隔符

使用`---`表示文档的开始，使用`...`表示文档的结束：

```yaml
---
# 第一个文档
document1:
  key1: value1
  key2: value2
...
---
# 第二个文档
document2:
  key3: value3
  key4: value4
...
```

## 1.4 YAML文件的基本结构

一个基本的YAML文件包含以下元素：

```yaml
# 文件注释
---
# 文档开始标记

# 顶级键值对
root_key: root_value

# 嵌套结构
nested:
  key1: value1
  key2: value2

# 列表（数组）
list:
  - item1
  - item2
  - item3

# 文档结束标记（可选）
...
```

## 1.5 YAML与JSON的关系

YAML是JSON的超集，任何有效的JSON文档也是有效的YAML文档。下面是一个对比示例：

### JSON格式
```json
{
  "name": "John Doe",
  "age": 30,
  "married": true,
  "children": [
    {
      "name": "Alice",
      "age": 5
    },
    {
      "name": "Bob",
      "age": 3
    }
  ],
  "address": {
    "street": "123 Main St",
    "city": "Anytown",
    "zip": "12345"
  }
}
```

### YAML格式
```yaml
name: John Doe
age: 30
married: true
children:
  - name: Alice
    age: 5
  - name: Bob
    age: 3
address:
  street: 123 Main St
  city: Anytown
  zip: "12345"
```

可以看到，YAML格式更加简洁易读，不需要使用大括号、引号和逗号等符号。

## 1.6 YAML工具和解析器

### 1.6.1 在线验证器

- [YAML Lint](https://yamllint.com/) - 在线YAML语法验证
- [YAML Formatter](https://yaml-formatter.com/) - 在线YAML格式化

### 1.6.2 编程语言支持

大多数编程语言都有YAML解析库：

- **Python**: PyYAML, ruamel.yaml
- **JavaScript**: js-yaml, yaml
- **Java**: SnakeYAML, Jackson
- **Ruby**: Psych (内置)
- **Go**: gopkg.in/yaml.v2, gopkg.in/yaml.v3
- **PHP**: Symfony YAML Component

## 1.7 实验与验证

让我们通过一些简单的例子来验证YAML的基本语法：

### 实验1：创建一个简单的YAML文件

创建一个名为`experiment1.yml`的文件：

```yaml
# 实验1：基本YAML结构
---
# 个人信息
name: "张三"
age: 25
student: true

# 地址信息
address:
  street: "北京市朝阳区"
  city: "北京"
  zip: "100000"

# 兴趣爱好
hobbies:
  - "阅读"
  - "游泳"
  - "编程"
```

### 实验2：验证YAML语法

使用Python的PyYAML库验证上面的YAML文件：

```python
import yaml

# 读取YAML文件
with open('experiment1.yml', 'r', encoding='utf-8') as file:
    try:
        data = yaml.safe_load(file)
        print("YAML语法正确！")
        print("解析结果：")
        print(data)
    except yaml.YAMLError as e:
        print(f"YAML语法错误：{e}")
```

### 实验3：将Python对象转换为YAML

```python
import yaml

# Python字典
person = {
    'name': '李四',
    'age': 30,
    'married': False,
    'children': ['小明', '小红'],
    'address': {
        'street': '上海市浦东新区',
        'city': '上海',
        'zip': '200000'
    }
}

# 转换为YAML
yaml_str = yaml.dump(person, allow_unicode=True, indent=2)
print("转换后的YAML：")
print(yaml_str)

# 保存到文件
with open('experiment2.yml', 'w', encoding='utf-8') as file:
    yaml.dump(person, file, allow_unicode=True, indent=2)
```

## 1.8 常见错误与注意事项

### 1.8.1 缩进错误

```yaml
# 错误示例：使用了Tab缩进
parent:
	child: value  # 使用Tab会导致解析错误

# 正确示例：使用空格缩进
parent:
  child: value  # 使用2个空格缩进
```

### 1.8.2 冒号后缺少空格

```yaml
# 错误示例：冒号后缺少空格
key:value  # 解析器可能无法正确识别

# 正确示例：冒号后有空格
key: value
```

### 1.8.3 特殊字符处理

```yaml
# 包含特殊字符的值需要引号
password: "p@ssw0rd!"
path: "C:\\Program Files\\App"

# 数字字符串需要引号
zip: "12345"  # 字符串
age: 30       # 数字
```

## 1.9 总结

本章介绍了YAML的基础知识，包括：

1. YAML的定义、历史和特点
2. YAML的应用场景
3. YAML的基本语法规则
4. YAML与JSON的关系
5. YAML工具和解析器
6. 通过实验验证YAML语法

掌握这些基础知识后，我们可以继续学习更复杂的YAML数据类型和结构。在下一章中，我们将详细介绍YAML支持的各种数据类型和高级结构。