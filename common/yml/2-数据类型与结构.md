# 第2章：YAML数据类型与结构

## 2.1 YAML数据类型概述

YAML支持多种数据类型，可以分为三大类：
- **标量（Scalars）**：单个值，如字符串、数字、布尔值等
- **序列（Sequences）**：有序的值列表，类似于数组
- **映射（Mappings）**：键值对集合，类似于对象或字典

本章将详细介绍这些数据类型及其用法。

## 2.2 标量类型

### 2.2.1 字符串

字符串是YAML中最常用的数据类型，可以用多种方式表示：

#### 单行字符串

```yaml
# 简单字符串（不需要引号）
name: John Doe

# 包含特殊字符的字符串（需要引号）
password: "p@ssw0rd!"
path: "C:\\Program Files\\App"

# 包含空格的字符串（建议使用引号）
greeting: "Hello, World!"
```

#### 多行字符串

YAML提供了两种多行字符串表示方式：块标量（|）和折叠标量（>）。

```yaml
# 块标量（|）：保留换行符
address: |
  123 Main Street
  Anytown, USA 12345

# 折叠标量（>）：将换行符转换为空格
description: >
  This is a long description
  that spans multiple lines
  but is treated as a single
  paragraph in the output.
```

#### 字符串中的特殊字符

```yaml
# 转义字符
escaped: "This contains a \"quote\" and a \\ backslash"

# Unicode字符
unicode: "Hello, 世界!"

# 空字符串
empty: ""

# null值（大小写不敏感）
null_value: null
another_null: Null
yet_another_null: NULL
```

### 2.2.2 数字

YAML支持多种数字格式：

```yaml
# 整数
integer: 42
negative_integer: -17
octal: 0o755  # 八进制
hexadecimal: 0xFF  # 十六进制

# 浮点数
float: 3.14
negative_float: -2.71
scientific: 1.23e-4  # 科学计数法

# 特殊值
infinity: .inf  # 正无穷
negative_infinity: -.inf  # 负无穷
not_a_number: .NaN  # 非数字
```

### 2.2.3 布尔值

YAML支持多种布尔值表示方式：

```yaml
# 常见的布尔值表示
true_value: true
false_value: false

# 其他表示方式（不推荐，但支持）
yes: true
no: false
on: true
off: false

# 注意：这些会被解析为字符串，不是布尔值
string_true: "true"
string_false: "false"
```

### 2.2.4 日期和时间

YAML支持ISO 8601格式的日期和时间：

```yaml
# 日期
date: 2023-05-15

# 时间
time: 14:30:00

# 日期和时间
datetime: 2023-05-15T14:30:00

# 带时区的日期时间
datetime_with_timezone: 2023-05-15T14:30:00+08:00

# 日期范围
date_range: 2023-05-01/2023-05-31
```

## 2.3 序列（列表/数组）

序列是有序的值集合，使用连字符（-）表示每个元素：

### 2.3.1 基本序列

```yaml
# 简单序列
fruits:
  - apple
  - banana
  - orange

# 内联序列（类似JSON数组）
vegetables: [carrot, broccoli, spinach]

# 混合类型序列
mixed_list:
  - "string"
  - 42
  - true
  - null
```

### 2.3.2 嵌套序列

```yaml
# 嵌套序列
nested_sequences:
  - - item1
    - item2
  - - item3
    - item4
    - item5

# 序列中的映射
sequence_of_mappings:
  - name: John
    age: 30
  - name: Jane
    age: 25
```

### 2.3.3 多行序列

```yaml
# 多行序列
long_sequence:
  - first item
  - second item
  - third item
  - fourth item
  - fifth item
```

## 2.4 映射（对象/字典）

映射是键值对的集合，使用冒号（:）分隔键和值：

### 2.4.1 基本映射

```yaml
# 简单映射
person:
  name: John Doe
  age: 30
  city: New York

# 内联映射（类似JSON对象）
inline_mapping: {name: Jane, age: 25, city: Boston}
```

### 2.4.2 嵌套映射

```yaml
# 嵌套映射
company:
  name: Tech Corp
  address:
    street: 123 Business Ave
    city: San Francisco
    state: CA
    zip: 94105
  contact:
    phone: 555-1234
    email: info@techcorp.com
```

### 2.4.3 复杂结构

```yaml
# 映射中的序列
person_with_hobbies:
  name: John
  age: 30
  hobbies:
    - reading
    - swimming
    - programming

# 序列中的映射
people:
  - name: John
    age: 30
    city: New York
  - name: Jane
    age: 25
    city: Boston
```

## 2.5 高级数据类型

### 2.5.1 集合

YAML支持集合（set）类型，使用`!!set`标签：

```yaml
# 集合（无序、唯一元素）
set_example: !!set
  ? apple
  ? banana
  ? orange
```

### 2.5.2 有序映射

YAML支持有序映射，使用`!!omap`标签：

```yaml
# 有序映射（保持键的顺序）
ordered_map: !!omap
  - name: John
  - age: 30
  - city: New York
```

### 2.5.3 二进制数据

YAML支持二进制数据，使用`!!binary`标签：

```yaml
# 二进制数据（Base64编码）
binary_data: !!binary R0lGODlhDAAMAIQAAP//9/X17unp5WZmZgAAAOfn515eXvPz7Y6OjuDg4J+fn5OTk6enp56enmleECcgggoBADs=
```

## 2.6 类型转换与强制

### 2.6.1 显式类型指定

可以使用双感叹号（!!）显式指定数据类型：

```yaml
# 显式指定字符串类型
string_number: !!str 123

# 显式指定整数类型
integer_string: !!int "456"

# 显式指定浮点数类型
float_string: !!float "3.14"

# 显式指定布尔值类型
boolean_string: !!bool "true"
```

### 2.6.2 自定义类型

YAML支持自定义类型：

```yaml
# 自定义类型示例
custom_date: !!custom/date 2023-05-15
custom_object: !!custom/object
  property1: value1
  property2: value2
```

## 2.7 数据类型验证

### 2.7.1 使用PyYAML验证类型

```python
import yaml
from typing import Dict, List, Any

def validate_yaml_types(yaml_content: str) -> Dict[str, Any]:
    """验证YAML内容的数据类型"""
    try:
        data = yaml.safe_load(yaml_content)
        
        # 检查数据类型
        if isinstance(data, dict):
            print("顶级数据类型: 映射 (字典)")
            for key, value in data.items():
                print(f"  {key}: {type(value).__name__}")
        elif isinstance(data, list):
            print("顶级数据类型: 序列 (列表)")
            for i, item in enumerate(data):
                print(f"  [{i}]: {type(item).__name__}")
        else:
            print(f"顶级数据类型: {type(data).__name__}")
        
        return data
    except yaml.YAMLError as e:
        print(f"YAML解析错误: {e}")
        return None

# 示例YAML内容
yaml_content = """
name: John Doe
age: 30
married: true
children:
  - Alice
  - Bob
address:
  street: 123 Main St
  city: Anytown
"""

validate_yaml_types(yaml_content)
```

## 2.8 实验与验证

### 实验1：创建包含各种数据类型的YAML文件

```yaml
# data_types.yml
# 包含各种数据类型的YAML示例
---
# 标量类型
string_value: "Hello, World!"
integer_value: 42
float_value: 3.14
boolean_value: true
date_value: 2023-05-15
null_value: null

# 序列类型
simple_list:
  - item1
  - item2
  - item3

mixed_list:
  - "string"
  - 123
  - true
  - null

nested_list:
  - - nested_item1
    - nested_item2
  - - nested_item3
    - nested_item4

# 映射类型
simple_mapping:
  key1: value1
  key2: value2
  key3: value3

nested_mapping:
  outer_key1:
    inner_key1: inner_value1
    inner_key2: inner_value2
  outer_key2:
    inner_key3: inner_value3
    inner_key4: inner_value4

# 复杂结构
complex_structure:
  users:
    - name: John
      age: 30
      hobbies:
        - reading
        - swimming
    - name: Jane
      age: 25
      hobbies:
        - painting
        - dancing
  settings:
    theme: dark
    notifications: true
    language: en-US
```

### 实验2：验证数据类型

```python
# validate_data_types.py
import yaml
import json

def analyze_yaml_structure(data, prefix=""):
    """分析YAML数据结构"""
    if isinstance(data, dict):
        print(f"{prefix}映射 (字典) - {len(data)} 个键:")
        for key, value in data.items():
            print(f"{prefix}  {key}: ", end="")
            analyze_yaml_structure(value, prefix + "  ")
    elif isinstance(data, list):
        print(f"{prefix}序列 (列表) - {len(data)} 个元素:")
        for i, item in enumerate(data):
            print(f"{prefix}  [{i}]: ", end="")
            analyze_yaml_structure(item, prefix + "  ")
    elif isinstance(data, str):
        print(f"字符串: '{data}'")
    elif isinstance(data, int):
        print(f"整数: {data}")
    elif isinstance(data, float):
        print(f"浮点数: {data}")
    elif isinstance(data, bool):
        print(f"布尔值: {data}")
    elif data is None:
        print("null值")
    else:
        print(f"未知类型: {type(data).__name__}")

# 读取并分析YAML文件
with open('data_types.yml', 'r', encoding='utf-8') as file:
    data = yaml.safe_load(file)

print("YAML数据结构分析:")
analyze_yaml_structure(data)

# 转换为JSON以查看结构
json_str = json.dumps(data, ensure_ascii=False, indent=2)
print("\n等效的JSON表示:")
print(json_str)
```

## 2.9 常见问题与解决方案

### 2.9.1 数字被解析为字符串

```yaml
# 问题：数字被解析为字符串
zip_code: "12345"  # 字符串
phone: "555-1234"  # 字符串

# 解决方案：使用显式类型指定
zip_code: !!str 12345  # 明确指定为字符串
phone: !!str 555-1234  # 明确指定为字符串
```

### 2.9.2 布尔值被解析为字符串

```yaml
# 问题：布尔值被解析为字符串
is_active: "true"  # 字符串，不是布尔值

# 解决方案：不使用引号
is_active: true  # 布尔值
```

### 2.9.3 日期被解析为字符串

```yaml
# 问题：日期被解析为字符串
event_date: "2023-05-15"  # 字符串

# 解决方案：不使用引号
event_date: 2023-05-15  # 日期类型
```

## 2.10 总结

本章详细介绍了YAML的各种数据类型和结构：

1. **标量类型**：字符串、数字、布尔值、日期和时间
2. **序列类型**：有序的值列表，支持嵌套和混合类型
3. **映射类型**：键值对集合，支持嵌套和复杂结构
4. **高级数据类型**：集合、有序映射、二进制数据
5. **类型转换与强制**：显式类型指定和自定义类型
6. **数据类型验证**：使用编程语言验证YAML数据类型
7. **常见问题与解决方案**：处理类型解析问题

掌握这些数据类型和结构后，我们可以继续学习YAML的高级特性。在下一章中，我们将介绍YAML的高级语法特性，如锚点、别名、合并等。