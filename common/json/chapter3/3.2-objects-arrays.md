# 3.2 对象与数组

## 对象（Object）类型详解

JSON对象是一种无序的键值对集合，使用花括号`{}`包围。对象是JSON中最常用的数据结构，用于表示实体、配置、响应数据等。

### 对象的基本结构

```json
{
  "key1": "value1",
  "key2": "value2",
  "key3": 123,
  "key4": true,
  "key5": null,
  "key6": ["array", "elements"],
  "key7": {
    "nested": "object"
  }
}
```

### 对象的键（Key）规则

回顾一下第2章中讨论的键的规则：

1. **必须使用双引号**：键必须是双引号包围的字符串
2. **必须是字符串**：键只能是字符串类型
3. **唯一性**：在同一对象中，键必须唯一
4. **可以包含Unicode字符**：键可以包含任何Unicode字符

```json
// 正确的键定义
{
  "name": "张三",
  "age": 30,
  "中文键": "中文值",
  "with-dash": "带连字符",
  "with_underscore": "带下划线",
  "with space": "带空格"
}

// 错误的键定义
{
  name: "张三",        // 缺少引号
  'age': 30,          // 使用单引号
  123: "数字键",       // 键是数字
  true: "布尔键",      // 键是布尔值
  "name": "值1",       // 重复键（第一个将被覆盖）
  "name": "值2"
}
```

### 对象的值（Value）规则

对象的值可以是任何有效的JSON值：字符串、数字、布尔值、对象、数组或null。

```json
{
  "stringField": "这是一个字符串",
  "numberField": 42,
  "booleanField": true,
  "nullField": null,
  "objectField": {
    "nestedKey": "嵌套值"
  },
  "arrayField": ["元素1", "元素2", 123, true]
}
```

### 空对象

空对象表示没有任何键值对的对象：

```json
{
  "emptyObject": {},
  "config": {},  // 表示配置存在但没有内容
  "metadata": {} // 表示元数据存在但没有内容
}
```

### 嵌套对象

对象可以嵌套在其他对象中，形成层次结构：

```json
{
  "user": {
    "id": "user_123",
    "profile": {
      "personal": {
        "firstName": "三",
        "lastName": "张",
        "birthDate": "1990-01-15"
      },
      "contact": {
        "email": "zhangsan@example.com",
        "phone": {
          "mobile": "138-0000-0000",
          "home": "010-12345678"
        }
      }
    },
    "preferences": {
      "ui": {
        "theme": "dark",
        "language": "zh-CN",
        "fontSize": 16
      },
      "notifications": {
        "email": true,
        "sms": false,
        "push": true
      }
    }
  }
}
```

### 对象的顺序

JSON对象本质上是无序的键值对集合。虽然JSON规范在RFC 8259中明确对象是无序的，但一些解析器可能会保留顺序。

```json
{
  "id": 123,
  "name": "张三",
  "email": "zhangsan@example.com"
}
```

在JavaScript中，ES2015引入了对象键的排序规则：
1. 数字键按升序排序
2. 字符串键按插入顺序排序
3. Symbol键按插入顺序排序

## 数组（Array）类型详解

JSON数组是有序的值集合，使用方括号`[]`包围。数组用于表示同类型数据的列表或序列。

### 数组的基本结构

```json
[
  "value1",
  "value2",
  123,
  true,
  null,
  {
    "key": "value"
  },
  ["nested", "array"]
]
```

### 空数组

空数组表示没有任何元素的数组：

```json
{
  "emptyArray": [],
  "tags": [],        // 没有标签
  "permissions": [], // 没有权限
  "errors": []       // 没有错误
}
```

### 数组元素的类型

数组可以包含任何有效的JSON值，包括其他数组或对象：

```json
{
  "stringArray": ["apple", "banana", "orange"],
  "numberArray": [1, 2, 3, 4.5, -6.7],
  "booleanArray": [true, false, true],
  "nullArray": [null, null, null],
  "mixedArray": ["string", 123, true, null, {"key": "value"}, [1, 2, 3]],
  "objectArray": [
    {
      "id": 1,
      "name": "张三"
    },
    {
      "id": 2,
      "name": "李四"
    }
  ],
  "nestedArrays": [
    [1, 2, 3],
    ["a", "b", "c"],
    [true, false, null]
  ]
}
```

### 数组的索引

数组是零索引的，意味着第一个元素的索引是0：

```json
{
  "fruits": ["apple", "banana", "orange"],
  "accessByIndex": {
    "firstFruit": "apple",    // 索引 0
    "secondFruit": "banana",  // 索引 1
    "thirdFruit": "orange"    // 索引 2
  }
}
```

### 嵌套数组

数组可以嵌套在其他数组中，形成多维数组：

```json
{
  "matrix": [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
  ],
  "tensor": [
    [
      [1, 2],
      [3, 4]
    ],
    [
      [5, 6],
      [7, 8]
    ]
  ]
}
```

## 对象与数组的组合

对象和数组可以相互嵌套，形成复杂的数据结构。这是JSON最强大的特性之一。

### 对象包含数组

对象可以包含数组作为值：

```json
{
  "user": {
    "id": "user_123",
    "name": "张三",
    "roles": ["user", "editor"],
    "permissions": [
      {
        "resource": "articles",
        "actions": ["read", "write"]
      },
      {
        "resource": "media",
        "actions": ["read"]
      }
    ],
    "contactHistory": [
      {
        "date": "2023-07-15",
        "type": "email",
        "subject": "订单确认"
      },
      {
        "date": "2023-07-10",
        "type": "phone",
        "duration": 300
      }
    ]
  }
}
```

### 数组包含对象

数组可以包含对象作为元素：

```json
{
  "products": [
    {
      "id": "prod_001",
      "name": "智能手机",
      "price": 5999,
      "inStock": true,
      "tags": ["电子产品", "通讯"]
    },
    {
      "id": "prod_002",
      "name": "笔记本电脑",
      "price": 8999,
      "inStock": false,
      "tags": ["电子产品", "办公"]
    }
  ]
}
```

### 复杂嵌套结构

对象和数组可以形成复杂的嵌套结构：

```json
{
  "company": {
    "name": "科技公司",
    "departments": [
      {
        "name": "研发部",
        "head": {
          "id": "emp_001",
          "name": "张三",
          "contact": {
            "email": "zhangsan@example.com",
            "phone": "138-0000-0000"
          }
        },
        "teams": [
          {
            "name": "前端团队",
            "members": [
              {
                "id": "emp_002",
                "name": "李四",
                "skills": ["JavaScript", "React", "CSS"],
                "projects": [
                  {
                    "name": "项目A",
                    "role": "前端开发",
                    "technologies": ["React", "Redux", "TypeScript"]
                  },
                  {
                    "name": "项目B",
                    "role": "技术负责人",
                    "technologies": ["React", "Node.js", "GraphQL"]
                  }
                ]
              },
              {
                "id": "emp_003",
                "name": "王五",
                "skills": ["JavaScript", "Vue", "Sass"],
                "projects": [
                  {
                    "name": "项目C",
                    "role": "前端开发",
                    "technologies": ["Vue", "Vuex", "TypeScript"]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}
```

## 对象与数组的选择

在实际应用中，选择使用对象还是数组取决于数据的性质和用途。

### 使用对象的场景

1. **表示实体或资源**：当数据有明确的标识和属性时
2. **键值映射**：当需要通过键快速访问值时
3. **配置数据**：当数据是配置项时
4. **非序列数据**：当数据没有自然的顺序时

```json
// 表示用户实体
{
  "user": {
    "id": "user_123",
    "name": "张三",
    "email": "zhangsan@example.com",
    "age": 30
  }
}

// 配置数据
{
  "database": {
    "host": "localhost",
    "port": 5432,
    "name": "myapp",
    "username": "user",
    "password": "password"
  }
}
```

### 使用数组的场景

1. **列表数据**：当数据是同类型项目的列表时
2. **有序数据**：当数据的顺序有意义时
3. **序列数据**：当数据表示时间序列或步骤时
4. **重复结构**：当需要重复某种结构时

```json
// 用户列表
{
  "users": [
    {
      "id": "user_123",
      "name": "张三"
    },
    {
      "id": "user_456",
      "name": "李四"
    }
  ]
}

// 处理步骤
{
  "steps": [
    {
      "id": 1,
      "name": "接收订单",
      "duration": 30
    },
    {
      "id": 2,
      "name": "处理支付",
      "duration": 120
    },
    {
      "id": 3,
      "name": "发货",
      "duration": 240
    }
  ]
}
```

### 对象数组的使用

对象数组结合了两者的优点，常用于表示对象列表：

```json
{
  "products": [
    {
      "id": "prod_001",
      "name": "智能手机",
      "price": 5999
    },
    {
      "id": "prod_002",
      "name": "笔记本电脑",
      "price": 8999
    }
  ]
}
```

## 对象与数组的操作

### 访问对象属性

在JavaScript中访问对象属性：

```javascript
const user = {
  "id": "user_123",
  "name": "张三",
  "profile": {
    "email": "zhangsan@example.com",
    "address": {
      "city": "北京",
      "zip": "100000"
    }
  }
};

// 点表示法
console.log(user.name);  // 输出：张三

// 方括号表示法（适用于特殊字符键）
console.log(user["id"]);  // 输出：user_123

// 嵌套访问
console.log(user.profile.email);  // 输出：zhangsan@example.com
console.log(user.profile.address.city);  // 输出：北京
```

### 访问数组元素

在JavaScript中访问数组元素：

```javascript
const fruits = ["apple", "banana", "orange"];

// 通过索引访问
console.log(fruits[0]);  // 输出：apple
console.log(fruits[1]);  // 输出：banana

// 获取数组长度
console.log(fruits.length);  // 输出：3

// 遍历数组
fruits.forEach(function(fruit, index) {
  console.log(index + ": " + fruit);
});

// 访问嵌套数组中的元素
const matrix = [
  [1, 2, 3],
  [4, 5, 6],
  [7, 8, 9]
];
console.log(matrix[0][1]);  // 输出：2
```

### 访问对象数组

访问对象数组中的元素和属性：

```javascript
const users = [
  {
    "id": "user_123",
    "name": "张三",
    "email": "zhangsan@example.com"
  },
  {
    "id": "user_456",
    "name": "李四",
    "email": "lisi@example.com"
  }
];

// 访问第一个用户的姓名
console.log(users[0].name);  // 输出：张三

// 访问第二个用户的邮箱
console.log(users[1].email);  // 输出：lisi@example.com

// 查找特定用户
const user = users.find(u => u.id === "user_123");
console.log(user.name);  // 输出：张三
```

## 实验环节：对象与数组操作

### 实验1：构建复杂嵌套结构

创建一个表示电商系统的复杂JSON结构，包含：

1. 商品列表（对象数组）
2. 用户信息（嵌套对象）
3. 订单信息（包含用户和商品的对象）
4. 分类树（嵌套对象和数组）

**要求**：
- 使用适当的嵌套结构
- 包含不同数据类型的字段
- 确保JSON语法正确
- 考虑数据访问的便利性

### 实验2：数据提取与操作

编写程序（使用JavaScript或Python）从复杂JSON中提取特定信息：

1. 获取所有商品名称
2. 计算订单总金额
3. 查找特定用户的所有订单
4. 统计每个分类下的商品数量

**示例数据**：
```json
{
  "users": [
    {
      "id": "user_123",
      "name": "张三",
      "email": "zhangsan@example.com"
    }
  ],
  "products": [
    {
      "id": "prod_001",
      "name": "智能手机",
      "price": 5999,
      "category": "electronics"
    }
  ],
  "orders": [
    {
      "id": "order_001",
      "userId": "user_123",
      "items": [
        {
          "productId": "prod_001",
          "quantity": 1,
          "price": 5999
        }
      ]
    }
  ]
}
```

### 实验3：对象与数组转换

实现对象和数组之间的转换函数：

1. 将对象转换为键值对数组
2. 将键值对数组转换为对象
3. 扁平化嵌套对象
4. 将数组转换为对象（以某个字段为键）

**JavaScript示例**：
```javascript
// 将对象转换为键值对数组
function objectToArray(obj) {
  return Object.entries(obj);
}

// 将键值对数组转换为对象
function arrayToObject(arr) {
  return Object.fromEntries(arr);
}

// 扁平化嵌套对象
function flattenObject(obj, prefix = '') {
  let result = {};
  
  for (const key in obj) {
    if (typeof obj[key] === 'object' && obj[key] !== null) {
      const nested = flattenObject(obj[key], prefix + key + '.');
      result = {...result, ...nested};
    } else {
      result[prefix + key] = obj[key];
    }
  }
  
  return result;
}

// 将数组转换为对象（以某个字段为键）
function arrayToObjectByKey(arr, keyField) {
  const result = {};
  
  for (const item of arr) {
    if (item[keyField]) {
      result[item[keyField]] = item;
    }
  }
  
  return result;
}
```

## 小结

本节我们深入探讨了JSON中的对象和数组：

1. **对象类型**：
   - 基本结构：花括号包围的键值对集合
   - 键的规则：双引号、字符串、唯一性
   - 值的规则：任何有效的JSON值
   - 嵌套对象：形成层次结构

2. **数组类型**：
   - 基本结构：方括号包围的有序值集合
   - 元素类型：任何有效的JSON值
   - 索引访问：零索引
   - 嵌套数组：多维数组结构

3. **对象与数组的组合**：
   - 对象包含数组
   - 数组包含对象
   - 复杂嵌套结构

4. **对象与数组的选择**：
   - 使用对象的场景：实体、配置、键值映射
   - 使用数组的场景：列表、有序数据、序列
   - 对象数组：结合两者优点

5. **对象与数组的操作**：
   - 访问对象属性：点表示法和方括号表示法
   - 访问数组元素：索引访问
   - 访问对象数组：结合两者

理解对象和数组的使用场景和操作方法，是构建有效JSON结构的关键。在下一节中，我们将探讨JSON中的嵌套结构与复杂数据表示，进一步深化我们对JSON数据组织的理解。

## 代码示例

请查看`code/chapter3/objects-arrays`目录，其中包含了：

1. `object_examples.json` - 各种对象结构示例
2. `array_examples.json` - 各种数组结构示例
3. `nested_structures.json` - 复杂嵌套结构示例
4. `object_vs_array.json` - 对象与数组选择示例
5. `object_operations.js` - JavaScript对象操作示例
6. `array_operations.js` - JavaScript数组操作示例
7. `nested_data_access.js` - 嵌套数据访问示例
8. `data_transformation.js` - 对象与数组转换示例
9. `ecommerce_system.json` - 电商系统完整示例