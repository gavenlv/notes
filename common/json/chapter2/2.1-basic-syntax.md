# 2.1 基本语法结构

## JSON语法基础

JSON（JavaScript Object Notation）的语法简单明了，但也有一些严格的规则需要遵守。本节将详细介绍JSON的基本语法结构，帮助您掌握编写有效JSON的技巧。

## JSON文本结构

一个完整的JSON文档可以是一个**对象**或是一个**数组**。这是JSON的顶层结构，也是JSON的入口点。

### 顶层对象结构

```json
{
  "key1": "value1",
  "key2": "value2",
  "key3": {
    "nestedKey": "nestedValue"
  }
}
```

### 顶层数组结构

```json
[
  "value1",
  "value2",
  {
    "key": "value"
  },
  [
    "nested",
    "array"
  ]
]
```

### 混合结构（对象包含数组，数组包含对象）

```json
{
  "users": [
    {
      "id": 1,
      "name": "张三"
    },
    {
      "id": 2,
      "name": "李四"
    }
  ],
  "admin": {
    "id": 0,
    "name": "管理员",
    "permissions": ["read", "write", "delete"]
  }
}
```

## 键值对详解

JSON的核心是键值对（key-value pairs），理解键值对的规则对于编写有效的JSON至关重要。

### 键（Key）的规则

1. **必须使用双引号**：JSON中的键必须用双引号包围，不能使用单引号或无引号

```json
// 正确
{
  "name": "张三",
  "age": 30
}

// 错误
{
  'name': "张三",  // 使用单引号
  name: "张三"      // 无引号
}
```

2. **必须是字符串**：键只能是字符串类型，不能是数字、布尔值或其他类型

```json
// 正确
{
  "name": "张三",
  "123": "数字作为键的字符串"
}

// 错误
{
  123: "数字不能作为键",  // 键不能是数字
  true: "布尔值不能作为键"  // 键不能是布尔值
}
```

3. **唯一性**：在同一个对象中，键必须唯一

```json
// 正确
{
  "firstName": "张",
  "lastName": "三"
}

// 不推荐（虽然某些解析器可能接受最后一个重复键，但不符合规范）
{
  "name": "张三",
  "name": "李四"  // 重复键
}
```

4. **可以包含Unicode字符**：键可以包含任何Unicode字符，包括中文

```json
{
  "姓名": "张三",
  "年龄": 30
}
```

5. **不能包含特殊控制字符**：键中不能包含未转义的控制字符

```json
// 错误
{
  "name": "张三",
  "key\twith\ttabs": "值"  // 包含未转义的制表符
}

// 正确
{
  "name": "张三",
  "key\\twith\\ttabs": "值"  // 使用转义字符
}
```

### 值（Value）的类型

JSON的值可以是以下六种类型之一：

#### 1. 字符串（String）

```json
{
  "simpleString": "Hello",
  "chineseString": "你好",
  "withQuotes": "他说：\"你好\"",
  "withEscapes": "第一行\n第二行\t制表符",
  "unicode": "\u4F60\u597D",  // Unicode转义序列表示"你好"
  "emptyString": ""
}
```

字符串的转义规则：
- `\"` - 双引号
- `\\` - 反斜杠
- `\/` - 正斜杠
- `\b` - 退格符
- `\f` - 换页符
- `\n` - 换行符
- `\r` - 回车符
- `\t` - 制表符
- `\uXXXX` - Unicode字符

#### 2. 数字（Number）

```json
{
  "integer": 42,
  "negativeInteger": -17,
  "float": 3.14159,
  "negativeFloat": -2.71828,
  "scientific": 1.23e+4,  // 科学计数法表示12300
  "negativeScientific": 1.23e-4,  // 科学计数法表示0.000123
  "zero": 0,
  "verySmall": 0.0000001
}
```

JSON中数字的限制：
- 不能有前导零（除了0本身）
- 不能包含空格
- 支持十进制、科学计数法
- 不支持八进制、十六进制

```json
// 正确
{
  "zero": 0,
  "positive": 123,
  "negative": -456,
  "decimal": 3.14,
  "scientific": 1.23e+10
}

// 错误
{
  "leadingZero": 0123,  // 前导零
  "hexadecimal": 0xFF,  // 十六进制
  "octal": 0o77,        // 八进制
  "withSpaces": 1 234    // 包含空格
}
```

#### 3. 布尔值（Boolean）

```json
{
  "trueValue": true,
  "falseValue": false,
  "booleanArray": [true, false, true]
}
```

注意：布尔值必须是小写的`true`和`false`，不能使用`True`、`False`或`TRUE`、`FALSE`。

#### 4. 数组（Array）

```json
{
  "emptyArray": [],
  "stringArray": ["apple", "banana", "orange"],
  "numberArray": [1, 2, 3, 4.5],
  "booleanArray": [true, false],
  "mixedArray": [
    "字符串",
    123,
    true,
    null,
    {
      "nested": "object"
    },
    [
      "nested",
      "array"
    ]
  ],
  "arrayOfObjects": [
    {
      "id": 1,
      "name": "张三"
    },
    {
      "id": 2,
      "name": "李四"
    }
  ]
}
```

数组的特点：
- 使用方括号`[]`包围
- 元素之间用逗号分隔
- 元素可以是任何有效的JSON值
- 支持混合类型数组（虽然不推荐）
- 不能有尾随逗号

#### 5. 对象（Object）

```json
{
  "emptyObject": {},
  "simpleObject": {
    "key": "value"
  },
  "nestedObject": {
    "level1": {
      "level2": {
        "level3": "深层嵌套对象"
      }
    }
  },
  "objectWithArray": {
    "users": [
      {
        "id": 1,
        "name": "张三"
      },
      {
        "id": 2,
        "name": "李四"
      }
    ]
  }
}
```

对象的特点：
- 使用花括号`{}`包围
- 包含零个或多个键值对
- 键值对之间用逗号分隔
- 键必须是字符串
- 值可以是任何有效的JSON值
- 键在同一个对象中必须唯一
- 不能有尾随逗号

#### 6. null值

```json
{
  "nullValue": null,
  "objectWithNull": {
    "name": "张三",
    "middleName": null,
    "nickname": null
  },
  "arrayWithNull": [
    "张三",
    null,
    "李四"
  ]
}
```

注意：null必须是小写的`null`，不能使用`Null`或`NULL`。

## 语法规则总结

以下是一些需要严格遵守的JSON语法规则：

### 1. 引号规则

- **键必须使用双引号**
- **字符串值必须使用双引号**
- **不能使用单引号**

```json
// 正确
{
  "name": "张三",
  "message": "他说：'你好'"

// 错误
{
  'name': "张三",      // 键使用单引号
  "message": 'Hello'   // 值使用单引号
}
```

### 2. 逗号规则

- **多个键值对之间使用逗号分隔**
- **多个数组元素之间使用逗号分隔**
- **最后一个键值对或数组元素后不能有逗号（尾随逗号）**

```json
// 正确
{
  "name": "张三",
  "age": 30
}

// 错误（有尾随逗号）
{
  "name": "张三",
  "age": 30,
}
```

### 3. 分隔符规则

- **键和值之间使用冒号`:`分隔**
- **键值对之间使用逗号`,`分隔**
- **数组元素之间使用逗号`,`分隔**

### 4. 注释规则

- **JSON不支持注释**（这是与许多其他配置格式的区别）

```json
// 错误
{
  // 这是单行注释
  "name": "张三",
  "age": 30,  /* 这是行尾注释 */
  /* 这是
     多行注释 */
  "email": "zhangsan@example.com"
}

// 正确（不带注释）
{
  "name": "张三",
  "age": 30,
  "email": "zhangsan@example.com"
}
```

### 5. 嵌套规则

- **对象可以嵌套在对象中**
- **数组可以嵌套在数组中**
- **对象和数组可以相互嵌套**
- **嵌套层次没有限制**（但实际应用中建议不要过深）

```json
{
  "level1": {
    "level2": {
      "level3": {
        "level4": {
          "level5": {
            "message": "深层次嵌套"
          }
        }
      }
    }
  },
  "arrays": [
    [
      [
        [
          ["深层嵌套数组"]
        ]
      ]
    ]
  ]
}
```

## 实验环节：JSON语法验证

### 实验1：验证基本语法

创建以下JSON文件，检查语法是否正确：

**文件：`syntax_test.json`**
```json
{
  "name": "张三",
  "age": 30,
  "isActive": true,
  "scores": [95, 87, 92],
  "address": {
    "street": "人民路123号",
    "city": "北京",
    "zipCode": "100000"
  },
  "phoneNumbers": [
    {
      "type": "手机",
      "number": "138-0000-0000"
    },
    {
      "type": "家庭",
      "number": "010-12345678"
    }
  ],
  "metadata": null
}
```

**验证步骤**：
1. 使用在线JSON验证工具（如https://jsonlint.com/）验证上述JSON
2. 观察验证结果
3. 如果有错误，尝试找出并修复

### 实验2：常见语法错误识别

以下是一些常见的语法错误，尝试识别并修复它们：

**错误1：使用单引号**
```json
{
  'name': '张三',
  'age': 30
}
```

**错误2：尾随逗号**
```json
{
  "name": "张三",
  "age": 30,
  "isActive": true,
}
```

**错误3：键不使用引号**
```json
{
  name: "张三",
  age: 30,
  isActive: true
}
```

**错误4：布尔值和null大小写错误**
```json
{
  "isActive": True,
  "isAdmin": FALSE,
  "middleName": Null
}
```

**错误5：数字格式错误**
```json
{
  "leadingZero": 0123,
  "hexNumber": 0xFF,
  "withSpaces": 1 234
}
```

### 实验3：复杂JSON构建

构建一个表示大学课程体系的复杂JSON，包含以下结构：

1. 大学名称和基本信息
2. 学院列表（至少3个学院）
3. 每个学院包含：
   - 学院名称
   - 专业列表（至少2个专业）
   - 每个专业包含：
     - 专业名称
     - 专业代码
     - 课程列表（至少3门课程）
     - 每门课程包含：
       - 课程名称
       - 课程代码
       - 学分
       - 先修课程（可能是数组或null）

## 小结

本节我们详细学习了JSON的基本语法结构：

1. JSON的顶层结构：对象或数组
2. 键值对的规则：键必须是双引号字符串，值可以是六种类型之一
3. 六种JSON值类型：字符串、数字、布尔值、数组、对象、null
4. 严格的语法规则：双引号、无尾随逗号、无注释
5. 嵌套结构：对象和数组可以相互嵌套

掌握这些基本语法规则是编写有效JSON的基础。在下一节中，我们将深入探讨JSON中名称与值的规则，以及一些高级语法特性。

## 代码示例

请查看`code/chapter2/basic-syntax`目录，其中包含了：

1. `valid_syntax_examples.json` - 各种有效的JSON语法示例
2. `common_errors.json` - 常见语法错误示例
3. `nested_structures.json` - 复杂嵌套结构示例
4. `validate_json.js` - 使用JavaScript验证JSON的示例代码
5. `validate_json.py` - 使用Python验证JSON的示例代码