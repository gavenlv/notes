# 2.2 名称与值规则

## 名称（键）的深入探讨

在JSON中，名称（通常称为键）是标识数据的重要组成部分。虽然看起来简单，但名称的使用有一些重要的规则和最佳实践需要掌握。

## 名称的基本规则

### 1. 必须使用双引号

JSON中最严格的规则之一是名称必须使用双引号，不能使用单引号或省略引号。

```json
// 正确的名称定义
{
  "name": "张三",
  "age": 30,
  "isActive": true,
  "user-id": "user123",
  "姓名": "李四"  // Unicode字符也是允许的
}

// 错误的名称定义
{
  name: "张三",        // 缺少引号
  'age': 30,          // 使用单引号
  "active": true,      // 名称尾随逗号
}
```

### 2. 名称必须是字符串

JSON中的名称只能是字符串类型，不能是数字、布尔值或其他类型。

```json
// 正确
{
  "123": "数字作为字符串的名称",
  "true": "布尔值true作为字符串的名称",
  "null": "null作为字符串的名称"
}

// 错误
{
  123: "数字不能作为名称",     // 键是数字，不是字符串
  true: "布尔值不能作为名称",   // 键是布尔值，不是字符串
  null: "null不能作为名称"      // 键是null，不是字符串
}
```

### 3. 名称的唯一性

在同一个对象中，名称必须唯一。虽然某些解析器可能会接受重复名称（通常取最后一个），但这不符合JSON规范。

```json
// 正确 - 名称唯一
{
  "firstName": "张",
  "lastName": "三",
  "age": 30
}

// 不推荐 - 名称重复
{
  "name": "张三",
  "name": "李四"  // 重复的名称，不同解析器可能有不同行为
}

// 一些解析器的可能行为
// JavaScript: {"name": "李四"} - 取最后一个
// Python: {"name": "李四"} - 取最后一个
// 某些严格解析器: 抛出错误
```

### 4. 名称中可以包含的字符

JSON名称可以包含任何Unicode字符，但有一些需要注意的特殊字符。

```json
{
  "simple": "简单名称",
  "with-dash": "包含连字符",
  "with_underscore": "包含下划线",
  "withDot.dot": "包含点号",
  "with$pecial": "包含特殊字符",
  "with space": "包含空格",
  "中文键": "中文键值对",
  "emoji键😀": "包含表情符号的键",
  "quotes": "包含引号 - 需要转义",
  "back\\slash": "包含反斜杠 - 需要转义"
}
```

### 5. 需要转义的特殊字符

在JSON名称中，以下字符需要转义：

- `"` (双引号) - 转义为 `\"`
- `\` (反斜杠) - 转义为 `\\`
- 控制字符（如换行符、制表符等）- 需要使用对应的转义序列

```json
// 正确使用转义字符
{
  "quoted\"name": "包含引号的名称",
  "path\\to\\file": "包含反斜杠的名称",
  "line1\\nline2": "包含换行符的名称"
}

// 错误 - 未转义的特殊字符
{
  "quoted"name": "包含引号的名称",  // 未转义的双引号
  "path\to\file": "包含反斜杠的名称" // 未转义的反斜杠
}
```

## 值的深入探讨

JSON中的值有六种基本类型：字符串、数字、布尔值、对象、数组和null。让我们深入了解每种值的规则和最佳实践。

### 1. 字符串值

#### 基本规则

- 必须使用双引号包围
- 支持Unicode字符
- 支持转义序列

```json
{
  "simpleString": "Hello, World!",
  "chineseString": "你好，世界！",
  "emojiString": "😀🎉🚀",
  "emptyString": "",
  "withQuotes": "他说：\"JSON很好用！\"",
  "withBackslash": "路径：C:\\Users\\Documents",
  "withNewlines": "第一行\n第二行\n第三行",
  "withTabs": "列1\t列2\t列3",
  "unicodeEscape": "\u4F60\u597D"  // Unicode转义表示"你好"
}
```

#### 转义序列完整列表

| 转义序列 | 字符 | 说明 |
|---------|------|------|
| `\"` | " | 双引号 |
| `\\` | \ | 反斜杠 |
| `\/` | / | 正斜杠（可选转义） |
| `\b` | 退格符 | 退格 |
| `\f` | 换页符 | 换页 |
| `\n` | 换行符 | 换行 |
| `\r` | 回车符 | 回车 |
| `\t` | 制表符 | 水平制表 |
| `\uXXXX` | Unicode字符 | 4位十六进制Unicode码点 |

#### 字符串最佳实践

1. **使用语义化的字符串**：让字符串内容明确表达含义
2. **避免过长的字符串**：考虑将大文本分割或使用外部文件
3. **保持一致的命名约定**：使用驼峰命名法或下划线命名法

```json
// 良好的字符串实践
{
  "pageTitle": "用户登录",
  "errorMessage": "用户名或密码错误，请重试。",
  "welcomeMessage": "欢迎回来，{{username}}！",
  "apiEndpoint": "https://api.example.com/v1/users",
  "timestampFormat": "YYYY-MM-DD HH:mm:ss"
}

// 不太好的实践
{
  "title1": "登录",  // 不够具体
  "msg": "错误",     // 过于模糊
  "url": "http://...",  // 不完整的URL
  "format": "YYYY..."   // 不完整的格式
}
```

### 2. 数字值

#### 基本规则

- 不使用引号包围
- 可以是整数或浮点数
- 支持科学计数法
- 不能包含前导零（除了0本身）
- 支持正负号

```json
{
  "positiveInteger": 42,
  "negativeInteger": -17,
  "zero": 0,
  "positiveFloat": 3.14159,
  "negativeFloat": -2.71828,
  "scientificNotation": 1.23e+4,  // 等于12300
  "negativeScientific": 5.67e-3,  // 等于0.00567
  "largeNumber": 9007199254740991,  // JavaScript中最大的安全整数
  "verySmallNumber": 0.0000001
}
```

#### 数字值的限制

1. **不能使用前导零**（除了0本身）
2. **不能包含空格或下划线**
3. **不支持八进制、十六进制**
4. **不支持 Infinity 或 NaN**

```json
// 正确的数字表示
{
  "validNumbers": [0, 123, -456, 3.14, -2.718, 1.23e+5]
}

// 错误的数字表示
{
  "leadingZero": 0123,    // 前导零（错误）
  "hexadecimal": 0xFF,    // 十六进制（错误）
  "octal": 0o77,          // 八进制（错误）
  "withSpaces": 1 234,    // 包含空格（错误）
  "withUnderscore": 1_234, // 包含下划线（错误）
  "infinity": Infinity,   // Infinity不是有效的JSON数字
  "notANumber": NaN       // NaN不是有效的JSON数字
}
```

#### 数字值的最佳实践

1. **使用适当的数据类型**：整数表示计数，浮点数表示测量值
2. **避免精度问题**：在需要高精度计算时，考虑使用字符串表示数字
3. **使用科学计数法表示极大或极小的数字**

```json
// 良好的数字实践
{
  "userId": 12345,              // 用户ID - 整数
  "price": 19.99,               // 价格 - 浮点数
  "quantity": 5,                // 数量 - 整数
  "rating": 4.5,                // 评分 - 浮点数
  "atomicMass": 1.23e-10,       // 原子质量 - 科学计数法
  "planetsCount": 8,             // 行星数量 - 整数
  "largeId": 9007199254740992    // 可能超出JavaScript安全整数范围，考虑使用字符串
}
```

### 3. 布尔值

#### 基本规则

- 只有两个值：`true`和`false`
- 必须是小写
- 不使用引号包围

```json
{
  "isActive": true,
  "isDeleted": false,
  "hasPermission": true,
  "isEmpty": false,
  "booleanArray": [true, false, true, false]
}
```

#### 布尔值的常见错误

```json
// 错误的布尔值表示
{
  "isActive": True,    // 首字母大写（错误）
  "isDeleted": FALSE,  // 全大写（错误）
  "hasPermission": "true",  // 使用字符串（错误）
  "isEmpty": 1,        // 使用数字（错误）
  "isCompleted": 0     // 使用数字（错误）
}

// 正确的布尔值表示
{
  "isActive": true,
  "isDeleted": false,
  "hasPermission": true,
  "isEmpty": false
}
```

#### 布尔值的最佳实践

1. **使用语义化的布尔键名**：键名应该以"is"、"has"、"can"等开头
2. **避免混合表示法**：不要在同一个JSON中同时使用布尔值和0/1表示真假
3. **保持布尔值的一致性**：相似的逻辑使用相同的布尔表示方式

```json
// 良好的布尔实践
{
  "isLoggedIn": true,
  "hasAdminRights": false,
  "canEdit": true,
  "isDeleted": false,
  "notificationsEnabled": true,
  "profileCompleted": false
}
```

### 4. 数组值

#### 基本规则

- 使用方括号`[]`包围
- 元素之间用逗号分隔
- 不能有尾随逗号
- 可以包含任何有效的JSON值
- 支持混合类型（虽然不推荐）

```json
{
  "emptyArray": [],
  "stringArray": ["apple", "banana", "orange"],
  "numberArray": [1, 2, 3, 4.5],
  "booleanArray": [true, false, true],
  "nullArray": [null, null, null],
  "mixedArray": ["字符串", 123, true, null, {"key": "value"}, [1, 2, 3]],
  "arrayOfObjects": [
    {
      "id": 1,
      "name": "张三"
    },
    {
      "id": 2,
      "name": "李四"
    }
  ],
  "nestedArrays": [
    [1, 2, 3],
    ["a", "b", "c"],
    [true, false]
  ]
}
```

#### 数组的常见错误

```json
// 错误的数组表示
{
  "withTrailingComma": [1, 2, 3,],  // 尾随逗号（错误）
  "withSpaces": [1, 2, 3 ],         // 元素后有空格和逗号（错误）
  "withoutBrackets": 1, 2, 3         // 缺少方括号（错误）
}

// 正确的数组表示
{
  "correctArray": [1, 2, 3],
  "stringArray": ["a", "b", "c"],
  "mixedArray": [1, "string", true, null]
}
```

#### 数组的最佳实践

1. **保持数组元素类型一致**：虽然JSON允许混合类型数组，但实际应用中应保持一致
2. **使用有意义的数组**：数组应表示同类型数据的集合
3. **避免过深的嵌套**：尽量保持数组结构的扁平化

```json
// 良好的数组实践
{
  "userIds": [1, 2, 3, 4, 5],
  "userNames": ["张三", "李四", "王五", "赵六", "钱七"],
  "userScores": [95, 87, 92, 78, 88],
  "permissions": ["read", "write", "delete"],
  "recentActivities": [
    {
      "type": "login",
      "timestamp": "2023-07-15T08:30:00Z"
    },
    {
      "type": "view_page",
      "timestamp": "2023-07-15T08:35:00Z"
    }
  ]
}
```

### 5. 对象值

#### 基本规则

- 使用花括号`{}`包围
- 包含零个或多个键值对
- 键值对之间用逗号分隔
- 不能有尾随逗号
- 键必须是字符串
- 值可以是任何有效的JSON值

```json
{
  "emptyObject": {},
  "simpleObject": {
    "key": "value"
  },
  "complexObject": {
    "stringKey": "字符串值",
    "numberKey": 123,
    "booleanKey": true,
    "nullKey": null,
    "arrayKey": [1, 2, 3],
    "objectKey": {
      "nestedKey": "嵌套值"
    }
  },
  "objectWithNestedObjects": {
    "level1": {
      "level2": {
        "level3": {
          "deepValue": "深层嵌套值"
        }
      }
    }
  }
}
```

#### 对象的常见错误

```json
// 错误的对象表示
{
  "withTrailingComma": {          // 对象后尾随逗号（错误）
    "key1": "value1",
    "key2": "value2",
  },
  "unquotedKey": {                 // 键不使用引号（错误）
    key: "value"
  },
  "singleQuoteKey": {              // 键使用单引号（错误）
    'key': "value"
  },
  "duplicateKeys": {               // 重复键（不符合规范）
    "name": "值1",
    "name": "值2"
  }
}

// 正确的对象表示
{
  "correctObject": {
    "key1": "value1",
    "key2": "value2"
  },
  "nestedObject": {
    "parent": {
      "child": {
        "grandchild": "值"
      }
    }
  }
}
```

#### 对象的最佳实践

1. **使用语义化的键名**：键名应该清晰地表达所包含数据的含义
2. **保持对象结构的一致性**：相似的数据应该使用相同的结构
3. **避免过深的嵌套**：考虑将深层嵌套结构扁平化

```json
// 良好的对象实践
{
  "user": {
    "id": 123,
    "username": "zhangsan",
    "email": "zhangsan@example.com",
    "profile": {
      "firstName": "三",
      "lastName": "张",
      "avatar": "https://example.com/avatar.jpg"
    },
    "preferences": {
      "theme": "dark",
      "language": "zh-CN",
      "notifications": true
    }
  },
  "metadata": {
    "created": "2023-01-15T00:00:00Z",
    "updated": "2023-07-14T15:30:00Z",
    "version": "1.2.0"
  }
}
```

### 6. null值

#### 基本规则

- 只有一个值：`null`
- 必须是小写
- 不使用引号包围
- 表示"无值"或"空值"

```json
{
  "nullValue": null,
  "objectWithNulls": {
    "name": "张三",
    "middleName": null,  // 可选字段，用户没有提供中间名
    "nickname": null     // 可选字段，用户没有提供昵称
  },
  "arrayWithNulls": [
    "张三",
    null,               // 第二个用户信息为空
    "李四"
  ]
}
```

#### null的常见误解

```json
// 错误的null表示
{
  "uppercaseNull": NULL,    // 全大写（错误）
  "mixedCaseNull": Null,    // 首字母大写（错误）
  "quotedNull": "null",     // 使用字符串表示（错误）
  "emptyObject": {},        // 空对象不等于null
  "emptyArray": []          // 空数组不等于null
}

// 正确的null表示
{
  "correctNull": null,
  "optionalField": null,    // 表示可选字段没有值
  "missingData": null       // 表示数据缺失
}
```

#### null的最佳实践

1. **明确使用null**：当字段明确表示"无值"时使用null
2. **与空值区分**：null不同于空字符串""、空对象{}和空数组[]
3. **保持一致性**：在相似情况下一致地使用null

```json
// 良好的null实践
{
  "user": {
    "id": 123,
    "name": "张三",
    "middleName": null,     // 用户没有中间名
    "avatar": "https://example.com/avatar.jpg",
    "lastLoginAt": null      // 用户从未登录
  },
  "product": {
    "id": 456,
    "name": "智能手机",
    "description": "",       // 描述是空字符串，不是null
    "discountPrice": null,   // 没有折扣价
    "tags": []               // 没有标签，是空数组，不是null
  }
}
```

## 实验环节：名称与值规则验证

### 实验1：名称规则验证

创建一个包含各种名称的JSON文件，验证哪些是有效的，哪些是无效的：

**文件：`name_rules_test.json`**
```json
{
  "simple": "简单名称",
  "with-dash": "带连字符",
  "with_underscore": "带下划线",
  "with space": "带空格",
  "中文名称": "中文键",
  "emoji😀": "表情符号键",
  "123": "数字字符串键",
  "true": "布尔字符串键",
  "null": "null字符串键",
  "special!@#": "特殊字符键",
  "line\nbreak": "换行符键",
  "quote\"test": "引号键",
  "back\\slash": "反斜杠键"
}
```

### 实验2：值类型验证

创建一个包含各种值类型的JSON文件，验证每种值类型的正确性：

**文件：`value_types_test.json`**
```json
{
  "stringType": "这是一个字符串",
  "numberType": 12345,
  "floatType": 123.45,
  "scientificType": 1.23e+5,
  "booleanTrue": true,
  "booleanFalse": false,
  "nullType": null,
  "arrayType": [1, "two", true, null, {"key": "value"}],
  "objectType": {
    "nestedString": "嵌套字符串",
    "nestedNumber": 54321,
    "nestedBoolean": true,
    "nestedNull": null
  },
  "mixedType": "这是一个混合类型测试"
}
```

### 实验3：常见错误识别与修复

以下是一些常见的名称和值错误，尝试识别并修复它们：

**文件：`errors_and_fixes.json`**
```json
// 错误示例1：名称不使用引号
{
  name: "张三",
  age: 30,
  email: "zhangsan@example.com"
}

// 错误示例2：尾随逗号
{
  "name": "李四",
  "age": 25,
  "email": "lisi@example.com",
}

// 错误示例3：布尔值和null大小写错误
{
  "isActive": True,
  "isAdmin": FALSE,
  "middleName": Null
}

// 错误示例4：字符串使用单引号
{
  'name': "王五",
  "message": 'Hello, World!'
}

// 错误示例5：数字格式错误
{
  "id": 00123,
  "hexValue": 0xFF,
  "withSpaces": 1 234
}
```

## 小结

本节我们深入探讨了JSON中名称和值的规则：

1. **名称（键）的规则**：
   - 必须使用双引号
   - 必须是字符串
   - 在同一对象中必须唯一
   - 可以包含任何Unicode字符（需适当转义）

2. **值的规则**：
   - 字符串：必须使用双引号，支持Unicode和转义序列
   - 数字：不使用引号，支持整数、浮点数和科学计数法
   - 布尔值：只能是true和false（小写）
   - 数组：使用方括号，元素之间用逗号分隔
   - 对象：使用花括号，包含键值对
   - null：表示空值，必须是小写

3. **常见错误**：
   - 名称不使用引号或使用单引号
   - 值使用了错误的格式（如布尔值大写）
   - 尾随逗号
   - 数字格式错误

4. **最佳实践**：
   - 使用语义化的名称
   - 保持值类型的一致性
   - 明确区分null、空字符串、空对象和空数组

掌握这些名称和值的规则，可以帮助您编写出有效、可读性强的JSON文档。在下一节中，我们将探讨JSON文档的整体结构和组织方式。

## 代码示例

请查看`code/chapter2/name-value-rules`目录，其中包含了：

1. `valid_names.json` - 各种有效的名称示例
2. `invalid_names.json` - 无效的名称示例
3. `value_types_examples.json` - 各种值类型的完整示例
4. `common_errors_and_fixes.json` - 常见错误及修复示例
5. `validate_names_values.js` - 使用JavaScript验证名称和值的示例代码
6. `validate_names_values.py` - 使用Python验证名称和值的示例代码