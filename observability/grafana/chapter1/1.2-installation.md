# 1.2 Grafanaå®‰è£…ä¸é…ç½®

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹å®‰è£…Grafanaä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.14+, æˆ–Linux (Ubuntu 16.04+, CentOS 7+, RHEL 7+)
- **å†…å­˜**: æœ€å°‘512MBï¼Œæ¨è2GB+
- **ç£ç›˜ç©ºé—´**: æœ€å°‘250MBï¼Œæ¨è1GB+
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºä¸‹è½½å’Œè®¿é—®æ’ä»¶ï¼‰
- **æƒé™**: ç®¡ç†å‘˜æˆ–sudoæƒé™ï¼ˆç”¨äºå®‰è£…ï¼‰

## ğŸ§ Linuxå®‰è£…

### æ–¹å¼1: ä½¿ç”¨APTåŒ…ç®¡ç†å™¨ï¼ˆUbuntu/Debianï¼‰

```bash
# æ·»åŠ Grafana APTä»“åº“
sudo apt-get install -y apt-transport-https
sudo apt-get install -y software-properties-common wget
sudo wget -q -O - https://apt.grafana.com/gpg.key | sudo apt-key add -
echo "deb https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list

# æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£…Grafana
sudo apt-get update
sudo apt-get install -y grafana

# å¯ç”¨å¹¶å¯åŠ¨GrafanaæœåŠ¡
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
```

### æ–¹å¼2: ä½¿ç”¨YUM/DNFåŒ…ç®¡ç†å™¨ï¼ˆCentOS/RHEL/Fedoraï¼‰

```bash
# æ·»åŠ Grafana YUMä»“åº“
sudo cat > /etc/yum.repos.d/grafana.repo << EOF
[grafana]
name=grafana
baseurl=https://packages.grafana.com/oss/rpm
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packages.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF

# å®‰è£…Grafana
sudo yum install -y grafana  # å¯¹äºæ—§ç³»ç»Ÿ
# æˆ–
sudo dnf install -y grafana  # å¯¹äºè¾ƒæ–°ç³»ç»Ÿ

# å¯ç”¨å¹¶å¯åŠ¨GrafanaæœåŠ¡
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
```

### æ–¹å¼3: ä½¿ç”¨äºŒè¿›åˆ¶åŒ…

```bash
# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼ˆè¯·æ›¿æ¢ä¸ºæœ€æ–°ç‰ˆæœ¬å·ï¼‰
wget https://dl.grafana.com/oss/release/grafana-9.5.0-1.x86_64.rpm
sudo yum install -y grafana-9.5.0-1.x86_64.rpm

# å¯ç”¨å¹¶å¯åŠ¨GrafanaæœåŠ¡
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
```

## ğŸ macOSå®‰è£…

### æ–¹å¼1: ä½¿ç”¨Homebrew

```bash
# å®‰è£…Homebrewï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# å®‰è£…Grafana
brew install grafana

# å¯åŠ¨GrafanaæœåŠ¡
brew services start grafana
```

### æ–¹å¼2: ä½¿ç”¨äºŒè¿›åˆ¶åŒ…

```bash
# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
wget https://dl.grafana.com/oss/release/grafana-9.5.0.darwin-amd64.tar.gz
tar -zxvf grafana-9.5.0.darwin-amd64.tar.gz

# å¯åŠ¨Grafana
cd grafana-9.5.0/
./bin/grafana-server web
```

## ğŸªŸ Windowså®‰è£…

### æ–¹å¼1: ä½¿ç”¨å®‰è£…åŒ…

1. è®¿é—® [Grafanaä¸‹è½½é¡µé¢](https://grafana.com/grafana/download?platform=windows)
2. ä¸‹è½½Windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼ˆ`.exe`æ–‡ä»¶ï¼‰
3. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå®‰è£…åŒ…
4. æŒ‰ç…§å®‰è£…å‘å¯¼å®Œæˆå®‰è£…
5. å®‰è£…å®Œæˆåï¼ŒGrafanaæœåŠ¡å°†è‡ªåŠ¨å¯åŠ¨

### æ–¹å¼2: ä½¿ç”¨ZIPåŒ…

```powershell
# ä¸‹è½½ZIPåŒ…
Invoke-WebRequest -Uri "https://dl.grafana.com/oss/release/grafana-9.5.0.windows-amd64.zip" -OutFile "grafana-9.5.0.windows-amd64.zip"

# è§£å‹
Expand-Archive -Path "grafana-9.5.0.windows-amd64.zip" -DestinationPath "C:\"

# å¯åŠ¨Grafana
cd C:\grafana-9.5.0\bin\
.\grafana-server.exe
```

### æ–¹å¼3: ä½¿ç”¨Chocolatey

```powershell
# å®‰è£…Chocolateyï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# å®‰è£…Grafana
choco install grafana

# å¯åŠ¨GrafanaæœåŠ¡
choco start grafana
```

## ğŸ³ Dockerå®‰è£…

### æ–¹å¼1: ä½¿ç”¨Dockerå‘½ä»¤

```bash
# æ‹‰å–Grafanaé•œåƒ
docker pull grafana/grafana:latest

# è¿è¡ŒGrafanaå®¹å™¨
docker run -d \
  -p 3000:3000 \
  --name grafana \
  -e "GF_SECURITY_ADMIN_PASSWORD=admin" \
  grafana/grafana:latest
```

### æ–¹å¼2: ä½¿ç”¨Docker Compose

åˆ›å»º`docker-compose.yml`æ–‡ä»¶ï¼š

```yaml
version: '3'

services:
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - '3000:3000'
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana-storage:/var/lib/grafana
    restart: unless-stopped

volumes:
  grafana-storage:
```

è¿è¡Œå®¹å™¨ï¼š

```bash
docker-compose up -d
```

## âš™ï¸ åŸºæœ¬é…ç½®

### é…ç½®æ–‡ä»¶ä½ç½®

ä¸åŒæ“ä½œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ä½ç½®ï¼š

- **Linux/Windows**: `/etc/grafana/grafana.ini`
- **macOS (Homebrew)**: `/usr/local/etc/grafana/grafana.ini`
- **Docker**: é€šè¿‡ç¯å¢ƒå˜é‡æˆ–æŒ‚è½½é…ç½®æ–‡ä»¶

### åŸºæœ¬é…ç½®é¡¹

ç¼–è¾‘é…ç½®æ–‡ä»¶`grafana.ini`ï¼š

```ini
[server]
# ç›‘å¬åœ°å€
http_addr = 0.0.0.0
# ç›‘å¬ç«¯å£
http_port = 3000

[security]
# ç®¡ç†å‘˜åˆå§‹å¯†ç 
admin_user = admin
admin_password = your_secure_password

[database]
# æ•°æ®åº“ç±»å‹ï¼ˆé»˜è®¤ä¸ºSQLiteï¼‰
type = sqlite3
# æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼ˆSQLiteï¼‰
path = /var/lib/grafana/grafana.db

[users]
# å…è®¸ç”¨æˆ·æ³¨å†Œ
allow_sign_up = false

[smtp]
# é‚®ä»¶æœåŠ¡å™¨é…ç½®ï¼ˆç”¨äºå‘Šè­¦é€šçŸ¥ï¼‰
enabled = true
host = smtp.gmail.com:587
user = your_email@gmail.com
password = your_app_password
from_address = your_email@gmail.com
```

### ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼š

```bash
# Linux/macOS
export GF_SECURITY_ADMIN_PASSWORD=mySecretPassword
export GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource
./bin/grafana-server

# Windows
set GF_SECURITY_ADMIN_PASSWORD=mySecretPassword
set GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource
.\grafana-server.exe
```

Dockerç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
docker run -d \
  -p 3000:3000 \
  --name grafana \
  -e "GF_SECURITY_ADMIN_PASSWORD=mySecretPassword" \
  -e "GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource" \
  grafana/grafana:latest
```

## ğŸ” éªŒè¯å®‰è£…

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

**Linux (systemd):**
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status grafana-server

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u grafana-server -f
```

**macOS (Homebrew):**
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
brew services list

# æŸ¥çœ‹æ—¥å¿—
tail -f /usr/local/var/log/grafana/grafana.log
```

**Windows (æœåŠ¡):**
```powershell
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
Get-Service grafana

# æŸ¥çœ‹æ—¥å¿—
Get-Content "C:\Program Files\GrafanaLabs\grafana\logs\grafana.log" -Wait
```

**Docker:**
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹æ—¥å¿—
docker logs grafana
```

### è®¿é—®Grafana Webç•Œé¢

1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—® `http://localhost:3000`
3. ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼š
   - ç”¨æˆ·å: `admin`
   - å¯†ç : `admin`ï¼ˆé¦–æ¬¡ç™»å½•åä¼šè¦æ±‚æ›´æ”¹ï¼‰

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### ç«¯å£å ç”¨é—®é¢˜

å¦‚æœ3000ç«¯å£å·²è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ï¼š

```ini
[server]
http_port = 3030
```

æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
export GF_SERVER_HTTP_PORT=3030
```

### æƒé™é—®é¢˜

ç¡®ä¿Grafanaæœ‰æƒé™å†™å…¥æ•°æ®ç›®å½•ï¼š

```bash
# Linux
sudo chown -R grafana:grafana /var/lib/grafana
sudo chmod -R 755 /var/lib/grafana

# Windows
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦æˆ–PowerShell
```

### å†…å­˜ä¸è¶³

å¯¹äºèµ„æºå—é™çš„ç¯å¢ƒï¼Œå¯ä»¥è°ƒæ•´Grafanaçš„å†…å­˜é™åˆ¶ï¼š

```bash
# Linux
export GF_SERVER_MAX_CONNECTIONS=200
export GF_DATABASE_CONN_MAX_LIFETIME=14400

# Docker
docker run -d \
  --memory=1g \
  -p 3000:3000 \
  grafana/grafana:latest
```

### é˜²ç«å¢™é…ç½®

ç¡®ä¿é˜²ç«å¢™å…è®¸è®¿é—®Grafanaç«¯å£ï¼š

```bash
# Ubuntu/Debian
sudo ufw allow 3000/tcp

# CentOS/RHEL
sudo firewall-cmd --add-port=3000/tcp --permanent
sudo firewall-cmd --reload

# Windows
New-NetFirewallRule -DisplayName "Allow Grafana" -Direction Inbound -Protocol TCP -LocalPort 3000 -Action Allow
```

## ğŸ§ª å®éªŒï¼šå®‰è£…å’Œé…ç½®Grafana

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„å®éªŒæ¥éªŒè¯Grafanaçš„å®‰è£…ï¼š

1. æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿï¼Œé€‰æ‹©ä¸€ç§å®‰è£…æ–¹å¼å®‰è£…Grafana
2. å®Œæˆåˆå§‹é…ç½®ï¼ˆä¿®æ”¹é»˜è®¤å¯†ç ï¼‰
3. è®¿é—®Grafana Webç•Œé¢
4. æ¢ç´¢ç•Œé¢å’ŒåŸºæœ¬è®¾ç½®

**å®éªŒä»£ç ç¤ºä¾‹ï¼ˆå‚è€ƒï¼‰ï¼š**

è§[code/experiments/basic-setup.sh](../code/chapter1/basic-setup.sh)æˆ–[code/experiments/basic-setup.ps1](../code/chapter1/basic-setup.ps1)

## ğŸ“ æœ¬ç« å°ç»“

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ï¼š

- å¦‚ä½•åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…Grafana
- ä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²Grafana
- Grafanaçš„åŸºæœ¬é…ç½®é€‰é¡¹
- å¸¸è§å®‰è£…é—®é¢˜çš„è§£å†³æ–¹æ³•
- å¦‚ä½•éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ

å®Œæˆå®‰è£…åï¼Œæ‚¨ç°åœ¨å¯ä»¥è®¿é—®Grafana Webç•Œé¢å¹¶å¼€å§‹æ¢ç´¢å…¶åŠŸèƒ½ã€‚åœ¨ä¸‹ä¸€ç« [1.3 åˆ›å»ºç¬¬ä¸€ä¸ªä»ªè¡¨ç›˜](./1.3-first-dashboard.md)ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªä»ªè¡¨ç›˜å¹¶æ·»åŠ æ•°æ®æºã€‚

## ğŸ¤” æ€è€ƒé¢˜

1. ä¸ºä»€ä¹ˆåœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…Grafanaæ¯”ä½¿ç”¨äºŒè¿›åˆ¶åŒ…æ›´æ¨èï¼Ÿ
2. ä½¿ç”¨Dockerå®‰è£…Grafanaæœ‰å“ªäº›ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Ÿ
3. åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä¿®æ”¹Grafanaçš„é»˜è®¤é…ç½®ï¼Ÿ

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [Grafanaå®‰è£…å®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/grafana/latest/installation/)
- [Grafanaé…ç½®å‚è€ƒ](https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/)
- [Grafanaç¯å¢ƒå˜é‡å‚è€ƒ](https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/#environment-variables)