# ç¬¬9ç« ï¼šé«˜å¯ç”¨ä¸è”é‚¦é›†ç¾¤

> **å­¦ä¹ æ—¶é•¿**: 6-8å°æ—¶  
> **éš¾åº¦**: â­â­â­â­â­  
> **é‡è¦æ€§**: â­â­â­â­â­ (ç”Ÿäº§ç¯å¢ƒå¿…å¤‡)

## æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« å,ä½ å°†èƒ½å¤Ÿ:

- âœ… ç†è§£Prometheusé«˜å¯ç”¨æ¶æ„è®¾è®¡
- âœ… éƒ¨ç½²Prometheus HAé›†ç¾¤
- âœ… é…ç½®è”é‚¦é›†ç¾¤å®ç°æ¨ªå‘æ‰©å±•
- âœ… é›†æˆè¿œç¨‹å­˜å‚¨(Thanosã€Cortexã€M3DB)
- âœ… å®æ–½é•¿æœŸæ•°æ®ä¿ç•™ç­–ç•¥
- âœ… å¤„ç†æ•°æ®ä¸€è‡´æ€§å’Œæ•…éšœåˆ‡æ¢

---

## 9.1 Prometheusé«˜å¯ç”¨æ¦‚è¿°

### 9.1.1 ä¸ºä»€ä¹ˆéœ€è¦é«˜å¯ç”¨?

**å•ç‚¹æ•…éšœé—®é¢˜**:
- Prometheuså®•æœºå¯¼è‡´ç›‘æ§ä¸å¯ç”¨
- æ•°æ®ä¸¢å¤±æ— æ³•æ¢å¤
- å‘Šè­¦å¤±æ•ˆ

**é«˜å¯ç”¨ç›®æ ‡**:
- ğŸ“Š ç›‘æ§æ•°æ®ä¸ä¸¢å¤±
- ğŸ”” å‘Šè­¦æŒç»­å¯ç”¨
- âš¡ æŸ¥è¯¢æœåŠ¡ä¸ä¸­æ–­
- ğŸ’¾ æ•°æ®é•¿æœŸä¿ç•™

### 9.1.2 é«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **ä¸»å¤‡éƒ¨ç½²** | ç®€å•æ˜“å®ç° | åˆ‡æ¢å¯èƒ½ä¸¢æ•°æ® | å°è§„æ¨¡ |
| **å¤šå‰¯æœ¬** | æ•°æ®å†—ä½™ | å­˜å‚¨æˆæœ¬é«˜ | ä¸­ç­‰è§„æ¨¡ |
| **è”é‚¦é›†ç¾¤** | æ¨ªå‘æ‰©å±• | æ¶æ„å¤æ‚ | å¤§è§„æ¨¡ |
| **è¿œç¨‹å­˜å‚¨** | é•¿æœŸä¿ç•™ | ä¾èµ–å¤–éƒ¨ç³»ç»Ÿ | ä¼ä¸šçº§ |

---

## 9.2 Prometheusé«˜å¯ç”¨éƒ¨ç½²

### 9.2.1 å¤šå‰¯æœ¬æ¶æ„

**æ¶æ„å›¾**:
```
          â”Œâ”€> Prometheus å®ä¾‹1 â”€â”
Target â”€â”€â”€â”¼â”€> Prometheus å®ä¾‹2 â”€â”¼â”€> Alertmanager HA
          â””â”€> Prometheus å®ä¾‹3 â”€â”˜
```

**ç‰¹ç‚¹**:
- å¤šä¸ªPrometheusé‡‡é›†ç›¸åŒç›®æ ‡
- æ•°æ®å®Œå…¨å†—ä½™
- å‘Šè­¦ä¼šé‡å¤,éœ€è¦Alertmanagerå»é‡

**éƒ¨ç½²æ–¹æ¡ˆ**:

**å®ä¾‹1é…ç½®** (`prometheus-1.yml`):

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'main-cluster'
    replica: 'prometheus-1'  # æ ‡è¯†å‰¯æœ¬

rule_files:
  - '/etc/prometheus/rules/*.yml'

alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - 'alertmanager-1:9093'
            - 'alertmanager-2:9093'

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
  
  - job_name: 'node-exporter'
    static_configs:
      - targets:
          - 'node-01:9100'
          - 'node-02:9100'
```

**å®ä¾‹2é…ç½®** (`prometheus-2.yml`):

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'main-cluster'
    replica: 'prometheus-2'  # ä¸åŒçš„å‰¯æœ¬æ ‡è¯†

# å…¶ä»–é…ç½®ç›¸åŒ
```

**Docker Composeéƒ¨ç½²**:

```yaml
version: '3.8'

services:
  prometheus-1:
    image: prom/prometheus:latest
    container_name: prometheus-1
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus-1.yml:/etc/prometheus/prometheus.yml
      - prometheus-1-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'
  
  prometheus-2:
    image: prom/prometheus:latest
    container_name: prometheus-2
    ports:
      - "9091:9090"
    volumes:
      - ./prometheus-2.yml:/etc/prometheus/prometheus.yml
      - prometheus-2-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'

volumes:
  prometheus-1-data:
  prometheus-2-data:
```

### 9.2.2 Alertmanageré«˜å¯ç”¨

**Alertmanageré›†ç¾¤**:

```
Prometheus 1 â”€â”
               â”œâ”€> Alertmanager 1 â”€â”
Prometheus 2 â”€â”¤                    â”œâ”€> é€šçŸ¥æ¸ é“
               â”œâ”€> Alertmanager 2 â”€â”¤
Prometheus 3 â”€â”˜                    â””â”€> (å»é‡åå‘é€)
```

**Alertmanager 1é…ç½®** (`alertmanager-1.yml`):

```yaml
global:
  resolve_timeout: 5m

route:
  receiver: 'default'
  group_by: ['alertname', 'cluster']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h

receivers:
  - name: 'default'
    email_configs:
      - to: 'team@example.com'

# é›†ç¾¤é…ç½®
cluster:
  listen-address: '0.0.0.0:9094'
  peers:
    - 'alertmanager-2:9094'
    - 'alertmanager-3:9094'
```

**Docker Composeéƒ¨ç½²**:

```yaml
services:
  alertmanager-1:
    image: prom/alertmanager:latest
    ports:
      - "9093:9093"
    volumes:
      - ./alertmanager-1.yml:/etc/alertmanager/alertmanager.yml
    command:
      - '--config.file=/etc/alertmanager/alertmanager.yml'
      - '--cluster.listen-address=0.0.0.0:9094'
      - '--cluster.peer=alertmanager-2:9094'
      - '--cluster.peer=alertmanager-3:9094'
  
  alertmanager-2:
    image: prom/alertmanager:latest
    ports:
      - "9095:9093"
    volumes:
      - ./alertmanager-2.yml:/etc/alertmanager/alertmanager.yml
    command:
      - '--config.file=/etc/alertmanager/alertmanager.yml'
      - '--cluster.listen-address=0.0.0.0:9094'
      - '--cluster.peer=alertmanager-1:9094'
      - '--cluster.peer=alertmanager-3:9094'
```

---

## 9.3 è”é‚¦é›†ç¾¤ (Federation)

### 9.3.1 è”é‚¦é›†ç¾¤æ¦‚è¿°

**è”é‚¦**å…è®¸ä¸€ä¸ªPrometheusæŠ“å–å¦ä¸€ä¸ªPrometheusçš„æ•°æ®,å®ç°åˆ†å±‚æ¶æ„ã€‚

**æ¶æ„å›¾**:

```
                    å…¨å±€Prometheus
                          â†‘
                          â”‚ æŠ“å–
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
   åŒºåŸŸPrometheus 1   åŒºåŸŸPrometheus 2   åŒºåŸŸPrometheus 3
        â†‘                 â†‘                 â†‘
        â”‚                 â”‚                 â”‚
  â”Œâ”€â”€â”€â”¬â”€â”´â”€â”¬â”€â”€â”€â”     â”Œâ”€â”€â”€â”¬â”€â”´â”€â”¬â”€â”€â”€â”     â”Œâ”€â”€â”€â”¬â”€â”´â”€â”¬â”€â”€â”€â”
  T1  T2  T3  T4    T5  T6  T7  T8    T9  T10 T11 T12
```

**ä½¿ç”¨åœºæ™¯**:
- å¤šæ•°æ®ä¸­å¿ƒç›‘æ§
- å¤§è§„æ¨¡é›†ç¾¤(å•ä¸ªPrometheusæ— æ³•å¤„ç†)
- åˆ†å±‚ç®¡ç†(å›¢é˜Ÿ/é¡¹ç›®éš”ç¦»)

### 9.3.2 é…ç½®è”é‚¦é›†ç¾¤

**åŒºåŸŸPrometheusé…ç½®** (è¾¹ç¼˜å±‚):

```yaml
global:
  external_labels:
    datacenter: 'dc1'
    cluster: 'kubernetes-cluster-1'

scrape_configs:
  - job_name: 'kubernetes-nodes'
    kubernetes_sd_configs:
      - role: node
```

**å…¨å±€Prometheusé…ç½®** (ä¸­å¿ƒå±‚):

```yaml
global:
  external_labels:
    cluster: 'global-prometheus'

scrape_configs:
  # ä»åŒºåŸŸPrometheusæŠ“å–èšåˆæ•°æ®
  - job_name: 'federate-dc1'
    scrape_interval: 30s
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        # åªæŠ“å–èšåˆæŒ‡æ ‡
        - '{job="kubernetes-nodes"}'
        - '{__name__=~"job:.*"}'  # Recording Rules
        - 'up'  # å¥åº·çŠ¶æ€
    static_configs:
      - targets:
          - 'prometheus-dc1:9090'
        labels:
          datacenter: 'dc1'
  
  - job_name: 'federate-dc2'
    scrape_interval: 30s
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job="kubernetes-nodes"}'
        - '{__name__=~"job:.*"}'
    static_configs:
      - targets:
          - 'prometheus-dc2:9090'
        labels:
          datacenter: 'dc2'
```

**match[]å‚æ•°è¯¦è§£**:

```yaml
params:
  'match[]':
    # åŒ¹é…ç‰¹å®šjob
    - '{job="node-exporter"}'
    
    # åŒ¹é…æ‰€æœ‰Recording Rules
    - '{__name__=~".*:.*"}'
    
    # åŒ¹é…ç‰¹å®šæŒ‡æ ‡
    - 'up'
    - 'prometheus_build_info'
    
    # æ­£åˆ™åŒ¹é…
    - '{__name__=~"node_.*"}'
    
    # å¤šæ¡ä»¶
    - '{job="api",env="production"}'
```

### 9.3.3 åˆ†å±‚Recording Rules

**è¾¹ç¼˜Prometheus** (è¯¦ç»†æ•°æ®):

```yaml
groups:
  - name: instance_level
    interval: 30s
    rules:
      # å®ä¾‹çº§åˆ«CPU
      - record: instance:node_cpu:ratio
        expr: 1 - avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m]))
      
      # å®ä¾‹çº§åˆ«å†…å­˜
      - record: instance:node_memory:ratio
        expr: 1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)
```

**å…¨å±€Prometheus** (èšåˆæ•°æ®):

```yaml
groups:
  - name: datacenter_level
    interval: 60s
    rules:
      # æ•°æ®ä¸­å¿ƒçº§åˆ«CPUå¹³å‡å€¼
      - record: datacenter:node_cpu:avg_ratio
        expr: avg by (datacenter) (instance:node_cpu:ratio)
      
      # æ•°æ®ä¸­å¿ƒçº§åˆ«CPUæœ€å¤§å€¼
      - record: datacenter:node_cpu:max_ratio
        expr: max by (datacenter) (instance:node_cpu:ratio)
      
      # å…¨å±€CPUå¹³å‡å€¼
      - record: :node_cpu:avg_ratio
        expr: avg(instance:node_cpu:ratio)
```

---

## 9.4 è¿œç¨‹å­˜å‚¨

### 9.4.1 è¿œç¨‹å­˜å‚¨æ¦‚è¿°

Prometheusæœ¬åœ°å­˜å‚¨æœ‰é™åˆ¶:
- é»˜è®¤15å¤©ä¿ç•™æœŸ
- å•æœºå­˜å‚¨å®¹é‡æœ‰é™
- æ— æ³•è·¨å®ä¾‹æŸ¥è¯¢

**è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆ**:

| æ–¹æ¡ˆ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **Thanos** | å¼€æºã€S3å­˜å‚¨ã€å…¨å±€æŸ¥è¯¢ | å¤§è§„æ¨¡ã€å¤šé›†ç¾¤ |
| **Cortex** | å¼€æºã€å¤šç§Ÿæˆ·ã€æ°´å¹³æ‰©å±• | SaaSå¹³å° |
| **M3DB** | é«˜æ€§èƒ½ã€Uberå¼€æº | è¶…å¤§è§„æ¨¡ |
| **VictoriaMetrics** | é«˜æ€§èƒ½ã€ä½æˆæœ¬ | æ€§ä»·æ¯”ä¼˜å…ˆ |
| **InfluxDB** | æ—¶åºæ•°æ®åº“ | å·²æœ‰InfluxDB |

### 9.4.2 Thanosæ¶æ„

**Thanosç»„ä»¶**:

```
Prometheus + Sidecar â”€â”
                      â”œâ”€> å¯¹è±¡å­˜å‚¨(S3/Minio)
Prometheus + Sidecar â”€â”˜       â†“
                              â†“
                         Thanos Store
                              â†“
                         Thanos Query â”€> Grafana
                              â†‘
                         Thanos Ruler
```

**Prometheusé…ç½®** (å¯ç”¨è¿œç¨‹å†™å…¥):

```yaml
global:
  external_labels:
    cluster: 'prod-cluster'
    replica: 'prometheus-1'

# æœ¬åœ°å­˜å‚¨ä¿ç•™2å¤©
storage:
  tsdb:
    retention.time: 2d

# Thanos Sidecarä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨
```

**Thanos Sidecaréƒ¨ç½²**:

```yaml
services:
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=2d'
      - '--storage.tsdb.min-block-duration=2h'
      - '--storage.tsdb.max-block-duration=2h'
      - '--web.enable-lifecycle'
  
  thanos-sidecar:
    image: thanosio/thanos:latest
    volumes:
      - prometheus-data:/prometheus
    command:
      - 'sidecar'
      - '--tsdb.path=/prometheus'
      - '--prometheus.url=http://prometheus:9090'
      - '--objstore.config-file=/etc/thanos/bucket.yml'
      - '--grpc-address=0.0.0.0:10901'
      - '--http-address=0.0.0.0:10902'
```

**å¯¹è±¡å­˜å‚¨é…ç½®** (`bucket.yml`):

```yaml
type: S3
config:
  bucket: "thanos-metrics"
  endpoint: "s3.amazonaws.com"
  access_key: "your-access-key"
  secret_key: "your-secret-key"
  region: "us-east-1"
```

**Thanos Queryéƒ¨ç½²**:

```yaml
thanos-query:
  image: thanosio/thanos:latest
  ports:
    - "9090:9090"
  command:
    - 'query'
    - '--http-address=0.0.0.0:9090'
    - '--store=thanos-sidecar-1:10901'
    - '--store=thanos-sidecar-2:10901'
    - '--store=thanos-store:10901'
```

**Thanos Storeéƒ¨ç½²** (æŸ¥è¯¢å¯¹è±¡å­˜å‚¨å†å²æ•°æ®):

```yaml
thanos-store:
  image: thanosio/thanos:latest
  command:
    - 'store'
    - '--data-dir=/var/thanos/store'
    - '--objstore.config-file=/etc/thanos/bucket.yml'
    - '--grpc-address=0.0.0.0:10901'
    - '--http-address=0.0.0.0:10902'
```

### 9.4.3 VictoriaMetrics (ç®€åŒ–æ–¹æ¡ˆ)

**VictoriaMetrics**æ˜¯Prometheusçš„é«˜æ€§èƒ½æ›¿ä»£å“,å•è¿›ç¨‹éƒ¨ç½²ã€‚

**Prometheusè¿œç¨‹å†™å…¥é…ç½®**:

```yaml
remote_write:
  - url: http://victoriametrics:8428/api/v1/write
    queue_config:
      max_samples_per_send: 10000
      capacity: 20000
      max_shards: 30
```

**VictoriaMetricséƒ¨ç½²**:

```bash
docker run -d \
  --name=victoriametrics \
  -p 8428:8428 \
  -v victoria-data:/victoria-metrics-data \
  victoriametrics/victoria-metrics:latest \
  -retentionPeriod=12  # ä¿ç•™12ä¸ªæœˆ
```

**Grafanaæ•°æ®æºé…ç½®**:
```
URL: http://victoriametrics:8428
Access: Server
```

---

## 9.5 æ•°æ®å¤‡ä»½ä¸æ¢å¤

### 9.5.1 æœ¬åœ°æ•°æ®å¤‡ä»½

**å¿«ç…§å¤‡ä»½**:

```bash
# åˆ›å»ºå¿«ç…§
curl -X POST http://localhost:9090/api/v1/admin/tsdb/snapshot

# è¿”å›å¿«ç…§ç›®å½•
{
  "status": "success",
  "data": {
    "name": "20240101T120000Z-abc123def"
  }
}

# å¿«ç…§ä½ç½®
/prometheus/snapshots/20240101T120000Z-abc123def/

# å¤‡ä»½å¿«ç…§
tar czf prometheus-snapshot-$(date +%Y%m%d).tar.gz \
  /prometheus/snapshots/20240101T120000Z-abc123def/

# å®šæœŸæ¸…ç†å¿«ç…§
curl -X POST http://localhost:9090/api/v1/admin/tsdb/clean_tombstones
```

**å®šæ—¶å¤‡ä»½è„šæœ¬**:

```bash
#!/bin/bash

PROMETHEUS_URL="http://localhost:9090"
BACKUP_DIR="/backup/prometheus"
RETENTION_DAYS=30

# åˆ›å»ºå¿«ç…§
SNAPSHOT=$(curl -s -X POST ${PROMETHEUS_URL}/api/v1/admin/tsdb/snapshot | jq -r '.data.name')

if [ -z "$SNAPSHOT" ]; then
  echo "å¿«ç…§åˆ›å»ºå¤±è´¥!"
  exit 1
fi

# å¤‡ä»½å¿«ç…§
BACKUP_FILE="${BACKUP_DIR}/prometheus-${SNAPSHOT}.tar.gz"
tar czf ${BACKUP_FILE} -C /prometheus/snapshots ${SNAPSHOT}

echo "å¤‡ä»½å®Œæˆ: ${BACKUP_FILE}"

# æ¸…ç†æ—§å¤‡ä»½
find ${BACKUP_DIR} -name "prometheus-*.tar.gz" -mtime +${RETENTION_DAYS} -delete

# æ¸…ç†Prometheuså¿«ç…§
curl -X POST ${PROMETHEUS_URL}/api/v1/admin/tsdb/clean_tombstones
```

### 9.5.2 æ•°æ®æ¢å¤

```bash
# 1. åœæ­¢Prometheus
systemctl stop prometheus

# 2. æ¸…ç©ºç°æœ‰æ•°æ®
rm -rf /prometheus/data/*

# 3. è§£å‹å¤‡ä»½
tar xzf prometheus-20240101T120000Z-abc123def.tar.gz -C /prometheus/data/

# 4. å¯åŠ¨Prometheus
systemctl start prometheus
```

---

## 9.6 æ•…éšœåˆ‡æ¢ä¸ç›‘æ§

### 9.6.1 ç›‘æ§Prometheuså¥åº·çŠ¶æ€

```promql
# Prometheusè¿è¡ŒçŠ¶æ€
up{job="prometheus"}

# TSDBå—æ•°é‡
prometheus_tsdb_blocks_loaded

# é‡‡æ ·å™¨çŠ¶æ€
up{job="prometheus"} == 0

# æŸ¥è¯¢å»¶è¿Ÿ
prometheus_http_request_duration_seconds_bucket{handler="/api/v1/query"}

# å†…å­˜ä½¿ç”¨
process_resident_memory_bytes{job="prometheus"}

# ç£ç›˜ä½¿ç”¨
prometheus_tsdb_storage_blocks_bytes
```

### 9.6.2 å‘Šè­¦è§„åˆ™

```yaml
groups:
  - name: prometheus_alerts
    rules:
      - alert: PrometheusDown
        expr: up{job="prometheus"} == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Prometheuså®ä¾‹{{ $labels.instance }}å®•æœº"
      
      - alert: PrometheusTSDBCompactionsFailing
        expr: rate(prometheus_tsdb_compactions_failed_total[5m]) > 0
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: "Prometheus TSDBå‹ç¼©å¤±è´¥"
      
      - alert: PrometheusRuleEvaluationSlow
        expr: prometheus_rule_group_last_duration_seconds > 60
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "è§„åˆ™è¯„ä¼°è€—æ—¶è¿‡é•¿"
```

---

## 9.7 å®æˆ˜æ¡ˆä¾‹

### 9.7.1 å¤šæ•°æ®ä¸­å¿ƒç›‘æ§

```yaml
# å…¨å±€Prometheus
scrape_configs:
  # æ•°æ®ä¸­å¿ƒ1
  - job_name: 'federate-dc1'
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{__name__=~"job:.*"}'
    static_configs:
      - targets: ['prometheus-dc1.example.com:9090']
        labels:
          datacenter: 'dc1'
          region: 'us-east'
  
  # æ•°æ®ä¸­å¿ƒ2
  - job_name: 'federate-dc2'
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{__name__=~"job:.*"}'
    static_configs:
      - targets: ['prometheus-dc2.example.com:9090']
        labels:
          datacenter: 'dc2'
          region: 'us-west'
```

### 9.7.2 Kuberneteså¤šé›†ç¾¤ç›‘æ§

```yaml
# å…¨å±€Prometheus
scrape_configs:
  - job_name: 'federate-k8s-prod'
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job=~"kubernetes-.*"}'
        - 'up'
    static_configs:
      - targets: ['prometheus-k8s-prod.monitoring.svc:9090']
        labels:
          cluster: 'prod'
          env: 'production'
  
  - job_name: 'federate-k8s-staging'
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job=~"kubernetes-.*"}'
        - 'up'
    static_configs:
      - targets: ['prometheus-k8s-staging.monitoring.svc:9090']
        labels:
          cluster: 'staging'
          env: 'staging'
```

---

## 9.8 æœ¬ç« å°ç»“

### æ ¸å¿ƒçŸ¥è¯†ç‚¹

âœ… **é«˜å¯ç”¨æ–¹æ¡ˆ**: å¤šå‰¯æœ¬ã€è”é‚¦ã€è¿œç¨‹å­˜å‚¨

âœ… **Alertmanager HA**: é›†ç¾¤æ¨¡å¼,è‡ªåŠ¨å»é‡

âœ… **è”é‚¦é›†ç¾¤**: åˆ†å±‚æ¶æ„,æ¨ªå‘æ‰©å±•

âœ… **è¿œç¨‹å­˜å‚¨**: Thanosã€VictoriaMetrics

âœ… **æ•°æ®å¤‡ä»½**: å¿«ç…§ã€å®šæœŸå¤‡ä»½ã€æ¢å¤

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æ•°æ®å†—ä½™ | é•¿æœŸå­˜å‚¨ | æŸ¥è¯¢æ€§èƒ½ | å¤æ‚åº¦ |
|------|---------|---------|---------|--------|
| å¤šå‰¯æœ¬ | âœ… | âŒ | â­â­â­ | â­â­ |
| è”é‚¦ | âŒ | âŒ | â­â­ | â­â­â­ |
| Thanos | âœ… | âœ… | â­â­â­ | â­â­â­â­ |
| VictoriaMetrics | âœ… | âœ… | â­â­â­â­â­ | â­â­ |

### ä¸‹ä¸€ç« é¢„å‘Š

**ç¬¬10ç«  - æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ**,å°†å­¦ä¹ :
- âš¡ æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- ğŸ’¾ å­˜å‚¨ä¼˜åŒ–
- ğŸ·ï¸ æ ‡ç­¾è®¾è®¡æœ€ä½³å®è·µ
- ğŸ“Š å¤§è§„æ¨¡ç›‘æ§æŒ‘æˆ˜

---

**ğŸ‰ æ­å–œ!** ä½ å·²ç»æŒæ¡äº†Prometheusé«˜å¯ç”¨æ¶æ„!
