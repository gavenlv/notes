# ç¬¬10ç« ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

> **å­¦ä¹ æ—¶é•¿**: 5-6å°æ—¶  
> **éš¾åº¦**: â­â­â­â­  
> **é‡è¦æ€§**: â­â­â­â­â­

## æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« å,ä½ å°†èƒ½å¤Ÿ:

- âœ… ä¼˜åŒ–PromQLæŸ¥è¯¢æ€§èƒ½
- âœ… ä¼˜åŒ–Prometheuså­˜å‚¨
- âœ… è®¾è®¡é«˜æ•ˆçš„æ ‡ç­¾ä½“ç³»
- âœ… é¿å…å¸¸è§çš„æ€§èƒ½é™·é˜±
- âœ… å®æ–½Prometheusæœ€ä½³å®è·µ
- âœ… å¤„ç†å¤§è§„æ¨¡ç›‘æ§æŒ‘æˆ˜

---

## 10.1 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

### 10.1.1 æŸ¥è¯¢æ€§èƒ½åˆ†æ

**æŸ¥çœ‹æŸ¥è¯¢ç»Ÿè®¡**:
- è®¿é—®: http://prometheus:9090/status
- ç‚¹å‡»"Query Stats"æŸ¥çœ‹æ…¢æŸ¥è¯¢

**æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡**:

```promql
# æŸ¥è¯¢å»¶è¿Ÿåˆ†å¸ƒ
prometheus_engine_query_duration_seconds

# æ…¢æŸ¥è¯¢(>5ç§’)
topk(10, 
  rate(prometheus_engine_query_duration_seconds_sum[5m]) 
  / 
  rate(prometheus_engine_query_duration_seconds_count[5m])
)

# æŸ¥è¯¢å¹¶å‘æ•°
prometheus_engine_queries_concurrent_max
```

### 10.1.2 ä¼˜åŒ–æŠ€å·§

**1. å‡å°‘æ—¶é—´åºåˆ—æ•°é‡**

```promql
# âŒ å·® - æŸ¥è¯¢æ‰€æœ‰åºåˆ—
rate(http_requests_total[5m])

# âœ… å¥½ - å…ˆè¿‡æ»¤å†æŸ¥è¯¢
rate(http_requests_total{job="api", env="production"}[5m])
```

**2. é¿å…è¿‡é•¿çš„æ—¶é—´èŒƒå›´**

```promql
# âŒ å·® - 30å¤©çª—å£
rate(http_requests_total[30d])

# âœ… å¥½ - ä½¿ç”¨Recording Rules
rate(job:http_requests:rate5m[30d])
```

**3. ä½¿ç”¨Recording Rulesé¢„è®¡ç®—**

```yaml
# é¢„è®¡ç®—å¤æ‚æŸ¥è¯¢
- record: job_method:http_requests:rate5m
  expr: sum(rate(http_requests_total[5m])) by (job, method)
```

**4. ä¼˜åŒ–èšåˆæ“ä½œ**

```promql
# âŒ å·® - å…ˆèšåˆå†è®¡ç®—
sum(rate(http_requests_total[5m])) by (job)

# âœ… å¥½ - å…ˆè®¡ç®—å†èšåˆ(å¦‚æœé€‚ç”¨)
sum by (job) (rate(http_requests_total[5m]))
```

**5. é¿å…ç¬›å¡å°”ç§¯**

```promql
# âŒ å·® - å¯èƒ½äº§ç”Ÿå¤§é‡ç»“æœ
metric_a * metric_b

# âœ… å¥½ - æ˜ç¡®æŒ‡å®šåŒ¹é…æ ‡ç­¾
metric_a * on(instance) metric_b
```

**6. é™åˆ¶è¿”å›ç»“æœ**

```promql
# ä½¿ç”¨topké™åˆ¶ç»“æœæ•°é‡
topk(10, rate(http_requests_total[5m]))

# ä½¿ç”¨limitk(Prometheus 2.42+)
limitk(100, rate(http_requests_total[5m]))
```

### 10.1.3 æŸ¥è¯¢è¶…æ—¶è®¾ç½®

**Prometheusé…ç½®**:

```yaml
global:
  query_timeout: 2m  # é»˜è®¤2åˆ†é’Ÿ

# å‘½ä»¤è¡Œå‚æ•°
--query.timeout=2m
--query.max-concurrency=20
--query.max-samples=50000000
```

---

## 10.2 å­˜å‚¨ä¼˜åŒ–

### 10.2.1 å­˜å‚¨æ¶æ„ç†è§£

**TSDBå­˜å‚¨ç»“æ„**:

```
/prometheus/data/
â”œâ”€â”€ 01ABCD...     # 2å°æ—¶block
â”œâ”€â”€ 01EFGH...     # 2å°æ—¶block
â”œâ”€â”€ chunks_head/  # å½“å‰å†™å…¥çš„block
â””â”€â”€ wal/          # WALæ—¥å¿—
```

**Blockå‹ç¼©æµç¨‹**:
```
2å°æ—¶block â†’ 12å°æ—¶block â†’ 24å°æ—¶block
```

### 10.2.2 å­˜å‚¨é…ç½®ä¼˜åŒ–

**ä¿ç•™æœŸè®¾ç½®**:

```bash
# æŒ‰æ—¶é—´ä¿ç•™(æ¨è)
--storage.tsdb.retention.time=30d

# æŒ‰å¤§å°ä¿ç•™
--storage.tsdb.retention.size=50GB

# ä¸¤è€…éƒ½é…ç½®æ—¶,ä»»ä¸€æ¡ä»¶æ»¡è¶³å³åˆ é™¤
--storage.tsdb.retention.time=30d \
--storage.tsdb.retention.size=100GB
```

**Blockå¤§å°é…ç½®**:

```bash
# æœ€å°blockæŒç»­æ—¶é—´(é»˜è®¤2h)
--storage.tsdb.min-block-duration=2h

# æœ€å¤§blockæŒç»­æ—¶é—´(é»˜è®¤10%)
--storage.tsdb.max-block-duration=24h
```

**WALé…ç½®**:

```bash
# WALå‹ç¼©(é»˜è®¤å¯ç”¨)
--storage.tsdb.wal-compression

# WALæ®µå¤§å°(é»˜è®¤128MB)
--storage.tsdb.wal-segment-size=128MB
```

### 10.2.3 å‡å°‘å­˜å‚¨ç©ºé—´

**1. é™ä½é‡‡æ ·é¢‘ç‡**

```yaml
scrape_configs:
  # å…³é”®æœåŠ¡ - 15ç§’
  - job_name: 'critical-service'
    scrape_interval: 15s
  
  # æ™®é€šæœåŠ¡ - 30ç§’
  - job_name: 'normal-service'
    scrape_interval: 30s
  
  # æ‰¹å¤„ç† - 5åˆ†é’Ÿ
  - job_name: 'batch-job'
    scrape_interval: 5m
```

**2. å‡å°‘æ ‡ç­¾åŸºæ•°**

```yaml
# âŒ å·® - é«˜åŸºæ•°æ ‡ç­¾
http_requests_total{user_id="12345", request_id="abc-def-ghi"}

# âœ… å¥½ - ä½åŸºæ•°æ ‡ç­¾
http_requests_total{service="api", method="GET", status="200"}
```

**3. ä½¿ç”¨metric_relabelåˆ é™¤ä¸éœ€è¦çš„æŒ‡æ ‡**

```yaml
scrape_configs:
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']
    metric_relabel_configs:
      # åˆ é™¤ä¸éœ€è¦çš„æŒ‡æ ‡
      - source_labels: [__name__]
        regex: 'node_arp_.*'
        action: drop
      
      # åˆ é™¤ä¸éœ€è¦çš„æ ‡ç­¾
      - regex: 'job|instance_id'
        action: labeldrop
```

**4. ä½¿ç”¨è¿œç¨‹å­˜å‚¨**

```yaml
# æœ¬åœ°ä¿ç•™2å¤©,è¿œç¨‹ä¿ç•™1å¹´
storage:
  tsdb:
    retention.time: 2d

remote_write:
  - url: http://victoriametrics:8428/api/v1/write
```

### 10.2.4 ç£ç›˜ç©ºé—´è§„åˆ’

**ä¼°ç®—å…¬å¼**:

```
ç£ç›˜ç©ºé—´ = æ¯ç§’æ ·æœ¬æ•° Ã— æ ·æœ¬å¤§å° Ã— ä¿ç•™æ—¶é—´

ç¤ºä¾‹:
- æ¯ç§’æ ·æœ¬æ•°: 10,000
- æ ·æœ¬å¤§å°: ~2å­—èŠ‚
- ä¿ç•™æ—¶é—´: 30å¤©
- ç£ç›˜ç©ºé—´: 10000 Ã— 2 Ã— 86400 Ã— 30 / 1024^3 â‰ˆ 50GB
```

**ç›‘æ§å­˜å‚¨ä½¿ç”¨**:

```promql
# TSDBå¤§å°(GB)
prometheus_tsdb_storage_blocks_bytes / 1024 / 1024 / 1024

# WALå¤§å°(GB)
prometheus_tsdb_wal_storage_size_bytes / 1024 / 1024 / 1024

# æ€»å­˜å‚¨å¤§å°
(prometheus_tsdb_storage_blocks_bytes + prometheus_tsdb_wal_storage_size_bytes) / 1024 / 1024 / 1024

# é¢„æµ‹30å¤©åå­˜å‚¨å¤§å°
predict_linear(prometheus_tsdb_storage_blocks_bytes[7d], 30*24*3600) / 1024 / 1024 / 1024
```

---

## 10.3 æ ‡ç­¾è®¾è®¡æœ€ä½³å®è·µ

### 10.3.1 æ ‡ç­¾å‘½åè§„èŒƒ

**âœ… å¥½çš„æ ‡ç­¾**:
```
job         # ä½œä¸šåç§°
instance    # å®ä¾‹æ ‡è¯†
env         # ç¯å¢ƒ(production/staging/dev)
region      # åŒºåŸŸ(us-east-1)
datacenter  # æ•°æ®ä¸­å¿ƒ
service     # æœåŠ¡åç§°
method      # HTTPæ–¹æ³•
status      # HTTPçŠ¶æ€ç 
```

**âŒ å·®çš„æ ‡ç­¾**:
```
user_id      # é«˜åŸºæ•°
request_id   # æ¯æ¬¡è¯·æ±‚éƒ½ä¸åŒ
timestamp    # æ—¶é—´æˆ³
email        # ä¸ªäººä¿¡æ¯
ip_address   # IPåœ°å€(å¯èƒ½å¾ˆå¤š)
```

### 10.3.2 æ§åˆ¶æ ‡ç­¾åŸºæ•°

**åŸºæ•°è®¡ç®—**:

```promql
# æŸ¥çœ‹æŒ‡æ ‡çš„åºåˆ—æ•°é‡
count(http_requests_total)

# æŸ¥çœ‹æ¯ä¸ªæ ‡ç­¾çš„åŸºæ•°
count by (__name__, job) ({__name__=~".+"})

# æ‰¾å‡ºé«˜åŸºæ•°æŒ‡æ ‡
topk(10, count by (__name__) ({__name__=~".+"}))
```

**åŸºæ•°æ§åˆ¶ç­–ç•¥**:

| åŸºæ•°çº§åˆ« | æ•°é‡ | ç¤ºä¾‹ | å»ºè®® |
|---------|------|------|------|
| ä½ | <10 | env, method, status | âœ… å¯ä»¥ä½¿ç”¨ |
| ä¸­ | 10-100 | service, region | âœ… å¯ä»¥ä½¿ç”¨ |
| é«˜ | 100-1000 | pod_name, hostname | âš ï¸ è°¨æ…ä½¿ç”¨ |
| è¶…é«˜ | >1000 | user_id, request_id | âŒ ä¸è¦ä½¿ç”¨ |

**é™ä½åŸºæ•°çš„æ–¹æ³•**:

```yaml
# æ–¹æ³•1: åœ¨åº”ç”¨å±‚èšåˆ
# âŒ ä¸è¦è¿™æ ·åš
http_requests{user_id="12345"}

# âœ… åº”è¯¥è¿™æ ·åš
http_requests{service="api", method="GET"}
user_activity_log  # å•ç‹¬çš„æ—¥å¿—ç³»ç»Ÿè®°å½•user_id

# æ–¹æ³•2: ä½¿ç”¨metric_relabelåˆ é™¤é«˜åŸºæ•°æ ‡ç­¾
metric_relabel_configs:
  - regex: 'user_id|request_id|session_id'
    action: labeldrop
```

### 10.3.3 æŒ‡æ ‡å‘½åè§„èŒƒ

**æ ¼å¼**: `namespace_subsystem_name_unit`

**ç¤ºä¾‹**:

```promql
# âœ… å¥½çš„å‘½å
http_requests_total              # Counter
http_request_duration_seconds    # Histogram
node_memory_MemAvailable_bytes   # Gauge
mysql_slow_queries_total         # Counter

# âŒ å·®çš„å‘½å
requests                         # å¤ªç®€å•
http_req_dur                     # ç¼©å†™ä¸æ¸…æ™°
memory_available                 # ç¼ºå°‘å•ä½
```

**å•ä½è§„èŒƒ**:

| ç±»å‹ | å•ä½ | ç¤ºä¾‹ |
|------|------|------|
| æ—¶é—´ | seconds | `_duration_seconds` |
| å¤§å° | bytes | `_size_bytes` |
| æ¯”ç‡ | ratio (0-1) | `_ratio` |
| ç™¾åˆ†æ¯” | ratio (0-1) | `_ratio` Ã— 100 |
| æ¸©åº¦ | celsius | `_celsius` |

---

## 10.4 é‡‡é›†ä¼˜åŒ–

### 10.4.1 é‡‡æ ·é—´éš”è®¾ç½®

**æ¨èé…ç½®**:

```yaml
global:
  scrape_interval: 15s  # é»˜è®¤15ç§’

scrape_configs:
  # å…³é”®æœåŠ¡ - é«˜é¢‘é‡‡é›†
  - job_name: 'critical-api'
    scrape_interval: 10s
    scrape_timeout: 5s
  
  # æ™®é€šæœåŠ¡ - æ ‡å‡†é¢‘ç‡
  - job_name: 'normal-service'
    scrape_interval: 15s
    scrape_timeout: 10s
  
  # æ‰¹å¤„ç† - ä½é¢‘é‡‡é›†
  - job_name: 'batch-job'
    scrape_interval: 5m
    scrape_timeout: 1m
  
  # Pushgateway - æ¨é€é¢‘ç‡ä¸€è‡´
  - job_name: 'pushgateway'
    scrape_interval: 30s
    honor_labels: true
```

### 10.4.2 ç›®æ ‡æ•°é‡ä¼˜åŒ–

**å•ä¸ªPrometheuså»ºè®®**:

| èµ„æº | å»ºè®®å€¼ |
|------|--------|
| ç›®æ ‡æ•°é‡ | < 1000 |
| æ—¶é—´åºåˆ— | < 100ä¸‡ |
| æ¯ç§’æ ·æœ¬ | < 10ä¸‡ |
| å†…å­˜ | 16-32GB |
| CPU | 4-8æ ¸ |

**è¶…è¿‡å»ºè®®å€¼æ—¶**:
- ä½¿ç”¨è”é‚¦é›†ç¾¤åˆ†æ•£è´Ÿè½½
- ä½¿ç”¨Recording Rulesé¢„èšåˆ
- é™ä½é‡‡æ ·é¢‘ç‡
- åˆ é™¤ä¸å¿…è¦çš„æŒ‡æ ‡

### 10.4.3 é‡‡é›†å¤±è´¥å¤„ç†

**ç›‘æ§é‡‡é›†çŠ¶æ€**:

```promql
# é‡‡é›†å¤±è´¥çš„ç›®æ ‡
up == 0

# é‡‡é›†è€—æ—¶
scrape_duration_seconds

# é‡‡é›†æ ·æœ¬æ•°
scrape_samples_scraped

# é‡‡é›†å¤±è´¥ç‡
sum(up == 0) / count(up) * 100
```

**å‘Šè­¦è§„åˆ™**:

```yaml
groups:
  - name: scrape_alerts
    rules:
      - alert: TargetDown
        expr: up == 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ç›®æ ‡{{ $labels.instance }}é‡‡é›†å¤±è´¥"
      
      - alert: ScrapeTooSlow
        expr: scrape_duration_seconds > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ç›®æ ‡{{ $labels.instance }}é‡‡é›†è€—æ—¶è¿‡é•¿"
      
      - alert: ScrapeSampleLimit
        expr: scrape_samples_post_metric_relabeling > 10000
        labels:
          severity: info
        annotations:
          summary: "ç›®æ ‡{{ $labels.instance }}æ ·æœ¬æ•°è¿‡å¤š"
```

---

## 10.5 Prometheusè‡ªèº«ç›‘æ§

### 10.5.1 å…³é”®æŒ‡æ ‡

```promql
# 1. å†…å­˜ä½¿ç”¨
process_resident_memory_bytes{job="prometheus"}

# 2. CPUä½¿ç”¨
rate(process_cpu_seconds_total{job="prometheus"}[5m])

# 3. Goroutineæ•°é‡
go_goroutines{job="prometheus"}

# 4. TSDBå—æ•°é‡
prometheus_tsdb_blocks_loaded

# 5. WALæŸå
prometheus_tsdb_wal_corruptions_total

# 6. å‹ç¼©å¤±è´¥
prometheus_tsdb_compactions_failed_total

# 7. æŸ¥è¯¢å¹¶å‘
prometheus_engine_queries_concurrent_max

# 8. è§„åˆ™è¯„ä¼°è€—æ—¶
prometheus_rule_group_last_duration_seconds

# 9. è¿œç¨‹å†™å…¥å¤±è´¥
prometheus_remote_storage_failed_samples_total
```

### 10.5.2 æ€§èƒ½åŸºå‡†

```promql
# è¯„ä¼°é¢‘ç‡åº” â‰ˆ é‡‡é›†é¢‘ç‡
global.evaluation_interval â‰ˆ global.scrape_interval

# è§„åˆ™è¯„ä¼°åº” < è¯„ä¼°é—´éš”
prometheus_rule_group_last_duration_seconds < 30

# TSDBå‹ç¼©åº”å®šæœŸæ‰§è¡Œ
increase(prometheus_tsdb_compactions_total[1h]) > 0

# æŸ¥è¯¢å»¶è¿Ÿåº” < 1ç§’(90%)
histogram_quantile(0.90, 
  rate(prometheus_http_request_duration_seconds_bucket{handler="/api/v1/query"}[5m])
) < 1
```

---

## 10.6 å¤§è§„æ¨¡ç›‘æ§æœ€ä½³å®è·µ

### 10.6.1 åˆ†å±‚æ¶æ„

```
         å…¨å±€Prometheus (èšåˆè§†å›¾)
                â†‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚       â”‚
   åŒºåŸŸProm  åŒºåŸŸProm  åŒºåŸŸProm
     (1000)  (1000)  (1000)
        â†‘       â†‘       â†‘
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”   ...   ...
  æœ¬åœ°Prom  æœ¬åœ°Prom
   (100)    (100)
    â†‘        â†‘
  Targets  Targets
```

### 10.6.2 æ•°æ®åˆ†ç‰‡ç­–ç•¥

**æ–¹æ¡ˆ1: æŒ‰ç¯å¢ƒåˆ†ç‰‡**

```
Prometheus-Prod    â†’ ç”Ÿäº§ç¯å¢ƒ
Prometheus-Staging â†’ æµ‹è¯•ç¯å¢ƒ
Prometheus-Dev     â†’ å¼€å‘ç¯å¢ƒ
```

**æ–¹æ¡ˆ2: æŒ‰æœåŠ¡åˆ†ç‰‡**

```
Prometheus-K8s     â†’ Kubernetesé›†ç¾¤
Prometheus-VMs     â†’ è™šæ‹Ÿæœº
Prometheus-DB      â†’ æ•°æ®åº“
```

**æ–¹æ¡ˆ3: æŒ‰åœ°åŸŸåˆ†ç‰‡**

```
Prometheus-US-East â†’ ç¾ä¸œ
Prometheus-US-West â†’ ç¾è¥¿
Prometheus-EU      â†’ æ¬§æ´²
```

### 10.6.3 é™é‡‡æ ·ç­–ç•¥

**åŸå§‹æ•°æ®**: 15ç§’é—´éš”,ä¿ç•™2å¤©
**5åˆ†é’Ÿèšåˆ**: ä¿ç•™30å¤©
**1å°æ—¶èšåˆ**: ä¿ç•™1å¹´

**å®ç°æ–¹å¼ - Thanos Downsampling**:

```bash
thanos compact \
  --data-dir=/var/thanos/compact \
  --objstore.config-file=/etc/thanos/bucket.yml \
  --retention.resolution-raw=2d \
  --retention.resolution-5m=30d \
  --retention.resolution-1h=1y \
  --downsampling.disable=false
```

---

## 10.7 å¸¸è§æ€§èƒ½é™·é˜±

### 10.7.1 é™·é˜±1: é«˜åŸºæ•°æ ‡ç­¾

**é—®é¢˜**:
```yaml
# âŒ user_idæœ‰ç™¾ä¸‡çº§åˆ«
http_requests_total{user_id="12345"}
```

**è§£å†³**:
```yaml
# âœ… å»é™¤é«˜åŸºæ•°æ ‡ç­¾
http_requests_total{service="api"}

# ç”¨æˆ·çº§åˆ«æ•°æ®å­˜å…¥æ—¥å¿—ç³»ç»Ÿ
```

### 10.7.2 é™·é˜±2: è¿‡åº¦ä½¿ç”¨æ­£åˆ™

**é—®é¢˜**:
```promql
# âŒ æ­£åˆ™åŒ¹é…å¾ˆæ…¢
{__name__=~".*requests.*"}
```

**è§£å†³**:
```promql
# âœ… ç²¾ç¡®åŒ¹é…
http_requests_total

# æˆ–ä½¿ç”¨å‰ç¼€åŒ¹é…
{__name__=~"http_.*"}
```

### 10.7.3 é™·é˜±3: å¤§æ—¶é—´èŒƒå›´æŸ¥è¯¢

**é—®é¢˜**:
```promql
# âŒ æŸ¥è¯¢90å¤©çš„åŸå§‹æ•°æ®
rate(http_requests_total[90d])
```

**è§£å†³**:
```yaml
# âœ… ä½¿ç”¨Recording Rules
- record: job:http_requests:rate5m
  expr: rate(http_requests_total[5m])

# æŸ¥è¯¢æ—¶ä½¿ç”¨é¢„èšåˆæ•°æ®
rate(job:http_requests:rate5m[90d])
```

### 10.7.4 é™·é˜±4: æœªä½¿ç”¨Recording Rules

**é—®é¢˜**: Dashboardå’Œå‘Šè­¦éƒ½æ‰§è¡Œå¤æ‚æŸ¥è¯¢

**è§£å†³**:
```yaml
# åˆ›å»ºRecording Rules
- record: instance_job:http_error_rate:ratio
  expr: |
    sum by (instance, job) (rate(http_requests_total{status=~"5.."}[5m]))
    /
    sum by (instance, job) (rate(http_requests_total[5m]))

# ä½¿ç”¨é¢„è®¡ç®—ç»“æœ
instance_job:http_error_rate:ratio
```

---

## 10.8 æ€§èƒ½è°ƒä¼˜æ£€æŸ¥æ¸…å•

**æŸ¥è¯¢ä¼˜åŒ–**:
- [ ] ä½¿ç”¨æ ‡ç­¾è¿‡æ»¤å‡å°‘åºåˆ—æ•°é‡
- [ ] é¿å…å¤§æ—¶é—´èŒƒå›´æŸ¥è¯¢
- [ ] ä½¿ç”¨Recording Rulesé¢„è®¡ç®—
- [ ] é™åˆ¶æŸ¥è¯¢ç»“æœæ•°é‡(topk/limitk)
- [ ] é¿å…ç¬›å¡å°”ç§¯

**å­˜å‚¨ä¼˜åŒ–**:
- [ ] è®¾ç½®åˆç†çš„ä¿ç•™æœŸ
- [ ] é…ç½®è¿œç¨‹å­˜å‚¨
- [ ] åˆ é™¤ä¸éœ€è¦çš„æŒ‡æ ‡(metric_relabel)
- [ ] ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µ
- [ ] å®šæœŸæ¸…ç†æ—§æ•°æ®

**æ ‡ç­¾ä¼˜åŒ–**:
- [ ] æ§åˆ¶æ ‡ç­¾åŸºæ•°(<1000)
- [ ] ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾å
- [ ] é¿å…é«˜åŸºæ•°æ ‡ç­¾(user_id, request_id)
- [ ] åˆ é™¤ä¸å¿…è¦çš„æ ‡ç­¾

**é‡‡é›†ä¼˜åŒ–**:
- [ ] è®¾ç½®åˆç†çš„é‡‡é›†é—´éš”
- [ ] é…ç½®é‡‡é›†è¶…æ—¶
- [ ] ç›‘æ§é‡‡é›†å¤±è´¥
- [ ] é™åˆ¶å•ä¸ªç›®æ ‡çš„æŒ‡æ ‡æ•°é‡

**æ¶æ„ä¼˜åŒ–**:
- [ ] ä½¿ç”¨è”é‚¦é›†ç¾¤(å¤§è§„æ¨¡)
- [ ] éƒ¨ç½²HAé›†ç¾¤
- [ ] é…ç½®Alertmanageré›†ç¾¤
- [ ] ç›‘æ§Prometheusè‡ªèº«

---

## 10.9 æœ¬ç« å°ç»“

### æ ¸å¿ƒçŸ¥è¯†ç‚¹

âœ… **æŸ¥è¯¢ä¼˜åŒ–**: è¿‡æ»¤ã€Recording Rulesã€é™åˆ¶ç»“æœ

âœ… **å­˜å‚¨ä¼˜åŒ–**: ä¿ç•™æœŸã€è¿œç¨‹å­˜å‚¨ã€é™ä½åŸºæ•°

âœ… **æ ‡ç­¾è®¾è®¡**: ä½åŸºæ•°ã€æœ‰æ„ä¹‰ã€åˆ é™¤ä¸å¿…è¦

âœ… **å¤§è§„æ¨¡**: åˆ†å±‚æ¶æ„ã€åˆ†ç‰‡ç­–ç•¥ã€é™é‡‡æ ·

âœ… **æ€§èƒ½ç›‘æ§**: å…³é”®æŒ‡æ ‡ã€åŸºå‡†æµ‹è¯•ã€å‘Šè­¦

### æ€§èƒ½æå‡å¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-------|--------|--------|------|
| å¤æ‚æŸ¥è¯¢ | 5ç§’ | 50ms | 100x |
| å­˜å‚¨ç©ºé—´ | 500GB | 100GB | 5x |
| æŸ¥è¯¢å¹¶å‘ | 10 | 100 | 10x |

### ä¸‹ä¸€ç« é¢„å‘Š

**ç¬¬11ç«  - åº”ç”¨ç¨‹åºç›‘æ§**,å°†å­¦ä¹ :
- ğŸ“Š å®¢æˆ·ç«¯åº“ä½¿ç”¨(Goã€Pythonã€Java)
- ğŸ¯ è‡ªå®šä¹‰æŒ‡æ ‡è®¾è®¡
- ğŸ’¼ ä¸šåŠ¡ç›‘æ§å®è·µ
- ğŸ” åˆ†å¸ƒå¼è¿½è¸ªé›†æˆ

---

**ğŸ‰ æ­å–œ!** ä½ å·²ç»æŒæ¡äº†Prometheusæ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€èƒ½!
