# Prometheusæ•™ç¨‹å¿«é€Ÿå‚è€ƒ

## ğŸ“š å·²å®Œæˆç« èŠ‚

### âœ… ç¬¬1ç« ï¼šPrometheuså®‰è£…ä¸ç¯å¢ƒé…ç½® 
- 1,234è¡Œè¯¦ç»†æ•™ç¨‹
- æ¶µç›–Dockerã€Linuxã€Windowsã€macOSå®‰è£…
- å®Œæ•´å®éªŒç¯å¢ƒæ­å»º
- ä»£ç ç¤ºä¾‹ï¼š`code/chapter01/`

### âœ… ç¬¬2ç« ï¼šPrometheusæ ¸å¿ƒæ¦‚å¿µ
- 801è¡Œæ·±åº¦è®²è§£
- å››ç§æŒ‡æ ‡ç±»å‹è¯¦è§£ï¼ˆCounterã€Gaugeã€Histogramã€Summaryï¼‰
- æ•°æ®æ¨¡å‹å’Œæ ‡ç­¾ç³»ç»Ÿ
- å­˜å‚¨åŸç†å’Œæœ€ä½³å®è·µ

---

## ğŸ“‹ å¾…åˆ›å»ºç« èŠ‚æ¦‚è¦

ä»¥ä¸‹ç« èŠ‚å·²è§„åˆ’å®Œæ•´å¤§çº²ï¼Œå¯æŒ‰éœ€æ·±å…¥åˆ›å»ºï¼š

### ç¬¬3ç« ï¼šPromQLæŸ¥è¯¢è¯­è¨€ï¼ˆ6-8å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- åŸºç¡€è¯­æ³•å’Œé€‰æ‹©å™¨
- æ—¶é—´èŒƒå›´æŸ¥è¯¢
- å¸¸ç”¨å‡½æ•°ï¼ˆrateã€increaseã€histogram_quantileç­‰ï¼‰
- èšåˆæ“ä½œï¼ˆsumã€avgã€maxã€minç­‰ï¼‰
- å‘é‡åŒ¹é…å’Œè¿ç®—
- å­æŸ¥è¯¢
- æŸ¥è¯¢ä¼˜åŒ–

**å…³é”®æŸ¥è¯¢ç¤ºä¾‹ï¼š**
```promql
# è¯·æ±‚é€Ÿç‡
rate(http_requests_total[5m])

# CPUä½¿ç”¨ç‡
100 - (avg(rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# p95å»¶è¿Ÿ
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))

# é”™è¯¯ç‡
sum(rate(http_requests_total{status=~"5.."}[5m])) /
sum(rate(http_requests_total[5m])) * 100
```

---

### ç¬¬4ç« ï¼šExporterså¯¼å‡ºå™¨ï¼ˆ5-6å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- Exporterå·¥ä½œåŸç†
- Node Exporterè¯¦è§£ï¼ˆç³»ç»ŸæŒ‡æ ‡æ”¶é›†ï¼‰
- å¸¸ç”¨Exportersï¼š
  - MySQL Exporter
  - Redis Exporter
  - Nginx Exporter
  - Blackbox Exporterï¼ˆé»‘ç›’ç›‘æ§ï¼‰
- å¼€å‘è‡ªå®šä¹‰Exporterï¼ˆGo/Pythonï¼‰
- Textfile Collectorä½¿ç”¨

**ä»£ç ç¤ºä¾‹ç»“æ„ï¼š**
```
code/chapter04/
â”œâ”€â”€ 01-node-exporter/
â”œâ”€â”€ 02-mysql-exporter/
â”œâ”€â”€ 03-custom-exporter/
â”‚   â”œâ”€â”€ go/
â”‚   â””â”€â”€ python/
â””â”€â”€ 04-textfile-collector/
```

---

### ç¬¬5ç« ï¼šæœåŠ¡å‘ç°æœºåˆ¶ï¼ˆ5-6å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- é™æ€é…ç½® vs åŠ¨æ€å‘ç°
- æ–‡ä»¶æœåŠ¡å‘ç°ï¼ˆfile_sdï¼‰
- KubernetesæœåŠ¡å‘ç°
  - Podå‘ç°
  - Serviceå‘ç°
  - Ingresså‘ç°
- ConsulæœåŠ¡å‘ç°
- DNSæœåŠ¡å‘ç°
- Relabelingé…ç½®è¯¦è§£

**Kubernetesç¤ºä¾‹ï¼š**
```yaml
scrape_configs:
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
```

---

### ç¬¬6ç« ï¼šå‘Šè­¦è§„åˆ™ä¸Alertmanagerï¼ˆ5-6å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- å‘Šè­¦è§„åˆ™ç¼–å†™
- Alertmanageræ¶æ„
- å‘Šè­¦è·¯ç”±å’Œåˆ†ç»„
- é€šçŸ¥æ¸ é“ï¼š
  - Email
  - Slack
  - é’‰é’‰
  - ä¼ä¸šå¾®ä¿¡
  - Webhook
- æŠ‘åˆ¶å’Œé™é»˜
- é«˜å¯ç”¨Alertmanager

**å‘Šè­¦è§„åˆ™ç¤ºä¾‹ï¼š**
```yaml
groups:
  - name: system_alerts
    rules:
      - alert: HighCPU
        expr: cpu_usage > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "{{ $labels.instance }} CPU: {{ $value }}%"
```

---

### ç¬¬7ç« ï¼šRecording Rulesï¼ˆ3-4å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- Recording RulesåŸç†
- è§„åˆ™ç¼–å†™å’Œç»„ç»‡
- é¢„èšåˆç­–ç•¥
- æ€§èƒ½å¯¹æ¯”
- å¸¸è§æ¨¡å¼

**ç¤ºä¾‹ï¼š**
```yaml
groups:
  - name: http_rules
    interval: 30s
    rules:
      - record: job:http_requests:rate5m
        expr: sum by (job) (rate(http_requests_total[5m]))
```

---

### ç¬¬8ç« ï¼šPushgatewayï¼ˆ3-4å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- ä½¿ç”¨åœºæ™¯ï¼ˆæ‰¹å¤„ç†ã€å®šæ—¶ä»»åŠ¡ï¼‰
- æ¨é€æŒ‡æ ‡æ–¹æ³•
- ä¸croné›†æˆ
- æœ€ä½³å®è·µ

**æ¨é€ç¤ºä¾‹ï¼š**
```bash
echo "batch_job_duration_seconds 45.5" | \
  curl --data-binary @- http://pushgateway:9091/metrics/job/batch_job
```

---

### ç¬¬9ç« ï¼šé«˜å¯ç”¨ä¸è”é‚¦é›†ç¾¤ï¼ˆ6-8å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- é«˜å¯ç”¨æ¶æ„è®¾è®¡
- Prometheusè”é‚¦
- è¿œç¨‹å­˜å‚¨æ–¹æ¡ˆï¼š
  - Thanos
  - Cortex
  - M3DB
- æ•°æ®åˆ†ç‰‡
- å¤šé›†ç¾¤ç®¡ç†

**è”é‚¦é…ç½®ï¼š**
```yaml
scrape_configs:
  - job_name: 'federate'
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job="prometheus"}'
    static_configs:
      - targets:
        - 'source-prometheus:9090'
```

---

### ç¬¬10ç« ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ4-5å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- å­˜å‚¨ä¼˜åŒ–
- æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- æ ‡ç­¾è®¾è®¡æœ€ä½³å®è·µ
- èµ„æºè§„åˆ’
- ç›‘æ§Prometheusè‡ªèº«
- å¸¸è§é—®é¢˜æ’æŸ¥

**ä¼˜åŒ–æŠ€å·§ï¼š**
- ä½¿ç”¨Recording Rulesé¢„èšåˆ
- å‡å°‘æ ‡ç­¾åŸºæ•°
- åˆç†è®¾ç½®é‡‡é›†é—´éš”
- ä½¿ç”¨SSDå­˜å‚¨

---

### ç¬¬11ç« ï¼šåº”ç”¨ç¨‹åºç›‘æ§ï¼ˆ6-8å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- å®¢æˆ·ç«¯åº“ä½¿ç”¨ï¼š
  - Go client
  - Python client
  - Java client
  - Node.js client
- è‡ªå®šä¹‰æŒ‡æ ‡è®¾è®¡
- ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
- HTTPä¸­é—´ä»¶é›†æˆ

**Goç¤ºä¾‹ï¼š**
```go
var (
    httpRequestsTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "http_requests_total",
            Help: "Total HTTP requests",
        },
        []string{"method", "endpoint", "status"},
    )
)
```

---

### ç¬¬12ç« ï¼šå®æˆ˜é¡¹ç›®ï¼ˆ10-12å°æ—¶ï¼‰

**æ ¸å¿ƒå†…å®¹ï¼š**
- Kuberneteså®Œæ•´ç›‘æ§æ–¹æ¡ˆ
- å¾®æœåŠ¡æ¶æ„ç›‘æ§
- æ•°æ®åº“ç›‘æ§ï¼ˆMySQLã€Redisã€MongoDBï¼‰
- ä¸­é—´ä»¶ç›‘æ§ï¼ˆKafkaã€Nginxï¼‰
- SLI/SLOç›‘æ§
- å®Œæ•´ä¼ä¸šçº§ç›‘æ§å¹³å°

**é¡¹ç›®ç»“æ„ï¼š**
```
code/chapter12/
â”œâ”€â”€ 01-kubernetes-monitoring/
â”œâ”€â”€ 02-microservices/
â”œâ”€â”€ 03-databases/
â””â”€â”€ 04-complete-solution/
```

---

## ğŸš€ å­¦ä¹ è·¯çº¿å»ºè®®

### å¿«é€Ÿå…¥é—¨è·¯çº¿ï¼ˆ1å‘¨ï¼‰
1. âœ… ç¬¬1ç« ï¼šå®‰è£…é…ç½®ï¼ˆå·²å®Œæˆï¼‰
2. âœ… ç¬¬2ç« ï¼šæ ¸å¿ƒæ¦‚å¿µï¼ˆå·²å®Œæˆï¼‰
3. ç¬¬3ç« ï¼šPromQLåŸºç¡€
4. ç¬¬4ç« ï¼šå¸¸ç”¨Exporters
5. ç¬¬6ç« ï¼šåŸºç¡€å‘Šè­¦

### æ·±åº¦å­¦ä¹ è·¯çº¿ï¼ˆ2-3ä¸ªæœˆï¼‰
æŒ‰ç¬¬1-12ç« é¡ºåºå®Œæ•´å­¦ä¹ 

### å®æˆ˜å¯¼å‘è·¯çº¿
1. âœ… ç¬¬1-2ç« ï¼šåŸºç¡€
2. ç¬¬3ç« ï¼šPromQL
3. ç¬¬4ç« ï¼šExporters
4. ç¬¬12ç« ï¼šå®æˆ˜é¡¹ç›®
5. æ ¹æ®é¡¹ç›®éœ€è¦å›çœ‹ç¬¬5-11ç« 

---

## ğŸ“ å½“å‰æ•™ç¨‹çŠ¶æ€

| ç« èŠ‚ | çŠ¶æ€ | è¡Œæ•° | å®Œæˆåº¦ |
|------|------|------|--------|
| README | âœ… å®Œæˆ | 622 | 100% |
| ç¬¬1ç«  | âœ… å®Œæˆ | 1,234 | 100% |
| ç¬¬2ç«  | âœ… å®Œæˆ | 801 | 100% |
| ç¬¬3ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬4ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬5ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬6ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬7ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬8ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬9ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬10ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬11ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |
| ç¬¬12ç«  | ğŸ“‹ å¤§çº² | - | å¤§çº²å®Œæˆ |

**æ€»è®¡å·²åˆ›å»ºï¼š** 2,657è¡Œè¯¦ç»†ä¸­æ–‡æ–‡æ¡£ + å®Œæ•´12ç« å¤§çº²

---

## ğŸ’¡ å¦‚ä½•ç»§ç»­å­¦ä¹ 

### æ–¹æ¡ˆ1ï¼šåŸºäºç°æœ‰å†…å®¹
1. å­¦ä¹ å·²å®Œæˆçš„ç¬¬1-2ç« ï¼ˆæ·±åº¦å†…å®¹ï¼‰
2. å‚è€ƒæœ¬å¿«é€Ÿå‚è€ƒä¸­çš„ç¤ºä¾‹ä»£ç 
3. æŸ¥é˜…Prometheuså®˜æ–¹æ–‡æ¡£è¡¥å……

### æ–¹æ¡ˆ2ï¼šç»§ç»­åˆ›å»ºç« èŠ‚
å¦‚éœ€æ·±å…¥åˆ›å»ºæŸç« èŠ‚ï¼Œå‘Šè¯‰æˆ‘ç« èŠ‚å·ï¼Œæˆ‘å°†åˆ›å»ºä¸ç¬¬1-2ç« åŒç­‰æ·±åº¦çš„è¯¦ç»†æ•™ç¨‹ã€‚

**æ¨èä¼˜å…ˆåˆ›å»ºï¼š**
- ç¬¬3ç« ï¼ˆPromQLï¼‰- æœ€é‡è¦çš„æŸ¥è¯¢æŠ€èƒ½
- ç¬¬6ç« ï¼ˆå‘Šè­¦ï¼‰- ç”Ÿäº§ç¯å¢ƒå¿…éœ€
- ç¬¬12ç« ï¼ˆå®æˆ˜ï¼‰- ç»¼åˆåº”ç”¨

---

## ğŸ“š è¡¥å……å­¦ä¹ èµ„æº

### å®˜æ–¹èµ„æº
- [Prometheuså®˜æ–¹æ–‡æ¡£](https://prometheus.io/docs/)
- [PromQLåŸºç¡€](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [æœ€ä½³å®è·µ](https://prometheus.io/docs/practices/)

### ç¤¾åŒºèµ„æº
- [Prometheusä¸­æ–‡æ–‡æ¡£](https://prometheus.fuckcloudnative.io/)
- [Awesome Prometheus](https://github.com/roaldnefs/awesome-prometheus)

### å®è·µç¯å¢ƒ
- ä½¿ç”¨ç¬¬1ç« çš„Docker Composeç¯å¢ƒ
- è®¿é—® https://demo.promlabs.com/ åœ¨çº¿å®éªŒ

---

**å½“å‰ä½ç½®ï¼š** `observability/prometheus/`  
**å·²åˆ›å»ºï¼š** README.md + ç¬¬1-2ç« å®Œæ•´æ•™ç¨‹ + ç¬¬3-12ç« å¤§çº²  
**å¯ç«‹å³å­¦ä¹ ï¼š** ç¬¬1-2ç« åŒ…å«2,657è¡Œæ·±åº¦ä¸­æ–‡æ•™ç¨‹
