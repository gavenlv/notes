auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096

# Consul配置
common:
  ring:
    kvstore:
      store: consul
      consul:
        host: consul:8500
        http_client_config:
          tls_config:
            insecure_skip_verify: true

# Distributor配置
distributor:
  ring:
    kvstore:
      store: consul
      consul:
        host: consul:8500
        http_client_config:
          tls_config:
            insecure_skip_verify: true
  ha_tracker:
    enable_ha_tracker: true
    update_timeout: 2s
    num_workers: 50

# Ingester配置
ingester:
  lifecycler:
    address: 127.0.0.1
    ring:
      kvstore:
        store: consul
        consul:
          host: consul:8500
      replication_factor: 2
    final_sleep: 0s
    num_tokens: 512
  chunk_idle_period: 1h
  max_chunk_age: 2h
  chunk_target_size: 1048576
  chunk_retain_period: 30s
  max_transfer_retries: 10
  wal:
    dir: /loki/wal
    enabled: true
    replay_memory_ceiling: 100MB

# Querier配置
querier:
  query_concurrency: 20
  engine:
    max_look_back_period: 30d
    query_timeout: 5m
    max_samples_per_query: 50000000
  query_ingester_within: 3h

# Query Frontend配置
frontend:
  compress_responses: true
  log_queries_longer_than: 10s
  max_outstanding_per_tenant: 2048
  scheduler_address: dns+query-scheduler-discovery:9090
  scheduler_worker_address: dns+frontend:9096
  max_retries: 2

# Compactor配置
compactor:
  working_directory: /loki/compactor
  shared_store: s3
  compaction_interval: 10m
  retention_enabled: true
  delete_request_cancel_period: 24h
  retention_delete_delay: 2h
  retention_delete_worker_count: 150

# Ruler配置
ruler:
  enable_alertmanager_discovery: true
  alertmanager_url: http://alertmanager:9093/api/v1/alerts
  enable_api: true
  evaluation_interval: 1m
  poll_interval: 1m
  notification_timeout: 10s
  external_url: http://localhost:3000

# 限制配置
limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h
  max_global_streams_per_user: 10000
  max_streams_per_user: 5000
  max_series_per_user: 100000
  max_series_per_metric: 1000
  ingestion_rate_mb: 100
  ingestion_burst_size_mb: 200
  max_concurrent_queries: 10
  query_timeout: 5m

# 模式配置
schema_config:
  configs:
    - from: 2020-10-24
      store: boltdb-shipper
      object_store: s3
      schema: v11
      index:
        prefix: index_
        period: 24h

# 存储配置
storage_config:
  boltdb_shipper:
    active_index_directory: /loki/boltdb-shipper-active
    cache_location: /loki/boltdb-shipper-cache
    shared_store: s3
  
  s3:
    endpoint: minio:9000
    insecure: true
    bucketnames: loki-chunks
    access_key_id: loki
    secret_access_key: loki-secret
    s3forcepathstyle: true

# 块存储配置
chunk_store_config:
  max_look_back_period: 0s
  chunk_cache_config:
    enable_fifocache: true
    fifocache:
      max_size_items: 10000
      ttl: 24h
      validity: 10s