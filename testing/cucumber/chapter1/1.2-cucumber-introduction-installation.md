# 1.2 Cucumber简介与安装

## 什么是Cucumber？

Cucumber是一个支持BDD的测试工具，它允许使用自然语言（主要是Gherkin语法）来编写测试用例。Cucumber最初是用Ruby编写的，但现在支持多种编程语言，包括Java、JavaScript、.NET等。

Cucumber的主要特点：

1. **自然语言支持**：使用Gherkin语法编写可读性强的测试用例
2. **跨语言支持**：支持多种编程语言实现步骤定义
3. **可执行文档**：特性文件既是文档又是可执行的测试
4. **集成友好**：可以与多种测试框架和工具集成
5. **报告丰富**：提供多种格式的测试报告

## Cucumber的核心组件

### 1. Gherkin

Gherkin是一种业务可读的领域特定语言，用于描述软件行为。它使用简单的关键词（如Feature、Scenario、Given、When、Then）来组织测试场景。

### 2. 特性文件（Feature Files）

特性文件是使用Gherkin语法编写的文本文件，通常以`.feature`为扩展名，描述软件的功能特性。

### 3. 步骤定义（Step Definitions）

步骤定义是将Gherkin步骤映射到可执行代码的函数或方法。每个步骤定义对应一个或多个Gherkin步骤。

### 4. 支持库（Support Code）

支持库包括辅助类、配置文件等，用于支持步骤定义的实现。

## Cucumber的工作原理

1. **解析特性文件**：Cucumber读取并解析.feature文件
2. **匹配步骤**：将每个Gherkin步骤与相应的步骤定义匹配
3. **执行代码**：执行步骤定义中的代码
4. **生成报告**：记录测试结果并生成报告

## 安装Cucumber

### Java环境安装

在安装Cucumber之前，需要确保已安装Java开发环境：

1. 下载并安装Java JDK（推荐JDK 8或更高版本）
2. 配置JAVA_HOME环境变量
3. 将Java的bin目录添加到PATH环境变量

验证Java安装：

```bash
java -version
javac -version
```

### Maven项目设置

我们将使用Maven来管理Cucumber项目依赖。创建一个新的Maven项目：

1. 打开命令行工具
2. 执行以下命令创建Maven项目：

```bash
mvn archetype:generate -DgroupId=com.example -DartifactId=cucumber-tutorial -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
```

3. 进入项目目录：

```bash
cd cucumber-tutorial
```

### 添加Cucumber依赖

编辑`pom.xml`文件，添加Cucumber依赖：

```xml
<dependencies>
    <!-- Cucumber Java依赖 -->
    <dependency>
        <groupId>io.cucumber</groupId>
        <artifactId>cucumber-java</artifactId>
        <version>7.11.1</version>
        <scope>test</scope>
    </dependency>
    
    <!-- Cucumber JUnit依赖 -->
    <dependency>
        <groupId>io.cucumber</groupId>
        <artifactId>cucumber-junit</artifactId>
        <version>7.11.1</version>
        <scope>test</scope>
    </dependency>
    
    <!-- JUnit依赖 -->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.13.2</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

### 配置Maven Surefire插件

在`pom.xml`中添加Maven Surefire插件配置，以便运行Cucumber测试：

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>3.0.0-M9</version>
            <configuration>
                <includes>
                    <include>**/*Test.java</include>
                    <include>**/*Runner.java</include>
                </includes>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### IDE配置

#### IntelliJ IDEA

1. 安装Cucumber for Java插件：
   - 打开File > Settings > Plugins
   - 搜索"Cucumber for Java"并安装
   - 重启IDE

2. 配置Gherkin文件支持：
   - 打开File > Settings > Editor > File Types
   - 确保Gherkin文件类型已关联到.feature文件

#### Eclipse

1. 安装Cucumber Eclipse插件：
   - 打开Help > Eclipse Marketplace
   - 搜索"Cucumber Eclipse Plugin"并安装
   - 重启Eclipse

## 项目结构设置

创建标准的Cucumber项目结构：

```
cucumber-tutorial
├── src
│   ├── main
│   │   └── java
│   │       └── com
│   │           └── example
│   │               └── app
│   │                   └── [应用程序代码]
│   └── test
│       ├── java
│       │   └── com
│       │       └── example
│       │           └── cucumber
│       │               ├── stepdefinitions
│       │               │   └── [步骤定义类]
│       │               └── runners
│       │                   └── [测试运行器类]
│       └── resources
│           └── features
│               └── [特性文件]
└── pom.xml
```

创建必要的目录：

```bash
mkdir -p src/test/java/com/example/cucumber/stepdefinitions
mkdir -p src/test/java/com/example/cucumber/runners
mkdir -p src/test/resources/features
```

## 验证安装

创建一个简单的特性文件来验证Cucumber安装是否成功：

1. 创建特性文件`src/test/resources/features/sample.feature`：

```gherkin
Feature: Sample Feature
  This is a sample feature to verify Cucumber installation

  Scenario: Sample Scenario
    Given I have a sample test
    When I run the test
    Then the test should pass
```

2. 创建步骤定义类`src/test/java/com/example/cucumber/stepdefinitions/SampleSteps.java`：

```java
package com.example.cucumber.stepdefinitions;

import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;

public class SampleSteps {

    @Given("I have a sample test")
    public void iHaveASampleTest() {
        System.out.println("Given: I have a sample test");
    }

    @When("I run the test")
    public void iRunTheTest() {
        System.out.println("When: I run the test");
    }

    @Then("the test should pass")
    public void theTestShouldPass() {
        System.out.println("Then: the test should pass");
    }
}
```

3. 创建测试运行器`src/test/java/com/example/cucumber/runners/SampleTestRunner.java`：

```java
package com.example.cucumber.runners;

import io.cucumber.junit.Cucumber;
import io.cucumber.junit.CucumberOptions;
import org.junit.runner.RunWith;

@RunWith(Cucumber.class)
@CucumberOptions(
    features = "src/test/resources/features",
    glue = "com.example.cucumber.stepdefinitions",
    plugin = {"pretty", "html:target/cucumber-reports"}
)
public class SampleTestRunner {
}
```

4. 运行测试：

```bash
mvn test
```

如果一切正常，你应该能看到测试输出，并在`target/cucumber-reports`目录中找到HTML格式的测试报告。

## 常见安装问题及解决方法

### 1. 依赖冲突

如果遇到依赖冲突，可以使用Maven的依赖树命令查看依赖关系：

```bash
mvn dependency:tree
```

### 2. 版本兼容性问题

确保Cucumber相关依赖的版本兼容。通常，同一版本的`cucumber-java`和`cucumber-junit`应该一起使用。

### 3. IDE无法识别Gherkin文件

确保已安装并启用了相应的IDE插件，并正确配置了文件类型关联。

## 总结

本节介绍了Cucumber的基本概念、核心组件和工作原理，并详细讲解了如何在不同环境中安装和配置Cucumber。通过创建一个简单的示例项目，我们验证了Cucumber的安装是否成功。

在下一节中，我们将学习如何创建一个完整的Cucumber项目，并编写更复杂的特性文件和步骤定义。

## 思考题

1. Cucumber的核心组件有哪些？它们各自的作用是什么？
2. 为什么需要配置Maven Surefire插件？
3. 如果在运行测试时遇到"Undefined step"错误，可能的原因是什么？
4. 特性文件应该放在项目的哪个位置？为什么？