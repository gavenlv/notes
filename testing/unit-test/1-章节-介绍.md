# 第1章 — 单元测试基础与第一个测试

目标：
- 理解什么是单元测试（Unit Test）。
- 能写出第一个可运行的测试（使用 `unittest` 与 `pytest`）。

概念解析
- 单元测试：针对最小可测试单元（通常是函数或类的方法）编写的自动化测试。它们应当快速、可重复、独立。
- 断言（assertion）：用于声明程序应满足的条件。测试框架会在断言失败时标记测试为失败。
- 测试隔离：每个测试应该互不影响（避免共享可变全局状态）。

为何写单元测试
- 提高代码质量，捕获回归。
- 作为设计反馈（TDD）。
- 为重构提供保障。

第一个示例（代码和测试）

文件结构：
- `testing/unit-test/code/chapter1/simple_math.py` — 简单的函数。
- `testing/unit-test/code/chapter1/test_simple_math.py` — 用 `pytest` 写的测试。

示例代码：

- simple_math.py

```python
# 简单数学函数

def add(a, b):
    """返回 a + b"""
    return a + b

def divide(a, b):
    """返回 a / b，如果 b == 0 则抛出 ZeroDivisionError"""
    return a / b
```

- test_simple_math.py

```python
from chapter1.simple_math import add, divide
import pytest

def test_add_positive():
    assert add(2, 3) == 5

def test_add_negative():
    assert add(-1, -1) == -2

def test_divide_ok():
    assert divide(10, 2) == 5

def test_divide_zero():
    with pytest.raises(ZeroDivisionError):
        divide(1, 0)
```

如何运行

```powershell
cd d:\workspace\superset-github\notes
python -m pytest testing\unit-test\code\chapter1 -q
```

练习与扩展
- 为 `add` 添加浮点值测试。
- 为 `divide` 添加精度测试和边界条件测试（极小的非零除数）。

最佳实践小结
- 每个测试只检查一个行为。
- 测试名应描述行为（`test_` 前缀 + 描述）。
- 保持测试快速（单位测试应在毫秒到几十毫秒内完成）。

下一章将讲测试组织与常见断言。