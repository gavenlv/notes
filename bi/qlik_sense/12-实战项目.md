# ç¬¬12ç« ï¼šå®æˆ˜é¡¹ç›®

> **å­¦ä¹ æ—¶é•¿**: 20-25å°æ—¶  
> **éš¾åº¦**: â­â­â­â­â­  
> **å‰ç½®çŸ¥è¯†**: ç¬¬1-11ç« 

## æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« å,ä½ å°†èƒ½å¤Ÿ:

- âœ… ç‹¬ç«‹å®Œæˆä¼ä¸šçº§é”€å”®åˆ†æé¡¹ç›®
- âœ… å¼€å‘è´¢åŠ¡ç®¡æ§ä»ªè¡¨æ¿é¡¹ç›®
- âœ… å®ç°ä¾›åº”é“¾å¯è§†åŒ–é¡¹ç›®
- âœ… æ„å»ºå®¢æˆ·è¡Œä¸ºåˆ†æé¡¹ç›®
- âœ… è®¾è®¡å®æ—¶ç›‘æ§å¤§å±é¡¹ç›®
- âœ… æŒæ¡é¡¹ç›®å¼€å‘å…¨æµç¨‹
- âœ… è§£å†³å®é™…ä¸šåŠ¡é—®é¢˜

---

## 12.1 ä¼ä¸šçº§é”€å”®åˆ†æé¡¹ç›®

### 12.1.1 é¡¹ç›®éœ€æ±‚åˆ†æ

**ä¸šåŠ¡èƒŒæ™¯**:
æŸå¤§å‹é›¶å”®ä¼ä¸šéœ€è¦å…¨é¢äº†è§£é”€å”®çŠ¶å†µï¼Œæ”¯æŒå†³ç­–åˆ¶å®šã€‚

**æ ¸å¿ƒéœ€æ±‚**:
1. é”€å”®ä¸šç»©ç›‘æ§ (KPIã€è¶‹åŠ¿ã€å¯¹æ¯”)
2. äº§å“åˆ†æ (ç±»åˆ«ã€å“ç‰Œã€å•å“)
3. å®¢æˆ·åˆ†æ (åŒºåŸŸã€ç±»å‹ã€ä»·å€¼)
4. æ¸ é“åˆ†æ (çº¿ä¸Šã€çº¿ä¸‹ã€åˆ†é”€)
5. é¢„æµ‹åˆ†æ (è¶‹åŠ¿é¢„æµ‹ã€ç›®æ ‡ç®¡ç†)

**æŠ€æœ¯è¦æ±‚**:
- æ•°æ®æº: å¤šä¸ªç³»ç»Ÿæ•°æ®æ•´åˆ
- å®æ—¶æ€§: æ¯æ—¥æ›´æ–°
- å®‰å…¨æ€§: å¤šå±‚çº§æƒé™æ§åˆ¶
- å¯æ‰©å±•: æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•

### 12.1.2 æ•°æ®æ¶æ„è®¾è®¡

```qlik
// 1. åˆ†å±‚æ•°æ®æ¶æ„

///$tab ç¬¬ä¸€å±‚: åŸå§‹æ•°æ®åŠ è½½
// é”€å”®æ•°æ®
åŸå§‹é”€å”®æ•°æ®:
LOAD
    OrderID,
    OrderDate,
    CustomerID,
    ProductID,
    ChannelID,
    Quantity,
    UnitPrice,
    Discount,
    SalesAmount as RawAmount
FROM [lib://Source/Sales_*.csv] (txt);

// å®¢æˆ·æ•°æ®
åŸå§‹å®¢æˆ·æ•°æ®:
SQL SELECT 
    CustomerID,
    CustomerName,
    CustomerType,
    Region,
    City,
    RegistrationDate
FROM CustomerMaster;

// äº§å“æ•°æ®
åŸå§‹äº§å“æ•°æ®:
LOAD
    ProductID,
    ProductName,
    Category,
    Brand,
    Cost
FROM [lib://Source/Products.xlsx] (ooxml);

///$tab ç¬¬äºŒå±‚: æ•°æ®æ¸…æ´—
// é”€å”®æ•°æ®æ¸…æ´—
æ¸…æ´—é”€å”®æ•°æ®:
LOAD
    OrderID,
    Date(OrderDate) as CleanOrderDate,
    Year(OrderDate) as OrderYear,
    Month(OrderDate) as OrderMonth,
    'Q' & Ceil(Month(OrderDate)/3) as OrderQuarter,
    CustomerID,
    ProductID,
    ChannelID,
    Num(Quantity) as CleanQuantity,
    Num(UnitPrice, '#,##0.00') as CleanUnitPrice,
    Num(Discount, '#,##0.00') as CleanDiscount,
    Num(RawAmount, '#,##0.00') as CleanAmount,
    // è®¡ç®—å­—æ®µ
    CleanQuantity * CleanUnitPrice * (1 - CleanDiscount) as CalculatedAmount,
    If(CleanAmount > 0, CleanAmount - (CleanQuantity * Cost), 0) as Profit
RESIDENT åŸå§‹é”€å”®æ•°æ®;

///$tab ç¬¬ä¸‰å±‚: æ•°æ®æ•´åˆ
// å®Œæ•´é”€å”®äº‹å®è¡¨
é”€å”®äº‹å®è¡¨:
LOAD
    s.OrderID,
    s.CleanOrderDate,
    s.OrderYear,
    s.OrderMonth,
    s.OrderQuarter,
    s.CustomerID,
    c.CustomerName,
    c.CustomerType,
    c.Region,
    c.City,
    s.ProductID,
    p.ProductName,
    p.Category,
    p.Brand,
    s.ChannelID,
    ch.ChannelName,
    s.CleanQuantity,
    s.CleanAmount,
    s.Profit,
    s.CleanAmount / s.CleanQuantity as AvgUnitPrice
RESIDENT æ¸…æ´—é”€å”®æ•°æ® s
LEFT JOIN (åŸå§‹å®¢æˆ·æ•°æ® c) ON s.CustomerID = c.CustomerID
LEFT JOIN (åŸå§‹äº§å“æ•°æ® p) ON s.ProductID = p.ProductID
LEFT JOIN (æ¸ é“ç»´åº¦ ch) ON s.ChannelID = ch.ChannelID;

// ç»´åº¦è¡¨ä¼˜åŒ–
å®¢æˆ·ç»´åº¦:
LOAD DISTINCT
    CustomerID,
    CustomerName,
    CustomerType,
    Region,
    City
RESIDENT é”€å”®äº‹å®è¡¨;

äº§å“ç»´åº¦:
LOAD DISTINCT
    ProductID,
    ProductName,
    Category,
    Brand
RESIDENT é”€å”®äº‹å®è¡¨;
```

### 12.1.3 æ ¸å¿ƒæŒ‡æ ‡è®¾è®¡

```qlik
// 1. KPIæŒ‡æ ‡è®¡ç®—

///$tab é”€å”®KPI
é”€å”®KPI:
LOAD
    // åŸºç¡€æŒ‡æ ‡
    Sum(CleanAmount) as æ€»é”€å”®é¢,
    Count(DISTINCT OrderID) as æ€»è®¢å•æ•°,
    Count(DISTINCT CustomerID) as å®¢æˆ·æ•°,
    Sum(CleanQuantity) as æ€»é”€å”®é‡,
    Avg(CleanAmount) as å¹³å‡è®¢å•é‡‘é¢,
    
    // åŒæ¯”æŒ‡æ ‡
    Sum({<OrderYear = {$(=Max(OrderYear))}>} CleanAmount) as ä»Šå¹´é”€å”®é¢,
    Sum({<OrderYear = {$(=Max(OrderYear)-1)}>} CleanAmount) as å»å¹´é”€å”®é¢,
    (Sum({<OrderYear = {$(=Max(OrderYear))}>} CleanAmount) / 
     Sum({<OrderYear = {$(=Max(OrderYear)-1)}>} CleanAmount) - 1) as é”€å”®é¢åŒæ¯”å¢é•¿,
    
    // ç¯æ¯”æŒ‡æ ‡
    Sum({<OrderYear = {$(=Max(OrderYear))}, OrderMonth = {$(=Max(OrderMonth))}>} CleanAmount) as æœ¬æœˆé”€å”®é¢,
    Sum({<OrderYear = {$(=Max(OrderYear))}, OrderMonth = {$(=Max(OrderMonth)-1)}>} CleanAmount) as ä¸Šæœˆé”€å”®é¢,
    (Sum({<OrderYear = {$(=Max(OrderYear))}, OrderMonth = {$(=Max(OrderMonth))}>} CleanAmount) / 
     Sum({<OrderYear = {$(=Max(OrderYear))}, OrderMonth = {$(=Max(OrderMonth)-1)}>} CleanAmount) - 1) as é”€å”®é¢ç¯æ¯”å¢é•¿,
    
    // ç›®æ ‡å®Œæˆç‡
    Sum(CleanAmount) / Sum({1} é”€å”®ç›®æ ‡) as ç›®æ ‡å®Œæˆç‡,
    
    // åˆ©æ¶¦æŒ‡æ ‡
    Sum(Profit) as æ€»åˆ©æ¶¦,
    Sum(Profit) / Sum(CleanAmount) as åˆ©æ¶¦ç‡
    
RESIDENT é”€å”®äº‹å®è¡¨;

///$tab äº§å“åˆ†æ
äº§å“åˆ†æ:
LOAD
    ProductID,
    ProductName,
    Category,
    Brand,
    // é”€å”®æŒ‡æ ‡
    Sum(CleanAmount) as äº§å“é”€å”®é¢,
    Count(DISTINCT OrderID) as äº§å“è®¢å•æ•°,
    Sum(CleanQuantity) as äº§å“é”€å”®é‡,
    // æ’åæŒ‡æ ‡
    Rank(Sum(CleanAmount)) as é”€å”®é¢æ’å,
    // å æ¯”æŒ‡æ ‡
    Sum(CleanAmount) / Sum(TOTAL CleanAmount) as é”€å”®é¢å æ¯”,
    // è¶‹åŠ¿æŒ‡æ ‡
    (Sum({<OrderMonth = {$(=Max(OrderMonth))}>} CleanAmount) / 
     Sum({<OrderMonth = {$(=Max(OrderMonth)-1)}>} CleanAmount) - 1) as æœˆç¯æ¯”å¢é•¿
    
RESIDENT é”€å”®äº‹å®è¡¨
GROUP BY ProductID, ProductName, Category, Brand
ORDER BY äº§å“é”€å”®é¢ DESC;

///$tab å®¢æˆ·åˆ†æ
å®¢æˆ·åˆ†æ:
LOAD
    CustomerID,
    CustomerName,
    CustomerType,
    Region,
    City,
    // å®¢æˆ·ä»·å€¼
    Sum(CleanAmount) as å®¢æˆ·æ€»é”€å”®é¢,
    Count(DISTINCT OrderID) as å®¢æˆ·è®¢å•æ•°,
    Avg(CleanAmount) as å®¢æˆ·å¹³å‡è®¢å•é‡‘é¢,
    Max(CleanOrderDate) as æœ€åè´­ä¹°æ—¥æœŸ,
    // å®¢æˆ·ç”Ÿå‘½å‘¨æœŸ
    Max(CleanOrderDate) - Min(CleanOrderDate) as å®¢æˆ·ç”Ÿå‘½å‘¨æœŸ,
    // è´­ä¹°é¢‘ç‡
    Count(DISTINCT OrderID) / (Max(CleanOrderDate) - Min(CleanOrderDate) + 1) * 365 as å¹´è´­ä¹°é¢‘ç‡,
    // å®¢æˆ·ç­‰çº§
    IF(
        Sum(CleanAmount) > 100000, 'VIPå®¢æˆ·',
        IF(Sum(CleanAmount) > 50000, 'é‡è¦å®¢æˆ·',
           IF(Sum(CleanAmount) > 10000, 'æ™®é€šå®¢æˆ·', 'æ½œåœ¨å®¢æˆ·'))
    ) as å®¢æˆ·ç­‰çº§
    
RESIDENT é”€å”®äº‹å®è¡¨
GROUP BY CustomerID, CustomerName, CustomerType, Region, City
ORDER BY å®¢æˆ·æ€»é”€å”®é¢ DESC;
```

### 12.1.4 å¯è§†åŒ–è®¾è®¡

```qlik
// 1. é”€å”®æ€»è§ˆä»ªè¡¨æ¿

///$tab é”€å”®æ€»è§ˆ
// KPIå¯¹è±¡
æ€»é”€å”®é¢_KPI:
// è¡¨è¾¾å¼: Sum(CleanAmount)
// æ ¼å¼: 'Â¥#,##0'
// ç›®æ ‡: Sum({1} é”€å”®ç›®æ ‡)

é”€å”®é¢åŒæ¯”å¢é•¿_KPI:
// è¡¨è¾¾å¼: (Sum({<OrderYear = {$(=Max(OrderYear))}>} CleanAmount) / Sum({<OrderYear = {$(=Max(OrderYear)-1)}>} CleanAmount) - 1)
// æ ¼å¼: '#,##0.0%'

// è¶‹åŠ¿åˆ†æå›¾
æœˆåº¦é”€å”®è¶‹åŠ¿:
// ç»´åº¦: OrderYear, OrderMonth
// åº¦é‡: Sum(CleanAmount)
// ç±»å‹: æŠ˜çº¿å›¾

// äº§å“ç±»åˆ«åˆ†æ
äº§å“ç±»åˆ«é”€å”®:
// ç»´åº¦: Category
// åº¦é‡: Sum(CleanAmount)
// ç±»å‹: æŸ±çŠ¶å›¾

// åŒºåŸŸé”€å”®åˆ†å¸ƒ
åŒºåŸŸé”€å”®åœ°å›¾:
// ç»´åº¦: Region
// åº¦é‡: Sum(CleanAmount)
// ç±»å‹: åœ°å›¾

///$tab äº§å“åˆ†æ
// Top 10äº§å“
Topäº§å“åˆ†æ:
// ç»´åº¦: ProductName
// åº¦é‡: Sum(CleanAmount)
// é™åˆ¶: å‰10é¡¹
// ç±»å‹: æ¡å½¢å›¾

// å“ç‰Œé”€å”®å æ¯”
å“ç‰Œé”€å”®é¥¼å›¾:
// ç»´åº¦: Brand
// åº¦é‡: Sum(CleanAmount)
// ç±»å‹: é¥¼å›¾

///$tab å®¢æˆ·åˆ†æ
// å®¢æˆ·ç­‰çº§åˆ†å¸ƒ
å®¢æˆ·ç­‰çº§åˆ†å¸ƒ:
// ç»´åº¦: å®¢æˆ·ç­‰çº§
// åº¦é‡: Count(DISTINCT CustomerID)
// ç±»å‹: ç¯å›¾

// å®¢æˆ·ä»·å€¼åˆ†æ
å®¢æˆ·ä»·å€¼æ•£ç‚¹å›¾:
// Xè½´: å®¢æˆ·è®¢å•æ•°
// Yè½´: å®¢æˆ·æ€»é”€å”®é¢
// å¤§å°: å¹³å‡è®¢å•é‡‘é¢
// ç±»å‹: æ•£ç‚¹å›¾
```

---

## 12.2 è´¢åŠ¡ç®¡æ§ä»ªè¡¨æ¿é¡¹ç›®

### 12.2.1 é¡¹ç›®éœ€æ±‚

**ä¸šåŠ¡èƒŒæ™¯**:
é›†å›¢å…¬å¸éœ€è¦ç»Ÿä¸€è´¢åŠ¡ç®¡ç†ï¼Œå®ç°è´¢åŠ¡æ•°æ®çš„é›†ä¸­ç®¡æ§å’Œåˆ†æã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
1. æ”¶å…¥æ”¯å‡ºåˆ†æ
2. æˆæœ¬æ§åˆ¶ç›‘æ§
3. é¢„ç®—æ‰§è¡Œè·Ÿè¸ª
4. è´¢åŠ¡æŒ‡æ ‡åˆ†æ
5. å¼‚å¸¸é¢„è­¦æœºåˆ¶

**æ•°æ®æº**:
- ERPç³»ç»Ÿè´¢åŠ¡æ•°æ®
- é“¶è¡Œæµæ°´æ•°æ®
- é¢„ç®—ç®¡ç†ç³»ç»Ÿ
- ç¨åŠ¡ç”³æŠ¥æ•°æ®

### 12.2.2 æ•°æ®æ¨¡å‹è®¾è®¡

```qlik
// 1. è´¢åŠ¡æ•°æ®æ•´åˆ

///$tab è´¢åŠ¡äº‹å®è¡¨
// æ”¶å…¥æ•°æ®
æ”¶å…¥äº‹å®:
LOAD
    TransactionID,
    Date(TransactionDate) as FinancialDate,
    Year(TransactionDate) as FinancialYear,
    Month(TransactionDate) as FinancialMonth,
    AccountCode,
    AccountName,
    Department,
    Project,
    IncomeAmount,
    Currency,
    ExchangeRate,
    IncomeAmount * ExchangeRate as StandardAmount
FROM [lib://Finance/Income_*.csv] (txt);

// æ”¯å‡ºæ•°æ®
æ”¯å‡ºäº‹å®:
LOAD
    TransactionID,
    Date(TransactionDate) as FinancialDate,
    Year(TransactionDate) as FinancialYear,
    Month(TransactionDate) as FinancialMonth,
    AccountCode,
    AccountName,
    Department,
    Project,
    ExpenseAmount,
    Currency,
    ExchangeRate,
    ExpenseAmount * ExchangeRate as StandardAmount
FROM [lib://Finance/Expense_*.csv] (txt);

// é¢„ç®—æ•°æ®
é¢„ç®—äº‹å®:
LOAD
    BudgetID,
    AccountCode,
    Department,
    Project,
    BudgetYear,
    BudgetMonth,
    BudgetAmount
FROM [lib://Finance/Budget_*.csv] (txt);

///$tab ç»´åº¦è¡¨è®¾è®¡
// ä¼šè®¡ç§‘ç›®ç»´åº¦
ä¼šè®¡ç§‘ç›®ç»´åº¦:
LOAD DISTINCT
    AccountCode,
    AccountName,
    AccountType,
    AccountCategory
FROM 
    (SELECT AccountCode, AccountName, 'Income' as AccountType, 'Revenue' as AccountCategory FROM æ”¶å…¥äº‹å®
     UNION
     SELECT AccountCode, AccountName, 'Expense' as AccountType, 'Cost' as AccountCategory FROM æ”¯å‡ºäº‹å®);

// éƒ¨é—¨ç»´åº¦
éƒ¨é—¨ç»´åº¦:
LOAD DISTINCT
    Department,
    DepartmentHead,
    CostCenter
FROM éƒ¨é—¨ä¸»æ•°æ®;

// é¡¹ç›®ç»´åº¦
é¡¹ç›®ç»´åº¦:
LOAD DISTINCT
    Project,
    ProjectManager,
    ProjectStatus,
    StartDate,
    EndDate
FROM é¡¹ç›®ä¸»æ•°æ®;

///$tab è´¢åŠ¡æŒ‡æ ‡è®¡ç®—
// æ•´åˆè´¢åŠ¡äº‹å®è¡¨
è´¢åŠ¡äº‹å®æ•´åˆ:
LOAD
    'Income' as TransactionType,
    TransactionID,
    FinancialDate,
    FinancialYear,
    FinancialMonth,
    AccountCode,
    Department,
    Project,
    StandardAmount as Amount
RESIDENT æ”¶å…¥äº‹å®;

CONCATENATE (è´¢åŠ¡äº‹å®æ•´åˆ)
LOAD
    'Expense' as TransactionType,
    TransactionID,
    FinancialDate,
    FinancialYear,
    FinancialMonth,
    AccountCode,
    Department,
    Project,
    StandardAmount * -1 as Amount  // æ”¯å‡ºä¸ºè´Ÿæ•°
RESIDENT æ”¯å‡ºäº‹å®;

// è®¡ç®—è´¢åŠ¡æŒ‡æ ‡
è´¢åŠ¡æŒ‡æ ‡:
LOAD
    FinancialYear,
    FinancialMonth,
    Department,
    Project,
    // æ”¶å…¥æŒ‡æ ‡
    Sum({<TransactionType={'Income'}>} Amount) as æ€»æ”¶å…¥,
    // æ”¯å‡ºæŒ‡æ ‡
    Sum({<TransactionType={'Expense'}>} Amount) as æ€»æ”¯å‡º,
    // å‡€åˆ©æ¶¦
    Sum(Amount) as å‡€åˆ©æ¶¦,
    // åˆ©æ¶¦ç‡
    Sum(Amount) / Sum({<TransactionType={'Income'}>} Amount) as åˆ©æ¶¦ç‡,
    // é¢„ç®—æ‰§è¡Œ
    Sum(Amount) as å®é™…å‘ç”Ÿ,
    Sum(é¢„ç®—é‡‘é¢) as é¢„ç®—é‡‘é¢,
    Sum(Amount) / Sum(é¢„ç®—é‡‘é¢) as é¢„ç®—æ‰§è¡Œç‡
    
RESIDENT è´¢åŠ¡äº‹å®æ•´åˆ
LEFT JOIN (é¢„ç®—äº‹å®) ON 
    è´¢åŠ¡äº‹å®æ•´åˆ.Department = é¢„ç®—äº‹å®.Department AND
    è´¢åŠ¡äº‹å®æ•´åˆ.Project = é¢„ç®—äº‹å®.Project AND
    è´¢åŠ¡äº‹å®æ•´åˆ.FinancialYear = é¢„ç®—äº‹å®.BudgetYear AND
    è´¢åŠ¡äº‹å®æ•´åˆ.FinancialMonth = é¢„ç®—äº‹å®.BudgetMonth
GROUP BY FinancialYear, FinancialMonth, Department, Project;
```

### 12.2.3 é¢„è­¦æœºåˆ¶å®ç°

```qlik
// 1. è´¢åŠ¡é¢„è­¦è§„åˆ™

///$tab é¢„è­¦è§„åˆ™å®šä¹‰
é¢„è­¦è§„åˆ™:
LOAD * INLINE [
    RuleID, RuleName, RuleCondition, AlertLevel, AlertMessage
    FR001, æ”¶å…¥å¤§å¹…ä¸‹é™, å‡€åˆ©æ¶¦ç¯æ¯”ä¸‹é™>20%, HIGH, "æœ¬æœˆå‡€åˆ©æ¶¦ç¯æ¯”å¤§å¹…ä¸‹é™ï¼Œè¯·å…³æ³¨"
    FR002, æ”¯å‡ºè¶…é¢„ç®—, é¢„ç®—æ‰§è¡Œç‡>110%, HIGH, "æ”¯å‡ºè¶…å‡ºé¢„ç®—10%ä»¥ä¸Šï¼Œè¯·æ§åˆ¶"
    FR003, ç°é‡‘æµç´§å¼ , æœˆåº¦ç°é‡‘æµ<0, MEDIUM, "æœ¬æœˆç°é‡‘æµä¸ºè´Ÿï¼Œè¯·å…³æ³¨èµ„é‡‘çŠ¶å†µ"
    FR004, æˆæœ¬ä¸Šå‡, æˆæœ¬ç‡ç¯æ¯”ä¸Šå‡>15%, MEDIUM, "æˆæœ¬ç‡ä¸Šå‡è¾ƒå¿«ï¼Œè¯·åˆ†æåŸå› "
    FR005, é¢„ç®—åå·®, é¢„ç®—æ‰§è¡Œç‡<80%, LOW, "é¢„ç®—æ‰§è¡Œä¸è¶³80%ï¼Œè¯·æ£€æŸ¥æ‰§è¡Œæƒ…å†µ"
];

///$tab é¢„è­¦è®¡ç®—
è´¢åŠ¡é¢„è­¦:
LOAD
    FinancialYear,
    FinancialMonth,
    Department,
    Project,
    // é¢„è­¦è®¡ç®—
    IF(
        (Sum(Amount) - Above(Sum(Amount))) / Above(Sum(Amount)) < -0.2,
        'FR001',
        IF(
            Sum(Amount) / Sum(é¢„ç®—é‡‘é¢) > 1.1,
            'FR002',
            IF(
                Sum(æœˆåº¦ç°é‡‘æµ) < 0,
                'FR003',
                ''
            )
        )
    ) as é¢„è­¦è§„åˆ™ID
    
RESIDENT è´¢åŠ¡æŒ‡æ ‡
WHERE TransactionType = 'Expense'
GROUP BY FinancialYear, FinancialMonth, Department, Project;

// å…³è”é¢„è­¦ä¿¡æ¯
LEFT JOIN (è´¢åŠ¡é¢„è­¦)
LOAD RuleID, RuleName, AlertLevel, AlertMessage
RESIDENT é¢„è­¦è§„åˆ™;
```

### 12.2.4 ç®¡æ§ä»ªè¡¨æ¿

```qlik
// 1. è´¢åŠ¡ç®¡æ§ä»ªè¡¨æ¿è®¾è®¡

///$tab è´¢åŠ¡æ€»è§ˆ
// æ ¸å¿ƒKPI
æ€»æ”¶å…¥_KPI:
// è¡¨è¾¾å¼: Sum({<TransactionType={'Income'}>} Amount)
// æ ¼å¼: 'Â¥#,##0'

æ€»æ”¯å‡º_KPI:
// è¡¨è¾¾å¼: Abs(Sum({<TransactionType={'Expense'}>} Amount))
// æ ¼å¼: 'Â¥#,##0'

å‡€åˆ©æ¶¦_KPI:
// è¡¨è¾¾å¼: Sum(Amount)
// æ ¼å¼: 'Â¥#,##0'

åˆ©æ¶¦ç‡_KPI:
// è¡¨è¾¾å¼: Sum(Amount) / Sum({<TransactionType={'Income'}>} Amount)
// æ ¼å¼: '#,##0.0%'

é¢„ç®—æ‰§è¡Œç‡_KPI:
// è¡¨è¾¾å¼: Sum(Amount) / Sum(é¢„ç®—é‡‘é¢)
// æ ¼å¼: '#,##0.0%'

///$tab æ”¶æ”¯åˆ†æ
// æœˆåº¦æ”¶æ”¯è¶‹åŠ¿
æœˆåº¦æ”¶æ”¯è¶‹åŠ¿:
// ç»´åº¦: FinancialYear, FinancialMonth
// åº¦é‡1: Sum({<TransactionType={'Income'}>} Amount)  // æ”¶å…¥
// åº¦é‡2: Abs(Sum({<TransactionType={'Expense'}>} Amount))  // æ”¯å‡º
// ç±»å‹: ç»„åˆå›¾(æŸ±çŠ¶+æŠ˜çº¿)

// éƒ¨é—¨æ”¯å‡ºåˆ†æ
éƒ¨é—¨æ”¯å‡ºåˆ†æ:
// ç»´åº¦: Department
// åº¦é‡: Abs(Sum({<TransactionType={'Expense'}>} Amount))
// ç±»å‹: æ¡å½¢å›¾

///$tab é¢„ç®—ç®¡æ§
// é¢„ç®—æ‰§è¡Œå¯¹æ¯”
é¢„ç®—æ‰§è¡Œå¯¹æ¯”:
// ç»´åº¦: Department
// åº¦é‡1: Sum(Amount)  // å®é™…
// åº¦é‡2: Sum(é¢„ç®—é‡‘é¢)  // é¢„ç®—
// ç±»å‹: å †ç§¯æŸ±çŠ¶å›¾

// é¢„ç®—åå·®åˆ†æ
é¢„ç®—åå·®åˆ†æ:
// ç»´åº¦: Department
// åº¦é‡: (Sum(Amount) / Sum(é¢„ç®—é‡‘é¢) - 1)
// ç±»å‹: æ°´å¹³æ¡å½¢å›¾

///$tab é¢„è­¦ç›‘æ§
// é¢„è­¦åˆ—è¡¨
é¢„è­¦åˆ—è¡¨:
// ç»´åº¦: AlertLevel, AlertMessage, FinancialYear, FinancialMonth
// åº¦é‡: Count(RuleID)
// ç±»å‹: è¡¨æ ¼

// é¢„è­¦è¶‹åŠ¿
é¢„è­¦è¶‹åŠ¿:
// ç»´åº¦: FinancialMonth, AlertLevel
// åº¦é‡: Count(RuleID)
// ç±»å‹: é¢ç§¯å›¾
```

---

## 12.3 ä¾›åº”é“¾å¯è§†åŒ–é¡¹ç›®

### 12.3.1 é¡¹ç›®éœ€æ±‚

**ä¸šåŠ¡èƒŒæ™¯**:
åˆ¶é€ ä¼ä¸šéœ€è¦ä¼˜åŒ–ä¾›åº”é“¾ç®¡ç†ï¼Œæé«˜è¿è¥æ•ˆç‡ã€‚

**æ ¸å¿ƒéœ€æ±‚**:
1. é‡‡è´­ç®¡ç†å¯è§†åŒ–
2. åº“å­˜çŠ¶æ€å®æ—¶ç›‘æ§
3. ç”Ÿäº§è®¡åˆ’è·Ÿè¸ª
4. ç‰©æµé…é€ä¼˜åŒ–
5. ä¾›åº”å•†ç»©æ•ˆè¯„ä¼°

**é›†æˆç³»ç»Ÿ**:
- ERPé‡‡è´­ç³»ç»Ÿ
- WMSä»“å‚¨ç³»ç»Ÿ
- MESç”Ÿäº§ç³»ç»Ÿ
- TMSè¿è¾“ç³»ç»Ÿ

### 12.3.2 ä¾›åº”é“¾æ•°æ®æ¨¡å‹

```qlik
// 1. ä¾›åº”é“¾æ•°æ®æ•´åˆ

///$tab é‡‡è´­ç®¡ç†
// é‡‡è´­è®¢å•
é‡‡è´­è®¢å•:
LOAD
    POID,
    PODate,
    SupplierID,
    ItemCode,
    Quantity as POQuantity,
    UnitPrice,
    Amount as POAmount,
    RequestedDate,
    ExpectedDate,
    Status as POStatus
FROM [lib://Supply/PO_*.csv] (txt);

// é‡‡è´­æ”¶è´§
é‡‡è´­æ”¶è´§:
LOAD
    GRNID,
    POID,
    ReceiveDate,
    ReceivedQuantity,
    QualityStatus,
    Inspector
FROM [lib://Supply/GRN_*.csv] (txt);

///$tab åº“å­˜ç®¡ç†
// åº“å­˜äº‹åŠ¡
åº“å­˜äº‹åŠ¡:
LOAD
    TransactionID,
    ItemCode,
    TransactionDate,
    TransactionType,
    Quantity,
    UnitCost,
    Location,
    BatchNumber
FROM [lib://Supply/Inventory_*.csv] (txt);

// åº“å­˜ä½™é¢
åº“å­˜ä½™é¢:
LOAD
    ItemCode,
    Location,
    OnHandQuantity,
    ReservedQuantity,
    AvailableQuantity,
    ReorderPoint,
    MaxStockLevel
FROM [lib://Supply/StockBalance.csv] (txt);

///$tab ç”Ÿäº§è®¡åˆ’
// ç”Ÿäº§è®¢å•
ç”Ÿäº§è®¢å•:
LOAD
    MOID,
    ItemCode,
    PlannedStartDate,
    PlannedEndDate,
    ActualStartDate,
    ActualEndDate,
    PlannedQuantity,
    ActualQuantity,
    Status as MOStatus
FROM [lib://Supply/MO_*.csv] (txt);

// ç‰©æ–™éœ€æ±‚
ç‰©æ–™éœ€æ±‚:
LOAD
    MOID,
    ComponentCode,
    RequiredQuantity,
    IssuedQuantity
FROM [lib://Supply/Material_*.csv] (txt);

///$tab ç‰©æµé…é€
// å‘è´§è®¢å•
å‘è´§è®¢å•:
LOAD
    SOID,
    CustomerID,
    ShipDate,
    Carrier,
    TrackingNumber,
    ShipQuantity,
    ShipStatus
FROM [lib://Supply/SO_*.csv] (txt);

// è¿è¾“è·Ÿè¸ª
è¿è¾“è·Ÿè¸ª:
LOAD
    TrackingNumber,
    Location,
    StatusUpdateTime,
    Status as TransportStatus,
    Remarks
FROM [lib://Supply/Tracking_*.csv] (txt);

///$tab ä¾›åº”å•†ç®¡ç†
// ä¾›åº”å•†ä¸»æ•°æ®
ä¾›åº”å•†ä¸»æ•°æ®:
LOAD
    SupplierID,
    SupplierName,
    ContactPerson,
    Phone,
    Email,
    Address,
    Category,
    Rating
FROM [lib://Supply/Supplier.csv] (txt);

// ä¾›åº”å•†ç»©æ•ˆ
ä¾›åº”å•†ç»©æ•ˆ:
LOAD
    SupplierID,
    Year,
    Month,
    DeliveryOnTimeRate,
    QualityRate,
    ServiceRate,
    OverallScore
FROM [lib://Supply/SupplierPerformance.csv] (txt);
```

### 12.3.3 ä¾›åº”é“¾æŒ‡æ ‡ä½“ç³»

```qlik
// 1. ä¾›åº”é“¾å…³é”®æŒ‡æ ‡

///$tab é‡‡è´­æŒ‡æ ‡
é‡‡è´­æŒ‡æ ‡:
LOAD
    POID,
    PODate,
    SupplierID,
    s.SupplierName,
    ItemCode,
    POQuantity,
    POAmount,
    ExpectedDate,
    POStatus,
    // é‡‡è´­å‘¨æœŸ
    ExpectedDate - PODate as é‡‡è´­å‘¨æœŸ,
    // äº¤æœŸè¾¾æˆç‡
    IF(ActualReceiptDate <= ExpectedDate, 1, 0) as äº¤æœŸè¾¾æˆ,
    // é‡‡è´­é‡‘é¢å æ¯”
    POAmount / Sum(TOTAL POAmount) as é‡‡è´­é‡‘é¢å æ¯”
    
RESIDENT é‡‡è´­è®¢å•
LEFT JOIN (ä¾›åº”å•†ä¸»æ•°æ® s) ON é‡‡è´­è®¢å•.SupplierID = s.SupplierID;

///$tab åº“å­˜æŒ‡æ ‡
åº“å­˜æŒ‡æ ‡:
LOAD
    ItemCode,
    Location,
    OnHandQuantity,
    ReservedQuantity,
    AvailableQuantity,
    ReorderPoint,
    MaxStockLevel,
    UnitCost,
    // åº“å­˜ä»·å€¼
    OnHandQuantity * UnitCost as åº“å­˜ä»·å€¼,
    // åº“å­˜å‘¨è½¬ç‡
    å‡ºåº“æ•°é‡ / ((æœŸåˆåº“å­˜ + æœŸæœ«åº“å­˜) / 2) as åº“å­˜å‘¨è½¬ç‡,
    // åº“å­˜å¤©æ•°
    AvailableQuantity / (æœˆåº¦å‡ºåº“é‡ / 30) as åº“å­˜å¤©æ•°,
    // å®‰å…¨åº“å­˜æ¯”ä¾‹
    (AvailableQuantity - ReorderPoint) / ReorderPoint as å®‰å…¨åº“å­˜æ¯”ä¾‹,
    // åº“å­˜çŠ¶æ€
    IF(AvailableQuantity <= ReorderPoint, 'éœ€è¡¥è´§',
       IF(AvailableQuantity > MaxStockLevel, 'è¶…å‚¨', 'æ­£å¸¸')) as åº“å­˜çŠ¶æ€
    
RESIDENT åº“å­˜ä½™é¢;

///$tab ç”Ÿäº§æŒ‡æ ‡
ç”Ÿäº§æŒ‡æ ‡:
LOAD
    MOID,
    ItemCode,
    PlannedStartDate,
    PlannedEndDate,
    ActualStartDate,
    ActualEndDate,
    PlannedQuantity,
    ActualQuantity,
    MOStatus,
    // è®¡åˆ’è¾¾æˆç‡
    ActualQuantity / PlannedQuantity as è®¡åˆ’è¾¾æˆç‡,
    // ç”Ÿäº§å‘¨æœŸ
    ActualEndDate - ActualStartDate as å®é™…ç”Ÿäº§å‘¨æœŸ,
    PlannedEndDate - PlannedStartDate as è®¡åˆ’ç”Ÿäº§å‘¨æœŸ,
    // å»¶æœŸå¤©æ•°
    IF(ActualEndDate > PlannedEndDate, ActualEndDate - PlannedEndDate, 0) as å»¶æœŸå¤©æ•°,
    // ç”Ÿäº§æ•ˆç‡
    ActualQuantity / (å®é™…ç”Ÿäº§å‘¨æœŸ * æ ‡å‡†äº§èƒ½) as ç”Ÿäº§æ•ˆç‡
    
RESIDENT ç”Ÿäº§è®¢å•;

///$tab ç‰©æµæŒ‡æ ‡
ç‰©æµæŒ‡æ ‡:
LOAD
    SOID,
    CustomerID,
    ShipDate,
    Carrier,
    ShipQuantity,
    ShipStatus,
    // é…é€æ—¶æ•ˆ
    å®é™…é€è¾¾æ—¶é—´ - ShipDate as é…é€å¤©æ•°,
    // å‡†æ—¶äº¤ä»˜ç‡
    IF(å®é™…é€è¾¾æ—¶é—´ <= æ‰¿è¯ºé€è¾¾æ—¶é—´, 1, 0) as å‡†æ—¶äº¤ä»˜,
    // è¿è¾“æˆæœ¬
    è¿è´¹ / ShipQuantity as å•ä½è¿è¾“æˆæœ¬,
    // å®¢æˆ·æ»¡æ„åº¦
    å®¢æˆ·ç­¾æ”¶è¯„åˆ†
    
RESIDENT å‘è´§è®¢å•;
```

### 12.3.4 ä¾›åº”é“¾å¯è§†åŒ–

```qlik
// 1. ä¾›åº”é“¾å¯è§†åŒ–è®¾è®¡

///$tab ä¾›åº”é“¾æ€»è§ˆ
// ä¾›åº”é“¾KPI
é‡‡è´­é‡‘é¢_KPI:
// è¡¨è¾¾å¼: Sum(POAmount)
// æ ¼å¼: 'Â¥#,##0'

åº“å­˜ä»·å€¼_KPI:
// è¡¨è¾¾å¼: Sum(åº“å­˜ä»·å€¼)
// æ ¼å¼: 'Â¥#,##0'

ç”Ÿäº§è¾¾æˆç‡_KPI:
// è¡¨è¾¾å¼: Avg(è®¡åˆ’è¾¾æˆç‡)
// æ ¼å¼: '#,##0.0%'

å‡†æ—¶äº¤ä»˜ç‡_KPI:
// è¡¨è¾¾å¼: Avg(å‡†æ—¶äº¤ä»˜)
// æ ¼å¼: '#,##0.0%'

///$tab é‡‡è´­ç›‘æ§
// ä¾›åº”å•†äº¤æœŸè¾¾æˆ
ä¾›åº”å•†äº¤æœŸè¾¾æˆ:
// ç»´åº¦: SupplierName
// åº¦é‡: Avg(äº¤æœŸè¾¾æˆ)
// ç±»å‹: æ°´å¹³æ¡å½¢å›¾

// é‡‡è´­é‡‘é¢è¶‹åŠ¿
é‡‡è´­é‡‘é¢è¶‹åŠ¿:
// ç»´åº¦: PODate (æŒ‰æœˆ)
// åº¦é‡: Sum(POAmount)
// ç±»å‹: æŠ˜çº¿å›¾

///$tab åº“å­˜ç›‘æ§
// åº“å­˜çŠ¶æ€åˆ†å¸ƒ
åº“å­˜çŠ¶æ€åˆ†å¸ƒ:
// ç»´åº¦: åº“å­˜çŠ¶æ€
// åº¦é‡: Count(ItemCode)
// ç±»å‹: é¥¼å›¾

// åº“å­˜å‘¨è½¬ç‡
åº“å­˜å‘¨è½¬ç‡åˆ†æ:
// ç»´åº¦: ItemCode
// åº¦é‡: åº“å­˜å‘¨è½¬ç‡
// é™åˆ¶: å‰20é¡¹
// ç±»å‹: æ¡å½¢å›¾

///$tab ç”Ÿäº§è·Ÿè¸ª
// ç”Ÿäº§è®¡åˆ’ç”˜ç‰¹å›¾
ç”Ÿäº§è®¡åˆ’ç”˜ç‰¹:
// ç»´åº¦: MOID, ItemCode
// å¼€å§‹æ—¶é—´: PlannedStartDate
// ç»“æŸæ—¶é—´: PlannedEndDate
// å®é™…æ—¶é—´: ActualStartDate to ActualEndDate
// ç±»å‹: ç”˜ç‰¹å›¾

// ç”Ÿäº§å»¶æœŸåˆ†æ
ç”Ÿäº§å»¶æœŸåˆ†æ:
// ç»´åº¦: å»¶æœŸå¤©æ•°åŒºé—´
// åº¦é‡: Count(MOID)
// ç±»å‹: ç›´æ–¹å›¾

///$tab ç‰©æµè·Ÿè¸ª
// è¿è¾“çŠ¶æ€ç›‘æ§
è¿è¾“çŠ¶æ€ç›‘æ§:
// ç»´åº¦: TransportStatus
// åº¦é‡: Count(TrackingNumber)
// ç±»å‹: ç€‘å¸ƒå›¾

// é…é€æ—¶æ•ˆåˆ†æ
é…é€æ—¶æ•ˆåˆ†æ:
// ç»´åº¦: Carrier
// åº¦é‡: Avg(é…é€å¤©æ•°)
// ç±»å‹: ç®±çº¿å›¾
```

---

## 12.4 å®¢æˆ·è¡Œä¸ºåˆ†æé¡¹ç›®

### 12.4.1 é¡¹ç›®éœ€æ±‚

**ä¸šåŠ¡èƒŒæ™¯**:
ç”µå•†å¹³å°éœ€è¦æ·±å…¥äº†è§£å®¢æˆ·è¡Œä¸ºï¼Œæå‡å®¢æˆ·ä½“éªŒå’Œè½¬åŒ–ç‡ã€‚

**åˆ†æç›®æ ‡**:
1. å®¢æˆ·ç”»åƒæ„å»º
2. è´­ä¹°è¡Œä¸ºåˆ†æ
3. ç”¨æˆ·æ—…ç¨‹ä¼˜åŒ–
4. ä¸ªæ€§åŒ–æ¨è
5. å®¢æˆ·æµå¤±é¢„è­¦

**æ•°æ®æº**:
- ç”¨æˆ·æ³¨å†Œä¿¡æ¯
- æµè§ˆè¡Œä¸ºæ—¥å¿—
- è´­ä¹°äº¤æ˜“è®°å½•
- å®¢æœäº¤äº’è®°å½•
- è¥é”€æ´»åŠ¨æ•°æ®

### 12.4.2 å®¢æˆ·æ•°æ®æ¨¡å‹

```qlik
// 1. å®¢æˆ·è¡Œä¸ºæ•°æ®æ•´åˆ

///$tab ç”¨æˆ·åŸºç¡€ä¿¡æ¯
// ç”¨æˆ·æ³¨å†Œæ•°æ®
ç”¨æˆ·æ³¨å†Œ:
LOAD
    UserID,
    RegisterDate,
    UserName,
    Email,
    Phone,
    Gender,
    BirthYear,
    Province,
    City,
    RegisterChannel
FROM [lib://Customer/User_*.csv] (txt);

// ç”¨æˆ·æ ‡ç­¾
ç”¨æˆ·æ ‡ç­¾:
LOAD
    UserID,
    TagCategory,
    TagValue,
    TagScore
FROM [lib://Customer/UserTags.csv] (txt);

///$tab è¡Œä¸ºæ—¥å¿—æ•°æ®
// æµè§ˆæ—¥å¿—
æµè§ˆæ—¥å¿—:
LOAD
    SessionID,
    UserID,
    PageURL,
    PageTitle,
    VisitTime,
    StayDuration,
    DeviceType,
    Referrer
FROM [lib://Customer/BrowseLog_*.csv] (txt);

// æœç´¢æ—¥å¿—
æœç´¢æ—¥å¿—:
LOAD
    SessionID,
    UserID,
    SearchKeyword,
    SearchTime,
    SearchResultCount,
    ClickPosition
FROM [lib://Customer/SearchLog_*.csv] (txt);

// ç‚¹å‡»æ—¥å¿—
ç‚¹å‡»æ—¥å¿—:
LOAD
    SessionID,
    UserID,
    ClickElement,
    ClickTime,
    PagePosition
FROM [lib://Customer/ClickLog_*.csv] (txt);

///$tab äº¤æ˜“æ•°æ®
// è®¢å•æ•°æ®
è®¢å•æ•°æ®:
LOAD
    OrderID,
    UserID,
    OrderTime,
    ProductID,
    Quantity,
    UnitPrice,
    Discount,
    Amount,
    PaymentMethod,
    OrderStatus
FROM [lib://Customer/Order_*.csv] (txt);

// è´­ç‰©è½¦æ•°æ®
è´­ç‰©è½¦æ•°æ®:
LOAD
    CartID,
    UserID,
    ProductID,
    AddTime,
    RemoveTime,
    IsConverted
FROM [lib://Customer/Cart_*.csv] (txt);

///$tab è¥é”€æ•°æ®
// è¥é”€æ´»åŠ¨
è¥é”€æ´»åŠ¨:
LOAD
    CampaignID,
    CampaignName,
    StartTime,
    EndTime,
    Channel,
    Budget
FROM [lib://Customer/Campaign.csv] (txt);

// ç”¨æˆ·å‚ä¸
ç”¨æˆ·å‚ä¸:
LOAD
    UserID,
    CampaignID,
    ExposureTime,
    ClickTime,
    ConversionTime,
    ConversionValue
FROM [lib://Customer/CampaignParticipation.csv] (txt);
```

### 12.4.3 å®¢æˆ·ç”»åƒæ„å»º

```qlik
// 1. å®¢æˆ·ç”»åƒæŒ‡æ ‡

///$tab åŸºç¡€ç”»åƒ
åŸºç¡€ç”»åƒ:
LOAD
    UserID,
    UserName,
    Gender,
    Year(Today()) - BirthYear as Age,
    Province,
    City,
    RegisterChannel,
    // æ³¨å†Œæ—¶é•¿
    Today() - RegisterDate as æ³¨å†Œå¤©æ•°,
    // æœ€è¿‘æ´»è·ƒ
    Max(VisitTime) as æœ€è¿‘è®¿é—®æ—¶é—´,
    Today() - Max(VisitTime) as æœ€è¿‘æ´»è·ƒå¤©æ•°,
    // å®¢æˆ·ç­‰çº§
    IF(Today() - RegisterDate > 730, 'è€ç”¨æˆ·',
       IF(Today() - RegisterDate > 180, 'æˆç†Ÿç”¨æˆ·', 'æ–°ç”¨æˆ·')) as ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸ
    
RESIDENT ç”¨æˆ·æ³¨å†Œ
GROUP BY UserID, UserName, Gender, BirthYear, Province, City, RegisterChannel, RegisterDate;

///$tab è¡Œä¸ºç”»åƒ
è¡Œä¸ºç”»åƒ:
LOAD
    UserID,
    // æ´»è·ƒåº¦æŒ‡æ ‡
    Count(DISTINCT Date(VisitTime)) as æ´»è·ƒå¤©æ•°,
    Count(SessionID) as è®¿é—®æ¬¡æ•°,
    Sum(StayDuration) as æ€»åœç•™æ—¶é—´,
    Avg(StayDuration) as å¹³å‡åœç•™æ—¶é—´,
    // æµè§ˆæ·±åº¦
    Count(PageURL) / Count(SessionID) as å¹³å‡é¡µé¢æ•°,
    // æœç´¢è¡Œä¸º
    Count(SearchKeyword) as æœç´¢æ¬¡æ•°,
    Count(DISTINCT SearchKeyword) as æœç´¢å…³é”®è¯æ•°,
    // äº¤äº’è¡Œä¸º
    Count(ClickElement) as ç‚¹å‡»æ¬¡æ•°,
    Count(ClickElement) / Count(PageURL) as é¡µé¢ç‚¹å‡»ç‡,
    // è®¾å¤‡åå¥½
    FirstSortedValue(DeviceType, -Count(DeviceType)) as ä¸»è¦è®¾å¤‡
    
RESIDENT æµè§ˆæ—¥å¿—
GROUP BY UserID;

///$tab ä»·å€¼ç”»åƒ
ä»·å€¼ç”»åƒ:
LOAD
    UserID,
    // äº¤æ˜“æŒ‡æ ‡
    Count(DISTINCT OrderID) as è®¢å•æ•°,
    Sum(Amount) as æ€»æ¶ˆè´¹é‡‘é¢,
    Avg(Amount) as å¹³å‡è®¢å•é‡‘é¢,
    Max(Amount) as æœ€å¤§è®¢å•é‡‘é¢,
    // è´­ä¹°é¢‘æ¬¡
    Count(OrderID) / (Max(OrderTime) - Min(OrderTime) + 1) * 365 as å¹´è´­ä¹°é¢‘æ¬¡,
    // è´­ç‰©è½¦è½¬åŒ–
    Sum(IsConverted) / Count(CartID) as è´­ç‰©è½¦è½¬åŒ–ç‡,
    // å®¢æˆ·ä»·å€¼
    Sum(Amount) * Count(OrderID) / Count(DISTINCT Date(OrderTime)) as å®¢æˆ·ä»·å€¼å¾—åˆ†,
    // å®¢æˆ·åˆ†å±‚
    IF(Sum(Amount) > 10000, 'é«˜ä»·å€¼å®¢æˆ·',
       IF(Sum(Amount) > 5000, 'ä¸­ä»·å€¼å®¢æˆ·',
          IF(Sum(Amount) > 1000, 'ä½ä»·å€¼å®¢æˆ·', 'æ½œåœ¨å®¢æˆ·'))) as å®¢æˆ·ä»·å€¼ç­‰çº§
    
RESIDENT è®¢å•æ•°æ®
LEFT JOIN (è´­ç‰©è½¦æ•°æ®) ON è®¢å•æ•°æ®.UserID = è´­ç‰©è½¦æ•°æ®.UserID
GROUP BY UserID;

///$tab è¥é”€ç”»åƒ
è¥é”€ç”»åƒ:
LOAD
    UserID,
    // è¥é”€å“åº”
    Count(DISTINCT CampaignID) as å‚ä¸æ´»åŠ¨æ•°,
    Count(ClickTime) as æ´»åŠ¨ç‚¹å‡»æ•°,
    Count(ConversionTime) as æ´»åŠ¨è½¬åŒ–æ•°,
    // è½¬åŒ–ç‡
    Count(ConversionTime) / Count(ExposureTime) as æ´»åŠ¨è½¬åŒ–ç‡,
    Sum(ConversionValue) as è¥é”€è´¡çŒ®å€¼,
    // æ¸ é“åå¥½
    FirstSortedValue(Channel, -Count(Channel)) as åå¥½è¥é”€æ¸ é“,
    // ROIåˆ†æ
    Sum(ConversionValue) / Count(DISTINCT CampaignID) as å¹³å‡æ´»åŠ¨ROI
    
RESIDENT ç”¨æˆ·å‚ä¸
LEFT JOIN (è¥é”€æ´»åŠ¨) ON ç”¨æˆ·å‚ä¸.CampaignID = è¥é”€æ´»åŠ¨.CampaignID
GROUP BY UserID;
```

### 12.4.4 å®¢æˆ·è¡Œä¸ºåˆ†æ

```qlik
// 1. å®¢æˆ·è¡Œä¸ºåˆ†ææ¨¡å‹

///$tab ç”¨æˆ·æ—…ç¨‹åˆ†æ
ç”¨æˆ·æ—…ç¨‹:
LOAD
    UserID,
    // æ—…ç¨‹é˜¶æ®µè¯†åˆ«
    IF(æ³¨å†Œå¤©æ•° <= 30, 'æ–°ç”¨æˆ·æœŸ',
       IF(æ´»è·ƒå¤©æ•° > 50 AND æ€»æ¶ˆè´¹é‡‘é¢ > 1000, 'æˆç†ŸæœŸ',
          IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 90, 'æ²‰é»˜æœŸ', 'æˆé•¿æœŸ'))) as ç”¨æˆ·é˜¶æ®µ,
    // æ—…ç¨‹çŠ¶æ€
    IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 180, 'æµå¤±é£é™©',
       IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 30, 'éœ€è¦æ¿€æ´»', 'æ´»è·ƒ')) as æ—…ç¨‹çŠ¶æ€,
    // ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®
    IF(ç”¨æˆ·é˜¶æ®µ = 'æ–°ç”¨æˆ·æœŸ', 'å¼•å¯¼å®Œæˆé¦–å•',
       IF(ç”¨æˆ·é˜¶æ®µ = 'æˆé•¿æœŸ', 'æå‡è´­ä¹°é¢‘æ¬¡',
          IF(ç”¨æˆ·é˜¶æ®µ = 'æˆç†ŸæœŸ', 'äº¤å‰é”€å”®', 'æŒ½å›æµå¤±'))) as è¡ŒåŠ¨å»ºè®®
    
RESIDENT åŸºç¡€ç”»åƒ
LEFT JOIN (è¡Œä¸ºç”»åƒ) ON åŸºç¡€ç”»åƒ.UserID = è¡Œä¸ºç”»åƒ.UserID
LEFT JOIN (ä»·å€¼ç”»åƒ) ON åŸºç¡€ç”»åƒ.UserID = ä»·å€¼ç”»åƒ.UserID;

///$tab æµå¤±é¢„è­¦
æµå¤±é¢„è­¦:
LOAD
    UserID,
    UserName,
    ç”¨æˆ·ä»·å€¼ç­‰çº§,
    æœ€è¿‘æ´»è·ƒå¤©æ•°,
    å¹³å‡è®¢å•é‡‘é¢,
    // æµå¤±é£é™©è¯„åˆ†
    (
        IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 90, 0.4, 0) +
        IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 180, 0.3, 0) +
        IF(å¹³å‡è®¢å•é‡‘é¢ < 100, 0.2, 0) +
        IF(ç”¨æˆ·ä»·å€¼ç­‰çº§ = 'æ½œåœ¨å®¢æˆ·', 0.1, 0)
    ) * 100 as æµå¤±é£é™©è¯„åˆ†,
    // é£é™©ç­‰çº§
    IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 180, 'é«˜é£é™©',
       IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 90, 'ä¸­é£é™©', 'ä½é£é™©')) as æµå¤±é£é™©ç­‰çº§,
    // æŒ½å›å»ºè®®
    IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 180, 'ç´§æ€¥æŒ½å›',
       IF(æœ€è¿‘æ´»è·ƒå¤©æ•° > 90, 'ä¸»åŠ¨è§¦è¾¾', 'ä¿æŒå…³æ³¨')) as æŒ½å›ç­–ç•¥
    
RESIDENT åŸºç¡€ç”»åƒ
LEFT JOIN (è¡Œä¸ºç”»åƒ) ON åŸºç¡€ç”»åƒ.UserID = è¡Œä¸ºç”»åƒ.UserID
LEFT JOIN (ä»·å€¼ç”»åƒ) ON åŸºç¡€ç”»åƒ.UserID = ä»·å€¼ç”»åƒ.UserID;

///$tab ä¸ªæ€§åŒ–æ¨è
ä¸ªæ€§åŒ–æ¨è:
LOAD
    UserID,
    // å•†å“åå¥½
    FirstSortedValue(ProductCategory, -Count(ProductID)) as åå¥½å“ç±»,
    Avg(Rating) as å¹³å‡è¯„åˆ†åå¥½,
    // ä»·æ ¼æ•æ„Ÿåº¦
    IF(Avg(UnitPrice) < 100, 'ä»·æ ¼æ•æ„Ÿ',
       IF(Avg(UnitPrice) < 500, 'ä»·æ ¼é€‚ä¸­', 'ä»·æ ¼ä¸æ•æ„Ÿ')) as ä»·æ ¼åå¥½,
    // æ—¶é—´åå¥½
    FirstSortedValue(Hour(OrderTime), -Count(OrderTime)) as è´­ä¹°æ—¶é—´åå¥½,
    // æ¨èç­–ç•¥
    IF(ä»·æ ¼åå¥½ = 'ä»·æ ¼æ•æ„Ÿ', 'æ¨èä¿ƒé”€å•†å“',
       IF(åå¥½å“ç±» = 'ç”µå­äº§å“', 'æ¨èæ–°å“', 'æ¨èçƒ­é”€')) as æ¨èç­–ç•¥
    
RESIDENT è®¢å•æ•°æ®
LEFT JOIN (å•†å“ç»´åº¦) ON è®¢å•æ•°æ®.ProductID = å•†å“ç»´åº¦.ProductID
GROUP BY UserID;
```

---

## 12.5 å®æ—¶ç›‘æ§å¤§å±é¡¹ç›®

### 12.5.1 é¡¹ç›®éœ€æ±‚

**ä¸šåŠ¡èƒŒæ™¯**:
å¤§å‹åˆ¶é€ ä¼ä¸šéœ€è¦å®æ—¶ç›‘æ§ç”Ÿäº§è¿è¥çŠ¶æ€ï¼Œæ”¯æŒå¿«é€Ÿå†³ç­–ã€‚

**ç›‘æ§ç›®æ ‡**:
1. ç”Ÿäº§å®æ—¶çŠ¶æ€
2. è®¾å¤‡è¿è¡Œç›‘æ§
3. è´¨é‡å¼‚å¸¸é¢„è­¦
4. èƒ½æºæ¶ˆè€—ç®¡ç†
5. å®‰å…¨ç¯å¢ƒç›‘æµ‹

**æŠ€æœ¯è¦æ±‚**:
- å®æ—¶æ•°æ®æ¥å…¥
- ç§’çº§åˆ·æ–°
- å¤§å±å±•ç¤ºä¼˜åŒ–
- å¼‚å¸¸è‡ªåŠ¨æŠ¥è­¦
- ç§»åŠ¨ç«¯é€‚é…

### 12.5.2 å®æ—¶æ•°æ®æ¶æ„

```qlik
// 1. å®æ—¶æ•°æ®æ¥å…¥

///$tab æ•°æ®æºé…ç½®
// IoTè®¾å¤‡æ•°æ® (é€šè¿‡REST API)
LIB CONNECT TO 'IoT_Platform';

// å®æ—¶ç”Ÿäº§æ•°æ®
å®æ—¶ç”Ÿäº§æ•°æ®:
SQL SELECT 
    EquipmentID,
    ProductID,
    ProductionCount,
    DefectCount,
    Runtime,
    Status,
    Timestamp
FROM RealTimeProduction
WHERE Timestamp >= DATEADD(minute, -5, GETDATE());

// è®¾å¤‡çŠ¶æ€æ•°æ®
è®¾å¤‡çŠ¶æ€æ•°æ®:
SQL SELECT 
    EquipmentID,
    Temperature,
    Pressure,
    Vibration,
    PowerConsumption,
    Status as EquipmentStatus,
    LastUpdate
FROM EquipmentStatus
WHERE LastUpdate >= DATEADD(minute, -5, GETDATE());

// è´¨é‡æ£€æµ‹æ•°æ®
è´¨é‡æ£€æµ‹æ•°æ®:
SQL SELECT 
    BatchID,
    ProductID,
    InspectionTime,
    InspectionResult,
    DefectType,
    DefectCount,
    Inspector
FROM QualityInspection
WHERE InspectionTime >= DATEADD(minute, -10, GETDATE());

///$tab å®æ—¶æŒ‡æ ‡è®¡ç®—
// ç”Ÿäº§å®æ—¶æŒ‡æ ‡
ç”Ÿäº§å®æ—¶æŒ‡æ ‡:
LOAD
    EquipmentID,
    ProductID,
    // äº§é‡æŒ‡æ ‡
    Sum(ProductionCount) as å®æ—¶äº§é‡,
    Sum(DefectCount) as å®æ—¶ä¸è‰¯å“æ•°,
    Sum(DefectCount) / Sum(ProductionCount) as å®æ—¶ä¸è‰¯ç‡,
    // æ•ˆç‡æŒ‡æ ‡
    Sum(Runtime) as å®æ—¶è¿è¡Œæ—¶é—´,
    Sum(ProductionCount) / Sum(Runtime) * 3600 as å®æ—¶äº§èƒ½,
    // çŠ¶æ€ç›‘æ§
    FirstSortedValue(Status, -Timestamp) as æœ€æ–°çŠ¶æ€,
    Max(Timestamp) as æœ€åæ›´æ–°æ—¶é—´,
    // å¼‚å¸¸æ£€æµ‹
    IF(Sum(DefectCount) / Sum(ProductionCount) > 0.05, 'è´¨é‡å¼‚å¸¸',
       IF(FirstSortedValue(Status, -Timestamp) = 'Down', 'è®¾å¤‡åœæœº', 'æ­£å¸¸')) as å¼‚å¸¸çŠ¶æ€
    
RESIDENT å®æ—¶ç”Ÿäº§æ•°æ®
GROUP BY EquipmentID, ProductID;

// è®¾å¤‡å¥åº·æŒ‡æ ‡
è®¾å¤‡å¥åº·æŒ‡æ ‡:
LOAD
    EquipmentID,
    // å‚æ•°ç›‘æ§
    Avg(Temperature) as å¹³å‡æ¸©åº¦,
    Max(Temperature) as æœ€é«˜æ¸©åº¦,
    Avg(Pressure) as å¹³å‡å‹åŠ›,
    Avg(Vibration) as å¹³å‡æŒ¯åŠ¨,
    Sum(PowerConsumption) as æ€»è€—ç”µé‡,
    // å¥åº·çŠ¶æ€
    FirstSortedValue(EquipmentStatus, -LastUpdate) as è®¾å¤‡çŠ¶æ€,
    IF(Avg(Temperature) > 80, 'é«˜æ¸©è­¦å‘Š',
       IF(Avg(Vibration) > 10, 'æŒ¯åŠ¨å¼‚å¸¸',
          IF(FirstSortedValue(EquipmentStatus, -LastUpdate) = 'Warning', 'æ³¨æ„çŠ¶æ€', 'æ­£å¸¸'))) as å¥åº·çŠ¶æ€,
    // ç»´æŠ¤é¢„è­¦
    IF(LastUpdate < DATEADD(hour, -24, NOW()), 'éœ€ç»´æŠ¤', 'æ­£å¸¸') as ç»´æŠ¤çŠ¶æ€
    
RESIDENT è®¾å¤‡çŠ¶æ€æ•°æ®
GROUP BY EquipmentID;
```

### 12.5.3 ç›‘æ§å¤§å±è®¾è®¡

```qlik
// 1. å®æ—¶ç›‘æ§å¤§å±

///$tab ç”Ÿäº§æ€»è§ˆ
// å®æ—¶äº§é‡KPI
å®æ—¶äº§é‡_KPI:
// è¡¨è¾¾å¼: Sum(å®æ—¶äº§é‡)
// æ ¼å¼: '#,##0'
// è¶‹åŠ¿: ä¸ä¸Šä¸€å‘¨æœŸå¯¹æ¯”

// å®æ—¶ä¸è‰¯ç‡KPI
å®æ—¶ä¸è‰¯ç‡_KPI:
// è¡¨è¾¾å¼: Sum(å®æ—¶ä¸è‰¯å“æ•°) / Sum(å®æ—¶äº§é‡)
// æ ¼å¼: '#,##0.00%'
// é¢œè‰²: æ ¹æ®é˜ˆå€¼å˜åŒ–

// è®¾å¤‡åˆ©ç”¨ç‡KPI
è®¾å¤‡åˆ©ç”¨ç‡_KPI:
// è¡¨è¾¾å¼: Sum(è¿è¡Œæ—¶é—´) / Sum(è®¡åˆ’æ—¶é—´)
// æ ¼å¼: '#,##0.0%'
// ç›®æ ‡: 85%

// OEEæŒ‡æ ‡
OEE_KPI:
// è¡¨è¾¾å¼: Availability * Performance * Quality
// æ ¼å¼: '#,##0.0%'
// ç›®æ ‡: 80%

///$tab ç”Ÿäº§çº¿ç›‘æ§
// ç”Ÿäº§çº¿çŠ¶æ€çŸ©é˜µ
ç”Ÿäº§çº¿çŠ¶æ€:
// ç»´åº¦: LineID, ProductID
// é¢œè‰²: æ ¹æ®çŠ¶æ€(æ­£å¸¸/è­¦å‘Š/å¼‚å¸¸)
// ç±»å‹: çŠ¶æ€çŸ©é˜µå›¾

// äº§é‡è¶‹åŠ¿å›¾
äº§é‡è¶‹åŠ¿:
// ç»´åº¦: Timestamp (5åˆ†é’Ÿé—´éš”)
// åº¦é‡: Sum(å®æ—¶äº§é‡)
// ç±»å‹: å®æ—¶æŠ˜çº¿å›¾

// ä¸è‰¯ç‡ç›‘æ§
ä¸è‰¯ç‡ç›‘æ§:
// ç»´åº¦: ProductID
// åº¦é‡: å®æ—¶ä¸è‰¯ç‡
// ç±»å‹: ä»ªè¡¨ç›˜

///$tab è®¾å¤‡ç›‘æ§
// è®¾å¤‡çŠ¶æ€é¢æ¿
è®¾å¤‡çŠ¶æ€é¢æ¿:
// ç»´åº¦: EquipmentID
// æŒ‡æ ‡: æ¸©åº¦ã€å‹åŠ›ã€æŒ¯åŠ¨ã€åŠŸç‡
// ç±»å‹: å¤šæŒ‡æ ‡å¡ç‰‡

// è®¾å¤‡å¥åº·åº¦
è®¾å¤‡å¥åº·åº¦:
// ç»´åº¦: EquipmentID
// åº¦é‡: å¥åº·çŠ¶æ€è¯„åˆ†
// ç±»å‹: é›·è¾¾å›¾

// ç»´æŠ¤é¢„è­¦
ç»´æŠ¤é¢„è­¦åˆ—è¡¨:
// ç»´åº¦: EquipmentID, ç»´æŠ¤çŠ¶æ€, æœ€åç»´æŠ¤æ—¶é—´
// ç±»å‹: é¢„è­¦è¡¨æ ¼

///$tab è´¨é‡ç›‘æ§
// è´¨é‡è¶‹åŠ¿
è´¨é‡è¶‹åŠ¿:
// ç»´åº¦: InspectionTime (å°æ—¶)
// åº¦é‡: Avg(InspectionResult)
// ç±»å‹: æ§åˆ¶å›¾

// ç¼ºé™·åˆ†æ
ç¼ºé™·åˆ†æ:
// ç»´åº¦: DefectType
// åº¦é‡: Sum(DefectCount)
// ç±»å‹: å¸•ç´¯æ‰˜å›¾

// æ£€éªŒå‘˜ç»©æ•ˆ
æ£€éªŒå‘˜ç»©æ•ˆ:
// ç»´åº¦: Inspector
// åº¦é‡: æ£€éªŒæ‰¹æ¬¡, åˆæ ¼ç‡
// ç±»å‹: æ•£ç‚¹å›¾

///$tab å¼‚å¸¸å‘Šè­¦
// å®æ—¶å‘Šè­¦
å®æ—¶å‘Šè­¦:
// ç»´åº¦: å¼‚å¸¸ç±»å‹, å¼‚å¸¸æ—¶é—´, è®¾å¤‡/äº§å“
// åº¦é‡: å¼‚å¸¸çº§åˆ«
// ç±»å‹: æ»šåŠ¨å‘Šè­¦åˆ—è¡¨

// å‘Šè­¦è¶‹åŠ¿
å‘Šè­¦è¶‹åŠ¿:
// ç»´åº¦: æ—¶é—´(å°æ—¶), å¼‚å¸¸ç±»å‹
// åº¦é‡: å‘Šè­¦æ¬¡æ•°
// ç±»å‹: çƒ­åŠ›å›¾

// MTTR/MTBFåˆ†æ
ç»´æŠ¤æŒ‡æ ‡:
// ç»´åº¦: EquipmentID
// æŒ‡æ ‡: MTTR, MTBF
// ç±»å‹: æŒ‡æ ‡å¡
```

### 12.5.4 è‡ªåŠ¨åŒ–å‘Šè­¦

```qlik
// 1. å‘Šè­¦è§„åˆ™å¼•æ“

///$tab å‘Šè­¦è§„åˆ™
å‘Šè­¦è§„åˆ™:
LOAD * INLINE [
    RuleID, RuleName, RuleCondition, AlertLevel, AlertChannel, AlertTemplate
    PR001, äº§é‡å¼‚å¸¸, å®æ—¶äº§é‡<ç›®æ ‡äº§é‡*0.8, HIGH, SMS+Email, "ç”Ÿäº§çº¿{LineID}äº§é‡å¼‚å¸¸ï¼Œå½“å‰äº§é‡{Current}ï¼Œç›®æ ‡äº§é‡{Target}"
    PR002, è´¨é‡å¼‚å¸¸, å®æ—¶ä¸è‰¯ç‡>0.05, HIGH, SMS+Email, "äº§å“è´¨é‡å¼‚å¸¸ï¼Œä¸è‰¯ç‡{Rate}è¶…è¿‡é˜ˆå€¼"
    PR003, è®¾å¤‡åœæœº, è®¾å¤‡çŠ¶æ€='Down', HIGH, SMS+Email, "è®¾å¤‡{EquipmentID}åœæœºï¼Œè¯·åŠæ—¶å¤„ç†"
    PR004, å‚æ•°è¶…é™, æ¸©åº¦>85 OR å‹åŠ›>100, MEDIUM, Email, "è®¾å¤‡{EquipmentID}å‚æ•°è¶…é™ï¼Œè¯·æ£€æŸ¥"
    PR005, ç»´æŠ¤æé†’, æœ€åç»´æŠ¤æ—¶é—´>30å¤©, LOW, Email, "è®¾å¤‡{EquipmentID}è¶…è¿‡30å¤©æœªç»´æŠ¤ï¼Œè¯·å®‰æ’"
];

///$tab å‘Šè­¦æ‰§è¡Œ
SUB ExecuteAlerts()
    
    // æ£€æŸ¥å„ç±»å‹å‘Šè­¦
    FOR i = 1 TO NoOfRows('å‘Šè­¦è§„åˆ™')
        
        LET vRuleID = Peek('RuleID', i-1, 'å‘Šè­¦è§„åˆ™');
        LET vRuleCondition = Peek('RuleCondition', i-1, 'å‘Šè­¦è§„åˆ™');
        LET vAlertLevel = Peek('AlertLevel', i-1, 'å‘Šè­¦è§„åˆ™');
        LET vAlertChannel = Peek('AlertChannel', i-1, 'å‘Šè­¦è§„åˆ™');
        LET vAlertTemplate = Peek('AlertTemplate', i-1, 'å‘Šè­¦è§„åˆ™');
        
        // æ‰§è¡Œæ¡ä»¶æ£€æŸ¥
        å‘Šè­¦æ£€æŸ¥:
        LOAD
            è®¾å¤‡ID,
            äº§å“ID,
            å½“å‰å€¼,
            é˜ˆå€¼,
            '$(vRuleID)' as RuleID
        FROM å®æ—¶æ•°æ®
        WHERE $(vRuleCondition);
        
        // å¦‚æœæœ‰å‘Šè­¦
        IF NoOfRows('å‘Šè­¦æ£€æŸ¥') > 0 THEN
            
            // è®°å½•å‘Šè­¦
            å‘Šè­¦æ—¥å¿—:
            LOAD
                Now() as å‘Šè­¦æ—¶é—´,
                '$(vRuleID)' as RuleID,
                RuleName,
                å‘Šè­¦çº§åˆ«,
                å‘Šè­¦å†…å®¹,
                å¤„ç†çŠ¶æ€
            RESIDENT å‘Šè­¦æ£€æŸ¥
            LEFT JOIN (å‘Šè­¦è§„åˆ™) ON å‘Šè­¦æ£€æŸ¥.RuleID = å‘Šè­¦è§„åˆ™.RuleID;
            
            // å‘é€å‘Šè­¦
            CALL SendAlert(vAlertChannel, vAlertTemplate);
            
        END IF
        
        DROP Table å‘Šè­¦æ£€æŸ¥;
        
    NEXT i
    
END SUB

// 2. å‘Šè­¦é€šçŸ¥
SUB SendAlert(vChannel, vTemplate)
    
    // è§£æé€šçŸ¥æ¸ é“
    IF Index(vChannel, 'SMS') > 0 THEN
        CALL SendSMS(vTemplate);
    END IF
    
    IF Index(vChannel, 'Email') > 0 THEN
        CALL SendEmail(vTemplate);
    END IF
    
    IF Index(vChannel, 'WeChat') > 0 THEN
        CALL SendWeChat(vTemplate);
    END IF
    
END SUB
```

---

## 12.6 é¡¹ç›®éƒ¨ç½²å’Œè¿ç»´

### 12.6.1 éƒ¨ç½²æ¶æ„

```qlik
// 1. ä¼ä¸šçº§éƒ¨ç½²æ–¹æ¡ˆ

///$tab éƒ¨ç½²ç¯å¢ƒ
// ç”Ÿäº§ç¯å¢ƒ
ç”Ÿäº§ç¯å¢ƒ:
LOAD * INLINE [
    Component, Server, Port, Description
    Repository, prod-qlik-repo, 443, "å…ƒæ•°æ®ç®¡ç†"
    Proxy, prod-qlik-proxy, 443, "ç”¨æˆ·è®¿é—®å…¥å£"
    Engine, prod-qlik-engine1, 4747, "è®¡ç®—å¼•æ“1"
    Engine, prod-qlik-engine2, 4747, "è®¡ç®—å¼•æ“2"
    Scheduler, prod-qlik-scheduler, 443, "ä»»åŠ¡è°ƒåº¦"
    Edge, prod-qlik-edge, 80, "è¾¹ç¼˜ç¼“å­˜"
];

// ç¾å¤‡ç¯å¢ƒ
ç¾å¤‡ç¯å¢ƒ:
LOAD * INLINE [
    Component, Server, Port, Description
    Repository, dr-qlik-repo, 443, "ç¾å¤‡å…ƒæ•°æ®"
    Proxy, dr-qlik-proxy, 443, "ç¾å¤‡è®¿é—®å…¥å£"
    Engine, dr-qlik-engine, 4747, "ç¾å¤‡è®¡ç®—å¼•æ“"
];

///$tab è´Ÿè½½å‡è¡¡
// è´Ÿè½½å‡è¡¡é…ç½®
è´Ÿè½½å‡è¡¡:
LOAD * INLINE [
    Service, VIP, Port, Algorithm, HealthCheck
    QlikSense, 192.168.1.100, 443, "RoundRobin", "/health"
    Engine, 192.168.1.101, 4747, "LeastConn", "/engine/health"
    Scheduler, 192.168.1.102, 443, "SourceIP", "/scheduler/health"
];

///$tab ç›‘æ§é…ç½®
// ç³»ç»Ÿç›‘æ§
ç³»ç»Ÿç›‘æ§:
LOAD * INLINE [
    Metric, Threshold, AlertLevel, MonitoringTool
    CPUä½¿ç”¨ç‡, 80%, HIGH, "Zabbix"
    å†…å­˜ä½¿ç”¨ç‡, 85%, HIGH, "Zabbix"
    ç£ç›˜ä½¿ç”¨ç‡, 90%, CRITICAL, "Zabbix"
    åº”ç”¨å“åº”æ—¶é—´, 5s, MEDIUM, "Prometheus"
    ç”¨æˆ·å¹¶å‘æ•°, 1000, HIGH, "Qlik Sense Logs"
];
```

### 12.6.2 æ€§èƒ½ä¼˜åŒ–

```qlik
// 1. é¡¹ç›®æ€§èƒ½ä¼˜åŒ–

///$tab æ•°æ®å±‚ä¼˜åŒ–
// QVDåˆ†å±‚ç­–ç•¥
QVDç­–ç•¥:
LOAD * INLINE [
    Layer, Data_Type, Refresh_Frequency, Storage_Location
    L1_Raw, åŸå§‹æ•°æ®, å®æ—¶/å°æ—¶, "/data/raw/"
    L2_Cleaned, æ¸…æ´—æ•°æ®, æ—¥, "/data/cleaned/"
    L3_Aggregated, èšåˆæ•°æ®, æ—¥/å‘¨, "/data/aggregated/"
    L4_Summary, æ±‡æ€»æ•°æ®, æœˆ, "/data/summary/"
];

// æ•°æ®åˆ†åŒº
æ•°æ®åˆ†åŒº:
LOAD
    *,
    // æŒ‰å¹´åˆ†åŒº
    Year(OrderDate) as YearPartition,
    // æŒ‰æœˆåˆ†åŒº
    Year(OrderDate) & '-' & Num(Month(OrderDate), '00') as MonthPartition,
    // æŒ‰ä¸šåŠ¡åˆ†åŒº
    BusinessUnit as BusinessPartition
    
FROM å¤§æ•°æ®è¡¨;

///$tab åº”ç”¨å±‚ä¼˜åŒ–
// å¯¹è±¡ä¼˜åŒ–
å¯¹è±¡ä¼˜åŒ–:
LOAD * INLINE [
    Object_Type, Optimization_Strategy, Performance_Impact
    Chart, ç»´åº¦é™åˆ¶+èšåˆä¼˜åŒ–, é«˜
    Table, åˆ†é¡µ+è™šæ‹Ÿæ»šåŠ¨, ä¸­
    KPI, å˜é‡ç¼“å­˜+ç®€åŒ–è¡¨è¾¾å¼, é«˜
    Filter, é¢„è®¡ç®—+ç´¢å¼•ä¼˜åŒ–, ä¸­
];

// è¡¨è¾¾å¼ä¼˜åŒ–
è¡¨è¾¾å¼ä¼˜åŒ–:
LOAD * INLINE [
    Optimization_Type, Before, After, Performance_Gain
    å˜é‡ç¼“å­˜, Sum(Aggr(Sum(Amount), Customer)), LET vTotal = Sum(Aggr(Sum(Amount), Customer)); $(vTotal), 30-50%
    é›†åˆåˆ†æ, Sum({<Year={2024}>} Amount), Sum({1<Year={2024}>} Amount), 20-30%
    é¢„èšåˆ, Aggr(Sum(Amount), Customer, Product), ä½¿ç”¨é¢„è®¡ç®—è¡¨, 50-70%
];
```

### 12.6.3 è¿ç»´ç®¡ç†

```qlik
// 1. è¿ç»´ç®¡ç†æµç¨‹

///$tab å˜æ›´ç®¡ç†
å˜æ›´ç®¡ç†æµç¨‹:
LOAD * INLINE [
    Phase, Activities, Responsible, Timeline, Deliverables
    è®¡åˆ’, éœ€æ±‚åˆ†æã€å½±å“è¯„ä¼°, é¡¹ç›®ç»ç†, 1-2å¤©, å˜æ›´è¯·æ±‚
    å¼€å‘, åŠŸèƒ½å¼€å‘ã€å•å…ƒæµ‹è¯•, å¼€å‘å›¢é˜Ÿ, 3-5å¤©, å¼€å‘ç‰ˆæœ¬
    æµ‹è¯•, é›†æˆæµ‹è¯•ã€ç”¨æˆ·éªŒæ”¶, æµ‹è¯•å›¢é˜Ÿ, 2-3å¤©, æµ‹è¯•æŠ¥å‘Š
    éƒ¨ç½², ç”Ÿäº§éƒ¨ç½²ã€éªŒè¯, è¿ç»´å›¢é˜Ÿ, 1å¤©, éƒ¨ç½²æŠ¥å‘Š
    ç›‘æ§, æ€§èƒ½ç›‘æ§ã€é—®é¢˜è·Ÿè¸ª, è¿ç»´å›¢é˜Ÿ, æŒç»­, è¿è¡ŒæŠ¥å‘Š
];

///$tab å¤‡ä»½æ¢å¤
å¤‡ä»½ç­–ç•¥:
LOAD * INLINE [
    Data_Type, Backup_Frequency, Retention_Period, Storage_Location, Recovery_Time
    åº”ç”¨æ•°æ®, æ—¥, 30å¤©, "/backup/app/", 1å°æ—¶
    ç³»ç»Ÿé…ç½®, å‘¨, 90å¤©, "/backup/config/", 2å°æ—¶
    ç”¨æˆ·å†…å®¹, æ—¥, 7å¤©, "/backup/content/", 30åˆ†é’Ÿ
    æ—¥å¿—æ•°æ®, å®æ—¶, 365å¤©, "/backup/logs/", 4å°æ—¶
];

///$tab æ•…éšœå¤„ç†
æ•…éšœå¤„ç†æµç¨‹:
LOAD * INLINE [
    Severity, Response_Time, Resolution_Time, Escalation_Level
    CRITICAL, 15åˆ†é’Ÿ, 2å°æ—¶, Level3
    HIGH, 1å°æ—¶, 8å°æ—¶, Level2
    MEDIUM, 4å°æ—¶, 24å°æ—¶, Level1
    LOW, 1ä¸ªå·¥ä½œæ—¥, 72å°æ—¶, Level1
];
```

---

## 12.7 è¯¾åå®è·µé¡¹ç›®

### é¡¹ç›®1: ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æ

**ä»»åŠ¡**: ä¸ºæŸç”µå•†å¹³å°æ„å»ºç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿ
- å®ç°ç”¨æˆ·ç”»åƒæ„å»º
- åˆ†æè´­ä¹°è½¬åŒ–æ¼æ–—
- è®¾è®¡ä¸ªæ€§åŒ–æ¨èç®—æ³•
- å»ºç«‹æµå¤±é¢„è­¦æœºåˆ¶

### é¡¹ç›®2: åˆ¶é€ ä¸šè´¨é‡ç®¡æ§

**ä»»åŠ¡**: ä¸ºåˆ¶é€ ä¼ä¸šå¼€å‘è´¨é‡ç®¡æ§ç³»ç»Ÿ
- å®ç°SPCè´¨é‡æ§åˆ¶
- æ„å»ºè´¨é‡è¿½æº¯ä½“ç³»
- è®¾è®¡å¼‚å¸¸æ£€æµ‹ç®—æ³•
- å»ºç«‹è´¨é‡æ”¹è¿›å»ºè®®

### é¡¹ç›®3: é‡‘èé£æ§ç›‘æ§

**ä»»åŠ¡**: ä¸ºé‡‘èæœºæ„å¼€å‘é£æ§ç›‘æ§ç³»ç»Ÿ
- å®ç°äº¤æ˜“å¼‚å¸¸æ£€æµ‹
- æ„å»ºå®¢æˆ·é£é™©ç”»åƒ
- è®¾è®¡å®æ—¶é¢„è­¦æœºåˆ¶
- å»ºç«‹åˆè§„æŠ¥å‘Šä½“ç³»

---

## 12.8 æœ¬ç« å°ç»“

### æ ¸å¿ƒæ”¶è·

âœ… **é¡¹ç›®å®æˆ˜èƒ½åŠ›**: æŒæ¡å®Œæ•´é¡¹ç›®å¼€å‘æµç¨‹  
âœ… **ä¸šåŠ¡ç†è§£æ·±åº¦**: æ·±å…¥ç†è§£å„è¡Œä¸šä¸šåŠ¡éœ€æ±‚  
âœ… **æŠ€æœ¯åº”ç”¨å¹¿åº¦**: ç†Ÿç»ƒè¿ç”¨å„ç§QlikæŠ€æœ¯  
âœ… **æ¶æ„è®¾è®¡èƒ½åŠ›**: å…·å¤‡ä¼ä¸šçº§æ¶æ„è®¾è®¡æ€ç»´  
âœ… **é—®é¢˜è§£å†³èƒ½åŠ›**: èƒ½å¤Ÿç‹¬ç«‹è§£å†³å¤æ‚ä¸šåŠ¡é—®é¢˜  

### é¡¹ç›®å¼€å‘æµç¨‹

```mermaid
graph TD
    A[éœ€æ±‚åˆ†æ] --> B[æ•°æ®æ¶æ„è®¾è®¡]
    B --> C[æ•°æ®æ¨¡å‹æ„å»º]
    C --> D[æŒ‡æ ‡ä½“ç³»è®¾è®¡]
    D --> E[å¯è§†åŒ–å¼€å‘]
    E --> F[æµ‹è¯•éªŒè¯]
    F --> G[éƒ¨ç½²ä¸Šçº¿]
    G --> H[è¿ç»´ç›‘æ§]
    H --> A
```

### æŠ€èƒ½ä½“ç³»æ€»ç»“

```qlik
// å®Œæ•´æŠ€èƒ½ä½“ç³»
æŠ€èƒ½ä½“ç³»:
LOAD * INLINE [
    æŠ€èƒ½ç±»åˆ«, æŠ€èƒ½é¡¹, æŒæ¡ç¨‹åº¦, åº”ç”¨åœºæ™¯
    åŸºç¡€æŠ€èƒ½, Qlik Senseç•Œé¢æ“ä½œ, ç²¾é€š, æ—¥å¸¸ä½¿ç”¨
    åŸºç¡€æŠ€èƒ½, æ•°æ®åŠ è½½è„šæœ¬, ç²¾é€š, æ•°æ®æ•´åˆ
    åŸºç¡€æŠ€èƒ½, å›¾è¡¨å¯¹è±¡ä½¿ç”¨, ç²¾é€š, å¯è§†åŒ–è®¾è®¡
    è¿›é˜¶æŠ€èƒ½, Set Analysis, ç²¾é€š, å¤æ‚åˆ†æ
    è¿›é˜¶æŠ€èƒ½, AGGRå‡½æ•°, ç²¾é€š, é«˜çº§è®¡ç®—
    è¿›é˜¶æŠ€èƒ½, Extensionså¼€å‘, ç†Ÿç»ƒ, è‡ªå®šä¹‰åŠŸèƒ½
    æ¶æ„æŠ€èƒ½, æ•°æ®å»ºæ¨¡, ç²¾é€š, æ€§èƒ½ä¼˜åŒ–
    æ¶æ„æŠ€èƒ½, å®‰å…¨è®¾è®¡, ç²¾é€š, æƒé™æ§åˆ¶
    æ¶æ„æŠ€èƒ½, éƒ¨ç½²è¿ç»´, ç†Ÿç»ƒ, ä¼ä¸šå®æ–½
    ä¸šåŠ¡æŠ€èƒ½, é”€å”®åˆ†æ, ç²¾é€š, ä¸šåŠ¡åœºæ™¯
    ä¸šåŠ¡æŠ€èƒ½, è´¢åŠ¡åˆ†æ, ç²¾é€š, ç®¡æ§åœºæ™¯
    ä¸šåŠ¡æŠ€èƒ½, ä¾›åº”é“¾åˆ†æ, ç†Ÿç»ƒ, è¿è¥åœºæ™¯
];
```

### æŒç»­å­¦ä¹ å»ºè®®

1. **å…³æ³¨æ–°æŠ€æœ¯**: è·Ÿè¸ªQlik Senseæ–°ç‰ˆæœ¬ç‰¹æ€§
2. **è¡Œä¸šå­¦ä¹ **: æ·±å…¥äº†è§£ä¸åŒè¡Œä¸šä¸šåŠ¡ç‰¹ç‚¹
3. **æŠ€æœ¯æ‹“å±•**: å­¦ä¹ ç›¸å…³æŠ€æœ¯å¦‚JavaScriptã€Python
4. **ç¤¾åŒºå‚ä¸**: ç§¯æå‚ä¸Qlikç¤¾åŒºäº¤æµ
5. **è®¤è¯è€ƒè¯•**: è€ƒå–Qlik Senseç›¸å…³è®¤è¯

---

## ğŸ“ **æ­å–œå®ŒæˆQlik Senseä¸“å®¶æ•™ç¨‹ï¼**

é€šè¿‡æœ¬æ•™ç¨‹çš„ç³»ç»Ÿå­¦ä¹ ï¼Œæ‚¨å·²ç»å…·å¤‡äº†:

### ğŸ“Š **ä¸“ä¸šèƒ½åŠ›**
- âœ… å®Œæ•´æŒæ¡Qlik Senseä»å…¥é—¨åˆ°ä¸“å®¶çš„æ‰€æœ‰çŸ¥è¯†
- âœ… ç†Ÿç»ƒè¿ç”¨æ•°æ®åŠ è½½ã€è½¬æ¢ã€å»ºæ¨¡æŠ€æœ¯
- âœ… ç²¾é€šè¡¨è¾¾å¼ã€é›†åˆåˆ†æã€é«˜çº§å‡½æ•°
- âœ… å…·å¤‡ä¼ä¸šçº§é¡¹ç›®å¼€å‘å’Œå®æ–½èƒ½åŠ›

### ğŸš€ **å®æˆ˜ç»éªŒ**
- âœ… å®Œæˆ5ä¸ªå®Œæ•´çš„ä¼ä¸šçº§å®æˆ˜é¡¹ç›®
- âœ… æŒæ¡å„è¡Œä¸šä¸šåŠ¡åˆ†ææ–¹æ³•
- âœ… å…·å¤‡å¤æ‚é—®é¢˜è§£å†³èƒ½åŠ›
- âœ… æ‹¥æœ‰å®Œæ•´çš„é¡¹ç›®äº¤ä»˜ç»éªŒ

### ğŸ’¼ **èŒä¸šå‘å±•**
- âœ… å¯èƒœä»»Qlik Senseå¼€å‘å·¥ç¨‹å¸ˆèŒä½
- âœ… å…·å¤‡BIé¡¾é—®å’Œæ¶æ„å¸ˆèƒ½åŠ›
- âœ… èƒ½å¤Ÿç‹¬ç«‹å®Œæˆä¼ä¸šçº§é¡¹ç›®
- âœ… æ‹¥æœ‰æŒç»­å­¦ä¹ å’Œæˆé•¿çš„åŸºç¡€

**æ‚¨ç°åœ¨å·²ç»æ˜¯çœŸæ­£çš„Qlik Senseä¸“å®¶ï¼**

---

[â† ä¸Šä¸€ç« ](./11-ä¼ä¸šçº§åº”ç”¨å¼€å‘.md) | [è¿”å›ç›®å½•](./README.md)
