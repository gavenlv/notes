# 第1章：Qlik Sense概述与环境搭建

> **学习时长**: 6-8小时  
> **难度**: ⭐  
> **前置知识**: 无

## 本章目标

学完本章后,你将能够:

- ✅ 深刻理解Qlik Sense的核心概念和技术架构
- ✅ 掌握Qlik Sense与其他BI工具的区别
- ✅ 成功安装和配置Qlik Sense开发环境
- ✅ 熟悉Qlik Sense界面和基本操作
- ✅ 创建第一个数据应用
- ✅ 理解关联引擎的工作原理

---

## 1.1 Qlik Sense简介

### 1.1.1 什么是Qlik Sense?

**Qlik Sense** 是新一代自助式商业智能(BI)和数据可视化平台,由Qlik公司开发。它采用独特的**关联引擎技术**,能够自动发现数据之间的关系,实现真正的探索性数据分析。

**核心特点**:

```
传统BI工具              →  Qlik Sense
├─ 预定义查询            →  自由探索
├─ 固定报表             →  动态交互
├─ 数据立方体           →  关联数据模型
├─ 复杂SQL             →  直观选择
└─ 被动接收             →  主动探索
```

**Qlik Sense的独特价值**:

1. **关联数据引擎**: 
   - 自动发现数据关联
   - 实时计算聚合
   - 全内存计算,速度极快

2. **自助式分析**:
   - 无需IT支持即可创建分析
   - 拖拽式操作
   - 智能建议

3. **响应式设计**:
   - 自适应任何设备
   - 触控友好
   - 云原生架构

### 1.1.2 Qlik Sense vs QlikView

**QlikView** 是Qlik的上一代产品,两者的主要区别:

| 特性 | QlikView | Qlik Sense |
|------|----------|-----------|
| **定位** | 引导式分析 | 自助式分析 |
| **开发方式** | 脚本+对象 | 可视化拖拽 |
| **部署方式** | 客户端/服务器 | 云原生/混合 |
| **界面设计** | 传统桌面风格 | 现代响应式 |
| **学习曲线** | 较陡峭 | 较平缓 |
| **适用场景** | 企业级复杂应用 | 敏捷分析+企业级 |
| **移动支持** | 有限 | 原生支持 |
| **协作能力** | 有限 | 强大 |

**重要**: Qlik Sense是未来发展方向,本教程专注于Qlik Sense。

### 1.1.3 Qlik Sense vs Power BI vs Tableau

**市场主流BI工具对比**:

| 维度 | Qlik Sense | Power BI | Tableau |
|------|-----------|----------|---------|
| **数据引擎** | 关联引擎(内存) | VertiPaq(内存) | VizQL(查询) |
| **关联发现** | ⭐⭐⭐⭐⭐ 自动 | ⭐⭐⭐ 手动 | ⭐⭐⭐ 手动 |
| **自助式** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **企业级** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **学习难度** | 中等 | 较低 | 中等 |
| **价格** | 较高 | 低 | 较高 |
| **生态系统** | 成熟 | 最丰富(MS) | 成熟 |
| **云能力** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

**Qlik Sense的优势**:
- 🔥 **关联引擎**: 独一无二的技术
- 🚀 **性能**: 全内存计算,速度极快
- 🎯 **探索性分析**: 最适合即席分析
- 🔒 **企业级安全**: Section Access行级安全

---

## 1.2 核心技术原理

### 1.2.1 关联引擎(Associative Engine)

**什么是关联引擎?**

这是Qlik的核心技术,与传统查询引擎完全不同:

```
传统查询引擎:
用户点击 → 生成SQL → 查询数据库 → 返回结果 → 显示
[每次点击都要查询,慢]

Qlik关联引擎:
数据加载 → 全量内存 → 建立索引 → 用户交互 → 实时响应
[一次加载,内存计算,极快]
```

**关联引擎工作流程**:

1. **数据加载阶段**:
   ```
   数据源 → Load脚本 → 数据转换 → 内存存储 → 索引建立
   ```

2. **用户交互阶段**:
   ```
   选择维度值 → 引擎计算关联 → 更新所有对象 → 实时响应
   ```

3. **关联特性**:
   - **绿色**: 与当前选择关联的值
   - **白色**: 未选择但有数据的值  
   - **灰色**: 与选择不关联的值(排除值)

**示例理解**:

假设有销售数据:
```
订单表: 订单ID, 日期, 客户ID, 产品ID, 金额
客户表: 客户ID, 客户名, 城市
产品表: 产品ID, 产品名, 类别
```

当你选择"北京"城市时:
- Qlik自动找到北京的所有客户
- 关联这些客户的所有订单
- 关联这些订单的所有产品
- 所有图表实时更新
- 其他城市变灰(被排除)

这一切都在**毫秒级**完成!

### 1.2.2 内存计算技术

**为什么Qlik Sense这么快?**

1. **列式存储**:
   ```
   传统行式:
   [ID=1, Name=张三, Age=25, City=北京]
   [ID=2, Name=李四, Age=30, City=上海]
   
   Qlik列式:
   ID列: [1, 2]
   Name列: [张三, 李四]
   Age列: [25, 30]
   City列: [北京, 上海]
   
   优势: 压缩率高, 聚合查询快
   ```

2. **符号表(Symbol Tables)**:
   ```
   原始数据: [北京, 上海, 北京, 北京, 上海]
   
   符号表:
   0 → 北京
   1 → 上海
   
   存储: [0, 1, 0, 0, 1]
   
   优势: 大幅压缩, 快速比较
   ```

3. **压缩技术**:
   - 数据压缩率通常达到 90%+
   - 1GB原始数据 → 100MB内存占用
   - 更多数据装入内存

4. **位图索引**:
   ```
   快速筛选和聚合
   时间复杂度: O(1)
   ```

### 1.2.3 数据加载与刷新

**数据流转过程**:

```mermaid
graph LR
    A[数据源] --> B[Load脚本]
    B --> C[数据转换]
    C --> D[内存加载]
    D --> E[索引建立]
    E --> F[QVF文件]
    F --> G[用户访问]
    G --> H[实时交互]
```

**加载方式**:

1. **全量加载**:
   - 每次重新加载所有数据
   - 适合数据量小或数据经常变化

2. **增量加载**:
   - 只加载新增和修改的数据
   - 适合大数据量,提高效率

3. **按需加载(On-Demand)**:
   - 仅在需要时加载详细数据
   - 适合超大数据集

---

## 1.3 Qlik Sense产品版本

### 1.3.1 Qlik Sense Desktop

**特点**:
- ✅ 免费下载使用
- ✅ 个人开发学习
- ✅ 功能完整
- ❌ 不支持协作
- ❌ 仅Windows平台

**适用场景**:
- 学习和培训
- 原型开发
- 个人分析

**限制**:
- 单用户
- 本地存储
- 无法发布共享

### 1.3.2 Qlik Sense Enterprise

**特点**:
- ✅ 企业级部署
- ✅ 多用户协作
- ✅ 完整安全控制
- ✅ 扩展性强
- ✅ 混合云部署

**部署方式**:

1. **Windows部署**:
   - 单节点: 中小企业
   - 多节点集群: 大企业

2. **Qlik Sense Enterprise on Kubernetes**:
   - 容器化部署
   - 云原生
   - 自动扩展

**组件架构**:

```
Qlik Sense Enterprise架构:

用户层:
├─ Hub (主页)
├─ 工作表
└─ 管理控制台(QMC)

服务层:
├─ Engine服务 (计算引擎)
├─ Proxy服务 (代理)
├─ Scheduler服务 (调度)
└─ Repository服务 (元数据)

存储层:
├─ PostgreSQL (元数据库)
└─ 文件共享 (QVF文件)
```

### 1.3.3 Qlik Sense Cloud (SaaS)

**Qlik Sense Business**:
- 纯云端SaaS
- 按用户订阅
- 快速部署
- 自动更新

**Qlik Sense Enterprise SaaS**:
- 企业级云服务
- 更多功能
- 更高性能
- 混合部署

**对比**:

| 功能 | Business | Enterprise SaaS |
|------|----------|----------------|
| 数据容量 | 有限制 | 无限制 |
| 用户数 | 有限制 | 无限制 |
| 数据刷新 | 受限 | 灵活 |
| 安全性 | 基础 | 高级 |
| 扩展开发 | 不支持 | 支持 |
| API访问 | 受限 | 完整 |

---

## 1.4 环境安装

### 1.4.1 Qlik Sense Desktop安装

**系统要求**:

**最低配置**:
- OS: Windows 10/11 (64位)
- CPU: Intel Core i3 或同等级
- RAM: 4GB
- 硬盘: 2GB可用空间

**推荐配置**:
- OS: Windows 10/11 Pro (64位)
- CPU: Intel Core i5/i7 或AMD同等级
- RAM: 16GB+ 
- 硬盘: 10GB+ SSD
- 显示器: 1920x1080+

**安装步骤**:

**步骤1: 下载安装包**

1. 访问Qlik官网: https://www.qlik.com
2. 选择 "Free Download" → "Qlik Sense Desktop"
3. 填写注册信息(需要邮箱)
4. 下载 `Qlik_Sense_Desktop_setup.exe`

**步骤2: 运行安装程序**

```powershell
# 双击安装程序,或命令行运行
.\Qlik_Sense_Desktop_setup.exe
```

安装向导:
1. 欢迎界面 → [下一步]
2. 许可协议 → [我接受] → [下一步]
3. 安装位置 → 默认或自定义 → [下一步]
4. 准备安装 → [安装]
5. 安装进度 → 等待5-10分钟
6. 完成 → [启动Qlik Sense Desktop]

**步骤3: 首次启动**

1. 启动Qlik Sense Desktop
2. 接受条款
3. 界面语言选择(中文/English)
4. 进入Hub主页

**安装验证**:

```powershell
# 检查安装目录
dir "C:\Users\$env:USERNAME\AppData\Local\Programs\Qlik\Sense"

# 检查数据目录
dir "$env:USERPROFILE\Documents\Qlik\Sense\Apps"
```

### 1.4.2 Qlik Sense Enterprise安装

**系统架构**:

```
最小部署 (单节点):
Windows Server 2016/2019/2022
├─ RAM: 32GB+
├─ CPU: 8核+
├─ 硬盘: 100GB+ SSD
└─ 数据库: PostgreSQL

推荐部署 (多节点):
中央节点:
├─ Repository + Proxy + Scheduler
├─ RAM: 32GB
└─ CPU: 8核

引擎节点 (可扩展):
├─ Engine服务
├─ RAM: 64GB+
└─ CPU: 16核+

数据库服务器:
└─ PostgreSQL 单独部署
```

**安装准备**:

1. **准备工作**:
   ```powershell
   # 启用.NET Framework 3.5
   Install-WindowsFeature NET-Framework-Core
   
   # 创建服务账户
   $password = ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force
   New-LocalUser -Name "QlikService" -Password $password
   
   # 配置防火墙规则
   New-NetFirewallRule -Name "Qlik_443" -DisplayName "Qlik HTTPS" `
       -Direction Inbound -Protocol TCP -LocalPort 443 -Action Allow
   ```

2. **安装PostgreSQL**:
   - 下载PostgreSQL 11+
   - 创建数据库: QSR
   - 配置连接

3. **安装Qlik Sense**:
   ```
   1. 运行Qlik_Sense_Enterprise_setup.exe
   2. 选择安装类型: "Central Node"
   3. 配置数据库连接
   4. 设置服务账户
   5. 配置证书(自签名或CA证书)
   6. 完成安装
   ```

**访问QMC**(Qlik Management Console):
```
https://your-server/qmc
```

### 1.4.3 Cloud版本使用

**注册Qlik Cloud**:

1. 访问: https://qlikcloud.com
2. 选择试用版或订阅
3. 创建账户
4. 验证邮箱
5. 登录Qlik Cloud

**创建租户**(Tenant):
- 选择区域(EU/US/AP)
- 命名租户
- 配置设置

**访问方式**:
```
https://your-tenant.qlikcloud.com
```

---

## 1.5 界面导航

### 1.5.1 Hub主页

**Hub界面布局**:

```
┌─────────────────────────────────────────────┐
│  [Qlik Sense]  搜索🔍  [新建] [我的工作] [🔔]│
├─────────────────────────────────────────────┤
│                                             │
│  我的应用                           [全部] │
│  ┌──────┐  ┌──────┐  ┌──────┐            │
│  │App 1 │  │App 2 │  │App 3 │   [+]新建  │
│  └──────┘  └──────┘  └──────┘            │
│                                             │
│  与我共享                                   │
│  ┌──────┐  ┌──────┐                       │
│  │App 4 │  │App 5 │                       │
│  └──────┘  └──────┘                       │
│                                             │
└─────────────────────────────────────────────┘
```

**主要区域**:

1. **顶部导航栏**:
   - Qlik Sense Logo
   - 全局搜索
   - 新建按钮
   - 通知中心
   - 用户菜单

2. **应用区域**:
   - 我的应用
   - 与我共享的应用
   - 收藏的应用
   - 最近使用的应用

3. **操作按钮**:
   - 创建新应用
   - 导入应用
   - 上传数据

### 1.5.2 应用界面

**打开应用后的界面**:

```
┌─────────────────────────────────────────────┐
│  < 返回  [App Name]  📊 工作表  ✏️ 编辑    │
├─────────────────────────────────────────────┤
│  工作表导航:                                │
│  [概览] [销售分析] [产品分析] [+ 新建]     │
├─────────────────────────────────────────────┤
│                                             │
│  📊 销售总额        📊 订单数量            │
│  ┌─────────────┐    ┌─────────────┐       │
│  │  ¥1,234,567│    │    1,234    │       │
│  └─────────────┘    └─────────────┘       │
│                                             │
│  📊 销售趋势                                │
│  ┌───────────────────────────────────┐    │
│  │  ▁▃▅▇▇▅▃▁  折线图               │    │
│  └───────────────────────────────────┘    │
│                                             │
└─────────────────────────────────────────────┘
```

**主要模式**:

1. **分析模式** (默认):
   - 查看数据
   - 进行选择
   - 探索分析

2. **编辑模式**:
   - 设计工作表
   - 添加图表
   - 配置属性

3. **数据管理器**:
   - 管理数据源
   - 数据关联
   - 数据预览

4. **数据加载编辑器**:
   - 编写脚本
   - 数据加载
   - 调试

### 1.5.3 关键工具栏

**编辑模式工具栏**:

```
┌────────────────────────────────────────┐
│ 📐 图表  📊 字段  🎨 主题  ⚙️ 高级 │
└────────────────────────────────────────┘

图表:
├─ 条形图
├─ 折线图
├─ 饼图
├─ 表格
├─ KPI
└─ ...更多

字段:
└─ 拖拽字段到可视化

主题:
└─ 颜色方案和样式

高级:
└─ 自定义对象
```

---

## 1.6 创建第一个应用

### 1.6.1 准备示例数据

**创建销售数据CSV文件**:

```csv
# sales_data.csv
日期,产品,销售额,数量,地区
2024-01-01,产品A,1000,10,北京
2024-01-01,产品B,1500,15,上海
2024-01-02,产品A,800,8,北京
2024-01-02,产品C,2000,20,广州
2024-01-03,产品B,1200,12,上海
2024-01-03,产品A,900,9,深圳
2024-01-04,产品C,1800,18,北京
2024-01-05,产品A,1100,11,上海
```

保存到: `code/chapter01/data/sales_data.csv`

### 1.6.2 创建新应用

**步骤1: 创建应用**

1. 在Hub主页点击 **[创建新应用]**
2. 输入应用名称: "我的第一个Qlik应用"
3. 点击 **[创建]**

**步骤2: 添加数据**

1. 进入数据管理器
2. 点击 **[添加数据]**
3. 选择 **[文件和其他来源]**
4. 选择刚创建的CSV文件
5. 预览数据
6. 点击 **[添加数据]**

**步骤3: 关联数据**(此例单表无需关联)

1. 查看数据模型
2. 确认字段类型正确
3. 点击 **[加载数据]**

### 1.6.3 创建第一个可视化

**创建KPI - 总销售额**:

1. 进入工作表编辑模式
2. 从左侧拖拽 **[KPI]** 到画布
3. 在属性面板配置:
   - 度量: `Sum(销售额)`
   - 标签: "总销售额"
4. 调整大小和位置

**创建条形图 - 各产品销售额**:

1. 拖拽 **[条形图]** 到画布
2. 配置:
   - 维度: 产品
   - 度量: `Sum(销售额)`
   - 排序: 按度量降序
3. 设置标题: "产品销售额对比"

**创建折线图 - 销售趋势**:

1. 拖拽 **[折线图]**
2. 配置:
   - 维度: 日期
   - 度量: `Sum(销售额)`
3. 标题: "销售趋势"

**创建饼图 - 地区分布**:

1. 拖拽 **[饼图]**
2. 配置:
   - 维度: 地区
   - 度量: `Sum(销售额)`
3. 显示百分比

### 1.6.4 交互探索

**尝试以下操作**:

1. **点击任意产品**:
   - 观察其他图表如何联动
   - 注意哪些值变绿/灰

2. **多选**:
   - Ctrl+点击选择多个产品
   - 观察结果

3. **清除选择**:
   - 点击 [×] 清除按钮

4. **搜索**:
   - 在维度中搜索特定值

**体验关联引擎的魔力**! 🎉

---

## 1.7 实验:深入理解关联

### 实验1: 关联状态观察

**目标**: 理解绿、白、灰三种状态

**步骤**:

1. 创建列表框显示所有维度
2. 不做任何选择,观察:
   - 所有值都是白色(可选)
3. 选择"北京":
   - "北京"变绿(已选)
   - 相关产品变绿(关联)
   - 不相关的变灰(排除)
4. 再选择"产品A":
   - 双重筛选效果
   - 只显示北京的产品A数据

**代码示例** (创建列表框):

在编辑模式下,使用自定义对象创建列表框,或在数据加载编辑器中:

```qlik
// 已自动加载数据,无需额外代码
// 在可视化中拖拽"过滤窗格"即可
```

### 实验2: 数据模型查看

**步骤**:

1. 点击 [数据模型查看器]
2. 观察:
   - 表结构
   - 字段列表
   - 数据预览
3. 检查字段统计:
   - 唯一值数量
   - 数据分布
   - 空值情况

**模型视图**:

```
Sales_Data表:
├─ 日期 (维度)
├─ 产品 (维度)
├─ 销售额 (度量)
├─ 数量 (度量)
└─ 地区 (维度)

字段统计:
产品: 3个唯一值
地区: 4个唯一值
日期: 5个唯一值
```

---

## 1.8 常见问题排查

### 1.8.1 安装问题

**问题1: 安装失败**

```
错误: "无法安装.NET Framework"

解决方案:
1. 手动安装.NET Framework 4.7.2+
2. 下载地址: microsoft.com/dotnet
3. 重启后重新安装Qlik Sense
```

**问题2: 启动失败**

```
错误: "Qlik Sense Desktop无法启动"

解决方案:
1. 检查防火墙设置
2. 以管理员身份运行
3. 检查端口4848是否被占用:
   netstat -ano | findstr 4848
4. 重新安装
```

### 1.8.2 数据加载问题

**问题: CSV文件无法加载**

```
错误: "无法解析文件"

解决方案:
1. 检查文件编码(推荐UTF-8)
2. 检查分隔符(逗号/制表符)
3. 检查文件路径中文字符
4. 使用数据加载编辑器手动加载:

LOAD
    日期,
    产品,
    销售额,
    数量,
    地区
FROM [lib://DataFiles/sales_data.csv]
(txt, utf8, embedded labels, delimiter is ',');
```

### 1.8.3 性能问题

**应用打开缓慢**:

```
原因: 数据量过大

优化方案:
1. 使用QVD文件
2. 增量加载
3. 减少不必要字段
4. 优化数据模型
```

---

## 1.9 课后练习

### 练习1: 环境配置

**任务**:
1. 安装Qlik Sense Desktop
2. 熟悉Hub界面
3. 探索示例应用(如果有)

### 练习2: 创建应用

**任务**:
使用提供的数据创建包含以下内容的应用:
1. 至少3个KPI
2. 2个条形图
3. 1个折线图
4. 1个饼图

**数据**: 使用本章提供的sales_data.csv

### 练习3: 探索关联

**任务**:
1. 在应用中进行各种选择
2. 观察关联状态变化
3. 截图记录不同选择下的界面状态
4. 总结关联引擎的工作方式

---

## 1.10 本章小结

### 核心概念回顾

✅ **Qlik Sense**: 新一代自助式BI平台

✅ **关联引擎**: 独特的技术优势,实时关联计算

✅ **内存计算**: 全量数据内存,极速响应

✅ **产品版本**: Desktop(学习)、Enterprise(企业)、Cloud(云)

✅ **核心特点**: 
- 自动关联
- 探索式分析
- 响应式设计
- 云原生

### 关键操作

```
安装Qlik Sense
    ↓
创建应用
    ↓
添加数据
    ↓
创建可视化
    ↓
探索分析
```

### 技术要点

**关联引擎状态**:
- 🟢 绿色: 已选择或关联
- ⚪ 白色: 可选择
- ⚫ 灰色: 被排除

**数据流程**:
```
数据源 → 加载脚本 → 内存 → 关联引擎 → 可视化
```

### 下一章预告

**第2章 - 数据加载基础**,将深入学习:
- 🔌 各类数据连接器
- 📝 Load脚本语法
- 🔄 数据转换技巧
- 🐛 调试与优化

---

[← 返回目录](./README.md) | [下一章: 数据加载基础 →](./2-数据加载基础.md)

---

**重要提示**: 
- 请确保完成所有练习
- 动手实践是掌握Qlik Sense的关键
- 有问题随时查阅官方文档: https://help.qlik.com

**恭喜完成第1章! 🎉**
