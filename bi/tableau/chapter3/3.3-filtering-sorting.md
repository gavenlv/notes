# 3.3 筛选与排序

## 筛选与排序概述

筛选和排序是数据分析中的基本操作，它们帮助用户聚焦于特定数据子集，并按照特定顺序组织数据，从而更好地发现模式和洞察。本章将详细介绍Tableau中的筛选和排序功能，以及如何有效地应用这些技术来优化数据分析体验。

## 筛选基础

### 筛选的作用

筛选功能允许用户从数据集中选择特定子集，实现以下目标：

1. **聚焦分析**：专注于特定时间段、地区或产品类别
2. **简化视图**：减少数据噪音，突出关键信息
3. **交互探索**：创建动态分析，允许用户实时筛选数据
4. **性能优化**：减少处理的数据量，提高响应速度

### Tableau中的筛选器类型

1. **维度筛选器**
   - 基于维度字段的筛选
   - 适用于类别型数据
   - 包括单选、多选、通配符等类型

2. **度量筛选器**
   - 基于度量字段的筛选
   - 适用于数值型数据
   - 包括值范围、相对值等类型

3. **日期筛选器**
   - 基于日期/时间字段的筛选
   - 包括相对日期、日期范围等类型
   - 支持多种时间粒度

4. **集筛选器**
   - 基于预定义数据集的筛选
   - 条件集或常规集
   - 动态或静态成员

5. **计算筛选器**
   - 基于计算字段或表达式的筛选
   - 可以实现复杂的筛选逻辑
   - 包括布尔表达式和条件逻辑

## 维度筛选器

### 创建维度筛选器

1. **基本筛选方法**
   ```markdown
   1. 将维度字段拖到"筛选器"功能区
   2. 在弹出的对话框中选择筛选类型：
      - 所有值：选择所有可能的值
      - 选择列表：从列表中选择特定值
      - 通配符：使用通配符模式匹配
   3. 点击"确定"应用筛选
   4. 筛选器会显示在筛选器卡片中
   ```

2. **筛选器显示选项**
   ```markdown
   1. 右键点击筛选器卡片
   2. 选择"显示筛选器"
   3. 可以选择显示方式：
      - 单值（下拉列表）
      - 单值（滑块）
      - 多值（列表）
      - 多值（下拉列表）
      - 通配符匹配
   4. 可以设置筛选器标题和外观
   ```

3. **通配符筛选**
   ```markdown
   1. 创建通配符筛选器：
      - 选择字段类型为"通配符"
      - 输入匹配模式：
        - *：匹配任意字符序列
        - ?：匹配任意单个字符
      - 示例："A*"匹配所有以A开头的值
   ```

### 多选与层级筛选

1. **多值选择**
   ```markdown
   1. 在筛选器中启用多选
   2. 可以选择多个值：
      - 列表：勾选多个选项
      - 下拉：Ctrl/Cmd+点击多选
   3. 可以使用"无"、"所有"和"自定义"选项
   ```

2. **层级筛选**
   ```markdown
   1. 创建字段层次结构
   2. 将层次结构字段拖到筛选器
   3. Tableau会创建层级筛选器：
      - 可以逐级筛选
      - 下级筛选受上级筛选限制
   4. 例如：国家 > 州 > 城市
   ```

## 度量筛选器

### 创建度量筛选器

1. **范围筛选**
   ```markdown
   1. 将度量字段拖到"筛选器"功能区
   2. 选择"范围"选项
   3. 设置最小值和最大值
   4. 可以包含或排除边界值
   ```

2. **至少/至多筛选**
   ```markdown
   1. 选择"至少"或"至多"选项
   2. 设置阈值
   3. 筛选出满足条件的记录
   ```

3. **特殊值筛选**
   ```markdown
   1. 选择"特殊值"选项
   2. 可以筛选：
      - 仅空值
      - 仅非空值
      - 所有空值和非空值
   ```

### 顶部/底部筛选

1. **基本前N筛选**
   ```markdown
   1. 将字段拖到筛选器
   2. 选择"顶部"选项
   3. 设置筛选条件：
      - 按字段：选择排序字段
      - 聚合方式：选择聚合函数
      - 数量：输入N值（如前10）
   4. 可以创建"顶部N"或"底部N"筛选
   ```

2. **条件前N筛选**
   ```markdown
   1. 选择"按字段"选项卡
   2. 选择计算方式：
      - 按聚合：基于聚合值筛选
      - 按公式：基于计算表达式筛选
   3. 设置条件和阈值
   ```

## 日期筛选器

### 日期筛选类型

1. **相对日期筛选**
   ```markdown
   1. 将日期字段拖到筛选器
   2. 选择"相对日期"选项
   3. 设置时间范围：
      - 最近：今天、昨天、本周、本月等
      - 过去/将来N天/周/月/年
      - 至今：年初至今、季度至今等
   4. Tableau会动态计算日期范围
   ```

2. **日期范围筛选**
   ```markdown
   1. 选择"范围"选项
   2. 设置开始和结束日期：
      - 固定日期：指定具体日期
      - 动态日期：使用相对值
   3. 可以包含或排除边界日期
   ```

3. **日期值筛选**
   ```markdown
   1. 选择"单个日期"或"单个日期（列表）"
   2. 可以选择特定日期：
      - 列表：从日历选择
      - 下拉：日期选择器
   3. 适合固定的日期集合筛选
   ```

### 日期筛选器显示

1. **日期选择器**
   ```markdown
   1. 选择合适的日期筛选器显示方式：
      - 滑块：适用于连续日期范围
      - 下日历：适用于单个日期选择
      - 列表：适用于离散日期值
   2. 可以自定义显示格式和范围
   ```

2. **相对日期控件**
   ```markdown
   1. 使用相对日期筛选器
   2. 用户可以选择：
      - 时间单位（天、周、月、年）
      - 相对方向（过去、将来）
      - 数量（如"最近7天"）
   3. 提供灵活的时间范围选择
   ```

## 筛选器顺序与执行

### 筛选器执行顺序

Tableau中的筛选器按以下顺序执行：

1. **数据源筛选器**
   - 在数据源层面应用的筛选
   - 影响整个工作簿
   - 执行顺序最高

2. **维度筛选器**
   - 基于维度字段的筛选
   - 在上下文筛选器之后执行

3. **上下文筛选器**
   - 独立处理并创建临时数据子集
   - 其他筛选器基于此子集执行
   - 可以提高性能

4. **度量筛选器**
   - 基于度量字段的筛选
   - 在所有维度筛选之后执行

5. **表计算筛选器**
   - 基于表计算的筛选
   - 执行顺序最低

### 上下文筛选器

1. **创建上下文筛选器**
   ```markdown
   1. 右键点击现有筛选器
   2. 选择"添加到上下文"
   3. 筛选器会变成灰色，表示已成为上下文筛选器
   4. 上下文筛选器会首先执行，创建临时数据集
   ```

2. **上下文筛选器应用场景**
   ```markdown
   1. 性能优化：
      - 减少后续筛选器的数据处理量
      - 适用于大型数据集
   2. 固定比较基准：
      - 如"前10名产品"的筛选基于特定地区
      - 确保比较基准一致
   ```

## 排序基础

### 排序的作用

排序功能允许用户按照特定规则组织数据，实现以下目标：

1. **突出重点**：将重要数据排在前面
2. **比较分析**：按大小或时间顺序比较数据
3. **模式识别**：通过排序发现趋势和异常
4. **提高可读性**：有序的数据更易于理解和分析

### Tableau中的排序类型

1. **默认排序**
   - 按字母或数字顺序排序
   - 由Tableau自动应用
   - 可以是升序或降序

2. **手动排序**
   - 用户自定义排序顺序
   - 基于业务逻辑或特定需求
   - 使用对话框设置顺序

3. **计算排序**
   - 基于计算字段或表达式的排序
   - 可以实现复杂的排序逻辑
   - 支持多级排序

4. **嵌套排序**
   - 基于多个字段的排序
   - 先按主字段排序，再按次字段排序
   - 创建层次化的排序结构

## 排序应用

### 基本排序操作

1. **工具栏排序**
   ```markdown
   1. 选择要排序的字段
   2. 点击工具栏中的排序按钮：
      - A-Z：升序排序
      - Z-A：降序排序
   3. Tableau会根据所选字段排序视图
   ```

2. **字段排序**
   ```markdown
   1. 右键点击维度字段
   2. 选择"排序"选项
   3. 设置排序方式：
      - 数据源顺序
      - 字母顺序
      - 手动设置
   4. 可以设置升序或降序
   ```

3. **手动排序**
   ```markdown
   1. 选择"手动设置"排序
   2. 在对话框中拖拽项目调整顺序
   3. 可以使用按钮移动项目
   4. 适用于有特定业务逻辑的排序需求
   ```

### 高级排序技巧

1. **多字段排序**
   ```markdown
   1. 首先按主字段排序
   2. 选择次字段，右键点击"排序"
   3. Tableau会保持主字段排序，在此基础上按次字段排序
   4. 可以创建多级排序结构
   ```

2. **基于度量的排序**
   ```markdown
   1. 右键点击维度字段
   2. 选择"排序"
   3. 选择"字段"选项
   4. 选择排序依据的度量字段和聚合方式
   5. 设置升序或降序
   6. Tableau会根据度量值排序维度项
   ```

3. **计算字段排序**
   ```markdown
   1. 创建计算字段定义排序逻辑
   2. 示例：按销售额增长率排序
      [增长率] = (SUM([当前销售额]) - SUM([上年销售额])) / SUM([上年销售额])
   3. 使用此字段作为排序依据
   4. 可以实现复杂的自定义排序逻辑
   ```

## 筛选与排序结合应用

### 动态排序

1. **基于筛选的排序**
   ```markdown
   1. 创建筛选器限制数据范围
   2. 应用排序仅对筛选后的数据有效
   3. 当筛选条件变化时，排序结果自动更新
   4. 创建交互式分析体验
   ```

2. **动态Top N排序**
   ```markdown
   1. 创建参数控制N值
   2. 使用参数创建动态前N计算
   3. 将计算字段设为筛选器
   4. 创建用户可交互的动态排序
   ```

### 筛选与排序的组合案例

1. **销售业绩分析**
   ```markdown
   1. 筛选特定时间段和区域
   2. 按销售额降序排序产品
   3. 突出表现最佳的产品
   4. 创建交互式业绩仪表盘
   ```

2. **客户行为分析**
   ```markdown
   1. 筛选高价值客户
   2. 按购买频率排序
   3. 识别最活跃的客户
   4. 支持营销决策
   ```

## 筛选器与用户交互

### 筛选器设计原则

1. **直观易用**
   ```markdown
   1. 使用清晰的筛选器标题
   2. 选择合适的筛选器显示类型
   3. 提供默认值减少用户操作
   4. 确保筛选器响应迅速
   ```

2. **逻辑一致**
   ```markdown
   1. 相关筛选器应有逻辑关系
   2. 避免筛选器冲突或矛盾
   3. 使用层级筛选器展示数据层次
   4. 保持筛选器术语一致性
   ```

3. **性能考虑**
   ```markdown
   1. 合理使用上下文筛选器
   2. 避免过多独立筛选器
   3. 使用数据提取提高性能
   4. 考虑数据刷新频率
   ```

### 高级筛选器功能

1. **筛选器操作**
   ```markdown
   1. 在仪表盘中创建筛选器操作
   2. 允许用户通过点击图表元素进行筛选
   3. 创建联动分析体验
   4. 减少筛选器占用的界面空间
   ```

2. **全局筛选器**
   ```markdown
   1. 设置筛选器应用于所有工作表
   2. 在仪表盘中创建全局筛选效果
   3. 保持整个仪表盘的一致性
   4. 减少重复配置
   ```

3. **URL筛选器**
   ```markdown
   1. 使用URL参数传递筛选值
   2. 创建预筛选的仪表盘链接
   3. 支持外部系统集成
   4. 实现深度链接到特定视图
   ```

## 实验练习

为了巩固本章所学知识，请完成以下练习：

1. **基本筛选练习**
   - 创建基于维度、度量和日期的筛选器
   - 尝试不同类型的筛选器显示方式
   - 比较不同筛选器的效果

2. **排序练习**
   - 使用不同方法对数据进行排序
   - 创建基于度量的排序
   - 实现多级排序效果

3. **筛选与排序结合**
   - 创建交互式筛选和排序
   - 设计动态Top N分析
   - 实现筛选器联动效果

4. **高级应用**
   - 创建上下文筛选器
   - 设计层级筛选器
   - 实现URL筛选器功能

通过完成这些练习，您将掌握Tableau中的筛选和排序技术，能够有效地控制和组织数据视图，创建交互式和用户友好的分析体验。