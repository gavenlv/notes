# 7.3 用户与权限管理

## 用户与权限管理概述

Tableau的用户与权限管理系统是确保数据安全、控制内容访问和实现协作分析的核心机制。通过合理的用户角色分配和权限设置，可以确保合适的人员访问合适的内容，同时保护敏感数据不被未授权访问。本章将详细介绍Tableau中的用户管理、角色体系和权限模型。

## 用户体系

### 用户类型

1. **本地用户**
   ```markdown
   1. 特点：
      - 在Tableau系统中直接创建和管理
      - 密码存储在Tableau数据库中
      - 适合小型组织或特定场景
      - 独立于外部认证系统
   
   2. 创建方法：
      - 服务器管理员在Tableau Server中创建
      - 设置用户名、密码和基本信息
      - 分配初始角色和权限
      - 可发送欢迎邮件通知用户
   
   3. 管理方式：
      - 服务器管理员完全管理
      - 密码重置和账户锁定
      - 用户组管理
      - 登录历史和活动监控
   ```

2. **Active Directory用户**
   ```markdown
   1. 特点：
      - 从企业Active Directory同步
      - 使用企业账户登录Tableau
      - 支持单点登录(SSO)
      - 集中管理用户身份
   
   2. 同步方式：
      - 导入AD用户和组
      - 设置同步计划
      - 选择特定OU或组
      - 保留或删除失效用户
   
   3. 管理优势：
      - 统一身份管理
      - 减少管理开销
      - 提高安全性
      - 符合企业IT政策
   ```

3. **外部认证用户**
   ```markdown
   1. SAML认证：
      - 使用SAML 2.0协议
      - 集成企业身份提供商(IdP)
      - 支持联合身份管理
      - 适合大型企业
   
   2. OpenID Connect：
      - 使用OAuth 2.0和OpenID Connect
      - 集成现代身份提供商
      - 支持移动应用访问
      - 提供更灵活的认证选项
   
   3. 配置要点：
      - 设置元数据交换
      - 配置证书和签名
      - 映射用户属性
      - 设置默认角色和站点
   ```

### 用户组管理

1. **组类型**
   ```markdown
   1. 本地组：
      - 在Tableau中直接创建
      - 可以包含本地和AD用户
      - 灵活的权限管理单位
      - 适合特定业务场景
   
   2. Active Directory组：
      - 从AD导入的组
      - 自动保持与AD同步
      - 包含AD中的用户成员
      - 简化大型组织管理
   
   3. 嵌套组：
      - 组内包含其他组
      - 创建层次化的组结构
      - 简化权限分配
      - 提高管理效率
   ```

2. **组管理最佳实践**
   ```markdown
   1. 命名规范：
      - 使用描述性组名
      - 建立统一的命名约定
      - 包含部门或职能信息
      - 避免使用特殊字符
   
   2. 结构设计：
      - 基于业务职能创建组
      - 保持组结构简洁
      - 避免过度嵌套
      - 定期审核组成员
   
   3. 权限分配：
      - 优先使用组而非用户分配权限
      - 创建业务相关的权限模板
      - 定期审核和调整权限
      - 使用角色简化管理
   ```

## 角色体系

### 服务器角色

1. **服务器管理员(Server Administrator)**
   ```markdown
   1. 权限范围：
      - 全系统管理权限
      - 用户和许可证管理
      - 服务器配置和维护
      - 所有内容访问权限
      - 站点创建和管理
   
   2. 典型职责：
      - 服务器安装和配置
      - 用户账户和许可证管理
      - 服务器性能监控
      - 备份和恢复
      - 安全策略制定
   
   3. 安全考虑：
      - 限制服务器管理员数量
      - 使用MFA增强安全性
      - 定期审核管理员活动
      - 分离管理员职责
   ```

2. **站点管理员(Site Administrator)**
   ```markdown
   1. 权限范围：
      - 站点级别管理权限
      - 站点用户和组管理
      - 站点内容权限管理
      - 站点配置设置
      - 数据源连接管理
   
   2. 典型职责：
      - 站点内容组织
      - 用户访问控制
      - 内容权限分配
      - 站点性能监控
      - 用户支持和管理
   
   3. 与服务器管理员区别：
      - 权限仅限特定站点
      - 不能管理服务器级配置
      - 不能创建新站点
      - 不能管理许可证
   ```

### 内容角色

1. **项目负责人(Project Leader)**
   ```markdown
   1. 权限范围：
      - 项目级别管理权限
      - 项目内容管理
      - 项目用户权限设置
      - 项目连接管理
   
   2. 典型职责：
      - 项目内容组织
      - 项目内容质量控制
      - 项目用户访问控制
      - 项目协作协调
   
   3. 权限特点：
      - 继承项目权限
      - 可以修改项目内内容权限
      - 可以管理项目用户和组
      - 不能创建新项目
   ```

2. **发布者(Publisher)**
   ```markdown
   1. 权限范围：
      - 发布内容权限
      - 数据源连接权限
      - 编辑已发布内容
      - 管理自己发布的内容
   
   2. 典型职责：
      - 创建和发布工作簿
      - 管理数据源连接
      - 更新已发布内容
      - 提供内容技术支持
   
   3. 权限限制：
      - 不能修改他人发布的内容
      - 不能管理项目
      - 不能设置权限（除非内容所有者）
      - 不能管理用户
   ```

3. **交互者(Interactor)**
   ```markdown
   1. 权限范围：
      - 查看和交互内容
      - 筛选和下钻权限
      - 添加评论和标记
      - 基本交互权限
   
   2. 典型职责：
      - 数据分析和探索
      - 仪表盘交互使用
      - 添加评论和反馈
      - 参与数据讨论
   
   3. 权限限制：
      - 不能编辑内容
      - 不能发布新内容
      - 不能修改数据源
      - 不能管理权限
   ```

4. **只读用户(Viewer)**
   ```markdown
   1. 权限范围：
      - 仅查看内容权限
      - 无交互权限
      - 查看预定义视图
      - 仅查看权限
   
   2. 典型职责：
      - 查看报表和仪表盘
      - 接收数据更新通知
      - 基础数据消费
   
   3. 权限限制：
      - 不能筛选或下钻
      - 不能编辑内容
      - 不能添加评论
      - 最小权限级别
   ```

### 角色分配原则

1. **最小权限原则**
   ```markdown
   1. 权限最小化：
      - 分配完成任务所需的最小权限
      - 定期审核权限使用情况
      - 及时回收不再需要的权限
      - 避免权限过度分配
   
   2. 默认拒绝：
      - 默认情况下拒绝所有权限
      - 明确授予必要的权限
      - 定期审核权限设置
      - 监控权限使用
   
   3. 职责分离：
      - 分离不同角色的职责
      - 避免权限集中
      - 创建审批流程
      - 定期轮换职责
   ```

2. **基于角色的访问控制(RBAC)**
   ```markdown
   1. 角色定义：
      - 基于业务需求定义角色
      - 明确角色权限范围
      - 建立角色层次结构
      - 定期更新角色定义
   
   2. 权限分配：
      - 通过角色分配权限
      - 避免直接分配权限给用户
      - 使用角色简化管理
      - 定期审核角色分配
   
   3. 角色生命周期：
      - 定义角色创建流程
      - 建立角色审核机制
      - 设置角色失效条件
      - 处理角色冲突
   ```

## 权限模型

### 权限层级

1. **服务器级权限**
   ```markdown
   1. 管理权限：
      - 服务器配置管理
      - 用户和许可证管理
      - 站点管理
      - 系统监控和维护
   
   2. 访问权限：
      - 访问服务器管理界面
      - 查看系统日志
      - 执行系统级任务
      - 查看全局统计信息
   
   3. 影响范围：
      - 影响所有站点和用户
      - 最高级别的权限
      - 需要严格控制和审计
      - 仅限服务器管理员
   ```

2. **站点级权限**
   ```markdown
   1. 管理权限：
      - 站点配置管理
      - 站点用户和组管理
      - 站点内容管理
      - 站点连接管理
   
   2. 内容权限：
      - 访问站点内容
      - 发布内容到站点
      - 管理站点内容权限
      - 使用站点数据源
   
   3. 影响范围：
      - 仅影响特定站点
      - 由站点管理员控制
      - 可以继承服务器权限
      - 可以覆盖默认权限
   ```

3. **项目级权限**
   ```markdown
   1. 管理权限：
      - 项目内容组织
      - 项目用户权限设置
      - 项目内容权限管理
      - 项目连接管理
   
   2. 内容权限：
      - 访问项目内容
      - 发布内容到项目
      - 编辑项目内容
      - 使用项目数据源
   
   3. 继承和覆盖：
      - 继承站点级权限
      - 可以覆盖父级权限
      - 可以锁定权限防止覆盖
      - 权限可以逐级细化
   ```

4. **内容级权限**
   ```markdown
   1. 工作簿权限：
      - 查看、交互、编辑工作簿
      - 发布新版本
      - 下载工作簿
      - 管理工作簿权限
   
   2. 数据源权限：
      - 连接数据源
      - 发布数据源
      - 编辑数据源
      - 管理数据源权限
   
   3. 视图权限：
      - 查看和交互视图
      - 下载视图
      - 添加评论
      - 分享视图
   ```

### 权限规则

1. **权限计算**
   ```markdown
   1. 权限组合：
      - 合并所有适用的权限规则
      - 明确允许优先于明确拒绝
      - 继承权限可以被覆盖
      - 拒绝规则通常优先于允许规则
   
   2. 权限继承：
      - 子对象默认继承父对象权限
      - 可以在子对象级别覆盖权限
      - 可以锁定权限防止被覆盖
      - 权限逐级向下传播
   
   3. 有效权限：
      - 最终有效的权限是所有规则组合的结果
      - 可以查看有效权限了解实际权限
      - 权限计算遵循特定优先级顺序
      - 冲突时按预设规则解决
   ```

2. **权限模板**
   ```markdown
   1. 预定义模板：
      - 查看：仅查看权限
      - 交互：查看和基本交互
      - 编辑：查看、交互和编辑
      - 发布：编辑和发布
      - 管理：完全管理权限
   
   2. 自定义模板：
      - 根据业务需求创建
      - 组合不同权限选项
      - 保存为可重用模板
      - 应用到项目和内容
   
   3. 模板应用：
      - 设置默认权限模板
      - 新内容自动应用默认模板
      - 批量应用权限模板
      - 定期审核模板设置
   ```

### 行级安全性

1. **数据过滤**
   ```markdown
   1. 基本概念：
      - 在数据行级别控制访问
      - 不同用户看到不同数据子集
      - 保护敏感数据不被不当访问
      - 实现数据共享与安全的平衡
   
   2. 实现方式：
      - 用户筛选器：基于用户身份的筛选
      - 数据源筛选：在数据源层面设置筛选
      - 行级安全性：在数据库层面设置
   
   3. 应用场景：
      - 销售人员只能查看自己的客户数据
      - 区域经理只能查看本区域数据
      - 部门用户只能查看本部门数据
      - 敏感字段对特定用户隐藏
   ```

2. **实现方法**
   ```markdown
   1. 用户筛选器：
      - 创建用户/组关联表
      - 创建计算字段筛选数据
      - 使用USERNAME()或ISMEMBEROF()函数
      - 灵活但可能影响性能
   
   2. 数据源筛选：
      - 在数据源层面设置用户筛选
      - 提高性能和安全性
      - 需要Tableau Server或数据源支持
      - 更适合大规模部署
   
   3. 数据库级安全：
      - 在数据库中实现行级安全
      - 使用视图或安全策略
      - 最高性能和安全性
      - 需要数据库管理员支持
   ```

## 权限管理最佳实践

### 权限设计原则

1. **角色基础设计**
   ```markdown
   1. 基于业务职能：
      - 根据实际工作职责设计角色
      - 避免基于个人偏好设计
      - 定期评估和更新角色定义
      - 保持角色设计的简洁性
   
   2. 最小权限原则：
      - 每个角色分配最小必要权限
      - 定期审核权限使用情况
      - 及时回收不再需要的权限
      - 监控权限异常使用
   
   3. 权限分离：
      - 分离不相容的权限
      - 避免权限过度集中
      - 实施职责分离
      - 定期轮换敏感角色
   ```

2. **权限实施策略**
   ```markdown
   1. 分阶段实施：
      - 从简单权限开始
      - 逐步细化权限控制
      - 定期评估和调整
      - 保持权限策略一致性
   
   2. 文档和培训：
      - 建立权限管理文档
      - 定期培训管理员
      - 提供用户权限指南
      - 建立权限支持渠道
   
   3. 监控和审计：
      - 定期审计权限设置
      - 监控异常访问行为
      - 分析权限使用模式
      - 及时响应安全事件
   ```

### 权限管理工具

1. **Tableau管理工具**
   ```markdown
   1. 服务器管理界面：
      - 图形化的权限管理界面
      - 直观的权限设置方式
      - 实时权限预览
      - 批量权限管理功能
   
   2. tabcmd命令行工具：
      - 脚本化权限管理
      - 批量权限操作
      - 自动化权限配置
      - 集成到管理流程
   
   3. REST API：
      - 程序化权限管理
      - 自定义权限管理工具
      - 第三方系统集成
      - 自动化权限工作流
   ```

2. **外部集成工具**
   ```markdown
   1. Active Directory集成：
      - 用户和组自动同步
      - 基于AD组的权限分配
      - 单点登录支持
      - 集中身份管理
   
   2. 身份管理平台：
      - 企业级身份和访问管理
      - 统一权限管理
      - 审计和合规报告
      - 生命周期管理
   
   3. 自定义管理工具：
      - 基于REST API开发
      - 针对特定业务需求
      - 集成现有IT系统
      - 自动化权限管理
   ```

## 实验练习

为了巩固本章所学知识，请完成以下练习：

1. **用户管理**
   - 创建不同类型的用户
   - 管理用户组
   - 实施用户生命周期管理

2. **角色分配**
   - 为不同用户分配适当角色
   - 创建自定义角色
   - 实施职责分离

3. **权限设置**
   - 设置多层级权限
   - 配置行级安全性
   - 应用权限模板

4. **权限审核**
   - 审核现有权限设置
   - 识别权限异常
   - 优化权限结构

通过完成这些练习，您将掌握Tableau中的用户与权限管理，能够设计和管理安全有效的访问控制体系。