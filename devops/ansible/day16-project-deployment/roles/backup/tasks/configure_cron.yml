---
# 配置备份计划任务

- name: 配置数据库备份计划任务
  cron:
    name: "Database Backup"
    minute: "{{ backup_schedule.split(' ')[0] }}"
    hour: "{{ backup_schedule.split(' ')[1] }}"
    day: "{{ backup_schedule.split(' ')[2] }}"
    month: "{{ backup_schedule.split(' ')[3] }}"
    weekday: "{{ backup_schedule.split(' ')[4] }}"
    job: "{{ backup_script_dir }}/database_backup.sh"
    user: "{{ backup_user }}"
  when: database_backup_enabled
  tags: [backup, cron, database]

- name: 配置文件备份计划任务
  cron:
    name: "File Backup"
    minute: "{{ backup_schedule.split(' ')[0] }}"
    hour: "{{ backup_schedule.split(' ')[1] }}"
    day: "{{ backup_schedule.split(' ')[2] }}"
    month: "{{ backup_schedule.split(' ')[3] }}"
    weekday: "{{ backup_schedule.split(' ')[4] }}"
    job: "{{ backup_script_dir }}/file_backup.sh"
    user: "{{ backup_user }}"
  when: file_backup_enabled
  tags: [backup, cron, file]

- name: 配置备份清理计划任务
  cron:
    name: "Backup Cleanup"
    minute: "0"
    hour: "3"
    job: "{{ backup_script_dir }}/cleanup_backups.sh"
    user: "{{ backup_user }}"
  tags: [backup, cron, cleanup]

- name: 配置备份验证计划任务
  cron:
    name: "Backup Verification"
    minute: "30"
    hour: "4"
    job: "{{ backup_script_dir }}/verify_backups.sh"
    user: "{{ backup_user }}"
  tags: [backup, cron, verify]