# ç¬¬10ç« ï¼šç»¼åˆæ¡ˆä¾‹

## ğŸ—ï¸ æœ¬ç« æ¦‚è¿°

æœ¬ç« é€šè¿‡ä¸‰ä¸ªå®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨çœŸå®åœºæ™¯ä¸­åº”ç”¨Jenkinsæ„å»ºä¼ä¸šçº§CI/CDè§£å†³æ–¹æ¡ˆã€‚æ¯ä¸ªæ¡ˆä¾‹éƒ½åŒ…å«å®Œæ•´çš„æ¶æ„è®¾è®¡ã€ä»£ç å®ç°å’Œéƒ¨ç½²æµç¨‹ã€‚

### ğŸ¯ å­¦ä¹ ç›®æ ‡

- æŒæ¡å¾®æœåŠ¡æ¶æ„çš„CI/CDå®ç°
- ç†è§£ç§»åŠ¨åº”ç”¨è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹
- å­¦ä¼šé—ç•™ç³»ç»Ÿç°ä»£åŒ–æ”¹é€ æ–¹æ¡ˆ
- æŒæ¡å…¨æ ˆåº”ç”¨çš„å¤šç¯å¢ƒéƒ¨ç½²ç­–ç•¥

## ğŸ“Š æ¡ˆä¾‹ä¸€ï¼šå¾®æœåŠ¡CI/CD Pipeline

### 1. é¡¹ç›®æ¶æ„æ¦‚è¿°

**ç³»ç»Ÿæ¶æ„**
```
å¾®æœåŠ¡é¡¹ç›®æ¶æ„ï¼š
â”œâ”€â”€ ç”¨æˆ·æœåŠ¡ (user-service)
â”œâ”€â”€ è®¢å•æœåŠ¡ (order-service) 
â”œâ”€â”€ æ”¯ä»˜æœåŠ¡ (payment-service)
â”œâ”€â”€ å•†å“æœåŠ¡ (product-service)
â”œâ”€â”€ APIç½‘å…³ (api-gateway)
â””â”€â”€ é…ç½®ä¸­å¿ƒ (config-server)
```

**æŠ€æœ¯æ ˆ**
- **åç«¯**: Spring Boot 2.7+, Spring Cloud
- **æ•°æ®åº“**: MySQL 8.0, Redis 6.0
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ 3.11
- **å®¹å™¨ç¼–æ’**: Docker + Kubernetes
- **ç›‘æ§**: Prometheus + Grafana

### 2. å¤šåˆ†æ”¯Pipelineè®¾è®¡

**ä¸»åˆ†æ”¯Pipeline**
```groovy
// Jenkinsfile.master
pipeline {
    agent {
        kubernetes {
            label 'jenkins-slave-k8s'
            yaml """
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: jnlp
    image: jenkins/jnlp-slave:alpine
    env:
    - name: JAVA_OPTS
      value: "-Xmx2g"
  - name: maven
    image: maven:3.8.6-openjdk-11
    command: ['cat']
    tty: true
    env:
    - name: MAVEN_OPTS
      value: "-Xmx1g"
            """
        }
    }
    
    environment {
        DOCKER_REGISTRY = 'registry.company.com'
        KUBE_NAMESPACE = 'production'
        SONAR_URL = 'http://sonarqube:9000'
        NEXUS_URL = 'http://nexus:8081'
    }
    
    stages {
        stage('ä»£ç è´¨é‡æ£€æŸ¥') {
            parallel {
                stage('SonarQubeåˆ†æ') {
                    steps {
                        container('maven') {
                            sh '''
                            mvn sonar:sonar \
                                -Dsonar.projectKey=user-service \
                                -Dsonar.host.url=${SONAR_URL} \
                                -Dsonar.login=${SONAR_TOKEN}
                            '''
                        }
                    }
                }
                stage('ä¾èµ–å®‰å…¨æ£€æŸ¥') {
                    steps {
                        container('maven') {
                            sh 'mvn org.owasp:dependency-check-maven:check'
                        }
                    }
                }
            }
        }
        
        stage('æ„å»ºå’Œæµ‹è¯•') {
            parallel {
                stage('å•å…ƒæµ‹è¯•') {
                    steps {
                        container('maven') {
                            sh 'mvn clean test -DskipTests=false'
                        }
                    }
                }
                stage('é›†æˆæµ‹è¯•') {
                    steps {
                        container('maven') {
                            sh './scripts/run-integration-tests.sh'
                        }
                    }
                }
            }
            post {
                always {
                    junit 'target/surefire-reports/*.xml'
                    archiveArtifacts 'target/*.jar'
                }
            }
        }
        
        stage('æ„å»ºDockeré•œåƒ') {
            steps {
                container('maven') {
                    script {
                        def imageName = "${DOCKER_REGISTRY}/user-service:${env.BUILD_NUMBER}"
                        sh """
                        docker build -t ${imageName} .
                        docker push ${imageName}
                        """
                        
                        // ä¿å­˜é•œåƒä¿¡æ¯
                        writeFile file: 'image-info.txt', 
                                 text: "IMAGE_NAME=${imageName}\nBUILD_NUMBER=${env.BUILD_NUMBER}"
                    }
                }
            }
        }
        
        stage('éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ') {
            when {
                expression { env.BRANCH_NAME == 'master' }
            }
            steps {
                container('maven') {
                    script {
                        // è¯»å–é•œåƒä¿¡æ¯
                        def imageInfo = readProperties file: 'image-info.txt'
                        def imageName = imageInfo.IMAGE_NAME
                        
                        // æ›´æ–°Kuberneteséƒ¨ç½²
                        sh """
                        kubectl set image deployment/user-service \
                            user-service=${imageName} \
                            -n ${KUBE_NAMESPACE}
                        
                        # ç­‰å¾…éƒ¨ç½²å®Œæˆ
                        kubectl rollout status deployment/user-service \
                            -n ${KUBE_NAMESPACE} --timeout=300s
                        """
                    }
                }
            }
        }
        
        stage('è‡ªåŠ¨åŒ–æµ‹è¯•') {
            when {
                expression { env.BRANCH_NAME == 'master' }
            }
            steps {
                container('maven') {
                    script {
                        // ç­‰å¾…æœåŠ¡å¯åŠ¨
                        sh './scripts/wait-for-service.sh user-service.production.svc.cluster.local'
                        
                        // è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
                        sh './scripts/run-e2e-tests.sh'
                        
                        // æ€§èƒ½æµ‹è¯•
                        sh './scripts/run-performance-tests.sh'
                    }
                }
            }
        }
    }
    
    post {
        success {
            script {
                // å‘é€æˆåŠŸé€šçŸ¥
                emailext (
                    subject: "âœ… æ„å»ºæˆåŠŸ: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                    body: """
                    æ„å»ºä¿¡æ¯:
                    - é¡¹ç›®: ${env.JOB_NAME}
                    - æ„å»ºå·: ${env.BUILD_NUMBER}
                    - åˆ†æ”¯: ${env.BRANCH_NAME}
                    - çŠ¶æ€: æˆåŠŸ
                    - æŒç»­æ—¶é—´: ${currentBuild.durationString}
                    
                    æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}
                    """,
                    to: 'devops-team@company.com'
                )
            }
        }
        failure {
            script {
                // å‘é€å¤±è´¥é€šçŸ¥
                emailext (
                    subject: "âŒ æ„å»ºå¤±è´¥: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                    body: """
                    æ„å»ºä¿¡æ¯:
                    - é¡¹ç›®: ${env.JOB_NAME}
                    - æ„å»ºå·: ${env.BUILD_NUMBER}
                    - åˆ†æ”¯: ${env.BRANCH_NAME}
                    - çŠ¶æ€: å¤±è´¥
                    - å¤±è´¥é˜¶æ®µ: ${currentBuild.result}
                    
                    æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}
                    """,
                    to: 'devops-team@company.com'
                )
            }
        }
        always {
            // æ¸…ç†å·¥ä½œç©ºé—´
            cleanWs()
        }
    }
}
```

### 3. å¼€å‘åˆ†æ”¯Pipeline

**ç‰¹æ€§åˆ†æ”¯Pipeline**
```groovy
// Jenkinsfile.feature
pipeline {
    agent any
    
    triggers {
        pollSCM('H/5 * * * *')  // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    }
    
    stages {
        stage('ä»£ç æ£€æŸ¥') {
            steps {
                sh './scripts/code-review.sh'
            }
        }
        
        stage('å¿«é€Ÿæ„å»º') {
            steps {
                sh 'mvn clean compile -DskipTests'
            }
        }
        
        stage('å•å…ƒæµ‹è¯•') {
            steps {
                sh 'mvn test -DskipITs=true'
            }
            post {
                always {
                    junit 'target/surefire-reports/*.xml'
                }
            }
        }
        
        stage('éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ') {
            when {
                expression { 
                    env.BRANCH_NAME.startsWith('feature/') || 
                    env.BRANCH_NAME.startsWith('hotfix/')
                }
            }
            steps {
                script {
                    def imageName = "${DOCKER_REGISTRY}/user-service:${env.BRANCH_NAME}-${env.BUILD_NUMBER}"
                    
                    sh """
                    docker build -t ${imageName} .
                    docker push ${imageName}
                    
                    # éƒ¨ç½²åˆ°æµ‹è¯•å‘½åç©ºé—´
                    kubectl set image deployment/user-service-test \
                        user-service=${imageName} \
                        -n testing
                    """
                }
            }
        }
    }
}
```

## ğŸ“± æ¡ˆä¾‹äºŒï¼šç§»åŠ¨åº”ç”¨CI/CD Pipeline

### 1. é¡¹ç›®æ¶æ„

**ç§»åŠ¨åº”ç”¨æŠ€æœ¯æ ˆ**
```
Androidåº”ç”¨:
â”œâ”€â”€ React Native 0.70+
â”œâ”€â”€ TypeScript 4.8+
â”œâ”€â”€ Android SDK 33
â”œâ”€â”€ Gradle 7.4+
â””â”€â”€ FirebaseæœåŠ¡

iOSåº”ç”¨:
â”œâ”€â”€ React Native 0.70+
â”œâ”€â”€ TypeScript 4.8+
â”œâ”€â”€ Xcode 14+
â”œâ”€â”€ CocoaPods 1.11+
â””â”€â”€ Apple Developer Account
```

### 2. å¤šå¹³å°æ„å»ºPipeline

**React Nativeè·¨å¹³å°æ„å»º**
```groovy
// Jenkinsfile.mobile
pipeline {
    agent {
        docker {
            image 'node:18-alpine'
            args '-v /var/run/docker.sock:/var/run/docker.sock'
        }
    }
    
    environment {
        ANDROID_HOME = '/opt/android-sdk'
        JAVA_HOME = '/usr/lib/jvm/java-11-openjdk'
        APP_VERSION = "1.0.${env.BUILD_NUMBER}"
        APP_BUILD = "${env.BUILD_NUMBER}"
    }
    
    stages {
        stage('ç¯å¢ƒå‡†å¤‡') {
            steps {
                sh '''
                # å®‰è£…Node.jsä¾èµ–
                npm ci
                
                # å®‰è£…iOSä¾èµ–
                cd ios && pod install && cd ..
                
                # è®¾ç½®Androidç¯å¢ƒ
                ./scripts/setup-android-env.sh
                '''
            }
        }
        
        stage('ä»£ç è´¨é‡æ£€æŸ¥') {
            parallel {
                stage('TypeScriptç¼–è¯‘æ£€æŸ¥') {
                    steps {
                        sh 'npx tsc --noEmit'
                    }
                }
                stage('ESLintæ£€æŸ¥') {
                    steps {
                        sh 'npx eslint src/**/*.{js,jsx,ts,tsx}'
                    }
                }
                stage('å•å…ƒæµ‹è¯•') {
                    steps {
                        sh 'npm test -- --coverage'
                    }
                    post {
                        always {
                            junit 'coverage/junit.xml'
                            publishHTML([
                                allowMissing: false,
                                alwaysLinkToLastBuild: true,
                                keepAll: true,
                                reportDir: 'coverage/lcov-report',
                                reportFiles: 'index.html',
                                reportName: 'å•å…ƒæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š'
                            ])
                        }
                    }
                }
            }
        }
        
        stage('Androidæ„å»º') {
            agent {
                docker {
                    image 'reactnativecommunity/react-native-android:latest'
                    args '-v /var/run/docker.sock:/var/run/docker.sock'
                }
            }
            steps {
                script {
                    // ç”ŸæˆAndroid APK
                    sh '''
                    cd android
                    ./gradlew assembleRelease \
                        -PversionCode=${APP_BUILD} \
                        -PversionName=${APP_VERSION}
                    '''
                    
                    // ç­¾åAPK
                    withCredentials([file(credentialsId: 'android-keystore', variable: 'KEYSTORE_FILE')]) {
                        sh '''
                        jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 \
                            -keystore ${KEYSTORE_FILE} \
                            -storepass ${ANDROID_KEYSTORE_PASSWORD} \
                            -keypass ${ANDROID_KEY_PASSWORD} \
                            android/app/build/outputs/apk/release/app-release-unsigned.apk \
                            ${ANDROID_KEY_ALIAS}
                        '''
                    }
                }
            }
            post {
                success {
                    archiveArtifacts 'android/app/build/outputs/apk/release/*.apk'
                }
            }
        }
        
        stage('iOSæ„å»º') {
            agent {
                node {
                    label 'macos-ios'
                }
            }
            steps {
                script {
                    // iOSæ„å»ºéœ€è¦macOSç¯å¢ƒ
                    sh '''
                    cd ios
                    xcodebuild -workspace MyApp.xcworkspace \
                              -scheme MyApp \
                              -configuration Release \
                              -archivePath build/MyApp.xcarchive \
                              archive
                    
                    xcodebuild -exportArchive \
                              -archivePath build/MyApp.xcarchive \
                              -exportOptionsPlist ExportOptions.plist \
                              -exportPath build
                    '''
                }
            }
            post {
                success {
                    archiveArtifacts 'ios/build/*.ipa'
                }
            }
        }
        
        stage('åº”ç”¨åˆ†å‘') {
            parallel {
                stage('åˆ†å‘åˆ°æµ‹è¯•å¹³å°') {
                    steps {
                        script {
                            // ä¸Šä¼ åˆ°Firebase App Distribution
                            withCredentials([string(credentialsId: 'firebase-token', variable: 'FIREBASE_TOKEN')]) {
                                sh '''
                                # Androidåˆ†å‘
                                firebase appdistribution:distribute \
                                    android/app/build/outputs/apk/release/app-release.apk \
                                    --app 1:123456789:android:abcdef123456 \
                                    --groups "qa-testers" \
                                    --token ${FIREBASE_TOKEN}
                                
                                # iOSåˆ†å‘ (TestFlight)
                                xcrun altool --upload-app \
                                    -f ios/build/MyApp.ipa \
                                    -u ${APPLE_ID} \
                                    -p ${APPLE_PASSWORD} \
                                    --type ios
                                '''
                            }
                        }
                    }
                }
                stage('ä¸Šä¼ åˆ°åº”ç”¨å•†åº—') {
                    when {
                        expression { env.BRANCH_NAME == 'master' }
                    }
                    steps {
                        script {
                            // Google Play Storeå‘å¸ƒ
                            sh '''
                            # Androidåº”ç”¨å•†åº—å‘å¸ƒ
                            bundle exec fastlane supply \
                                --package_name com.company.myapp \
                                --apk android/app/build/outputs/apk/release/app-release.apk \
                                --track production \
                                --json_key fastlane/key.json
                            '''
                            
                            // App Store Connectå‘å¸ƒ
                            sh '''
                            # iOSåº”ç”¨å•†åº—å‘å¸ƒ
                            xcrun altool --upload-app \
                                -f ios/build/MyApp.ipa \
                                -u ${APPLE_ID} \
                                -p ${APP_SPECIFIC_PASSWORD} \
                                --type ios
                            '''
                        }
                    }
                }
            }
        }
        
        stage('è‡ªåŠ¨åŒ–æµ‹è¯•') {
            parallel {
                stage('Android UIæµ‹è¯•') {
                    steps {
                        sh './scripts/run-android-ui-tests.sh'
                    }
                }
                stage('iOS UIæµ‹è¯•') {
                    steps {
                        sh './scripts/run-ios-ui-tests.sh'
                    }
                }
                stage('è·¨å¹³å°åŠŸèƒ½æµ‹è¯•') {
                    steps {
                        sh 'npx detox test --configuration ios.sim.release'
                        sh 'npx detox test --configuration android.emulator.release'
                    }
                }
            }
        }
    }
    
    post {
        always {
            // æ¸…ç†å·¥ä½œç©ºé—´
            cleanWs()
            
            // ç”Ÿæˆæ„å»ºæŠ¥å‘Š
            publishHTML([
                allowMissing: false,
                alwaysLinkToLastBuild: true,
                keepAll: true,
                reportDir: 'build/reports',
                reportFiles: 'index.html',
                reportName: 'ç§»åŠ¨åº”ç”¨æ„å»ºæŠ¥å‘Š'
            ])
        }
    }
}
```

## ğŸ¢ æ¡ˆä¾‹ä¸‰ï¼šé—ç•™ç³»ç»Ÿç°ä»£åŒ–æ”¹é€ 

### 1. é¡¹ç›®èƒŒæ™¯

**é—ç•™ç³»ç»Ÿç‰¹å¾**
- å•ä½“åº”ç”¨ï¼Œä»£ç åº“åºå¤§
- æ‰‹åŠ¨éƒ¨ç½²æµç¨‹
- ç¼ºä¹è‡ªåŠ¨åŒ–æµ‹è¯•
- æŠ€æœ¯æ ˆé™ˆæ—§

**ç°ä»£åŒ–ç›®æ ‡**
- å»ºç«‹è‡ªåŠ¨åŒ–CI/CDæµç¨‹
- å¼•å…¥å®¹å™¨åŒ–éƒ¨ç½²
- æ·»åŠ æµ‹è¯•è¦†ç›–
- å®ç°æ¸è¿›å¼é‡æ„

### 2. æ¸è¿›å¼æ”¹é€ Pipeline

**ç°ä»£åŒ–æ”¹é€ Pipeline**
```groovy
// Jenkinsfile.legacy-modernization
pipeline {
    agent any
    
    parameters {
        choice(name: 'DEPLOY_ENV', choices: ['dev', 'test', 'staging', 'prod'], description: 'éƒ¨ç½²ç¯å¢ƒ')
        booleanParam(name: 'RUN_TESTS', defaultValue: true, description: 'æ˜¯å¦è¿è¡Œæµ‹è¯•')
        booleanParam(name: 'DEPLOY_TO_K8S', defaultValue: false, description: 'æ˜¯å¦éƒ¨ç½²åˆ°K8S')
    }
    
    stages {
        stage('ä»£ç åˆ†æå’Œè´¨é‡æ£€æŸ¥') {
            steps {
                script {
                    // ä½¿ç”¨ç°ä»£åŒ–å·¥å…·åˆ†æé—ç•™ä»£ç 
                    sh './scripts/analyze-legacy-code.sh'
                    
                    // ç”ŸæˆæŠ€æœ¯å€ºåŠ¡æŠ¥å‘Š
                    sh './scripts/generate-tech-debt-report.sh'
                }
            }
            post {
                always {
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'reports/analysis',
                        reportFiles: 'index.html',
                        reportName: 'é—ç•™ä»£ç åˆ†ææŠ¥å‘Š'
                    ])
                }
            }
        }
        
        stage('å®‰å…¨æ‰«æ') {
            steps {
                script {
                    // ä¾èµ–å®‰å…¨æ‰«æ
                    sh 'mvn org.owasp:dependency-check-maven:check'
                    
                    // ä»£ç å®‰å…¨æ‰«æ
                    sh './scripts/run-security-scan.sh'
                }
            }
            post {
                always {
                    dependencyCheckPublisher(pattern: '**/dependency-check-report.xml')
                }
            }
        }
        
        stage('æ„å»ºå’Œæ‰“åŒ…') {
            parallel {
                stage('ä¼ ç»Ÿæ„å»ºæ–¹å¼') {
                    steps {
                        script {
                            // ä¿æŒä¼ ç»Ÿæ„å»ºæ–¹å¼ä½œä¸ºå¤‡ä»½
                            sh './scripts/traditional-build.sh'
                        }
                    }
                }
                stage('ç°ä»£åŒ–æ„å»ºæ–¹å¼') {
                    steps {
                        script {
                            // ä½¿ç”¨ç°ä»£åŒ–å·¥å…·æ„å»º
                            sh './scripts/modern-build.sh'
                        }
                    }
                }
            }
        }
        
        stage('è‡ªåŠ¨åŒ–æµ‹è¯•') {
            when {
                expression { params.RUN_TESTS }
            }
            steps {
                script {
                    // é€æ­¥æ·»åŠ æµ‹è¯•è¦†ç›–
                    sh './scripts/run-legacy-tests.sh'
                    
                    // é›†æˆæµ‹è¯•
                    sh './scripts/run-integration-tests.sh'
                }
            }
        }
        
        stage('å¤šç¯å¢ƒéƒ¨ç½²') {
            steps {
                script {
                    if (params.DEPLOY_TO_K8S) {
                        // æ–°æ¶æ„ï¼šå®¹å™¨åŒ–éƒ¨ç½²
                        sh "./scripts/deploy-to-k8s.sh ${params.DEPLOY_ENV}"
                    } else {
                        // æ—§æ¶æ„ï¼šä¼ ç»Ÿéƒ¨ç½²
                        sh "./scripts/deploy-traditional.sh ${params.DEPLOY_ENV}"
                    }
                }
            }
        }
        
        stage('å¥åº·æ£€æŸ¥å’Œç›‘æ§') {
            steps {
                script {
                    // éƒ¨ç½²åå¥åº·æ£€æŸ¥
                    sh './scripts/health-check.sh'
                    
                    // è®¾ç½®ç›‘æ§
                    sh './scripts/setup-monitoring.sh'
                }
            }
        }
        
        stage('å›æ»šæœºåˆ¶') {
            steps {
                script {
                    // å‡†å¤‡å›æ»šè„šæœ¬
                    sh './scripts/prepare-rollback.sh'
                    
                    // æµ‹è¯•å›æ»šæµç¨‹
                    if (params.DEPLOY_ENV == 'test') {
                        sh './scripts/test-rollback.sh'
                    }
                }
            }
        }
    }
    
    post {
        success {
            script {
                // å‘é€éƒ¨ç½²æˆåŠŸé€šçŸ¥
                emailext (
                    subject: "âœ… é—ç•™ç³»ç»Ÿéƒ¨ç½²æˆåŠŸ: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                    body: """
                    éƒ¨ç½²ä¿¡æ¯:
                    - ç¯å¢ƒ: ${params.DEPLOY_ENV}
                    - æ„å»ºå·: ${env.BUILD_NUMBER}
                    - éƒ¨ç½²æ–¹å¼: ${params.DEPLOY_TO_K8S ? 'Kubernetes' : 'ä¼ ç»Ÿ'}
                    - çŠ¶æ€: æˆåŠŸ
                    
                    æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}
                    """,
                    to: 'legacy-modernization-team@company.com'
                )
            }
        }
        failure {
            script {
                // è‡ªåŠ¨å›æ»š
                sh './scripts/auto-rollback.sh'
                
                // å‘é€å¤±è´¥é€šçŸ¥
                emailext (
                    subject: "âŒ é—ç•™ç³»ç»Ÿéƒ¨ç½²å¤±è´¥: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                    body: """
                    éƒ¨ç½²ä¿¡æ¯:
                    - ç¯å¢ƒ: ${params.DEPLOY_ENV}
                    - æ„å»ºå·: ${env.BUILD_NUMBER}
                    - å¤±è´¥é˜¶æ®µ: ${currentBuild.result}
                    - å·²æ‰§è¡Œè‡ªåŠ¨å›æ»š
                    
                    æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}
                    """,
                    to: 'legacy-modernization-team@company.com'
                )
            }
        }
        always {
            // ç”Ÿæˆéƒ¨ç½²æŠ¥å‘Š
            publishHTML([
                allowMissing: false,
                alwaysLinkToLastBuild: true,
                keepAll: true,
                reportDir: 'reports/deployment',
                reportFiles: 'index.html',
                reportName: 'é—ç•™ç³»ç»Ÿéƒ¨ç½²æŠ¥å‘Š'
            ])
        }
    }
}
```

## ğŸš€ æ¡ˆä¾‹å››ï¼šå…¨æ ˆåº”ç”¨CI/CD Pipeline

### 1. å…¨æ ˆæŠ€æœ¯æ¶æ„

**å‰ç«¯æŠ€æœ¯æ ˆ**
- React 18 + TypeScript
- Viteæ„å»ºå·¥å…·
- Tailwind CSS
- Cypressæµ‹è¯•æ¡†æ¶

**åç«¯æŠ€æœ¯æ ˆ**  
- Node.js + Express
- MongoDBæ•°æ®åº“
- Redisç¼“å­˜
- Socket.ioå®æ—¶é€šä¿¡

### 2. å¤šç¯å¢ƒéƒ¨ç½²Pipeline

**å…¨æ ˆåº”ç”¨Pipeline**
```groovy
// Jenkinsfile.fullstack
pipeline {
    agent any
    
    environment {
        NODE_ENV = 'production'
        DOCKER_REGISTRY = 'registry.company.com'
        FRONTEND_APP = 'myapp-frontend'
        BACKEND_APP = 'myapp-backend'
    }
    
    stages {
        stage('å‰ç«¯æ„å»º') {
            agent {
                docker {
                    image 'node:18-alpine'
                    reuseNode true
                }
            }
            steps {
                dir('frontend') {
                    sh '''
                    # å®‰è£…ä¾èµ–
                    npm ci
                    
                    # ç±»å‹æ£€æŸ¥
                    npx tsc --noEmit
                    
                    # ä»£ç è´¨é‡æ£€æŸ¥
                    npx eslint . --ext .ts,.tsx
                    
                    # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
                    npm run build
                    
                    # å•å…ƒæµ‹è¯•
                    npm test -- --coverage
                    '''
                }
                
                // å­˜æ¡£å‰ç«¯æ„å»ºäº§ç‰©
                archiveArtifacts 'frontend/dist/**'
            }
            post {
                always {
                    junit 'frontend/coverage/junit.xml'
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'frontend/coverage/lcov-report',
                        reportFiles: 'index.html',
                        reportName: 'å‰ç«¯æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š'
                    ])
                }
            }
        }
        
        stage('åç«¯æ„å»º') {
            agent {
                docker {
                    image 'node:18-alpine'
                    reuseNode true
                }
            }
            steps {
                dir('backend') {
                    sh '''
                    # å®‰è£…ä¾èµ–
                    npm ci
                    
                    # ç±»å‹æ£€æŸ¥
                    npx tsc --noEmit
                    
                    # ä»£ç è´¨é‡æ£€æŸ¥
                    npx eslint . --ext .ts,.js
                    
                    # å®‰å…¨æ‰«æ
                    npm audit --audit-level moderate
                    
                    # å•å…ƒæµ‹è¯•
                    npm test -- --coverage
                    
                    # é›†æˆæµ‹è¯•
                    npm run test:integration
                    '''
                }
                
                // å­˜æ¡£åç«¯æ„å»ºäº§ç‰©
                archiveArtifacts 'backend/dist/**'
            }
        }
        
        stage('Dockeré•œåƒæ„å»º') {
            steps {
                script {
                    // æ„å»ºå‰ç«¯Dockeré•œåƒ
                    def frontendImage = "${DOCKER_REGISTRY}/${FRONTEND_APP}:${env.BUILD_NUMBER}"
                    sh """
                    docker build -t ${frontendImage} -f frontend/Dockerfile .
                    docker push ${frontendImage}
                    """
                    
                    // æ„å»ºåç«¯Dockeré•œåƒ
                    def backendImage = "${DOCKER_REGISTRY}/${BACKEND_APP}:${env.BUILD_NUMBER}"
                    sh """
                    docker build -t ${backendImage} -f backend/Dockerfile .
                    docker push ${backendImage}
                    """
                    
                    // ä¿å­˜é•œåƒä¿¡æ¯
                    writeFile file: 'deployment-info.txt', 
                             text: """
                             FRONTEND_IMAGE=${frontendImage}
                             BACKEND_IMAGE=${backendImage}
                             BUILD_NUMBER=${env.BUILD_NUMBER}
                             """
                }
            }
        }
        
        stage('ç«¯åˆ°ç«¯æµ‹è¯•') {
            steps {
                script {
                    // å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
                    sh './scripts/start-test-environment.sh'
                    
                    // è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
                    dir('frontend') {
                        sh 'npx cypress run --spec "cypress/e2e/**/*.spec.js"'
                    }
                    
                    // æ€§èƒ½æµ‹è¯•
                    sh './scripts/run-performance-tests.sh'
                }
            }
            post {
                always {
                    // åœæ­¢æµ‹è¯•ç¯å¢ƒ
                    sh './scripts/stop-test-environment.sh'
                    
                    // å­˜æ¡£æµ‹è¯•æŠ¥å‘Š
                    archiveArtifacts 'frontend/cypress/reports/**'
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'frontend/cypress/reports/html',
                        reportFiles: 'index.html',
                        reportName: 'ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š'
                    ])
                }
            }
        }
        
        stage('å¤šç¯å¢ƒéƒ¨ç½²') {
            parallel {
                stage('éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ') {
                    when {
                        expression { env.BRANCH_NAME == 'develop' }
                    }
                    steps {
                        script {
                            sh './scripts/deploy-to-environment.sh development'
                        }
                    }
                }
                stage('éƒ¨ç½²åˆ°é¢„å‘å¸ƒç¯å¢ƒ') {
                    when {
                        expression { env.BRANCH_NAME == 'release/*' }
                    }
                    steps {
                        script {
                            sh './scripts/deploy-to-environment.sh staging'
                        }
                    }
                }
                stage('éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ') {
                    when {
                        expression { env.BRANCH_NAME == 'main' }
                    }
                    steps {
                        script {
                            sh './scripts/deploy-to-environment.sh production'
                        }
                    }
                }
            }
        }
        
        stage('ç”Ÿäº§ç¯å¢ƒéªŒè¯') {
            when {
                expression { env.BRANCH_NAME == 'main' }
            }
            steps {
                script {
                    // å¥åº·æ£€æŸ¥
                    sh './scripts/production-health-check.sh'
                    
                    // åŠŸèƒ½éªŒè¯
                    sh './scripts/functional-verification.sh'
                    
                    // æ€§èƒ½åŸºå‡†æµ‹è¯•
                    sh './scripts/performance-benchmark.sh'
                }
            }
        }
    }
    
    post {
        always {
            // æ¸…ç†å·¥ä½œç©ºé—´
            cleanWs()
            
            // å‘é€æ„å»ºæŠ¥å‘Š
            emailext (
                subject: "æ„å»ºæŠ¥å‘Š: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                body: """
                å…¨æ ˆåº”ç”¨æ„å»ºæŠ¥å‘Š:
                - é¡¹ç›®: ${env.JOB_NAME}
                - æ„å»ºå·: ${env.BUILD_NUMBER}
                - åˆ†æ”¯: ${env.BRANCH_NAME}
                - çŠ¶æ€: ${currentBuild.result}
                - æŒç»­æ—¶é—´: ${currentBuild.durationString}
                
                å‰ç«¯:
                - æ„å»ºçŠ¶æ€: ${currentBuild.result}
                - æµ‹è¯•è¦†ç›–ç‡: æŸ¥çœ‹æŠ¥å‘Š
                
                åç«¯:
                - æ„å»ºçŠ¶æ€: ${currentBuild.result}
                - æµ‹è¯•ç»“æœ: æŸ¥çœ‹æŠ¥å‘Š
                
                éƒ¨ç½²:
                - ç¯å¢ƒ: ${env.BRANCH_NAME == 'main' ? 'ç”Ÿäº§ç¯å¢ƒ' : env.BRANCH_NAME == 'develop' ? 'å¼€å‘ç¯å¢ƒ' : 'é¢„å‘å¸ƒç¯å¢ƒ'}
                - çŠ¶æ€: ${currentBuild.result}
                
                æŸ¥çœ‹è¯¦æƒ…: ${env.BUILD_URL}
                """,
                to: 'fullstack-team@company.com',
                attachLog: true
            )
        }
    }
}
```

## ğŸ¯ æœ¬ç« æ€»ç»“

æœ¬ç« é€šè¿‡å››ä¸ªå®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†Jenkinsåœ¨ä¸åŒåœºæ™¯ä¸‹çš„CI/CDå®ç°ï¼š

### âœ… æ¡ˆä¾‹è¦†ç›–èŒƒå›´
1. **å¾®æœåŠ¡æ¶æ„** - å¤šåˆ†æ”¯ã€å®¹å™¨åŒ–ã€Kuberneteséƒ¨ç½²
2. **ç§»åŠ¨åº”ç”¨** - è·¨å¹³å°æ„å»ºã€åº”ç”¨åˆ†å‘ã€è‡ªåŠ¨åŒ–æµ‹è¯•
3. **é—ç•™ç³»ç»Ÿ** - æ¸è¿›å¼æ”¹é€ ã€å®‰å…¨æ‰«æã€å¤šç¯å¢ƒéƒ¨ç½²
4. **å…¨æ ˆåº”ç”¨** - å‰åç«¯åˆ†ç¦»ã€å¤šç¯å¢ƒç­–ç•¥ã€ç«¯åˆ°ç«¯æµ‹è¯•

### ğŸš€ å…³é”®å®è·µ
- **æ¶æ„è®¾è®¡**ï¼šæ¯ä¸ªæ¡ˆä¾‹éƒ½æœ‰å®Œæ•´çš„æ¶æ„è¯´æ˜
- **ä»£ç è´¨é‡**ï¼šåŒ…å«ä»£ç æ£€æŸ¥ã€å®‰å…¨æ‰«æã€æµ‹è¯•è¦†ç›–
- **éƒ¨ç½²ç­–ç•¥**ï¼šæ”¯æŒå¤šç¯å¢ƒã€è“ç»¿éƒ¨ç½²ã€å›æ»šæœºåˆ¶
- **ç›‘æ§å‘Šè­¦**ï¼šé›†æˆå¥åº·æ£€æŸ¥ã€æ€§èƒ½ç›‘æ§ã€å®æ—¶å‘Šè­¦

### ğŸ“Š ç”Ÿäº§å°±ç»ªç‰¹æ€§
- æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•éªŒè¯
- åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- æ”¯æŒå¤§è§„æ¨¡éƒ¨ç½²å’Œè‡ªåŠ¨åŒ–è¿ç»´
- ç¬¦åˆä¼ä¸šçº§å®‰å…¨æ ‡å‡†å’Œæœ€ä½³å®è·µ

é€šè¿‡è¿™äº›æ¡ˆä¾‹ï¼Œæ‚¨å¯ä»¥å°†å­¦åˆ°çš„JenkinsçŸ¥è¯†åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œæ„å»ºé«˜æ•ˆå¯é çš„CI/CDæµç¨‹ã€‚