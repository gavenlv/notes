# ç¬¬7ç« ï¼šæ–‡ä»¶æ“ä½œä¸å¼‚å¸¸å¤„ç†

> **å­¦ä¹ æ—¶é•¿**: 6-7å°æ—¶  
> **éš¾åº¦**: â­â­â­â­  
> **å‰ç½®çŸ¥è¯†**: ç¬¬1-6ç« 

## æœ¬ç« ç›®æ ‡

å­¦å®Œæœ¬ç« å,ä½ å°†èƒ½å¤Ÿ:

- âœ… è¯»å†™æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ–‡ä»¶
- âœ… æ“ä½œæ–‡ä»¶è·¯å¾„å’Œç›®å½•
- âœ… ç†è§£å¼‚å¸¸å¤„ç†æœºåˆ¶
- âœ… ä½¿ç”¨try-except-finallyå¤„ç†é”™è¯¯
- âœ… è‡ªå®šä¹‰å¼‚å¸¸
- âœ… ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨

---

## 7.1 æ–‡ä»¶è¯»å–

### 7.1.1 æ‰“å¼€æ–‡ä»¶

```python
# åŸºæœ¬è¯­æ³•
file = open(filename, mode, encoding)

# å¸¸ç”¨æ¨¡å¼
# 'r'  - è¯»å–(é»˜è®¤)
# 'w'  - å†™å…¥(è¦†ç›–)
# 'a'  - è¿½åŠ 
# 'r+' - è¯»å†™
# 'b'  - äºŒè¿›åˆ¶æ¨¡å¼

# æ‰“å¼€æ–‡ä»¶
file = open('example.txt', 'r', encoding='utf-8')
# ä½¿ç”¨æ–‡ä»¶...
file.close()  # å¿…é¡»å…³é—­
```

### 7.1.2 è¯»å–æ–‡ä»¶

```python
# æ–¹å¼1: read() - è¯»å–å…¨éƒ¨å†…å®¹
with open('example.txt', 'r', encoding='utf-8') as file:
    content = file.read()
    print(content)

# æ–¹å¼2: readline() - è¯»å–ä¸€è¡Œ
with open('example.txt', 'r', encoding='utf-8') as file:
    line = file.readline()
    print(line)

# æ–¹å¼3: readlines() - è¯»å–æ‰€æœ‰è¡Œåˆ°åˆ—è¡¨
with open('example.txt', 'r', encoding='utf-8') as file:
    lines = file.readlines()
    for line in lines:
        print(line.strip())  # strip()å»é™¤æ¢è¡Œç¬¦

# æ–¹å¼4: éå†(æ¨è)
with open('example.txt', 'r', encoding='utf-8') as file:
    for line in file:
        print(line.strip())

# è¯»å–æŒ‡å®šå­—èŠ‚æ•°
with open('example.txt', 'r', encoding='utf-8') as file:
    content = file.read(100)  # è¯»å–å‰100ä¸ªå­—ç¬¦
```

### 7.1.3 withè¯­å¥

```python
# âœ… æ¨è:ä½¿ç”¨withè‡ªåŠ¨å…³é—­æ–‡ä»¶
with open('example.txt', 'r', encoding='utf-8') as file:
    content = file.read()
    print(content)
# æ–‡ä»¶è‡ªåŠ¨å…³é—­

# âŒ ä¸æ¨è:æ‰‹åŠ¨å…³é—­
file = open('example.txt', 'r', encoding='utf-8')
try:
    content = file.read()
    print(content)
finally:
    file.close()
```

---

## 7.2 æ–‡ä»¶å†™å…¥

### 7.2.1 å†™å…¥æ–‡ä»¶

```python
# å†™å…¥æ¨¡å¼(è¦†ç›–)
with open('output.txt', 'w', encoding='utf-8') as file:
    file.write('Hello, World!\n')
    file.write('Pythonæ–‡ä»¶æ“ä½œ\n')

# è¿½åŠ æ¨¡å¼
with open('output.txt', 'a', encoding='utf-8') as file:
    file.write('è¿½åŠ çš„å†…å®¹\n')

# å†™å…¥å¤šè¡Œ
lines = ['ç¬¬ä¸€è¡Œ\n', 'ç¬¬äºŒè¡Œ\n', 'ç¬¬ä¸‰è¡Œ\n']
with open('output.txt', 'w', encoding='utf-8') as file:
    file.writelines(lines)

# ä½¿ç”¨printå†™å…¥æ–‡ä»¶
with open('output.txt', 'w', encoding='utf-8') as file:
    print('Hello', file=file)
    print('World', file=file)
```

### 7.2.2 æ–‡ä»¶å®šä½

```python
with open('example.txt', 'r', encoding='utf-8') as file:
    # è·å–å½“å‰ä½ç½®
    pos = file.tell()
    print(f"å½“å‰ä½ç½®: {pos}")
    
    # è¯»å–10ä¸ªå­—ç¬¦
    content = file.read(10)
    print(f"è¯»å–å†…å®¹: {content}")
    print(f"å½“å‰ä½ç½®: {file.tell()}")
    
    # ç§»åŠ¨åˆ°å¼€å¤´
    file.seek(0)
    print(f"é‡ç½®åä½ç½®: {file.tell()}")
    
    # ç§»åŠ¨åˆ°ç‰¹å®šä½ç½®
    file.seek(5)
    content = file.read(5)
    print(f"ä»ä½ç½®5è¯»å–: {content}")
```

---

## 7.3 äºŒè¿›åˆ¶æ–‡ä»¶

```python
# è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶
with open('image.png', 'rb') as file:
    data = file.read()
    print(f"æ–‡ä»¶å¤§å°: {len(data)} å­—èŠ‚")

# å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶
data = b'\x00\x01\x02\x03\x04'
with open('binary.dat', 'wb') as file:
    file.write(data)

# å¤åˆ¶æ–‡ä»¶
with open('source.png', 'rb') as source:
    with open('copy.png', 'wb') as dest:
        dest.write(source.read())

# åˆ†å—è¯»å–å¤§æ–‡ä»¶
with open('large_file.dat', 'rb') as file:
    while True:
        chunk = file.read(1024)  # æ¯æ¬¡è¯»1KB
        if not chunk:
            break
        # å¤„ç†chunk
```

---

## 7.4 æ–‡ä»¶å’Œç›®å½•æ“ä½œ

### 7.4.1 osæ¨¡å—

```python
import os

# è·å–å½“å‰å·¥ä½œç›®å½•
cwd = os.getcwd()
print(f"å½“å‰ç›®å½•: {cwd}")

# æ”¹å˜å·¥ä½œç›®å½•
os.chdir('/path/to/directory')

# åˆ—å‡ºç›®å½•å†…å®¹
files = os.listdir('.')
print(files)

# åˆ›å»ºç›®å½•
os.mkdir('new_directory')

# åˆ›å»ºå¤šå±‚ç›®å½•
os.makedirs('parent/child/grandchild', exist_ok=True)

# åˆ é™¤æ–‡ä»¶
os.remove('file.txt')

# åˆ é™¤ç©ºç›®å½•
os.rmdir('empty_directory')

# åˆ é™¤ç›®å½•æ ‘
import shutil
shutil.rmtree('directory_with_contents')

# é‡å‘½å
os.rename('old_name.txt', 'new_name.txt')

# æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
if os.path.exists('file.txt'):
    print("æ–‡ä»¶å­˜åœ¨")

# æ£€æŸ¥æ˜¯å¦æ˜¯æ–‡ä»¶/ç›®å½•
print(os.path.isfile('file.txt'))
print(os.path.isdir('directory'))

# è·å–æ–‡ä»¶å¤§å°
size = os.path.getsize('file.txt')
print(f"æ–‡ä»¶å¤§å°: {size} å­—èŠ‚")

# è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´
import time
mtime = os.path.getmtime('file.txt')
print(time.ctime(mtime))
```

### 7.4.2 pathlibæ¨¡å—(æ¨è)

```python
from pathlib import Path

# åˆ›å»ºPathå¯¹è±¡
p = Path('example.txt')

# å½“å‰ç›®å½•
current = Path.cwd()
print(current)

# å®¶ç›®å½•
home = Path.home()
print(home)

# æ‹¼æ¥è·¯å¾„
path = Path('dir') / 'subdir' / 'file.txt'
print(path)

# æ£€æŸ¥å­˜åœ¨
if path.exists():
    print("è·¯å¾„å­˜åœ¨")

# è¯»å†™æ–‡ä»¶
path = Path('example.txt')
content = path.read_text(encoding='utf-8')
path.write_text('Hello, World!', encoding='utf-8')

# è·å–ä¿¡æ¯
print(path.name)        # æ–‡ä»¶å
print(path.stem)        # æ–‡ä»¶å(æ— æ‰©å±•å)
print(path.suffix)      # æ‰©å±•å
print(path.parent)      # çˆ¶ç›®å½•
print(path.is_file())   # æ˜¯å¦æ˜¯æ–‡ä»¶
print(path.is_dir())    # æ˜¯å¦æ˜¯ç›®å½•

# éå†ç›®å½•
for item in Path('.').iterdir():
    if item.is_file():
        print(f"æ–‡ä»¶: {item}")

# é€’å½’æŸ¥æ‰¾
for item in Path('.').rglob('*.py'):
    print(item)

# åˆ›å»ºç›®å½•
Path('new_dir').mkdir(exist_ok=True)
Path('parent/child').mkdir(parents=True, exist_ok=True)
```

### 7.4.3 shutilæ¨¡å—

```python
import shutil

# å¤åˆ¶æ–‡ä»¶
shutil.copy('source.txt', 'dest.txt')
shutil.copy2('source.txt', 'dest.txt')  # ä¿ç•™å…ƒæ•°æ®

# å¤åˆ¶ç›®å½•
shutil.copytree('source_dir', 'dest_dir')

# ç§»åŠ¨æ–‡ä»¶/ç›®å½•
shutil.move('source', 'destination')

# åˆ é™¤ç›®å½•æ ‘
shutil.rmtree('directory')

# ç£ç›˜ä½¿ç”¨æƒ…å†µ
total, used, free = shutil.disk_usage('/')
print(f"æ€»å®¹é‡: {total // (2**30)} GB")
print(f"å·²ä½¿ç”¨: {used // (2**30)} GB")
print(f"å‰©ä½™: {free // (2**30)} GB")

# åˆ›å»ºå‹ç¼©æ–‡ä»¶
shutil.make_archive('archive', 'zip', 'source_dir')

# è§£å‹
shutil.unpack_archive('archive.zip', 'extract_dir')
```

---

## 7.5 å¼‚å¸¸å¤„ç†

### 7.5.1 try-except

```python
# åŸºæœ¬å¼‚å¸¸å¤„ç†
try:
    result = 10 / 0
except ZeroDivisionError:
    print("é™¤æ•°ä¸èƒ½ä¸º0")

# æ•è·å¤šç§å¼‚å¸¸
try:
    number = int(input("è¾“å…¥æ•°å­—: "))
    result = 10 / number
except ValueError:
    print("è¾“å…¥æ— æ•ˆ")
except ZeroDivisionError:
    print("é™¤æ•°ä¸èƒ½ä¸º0")

# æ•è·å¤šç§å¼‚å¸¸(åŒä¸€å¤„ç†)
try:
    # ä»£ç 
    pass
except (ValueError, TypeError, KeyError):
    print("å‘ç”Ÿé”™è¯¯")

# è·å–å¼‚å¸¸ä¿¡æ¯
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"é”™è¯¯: {e}")
    print(f"ç±»å‹: {type(e)}")

# æ•è·æ‰€æœ‰å¼‚å¸¸
try:
    # ä»£ç 
    pass
except Exception as e:
    print(f"å‘ç”Ÿå¼‚å¸¸: {e}")
```

### 7.5.2 try-except-else-finally

```python
try:
    file = open('example.txt', 'r')
    content = file.read()
except FileNotFoundError:
    print("æ–‡ä»¶ä¸å­˜åœ¨")
else:
    # æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ
    print("æ–‡ä»¶è¯»å–æˆåŠŸ")
    print(content)
finally:
    # æ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ
    if 'file' in locals():
        file.close()
        print("æ–‡ä»¶å·²å…³é—­")

# å®é™…åº”ç”¨
def read_file(filename):
    try:
        with open(filename, 'r', encoding='utf-8') as file:
            return file.read()
    except FileNotFoundError:
        print(f"æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        return None
    except PermissionError:
        print(f"æ²¡æœ‰æƒé™è¯»å– {filename}")
        return None
    except Exception as e:
        print(f"è¯»å–æ–‡ä»¶æ—¶å‡ºé”™: {e}")
        return None
```

### 7.5.3 raiseæŠ›å‡ºå¼‚å¸¸

```python
# æŠ›å‡ºå¼‚å¸¸
def divide(a, b):
    if b == 0:
        raise ValueError("é™¤æ•°ä¸èƒ½ä¸º0")
    return a / b

try:
    result = divide(10, 0)
except ValueError as e:
    print(f"é”™è¯¯: {e}")

# é‡æ–°æŠ›å‡ºå¼‚å¸¸
try:
    # ä»£ç 
    pass
except Exception as e:
    print(f"æ•è·åˆ°å¼‚å¸¸: {e}")
    raise  # é‡æ–°æŠ›å‡º

# æŠ›å‡ºæ–°å¼‚å¸¸
try:
    int("abc")
except ValueError as e:
    raise TypeError("ç±»å‹è½¬æ¢å¤±è´¥") from e
```

### 7.5.4 è‡ªå®šä¹‰å¼‚å¸¸

```python
# å®šä¹‰å¼‚å¸¸ç±»
class InsufficientFundsError(Exception):
    """ä½™é¢ä¸è¶³å¼‚å¸¸"""
    def __init__(self, balance, amount):
        self.balance = balance
        self.amount = amount
        super().__init__(f"ä½™é¢{balance}ä¸è¶³,éœ€è¦{amount}")

class BankAccount:
    def __init__(self, balance=0):
        self.balance = balance
    
    def withdraw(self, amount):
        if amount > self.balance:
            raise InsufficientFundsError(self.balance, amount)
        self.balance -= amount
        return self.balance

# ä½¿ç”¨
account = BankAccount(100)
try:
    account.withdraw(150)
except InsufficientFundsError as e:
    print(f"é”™è¯¯: {e}")
    print(f"å½“å‰ä½™é¢: {e.balance}")
    print(f"å°è¯•å–æ¬¾: {e.amount}")
```

### 7.5.5 å¸¸è§å¼‚å¸¸ç±»å‹

```python
# ValueError - å€¼é”™è¯¯
try:
    int("abc")
except ValueError:
    print("æ— æ³•è½¬æ¢ä¸ºæ•´æ•°")

# TypeError - ç±»å‹é”™è¯¯
try:
    "hello" + 5
except TypeError:
    print("ç±»å‹ä¸åŒ¹é…")

# KeyError - é”®é”™è¯¯
try:
    d = {'a': 1}
    print(d['b'])
except KeyError:
    print("é”®ä¸å­˜åœ¨")

# IndexError - ç´¢å¼•é”™è¯¯
try:
    lst = [1, 2, 3]
    print(lst[10])
except IndexError:
    print("ç´¢å¼•è¶…å‡ºèŒƒå›´")

# FileNotFoundError - æ–‡ä»¶æœªæ‰¾åˆ°
try:
    open('nonexistent.txt')
except FileNotFoundError:
    print("æ–‡ä»¶ä¸å­˜åœ¨")

# AttributeError - å±æ€§é”™è¯¯
try:
    x = 10
    x.append(5)
except AttributeError:
    print("å¯¹è±¡æ²¡æœ‰è¯¥å±æ€§")

# ZeroDivisionError - é™¤é›¶é”™è¯¯
try:
    10 / 0
except ZeroDivisionError:
    print("é™¤æ•°ä¸ºé›¶")
```

---

## 7.6 å®éªŒ:æ—¥å¿—ç³»ç»Ÿ

```python
"""
ç®€å•æ—¥å¿—ç³»ç»Ÿ
åŠŸèƒ½:
- è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—(DEBUG, INFO, WARNING, ERROR)
- å†™å…¥æ–‡ä»¶
- è‡ªåŠ¨åˆ›å»ºæ—¥æœŸå‘½åçš„æ—¥å¿—æ–‡ä»¶
"""

import os
from datetime import datetime
from pathlib import Path

class Logger:
    """æ—¥å¿—è®°å½•å™¨"""
    
    DEBUG = 0
    INFO = 1
    WARNING = 2
    ERROR = 3
    
    LEVEL_NAMES = {
        DEBUG: 'DEBUG',
        INFO: 'INFO',
        WARNING: 'WARNING',
        ERROR: 'ERROR'
    }
    
    def __init__(self, log_dir='logs', level=INFO):
        self.level = level
        self.log_dir = Path(log_dir)
        self.log_dir.mkdir(exist_ok=True)
        
        # åˆ›å»ºä»Šæ—¥æ—¥å¿—æ–‡ä»¶
        today = datetime.now().strftime('%Y-%m-%d')
        self.log_file = self.log_dir / f'{today}.log'
    
    def _write_log(self, level, message):
        """å†™å…¥æ—¥å¿—"""
        if level < self.level:
            return
        
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        level_name = self.LEVEL_NAMES[level]
        log_line = f'[{timestamp}] [{level_name}] {message}\n'
        
        # å†™å…¥æ–‡ä»¶
        try:
            with open(self.log_file, 'a', encoding='utf-8') as f:
                f.write(log_line)
        except Exception as e:
            print(f"å†™å…¥æ—¥å¿—å¤±è´¥: {e}")
        
        # è¾“å‡ºåˆ°æ§åˆ¶å°
        print(log_line.strip())
    
    def debug(self, message):
        """è°ƒè¯•ä¿¡æ¯"""
        self._write_log(self.DEBUG, message)
    
    def info(self, message):
        """ä¸€èˆ¬ä¿¡æ¯"""
        self._write_log(self.INFO, message)
    
    def warning(self, message):
        """è­¦å‘Šä¿¡æ¯"""
        self._write_log(self.WARNING, message)
    
    def error(self, message):
        """é”™è¯¯ä¿¡æ¯"""
        self._write_log(self.ERROR, message)
    
    def get_logs(self, level=None):
        """è¯»å–æ—¥å¿—"""
        if not self.log_file.exists():
            return []
        
        logs = []
        with open(self.log_file, 'r', encoding='utf-8') as f:
            for line in f:
                if level is None:
                    logs.append(line.strip())
                elif self.LEVEL_NAMES[level] in line:
                    logs.append(line.strip())
        
        return logs

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    logger = Logger(level=Logger.DEBUG)
    
    logger.debug("è¿™æ˜¯è°ƒè¯•ä¿¡æ¯")
    logger.info("ç¨‹åºå¯åŠ¨")
    logger.warning("å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜")
    logger.error("è¿æ¥æ•°æ®åº“å¤±è´¥")
    
    print("\n=== æ‰€æœ‰é”™è¯¯æ—¥å¿— ===")
    for log in logger.get_logs(Logger.ERROR):
        print(log)
```

---

## 7.7 è¯¾åç»ƒä¹ 

### ç»ƒä¹ 1: æ–‡ä»¶ç»Ÿè®¡å·¥å…·

ç¼–å†™ç¨‹åºç»Ÿè®¡æ–‡æœ¬æ–‡ä»¶:
- æ€»è¡Œæ•°
- æ€»å­—æ•°
- å­—ç¬¦æ•°
- æœ€é•¿è¡Œ

### ç»ƒä¹ 2: é…ç½®æ–‡ä»¶è¯»å†™

å®ç°è¯»å†™INIæ ¼å¼é…ç½®æ–‡ä»¶:
```ini
[database]
host = localhost
port = 3306

[app]
name = MyApp
version = 1.0
```

### ç»ƒä¹ 3: å¼‚å¸¸å®‰å…¨çš„è®¡ç®—å™¨

å®ç°ä¸€ä¸ªè®¡ç®—å™¨,å¤„ç†æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸:
- é™¤é›¶
- è¾“å…¥é”™è¯¯
- è¿ç®—ç¬¦é”™è¯¯

---

## 7.8 æœ¬ç« å°ç»“

### æ–‡ä»¶æ“ä½œ

```python
# è¯»å–
with open('file.txt', 'r', encoding='utf-8') as f:
    content = f.read()

# å†™å…¥
with open('file.txt', 'w', encoding='utf-8') as f:
    f.write('Hello')

# è¿½åŠ 
with open('file.txt', 'a', encoding='utf-8') as f:
    f.write('World')
```

### å¼‚å¸¸å¤„ç†

```python
try:
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    risky_operation()
except SpecificError as e:
    # å¤„ç†ç‰¹å®šå¼‚å¸¸
    handle_error(e)
except Exception as e:
    # å¤„ç†å…¶ä»–å¼‚å¸¸
    log_error(e)
else:
    # æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ
    success()
finally:
    # æ€»æ˜¯æ‰§è¡Œ
    cleanup()
```

### ä¸‹ä¸€ç« é¢„å‘Š

**ç¬¬8ç«  - æ ‡å‡†åº“ä¸å¸¸ç”¨æ¨¡å—**,å°†å­¦ä¹ :
- ğŸ“… datetimeæ—¶é—´å¤„ç†
- ğŸ”¢ math/randomæ•°å­¦è¿ç®—
- ğŸ“ reæ­£åˆ™è¡¨è¾¾å¼
- ğŸŒ json/csvæ•°æ®æ ¼å¼

---

[â† ä¸Šä¸€ç« ](./6-é¢å‘å¯¹è±¡ç¼–ç¨‹.md) | [è¿”å›ç›®å½•](./README.md) | [ä¸‹ä¸€ç« : æ ‡å‡†åº“ä¸å¸¸ç”¨æ¨¡å— â†’](./8-æ ‡å‡†åº“ä¸å¸¸ç”¨æ¨¡å—.md)
