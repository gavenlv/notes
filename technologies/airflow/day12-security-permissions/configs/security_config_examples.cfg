# Airflow 安全配置示例文件
# 包含 RBAC、LDAP、OAuth、Vault 等安全配置示例

[core]
# 核心安全配置
security_manager_class = airflow.www.security.CustomSecurityManager
fernet_key = your_fernet_key_here
donot_pickle = True

[webserver]
# Web 服务器安全配置
rbac = True
authenticate = True

# HTTPS 配置
# web_server_ssl_cert = /path/to/certificate.crt
# web_server_ssl_key = /path/to/private.key

# Cookie 安全设置
cookie_secure = True
cookie_httponly = True
cookie_samesite = Lax

# Session 设置
session_lifetime_minutes = 30
force_log_out_after = 30

# CSRF 保护
wtf_csrf_enabled = True
wtf_csrf_time_limit = 3600

# 密码策略
# minimum_password_length = 12
# password_reset_timeout = 2592000

[api]
# API 安全配置
auth_backend = airflow.api.auth.backend.basic_auth
enable_experimental_api = False

[ldap]
# LDAP 身份验证配置
uri = ldap://ldap.example.com:389
user_filter = objectClass=*
user_name_attr = uid
group_member_attr = memberUid
superuser_filter = memberOf=cn=airflow_admins,ou=groups,dc=example,dc=com
data_profiler_filter = memberOf=cn=airflow_users,ou=groups,dc=example,dc=com
bind_user = cn=Manager,dc=example,dc=com
bind_password = ldap_bind_password
basedn = dc=example,dc=com
cacert = /etc/ssl/certs/ldap.crt
search_scope = LEVEL

[oauth]
# OAuth 身份验证配置
# Google OAuth 示例
google_oauth_client_id = your_google_oauth_client_id
google_oauth_client_secret = your_google_oauth_client_secret

# GitHub OAuth 示例
github_oauth_client_id = your_github_oauth_client_id
github_oauth_client_secret = your_github_oauth_client_secret

# Azure AD OAuth 示例
azure_oauth_client_id = your_azure_oauth_client_id
azure_oauth_client_secret = your_azure_oauth_client_secret
azure_tenant_id = your_azure_tenant_id

[openid]
# OpenID Connect 配置
client_id = your_openid_client_id
client_secret = your_openid_client_secret
base_url = https://openid.example.com
oidc_scopes = openid,email,profile

[celery]
# Celery 安全配置
broker_transport_options = {'master_name': 'master'}
result_backend = db+postgresql://airflow:airflow@postgres/airflow
worker_prefetch_multiplier = 1

[sentry]
# Sentry 错误跟踪配置
sentry_dsn = your_sentry_dsn_here

[elasticsearch]
# Elasticsearch 日志配置
elasticsearch_host = elasticsearch.example.com
elasticsearch_port = 9200
elasticsearch_user = airflow
elasticsearch_password = elasticsearch_password
elasticsearch_timeout = 30

[kerberos]
# Kerberos 安全配置
ccache = /tmp/airflow_krb5_ccache
principal = airflow/_HOST@EXAMPLE.COM
reinit_frequency = 3600
config_path = /etc/krb5.conf

[secrets]
# 密钥管理后端配置

# HashiCorp Vault 后端
backend = airflow.providers.hashicorp.secrets.vault.VaultBackend
backend_kwargs = {"connections_path": "airflow/connections", "variables_path": "airflow/variables", "url": "http://vault:8200"}

# AWS Secrets Manager 后端
# backend = airflow.providers.amazon.aws.secrets.secrets_manager.SecretsManagerBackend
# backend_kwargs = {"connections_prefix": "airflow/connections", "variables_prefix": "airflow/variables"}

# Google Secret Manager 后端
# backend = airflow.providers.google.cloud.secrets.secret_manager.CloudSecretManagerBackend
# backend_kwargs = {"connections_prefix": "airflow-connections", "variables_prefix": "airflow-variables"}

[lineage]
# 数据血缘追踪配置
backend = airflow.lineage.backend.atlas
atlas_host = atlas.example.com
atlas_port = 21000
atlas_username = atlas_user
atlas_password = atlas_password

[smtp]
# SMTP 邮件配置（用于警报）
smtp_host = smtp.example.com
smtp_starttls = True
smtp_ssl = False
smtp_port = 587
smtp_mail_from = airflow@example.com

[metrics]
# 度量指标配置
metrics_allow_list = dagrun_duration,dagbag_size,task_instance_duration
metrics_block_list = 

[logging]
# 日志安全配置
remote_logging = True
remote_log_conn_id = elasticsearch_default
remote_base_log_folder = elasticsearch+https://elasticsearch.example.com:9200/airflow/logs

[cli]
# CLI 安全配置
api_client = airflow.api.client.local_client
endpoint_url = http://localhost:8080

[callbacks]
# 回调安全配置
on_success_callback = airflow.utils.callbacks.success_callback
on_failure_callback = airflow.utils.callbacks.failure_callback

[database]
# 数据库安全配置
sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@postgres/airflow
sql_alchemy_pool_enabled = True
sql_alchemy_pool_size = 5
sql_alchemy_max_overflow = 10
sql_engine_encoding = utf-8

[debug]
# 调试配置（生产环境中应禁用）
fail_fast = False

[smart_sensor]
# 智能传感器配置
use_smart_sensor = False
shard_code_upper_limit = 10000
sensors_enabled = NamedHivePartitionSensor,S3KeySensor