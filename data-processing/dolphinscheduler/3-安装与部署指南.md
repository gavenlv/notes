# 第3章 安装与部署指南

## 3.1 环境准备

### 3.1.1 系统要求

#### 硬件要求

| 环境 | CPU | 内存 | 硬盘 | 网络 |
|------|-----|------|------|------|
| 最小配置 | 2核 | 4GB | 20GB | 100Mbps |
| 推荐配置 | 4核 | 8GB | 100GB | 1Gbps |
| 生产环境 | 8核+ | 16GB+ | 200GB+ | 10Gbps |

#### 软件要求

- **操作系统**：Linux（推荐CentOS 7+、Ubuntu 18+）
- **JDK**：1.8+（推荐1.8u181+）
- **数据库**：MySQL 5.7+ 或 PostgreSQL 12+
- **ZooKeeper**：3.4.6+
- **Redis**：3.2+（可选，用于缓存）
- **Python**：3.6+（用于Python任务）

### 3.1.2 用户和权限配置

```bash
# 创建dolphinscheduler用户
sudo useradd dolphinscheduler
sudo echo "dolphinscheduler ALL=(ALL) NOPASSWD: NOPASSWD: ALL" >> /etc/sudoers
sudo su - dolphinscheduler

# 创建工作目录
mkdir -p /opt/dolphinscheduler
cd /opt/dolphinscheduler
```

### 3.1.3 网络和端口规划

| 服务 | 端口 | 说明 |
|------|------|------|
| Master Server | 5678 | Master RPC端口 |
| Worker Server | 1234 | Worker RPC端口 |
| API Server | 12345 | API服务端口 |
| Logger Server | 50051 | 日志服务端口 |
| Alert Server | 50052 | 告警服务端口 |
| UI Frontend | 12345 | Web访问端口 |

### 3.1.4 数据库准备

#### MySQL数据库初始化

```sql
-- 创建数据库
CREATE DATABASE dolphinscheduler DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;

-- 创建用户
CREATE USER 'dolphinscheduler'@'%' IDENTIFIED BY 'dolphinscheduler';
GRANT ALL PRIVILEGES ON dolphinscheduler.* TO 'dolphinscheduler'@'%';
FLUSH PRIVILEGES;
```

#### PostgreSQL数据库初始化

```sql
-- 创建用户和数据库
CREATE USER dolphinscheduler WITH PASSWORD 'dolphinscheduler';
CREATE DATABASE dolphinscheduler OWNER dolphinscheduler;
GRANT ALL PRIVILEGES ON DATABASE dolphinscheduler TO dolphinscheduler;
```

## 3.2 安装包下载

### 3.2.1 官方下载

访问DolphinScheduler官网下载最新版本：

```bash
# 下载二进制包
wget https://dlcdn.apache.org/dolphinscheduler/3.1.0/apache-dolphinscheduler-3.1.0-bin.tar.gz

# 解压
tar -zxvf apache-dolphinscheduler-3.1.0-bin.tar.gz
```

### 3.2.2 源码编译

```bash
# 克隆源码
git clone https://github.com/apache/dolphinscheduler.git
cd dolphinscheduler

# 编译
mvn -U clean package -DskipTests -Prelease

# 编译后的包在 dolphinscheduler-dist/target/
```

## 3.3 伪集群部署

伪集群部署适合测试和学习环境，所有服务部署在同一台机器上。

### 3.3.1 环境配置

创建环境配置文件 `dolphinscheduler_env.sh`：

```bash
#!/bin/bash
# Java环境
export JAVA_HOME=/opt/java/jdk1.8.0_281
export HADOOP_HOME=/opt/hadoop
export HADOOP_CONF_DIR=/opt/hadoop/etc/hadoop
export SPARK_HOME1=/opt/spark
export SPARK_HOME2=/opt/spark2
export PYTHON_HOME=/usr/bin/python
export HIVE_HOME=/opt/hive

# 数据库配置
export DATABASE="mysql"
export SPRING_PROFILES_ACTIVE="mysql"
export SPRING_DATASOURCE_URL="jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true"
export SPRING_DATASOURCE_USERNAME="dolphinscheduler"
export SPRING_DATASOURCE_PASSWORD="dolphinscheduler"

# ZooKeeper配置
export REGISTRY_ZOOKEEPER_CONNECT_STRING="127.0.0.1:2181"

# 监控配置
export XLS_FILE_PATH="/opt/soft/xls"
export MONITOR_DB_STATE="false"
export MAIL_SERVER_HOST="smtp.163.com"
export MAIL_SERVER_PORT="25"
export MAIL_SENDER="xxx@163.com"
export MAIL_USERPASS="xxx"
export START_PROCESS_COUNT="20"
export EXECUTION_THREADS="20"
```

### 3.3.2 安装脚本执行

```bash
# 1. 初始化数据库
sh /opt/dolphinscheduler/bin/create-dolphinscheduler.sh

# 2. 启动所有服务
sh /opt/dolphinscheduler/bin/start-all.sh
```

### 3.3.3 服务状态检查

```bash
# 检查服务状态
sh /opt/dolphinscheduler/bin/status-all.sh

# 检查日志
tail -f /opt/dolphinscheduler/logs/dolphinscheduler-master.log
tail -f /opt/dolphinscheduler/logs/dolphinscheduler-worker.log
```

## 3.4 集群部署

集群部署适合生产环境，服务分布在多台机器上。

### 3.4.1 集群规划

| 节点 | 服务 |
|------|------|
| ds1 | Master, API, UI, Logger, Alert |
| ds2 | Master, Worker |
| ds3 | Master, Worker |
| ds4 | Worker, Worker |
| zk1 | ZooKeeper |
| zk2 | ZooKeeper |
| zk3 | ZooKeeper |
| db1 | MySQL |

### 3.4.2 Master节点部署

在Master节点上配置 `application.yaml`：

```yaml
# master配置
master:
  listen-port: 5678
  exec-threads: 100
  exec-task-num: 20
  fetch-task-num: 3

# 数据库配置
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://db1:3306/dolphinscheduler?useUnicode=true&characterEncoding=UTF-8
    username: dolphinscheduler
    password: dolphinscheduler
    
# ZooKeeper配置
registry:
  type: zookeeper
  zookeeper:
    namespace: dolphinscheduler
    connect-string: zk1:2181,zk2:2181,zk3:2181
```

启动Master服务：

```bash
# 启动Master
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh start master-server

# 检查状态
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status master-server
```

### 3.4.3 Worker节点部署

在Worker节点上配置 `worker.properties`：

```properties
# worker配置
worker.exec.threads=20
worker.heartbeat.interval=30
worker.max.cpuload.avg=10
worker.max.memory.avg=80

# registry配置
worker.registry.type=zookeeper
worker.registry.zookeeper.namespace=dolphinscheduler
worker.registry.zookeeper.connect-string=zk1:2181,zk2:2181,zk3:2181

# 数据源配置
worker.datasource.driver-class-name=com.mysql.jdbc.Driver
worker.datasource.url=jdbc:mysql://db1:3306/dolphinscheduler?useUnicode=true&characterEncoding=UTF-8
worker.datasource.username=dolphinscheduler
worker.datasource.password=dolphinscheduler
```

启动Worker服务：

```bash
# 启动Worker
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh start worker-server

# 检查状态
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status worker-server
```

### 3.4.4 API和UI部署

配置 `api-application.yaml`：

```yaml
server:
  port: 12345

spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://db1:3306/dolphinscheduler?useUnicode=true&characterEncoding=UTF-8
    username: dolphinscheduler
    password: dolphinscheduler

registry:
  type: zookeeper
  zookeeper:
    namespace: dolphinscheduler
    connect-string: zk1:2181,zk2:2181,zk3:2181
```

启动API服务：

```bash
# 启动API服务
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh start api-server

# 启动日志服务
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh start logger-server

# 启动告警服务
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh start alert-server
```

### 3.4.5 前端部署

```bash
# 安装nginx
sudo yum install -y nginx

# 配置nginx
sudo vim /etc/nginx/conf.d/dolphinscheduler.conf
```

Nginx配置：

```nginx
server {
    listen 8888;
    server_name localhost;
    
    location / {
        root /opt/dolphinscheduler/ui/dist;
        index index.html index.htm;
    }
    
    location /dolphinscheduler {
        proxy_pass http://localhost:12345;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

启动Nginx：

```bash
sudo systemctl start nginx
sudo systemctl enable nginx
```

## 3.5 Docker部署

### 3.5.1 Docker Compose方式

创建 `docker-compose.yml`：

```yaml
version: '3.1'

services:
  dolphinscheduler-postgresql:
    image: postgres:12-alpine
    container_name: dolphinscheduler-postgresql
    environment:
      POSTGRES_USER: dolphinscheduler
      POSTGRES_PASSWORD: dolphinscheduler
      POSTGRES_DB: dolphinscheduler
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U dolphinscheduler"]
      interval: 10s
      timeout: 5s
      retries: 5

  dolphinscheduler-zookeeper:
    image: zookeeper:3.4.14
    container_name: dolphinscheduler-zookeeper
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=dolphinscheduler-zookeeper:2888:3888
    ports:
      - "2181:2181"

  dolphinscheduler-master:
    image: apache/dolphinscheduler:latest
    container_name: dolphinscheduler-master
    depends_on:
      dolphinscheduler-postgresql:
        condition: service_healthy
      dolphinscheduler-zookeeper:
        condition: service_started
    command: ["master-server"]
    ports:
      - "12345:12345"
    environment:
      DATABASE_TYPE: postgresql
      DATABASE_DRIVER: org.postgresql.Driver
      DATABASE_HOST: dolphinscheduler-postgresql
      DATABASE_PORT: 5432
      DATABASE_USERNAME: dolphinscheduler
      DATABASE_PASSWORD: dolphinscheduler
      DATABASE_DATABASE: dolphinscheduler
      REGISTRY_ZOOKEEPER_CONNECT_STRING: dolphinscheduler-zookeeper:2181

  dolphinscheduler-worker:
    image: apache/dolphinscheduler:latest
    container_name: dolphinscheduler-worker
    depends_on:
      dolphinscheduler-postgresql:
        condition: service_healthy
      dolphinscheduler-zookeeper:
        condition: service_started
    command: ["worker-server"]
    ports:
      - "1234:1234"
    environment:
      DATABASE_TYPE: postgresql
      DATABASE_DRIVER: org.postgresql.Driver
      DATABASE_HOST: dolphinscheduler-postgresql
      DATABASE_PORT: 5432
      DATABASE_USERNAME: dolphinscheduler
      DATABASE_PASSWORD: dolphinscheduler
      DATABASE_DATABASE: dolphinscheduler
      REGISTRY_ZOOKEEPER_CONNECT_STRING: dolphinscheduler-zookeeper:2181

  dolphinscheduler-api:
    image: apache/dolphinscheduler:latest
    container_name: dolphinscheduler-api
    depends_on:
      dolphinscheduler-postgresql:
        condition: service_healthy
      dolphinscheduler-zookeeper:
        condition: service_started
    command: ["api-server"]
    ports:
      - "12345:12345"
    environment:
      DATABASE_TYPE: postgresql
      DATABASE_DRIVER: org.postgresql.Driver
      DATABASE_HOST: dolphinscheduler-postgresql
      DATABASE_PORT: 5432
      DATABASE_USERNAME: dolphinscheduler
      DATABASE_PASSWORD: dolphinscheduler
      DATABASE_DATABASE: dolphinscheduler
      REGISTRY_ZOOKEEPER_CONNECT_STRING: dolphinscheduler-zookeeper:2181

  dolphinscheduler-alert:
    image: apache/dolphinscheduler:latest
    container_name: dolphinscheduler-alert
    depends_on:
      dolphinscheduler-postgresql:
        condition: service_healthy
      dolphinscheduler-zookeeper:
        condition: service_started
    command: ["alert-server"]
    ports:
      - "50052:50052"
    environment:
      DATABASE_TYPE: postgresql
      DATABASE_DRIVER: org.postgresql.Driver
      DATABASE_HOST: dolphinscheduler-postgresql
      DATABASE_PORT: 5432
      DATABASE_USERNAME: dolphinscheduler
      DATABASE_PASSWORD: dolphinscheduler
      DATABASE_DATABASE: dolphinscheduler
      REGISTRY_ZOOKEEPER_CONNECT_STRING: dolphinscheduler-zookeeper:2181

volumes:
  postgres_data:
```

启动Docker Compose：

```bash
# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f dolphinscheduler-master
docker-compose logs -f dolphinscheduler-worker
```

### 3.5.2 单独Docker部署

#### 数据库容器

```bash
# 启动PostgreSQL
docker run -d --name dolphinscheduler-postgresql \
  -e POSTGRES_USER=dolphinscheduler \
  -e POSTGRES_PASSWORD=dolphinscheduler \
  -e POSTGRES_DB=dolphinscheduler \
  -p 5432:5432 \
  postgres:12-alpine

# 启动ZooKeeper
docker run -d --name dolphinscheduler-zookeeper \
  -p 2181:2181 \
  zookeeper:3.4.14
```

#### DolphinScheduler容器

```bash
# 启动Master
docker run -d --name dolphinscheduler-master \
  --link dolphinscheduler-postgresql:postgres \
  --link dolphinscheduler-zookeeper:zookeeper \
  -p 12345:12345 \
  -e DATABASE_TYPE=postgresql \
  -e DATABASE_DRIVER=org.postgresql.Driver \
  -e DATABASE_HOST=postgres \
  -e DATABASE_PORT=5432 \
  -e DATABASE_USERNAME=dolphinscheduler \
  -e DATABASE_PASSWORD=dolphinscheduler \
  -e DATABASE_DATABASE=dolphinscheduler \
  -e REGISTRY_ZOOKEEPER_CONNECT_STRING=zookeeper:2181 \
  apache/dolphinscheduler:latest master-server

# 启动Worker
docker run -d --name dolphinscheduler-worker \
  --link dolphinscheduler-postgresql:postgres \
  --link dolphinscheduler-zookeeper:zookeeper \
  -p 1234:1234 \
  -e DATABASE_TYPE=postgresql \
  -e DATABASE_DRIVER=org.postgresql.Driver \
  -e DATABASE_HOST=postgres \
  -e DATABASE_PORT=5432 \
  -e DATABASE_USERNAME=dolphinscheduler \
  -e DATABASE_PASSWORD=dolphinscheduler \
  -e DATABASE_DATABASE=dolphinscheduler \
  -e REGISTRY_ZOOKEEPER_CONNECT_STRING=zookeeper:2181 \
  apache/dolphinscheduler:latest worker-server
```

## 3.6 Kubernetes部署

### 3.6.1 命名空间创建

```yaml
# dolphinscheduler-namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: dolphinscheduler
```

### 3.6.2 数据库部署

```yaml
# dolphinscheduler-postgresql.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dolphinscheduler-postgresql
  namespace: dolphinscheduler
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dolphinscheduler-postgresql
  template:
    metadata:
      labels:
        app: dolphinscheduler-postgresql
    spec:
      containers:
      - name: postgresql
        image: postgres:12-alpine
        env:
        - name: POSTGRES_USER
          value: "dolphinscheduler"
        - name: POSTGRES_PASSWORD
          value: "dolphinscheduler"
        - name: POSTGRES_DB
          value: "dolphinscheduler"
        ports:
        - containerPort: 5432
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
      volumes:
      - name: postgres-storage
        persistentVolumeClaim:
          claimName: postgres-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: dolphinscheduler-postgresql
  namespace: dolphinscheduler
spec:
  ports:
  - port: 5432
    targetPort: 5432
  selector:
    app: dolphinscheduler-postgresql
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pvc
  namespace: dolphinscheduler
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
```

### 3.6.3 ZooKeeper部署

```yaml
# dolphinscheduler-zookeeper.yaml
apiVersion: v1
kind: Service
metadata:
  name: dolphinscheduler-zookeeper
  namespace: dolphinscheduler
spec:
  ports:
  - port: 2181
    name: client
  - port: 2888
    name: server
  - port: 3888
    name: leader-election
  selector:
    app: dolphinscheduler-zookeeper
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: dolphinscheduler-zookeeper
  namespace: dolphinscheduler
spec:
  serviceName: dolphinscheduler-zookeeper
  replicas: 3
  selector:
    matchLabels:
      app: dolphinscheduler-zookeeper
  template:
    metadata:
      labels:
        app: dolphinscheduler-zookeeper
    spec:
      containers:
      - name: zookeeper
        image: zookeeper:3.4.14
        env:
        - name: ZOO_MY_ID
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: ZOO_SERVERS
          value: "server.1=dolphinscheduler-zookeeper-0.dolphinscheduler-zookeeper:2888:3888;server.2=dolphinscheduler-zookeeper-1.dolphinscheduler-zookeeper:2888:3888;server.3=dolphinscheduler-zookeeper-2.dolphinscheduler-zookeeper:2888:3888"
        ports:
        - containerPort: 2181
        - containerPort: 2888
        - containerPort: 3888
```

### 3.6.4 Master部署

```yaml
# dolphinscheduler-master.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dolphinscheduler-master-config
  namespace: dolphinscheduler
data:
  application.yaml: |
    master:
      listen-port: 5678
      exec-threads: 100
      exec-task-num: 20
      fetch-task-num: 3
    
    registry:
      type: zookeeper
      zookeeper:
        namespace: dolphinscheduler
        connect-string: dolphinscheduler-zookeeper:2181
    
    spring:
      datasource:
        driver-class-name: org.postgresql.Driver
        url: jdbc:postgresql://dolphinscheduler-postgresql:5432/dolphinscheduler
        username: dolphinscheduler
        password: dolphinscheduler
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dolphinscheduler-master
  namespace: dolphinscheduler
spec:
  replicas: 3
  selector:
    matchLabels:
      app: dolphinscheduler-master
  template:
    metadata:
      labels:
        app: dolphinscheduler-master
    spec:
      containers:
      - name: master
        image: apache/dolphinscheduler:latest
        command: ["master-server"]
        ports:
        - containerPort: 5678
        volumeMounts:
        - name: master-config
          mountPath: /opt/dolphinscheduler/conf/application.yaml
          subPath: application.yaml
      volumes:
      - name: master-config
        configMap:
          name: dolphinscheduler-master-config
---
apiVersion: v1
kind: Service
metadata:
  name: dolphinscheduler-master
  namespace: dolphinscheduler
spec:
  ports:
  - port: 5678
    targetPort: 5678
  selector:
    app: dolphinscheduler-master
```

### 3.6.5 Worker部署

```yaml
# dolphinscheduler-worker.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dolphinscheduler-worker-config
  namespace: dolphinscheduler
data:
  worker.properties: |
    worker.exec.threads=20
    worker.heartbeat.interval=30
    worker.max.cpuload.avg=10
    worker.max.memory.avg=80
    
    worker.registry.type=zookeeper
    worker.registry.zookeeper.namespace=dolphinscheduler
    worker.registry.zookeeper.connect-string=dolphinscheduler-zookeeper:2181
    
    worker.datasource.driver-class-name=org.postgresql.Driver
    worker.datasource.url=jdbc:postgresql://dolphinscheduler-postgresql:5432/dolphinscheduler
    worker.datasource.username=dolphinscheduler
    worker.datasource.password=dolphinscheduler
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dolphinscheduler-worker
  namespace: dolphinscheduler
spec:
  replicas: 3
  selector:
    matchLabels:
      app: dolphinscheduler-worker
  template:
    metadata:
      labels:
        app: dolphinscheduler-worker
    spec:
      containers:
      - name: worker
        image: apache/dolphinscheduler:latest
        command: ["worker-server"]
        ports:
        - containerPort: 1234
        volumeMounts:
        - name: worker-config
          mountPath: /opt/dolphinscheduler/conf/worker.properties
          subPath: worker.properties
      volumes:
      - name: worker-config
        configMap:
          name: dolphinscheduler-worker-config
---
apiVersion: v1
kind: Service
metadata:
  name: dolphinscheduler-worker
  namespace: dolphinscheduler
spec:
  ports:
  - port: 1234
    targetPort: 1234
  selector:
    app: dolphinscheduler-worker
```

### 3.6.6 UI和API部署

```yaml
# dolphinscheduler-api.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: dolphinscheduler-api-config
  namespace: dolphinscheduler
data:
  application.yaml: |
    server:
      port: 12345
    
    spring:
      datasource:
        driver-class-name: org.postgresql.Driver
        url: jdbc:postgresql://dolphinscheduler-postgresql:5432/dolphinscheduler
        username: dolphinscheduler
        password: dolphinscheduler
    
    registry:
      type: zookeeper
      zookeeper:
        namespace: dolphinscheduler
        connect-string: dolphinscheduler-zookeeper:2181
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dolphinscheduler-api
  namespace: dolphinscheduler
spec:
  replicas: 2
  selector:
    matchLabels:
      app: dolphinscheduler-api
  template:
    metadata:
      labels:
        app: dolphinscheduler-api
    spec:
      containers:
      - name: api
        image: apache/dolphinscheduler:latest
        command: ["api-server"]
        ports:
        - containerPort: 12345
        volumeMounts:
        - name: api-config
          mountPath: /opt/dolphinscheduler/conf/application.yaml
          subPath: application.yaml
      volumes:
      - name: api-config
        configMap:
          name: dolphinscheduler-api-config
---
apiVersion: v1
kind: Service
metadata:
  name: dolphinscheduler-api
  namespace: dolphinscheduler
spec:
  type: NodePort
  ports:
  - port: 12345
    targetPort: 12345
    nodePort: 32345
  selector:
    app: dolphinscheduler-api
```

### 3.6.7 部署执行

```bash
# 创建命名空间
kubectl apply -f dolphinscheduler-namespace.yaml

# 部署数据库
kubectl apply -f dolphinscheduler-postgresql.yaml

# 部署ZooKeeper
kubectl apply -f dolphinscheduler-zookeeper.yaml

# 部署Master
kubectl apply -f dolphinscheduler-master.yaml

# 部署Worker
kubectl apply -f dolphinscheduler-worker.yaml

# 部署API和UI
kubectl apply -f dolphinscheduler-api.yaml

# 查看部署状态
kubectl get pods -n dolphinscheduler
kubectl get services -n dolphinscheduler
```

## 3.7 验证部署

### 3.7.1 服务状态检查

```bash
# 检查所有服务状态
sh /opt/dolphinscheduler/bin/status-all.sh

# 或单独检查
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status master-server
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status worker-server
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status api-server
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status logger-server
sh /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh status alert-server
```

### 3.7.2 日志检查

```bash
# 查看Master日志
tail -f /opt/dolphinscheduler/logs/dolphinscheduler-master.log

# 查看Worker日志
tail -f /opt/dolphinscheduler/logs/dolphinscheduler-worker.log

# 查看API日志
tail -f /opt/dolphinscheduler/logs/dolphinscheduler-api.log
```

### 3.7.3 访问测试

打开浏览器访问：http://<your-server-ip>:12345

默认账号：admin
默认密码：dolphinscheduler123

## 3.8 常见问题与解决方案

### 3.8.1 数据库连接问题

**问题**：无法连接到数据库
**解决方案**：
1. 检查数据库服务是否启动
2. 检查网络连接和防火墙设置
3. 检查数据库用户权限
4. 检查JDBC URL格式是否正确

### 3.8.2 ZooKeeper连接问题

**问题**：无法连接到ZooKeeper
**解决方案**：
1. 检查ZooKeeper服务状态
2. 检查ZooKeeper配置是否正确
3. 检查网络连通性
4. 检查防火墙设置

### 3.8.3 内存不足问题

**问题**：服务启动失败，提示内存不足
**解决方案**：
1. 调整JVM内存参数
2. 检查系统可用内存
3. 优化服务配置参数

```bash
# 修改内存参数
vim /opt/dolphinscheduler/bin/env/dolphinscheduler_env.sh

# 调整内存大小
export Xms="2g"
export Xmx="2g"
export Xmn="1g"
```

### 3.8.4 端口占用问题

**问题**：端口被占用导致服务启动失败
**解决方案**：
1. 查找占用端口的进程
2. 修改服务配置使用其他端口
3. 停止占用端口的进程

```bash
# 查找占用端口的进程
netstat -tunlp | grep 12345

# 杀掉进程
kill -9 <pid>
```

## 3.9 性能优化

### 3.9.1 JVM参数优化

```bash
# Master服务JVM参数
export MASTER_JVM_OPTS="-server -Xms4g -Xmx4g -Xmn2g -XX:+UseG1GC -XX:MaxGCPauseMillis=100"

# Worker服务JVM参数
export WORKER_JVM_OPTS="-server -Xms2g -Xmx2g -Xmn1g -XX:+UseG1GC -XX:MaxGCPauseMillis=100"
```

### 3.9.2 数据库优化

```sql
-- MySQL优化
SET GLOBAL max_connections=1000;
SET GLOBAL innodb_buffer_pool_size=4294967296; -- 4GB

-- PostgreSQL优化
ALTER SYSTEM SET max_connections = 1000;
ALTER SYSTEM SET shared_buffers = '1GB';
ALTER SYSTEM SET work_mem = '16MB';
```

### 3.9.3 网络优化

```bash
# 调整TCP参数
echo 'net.core.rmem_max = 16777216' >> /etc/sysctl.conf
echo 'net.core.wmem_max = 16777216' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem = 4096 65536 16777216' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_wmem = 4096 65536 16777216' >> /etc/sysctl.conf
sysctl -p
```

## 3.10 小结

本章详细介绍了DolphinScheduler的多种安装部署方式：

1. **环境准备**：详细的硬件和软件要求
2. **伪集群部署**：适合测试和学习环境
3. **集群部署**：适合生产环境的分布式部署
4. **Docker部署**：容器化部署方案
5. **Kubernetes部署**：云原生部署方案
6. **验证部署**：确保服务正常运行
7. **问题解决**：常见问题及解决方案
8. **性能优化**：部署后的性能调优建议

在下一章中，我们将介绍如何创建和管理DolphinScheduler的核心对象，包括项目、租户、用户等。