# 第1章 DolphinScheduler简介与安装

## 1.1 什么是DolphinScheduler

Apache DolphinScheduler是一个分布式去中心化、易扩展的可视化工作流任务调度系统，致力于解决数据处理流程中复杂的依赖关系，使整个数据处理流程直观可见。

### 1.1.1 调度系统的演变

在现代数据驱动型企业中，数据处理的复杂性与日俱增，调度系统经历了以下演变：

1. **单机Cron任务**：最早期的简单定时任务，适用于简单场景
2. **工作流调度器**：如Oozie、Azkaban等，支持DAG工作流
3. **现代化调度系统**：如DolphinScheduler、Airflow等，支持可视化、分布式执行

DolphinScheduler正是在这个背景下诞生，旨在解决企业级数据工作流调度的各种挑战。

### 1.1.2 DolphinScheduler的核心定位

- **分布式**：支持多节点部署，实现高可用和水平扩展
- **去中心化**：采用Master-Worker架构，Master无状态，可以随时扩展
- **可视化**：提供直观的拖拽式工作流设计界面
- **易扩展**：支持自定义任务类型和插件

## 1.2 DolphinScheduler的核心特点

### 1.2.1 主要特点

1. **可视化DAG设计**
   - 拖拽式界面设计工作流
   - 直观展示任务依赖关系
   - 支持工作流版本管理

2. **丰富的任务类型**
   - Shell脚本
   - SQL查询（MySQL、PostgreSQL、ClickHouse等）
   - Spark任务
   - Flink任务
   - HTTP请求
   - Python脚本
   - 条件分支
   - 子工作流

3. **强大的调度功能**
   - Cron表达式定时调度
   - 手动触发
   - 优先级调度
   - 失败重试
   - 补数机制

4. **完善的监控告警**
   - 任务执行状态监控
   - 执行日志查看
   - 性能指标统计
   - 多渠道告警（邮件、钉钉、企业微信等）

5. **高可用架构**
   - Master/Worker多节点部署
   - ZooKeeper协调
   - 数据库持久化
   - 容错机制

### 1.2.2 与其他调度系统的对比

| 特性 | DolphinScheduler | Airflow | Oozie | Azkaban |
|------|------------------|---------|-------|---------|
| 可视化设计 | ✅ 拖拽式界面 | ✅ 基础界面 | ❌ 代码配置 | ✅ 基础界面 |
| 任务类型 | 丰富 | 丰富 | 有限 | 有限 |
| 分布式执行 | ✅ | ✅ | ✅ | ✅ |
| 易用性 | 高 | 中 | 低 | 中 |
| 扩展性 | 高 | 高 | 中 | 中 |
| 社区活跃度 | 高 | 非常高 | 中 | 低 |

## 1.3 系统架构

### 1.3.1 整体架构图

```
┌─────────────────────────────────────────────────────────┐
│                    DolphinScheduler                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │    UI       │  │   API       │  │  Logger     │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                         │
├─────────────────────────────────────────────────────────┤
│                     Master集群                          │
│                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │   Master1   │  │   Master2   │  │   Master3   │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                         │
├─────────────────────────────────────────────────────────┤
│                     Worker集群                          │
│                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │   Worker1   │  │   Worker2   │  │   Worker3   │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                         │
├─────────────────────────────────────────────────────────┤
│                ZooKeeper集群                            │
│                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │    ZK1      │  │    ZK2      │  │    ZK3      │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                         │
├─────────────────────────────────────────────────────────┤
│                   数据库存储                            │
│                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │   MySQL     │  │ PostgreSQL  │  │  DA-Meta    │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 1.3.2 核心组件详解

#### 1.3.2.1 Master Server

Master是DolphinScheduler的核心调度服务，负责：

- 工作流定义解析
- 任务调度逻辑处理
- 任务分发和监控
- Master节点选举

Master通过ZooKeeper实现高可用，集群中只有一个处于active状态，其他处于standby状态。

#### 1.3.2.2 Worker Server

Worker是任务执行服务，负责：

- 接收Master分发的任务
- 执行具体任务
- 上报任务执行状态
- 任务日志收集

Worker可以水平扩展，支持不同类型的Worker（如Python Worker、Spark Worker等）。

#### 1.3.2.3 API Server

API Server提供RESTful API，用于：

- 工作流管理
- 任务监控
- 用户认证
- 系统配置

#### 1.3.2.4 UI Frontend

Web前端界面，提供：

- 工作流可视化设计
- 任务执行监控
- 系统管理
- 用户管理

#### 1.3.2.5 Logger Server

日志服务，负责：

- 收集Worker上报的任务日志
- 提供日志查询接口
- 清理过期日志

#### 1.3.2.6 Alert Server

告警服务，负责：

- 监控任务执行状态
- 触发告警规则
- 发送告警通知

## 1.4 核心概念

### 1.4.1 工作流定义（Workflow Definition）

工作流定义是一个DAG（有向无环图），由多个任务节点组成，定义了任务之间的依赖关系。

### 1.4.2 工作流实例（Workflow Instance）

工作流定义的一次具体执行，包含该次执行的所有任务实例。

### 1.4.3 任务定义（Task Definition）

工作流中的单个任务节点，包含任务类型、参数、依赖关系等信息。

### 1.4.4 任务实例（Task Instance）

任务定义的一次具体执行，记录执行状态、日志、结果等信息。

### 1.4.5 定时调度（Schedule）

工作流的定时执行配置，支持Cron表达式。

### 1.4.6 租户（Tenant）

租户是资源隔离的基本单位，每个租户有独立的资源配额。

### 1.4.7 项目（Project）

项目是工作流的组织单位，用户可以在项目下创建和管理工作流。

## 1.5 环境准备

### 1.5.1 硬件要求

#### 最小配置（测试环境）
- CPU: 2核心
- 内存: 4GB
- 硬盘: 20GB
- 网络: 100Mbps

#### 推荐配置（生产环境）
- Master节点: 4核心，8GB内存，100GB硬盘
- Worker节点: 8核心，16GB内存，200GB硬盘
- 数据库: 8核心，16GB内存，200GB硬盘
- ZooKeeper: 2核心，4GB内存，50GB硬盘

### 1.5.2 软件要求

#### 必需软件
- JDK 1.8+（推荐1.8u181+）
- MySQL 5.7+ 或 PostgreSQL 12+
- ZooKeeper 3.4.6+
- Redis（可选，用于缓存）

#### 可选软件
- Python 3.6+（用于Python任务）
- Node.js（用于前端开发）
- Docker（用于容器化部署）

### 1.5.3 网络要求

- 所有服务器之间网络互通
- Worker节点需要访问数据源
- UI访问端口需要开放（默认12345）

## 1.6 安装方式

DolphinScheduler支持多种安装方式：

### 1.6.1 伪集群部署
适合测试和学习环境，所有服务部署在同一台机器上。

### 1.6.2 集群部署
适合生产环境，服务分布在多台机器上。

### 1.6.3 Docker部署
适合快速体验和开发环境。

### 1.6.4 Kubernetes部署
适合云原生环境和容器化部署。

## 1.7 快速开始

让我们通过一个简单的例子快速体验DolphinScheduler：

1. 安装DolphinScheduler
2. 创建第一个项目
3. 设计一个简单的工作流
4. 执行并监控工作流

在接下来的章节中，我们将详细介绍每种安装方式，并完成这个快速开始的例子。

## 1.8 小结

本章介绍了DolphinScheduler的基本概念、特点和架构，帮助您对DolphinScheduler有一个全面的了解。我们了解到：

- DolphinScheduler是一个现代化的分布式工作流调度系统
- 它采用Master-Worker架构，支持高可用和水平扩展
- 提供可视化的工作流设计界面
- 支持丰富的任务类型和调度策略
- 具备完善的监控告警机制

在下一章中，我们将详细介绍如何安装和部署DolphinScheduler，并创建我们的第一个工作流。