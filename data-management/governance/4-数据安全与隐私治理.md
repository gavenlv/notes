# ç¬¬4ç« ï¼šæ•°æ®å®‰å…¨ä¸éšç§æ²»ç†

## ç« èŠ‚æ¦‚è¿°

æœ¬ç« å°†æ·±å…¥æ¢è®¨æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†çš„æ ¸å¿ƒæ¦‚å¿µã€æ–¹æ³•å’Œå®è·µã€‚åœ¨æ•°æ®é©±åŠ¨çš„æ—¶ä»£ï¼Œæ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤å·²æˆä¸ºä¼ä¸šå’Œç»„ç»‡çš„æ ¸å¿ƒå…³åˆ‡ã€‚æˆ‘ä»¬å°†ä»é›¶å¼€å§‹ï¼Œç³»ç»Ÿå­¦ä¹ å¦‚ä½•æ„å»ºå…¨é¢çš„æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤ä½“ç³»ï¼Œç¡®ä¿æ•°æ®èµ„äº§çš„å®‰å…¨æ€§å’Œåˆè§„æ€§ã€‚

## å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

1. ç†è§£æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†çš„æ ¸å¿ƒæ¦‚å¿µå’Œé‡è¦æ€§
2. æŒæ¡æ•°æ®å®‰å…¨æ¶æ„è®¾è®¡å’Œé£é™©è¯„ä¼°æ–¹æ³•
3. å­¦ä¼šå®æ–½éšç§ä¿æŠ¤æŠ€æœ¯å’Œéšç§å¢å¼ºæŠ€æœ¯
4. ç†è§£æ•°æ®åˆè§„è¦æ±‚ä¸æ³•è§„æ¡†æ¶
5. æŒæ¡æ•°æ®è®¿é—®æ§åˆ¶å’Œèº«ä»½è®¤è¯æœºåˆ¶
6. èƒ½å¤Ÿè®¾è®¡å’Œå®æ–½æ•°æ®å®‰å…¨äº‹ä»¶å“åº”è®¡åˆ’

---

## 4.1 æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†åŸºç¡€

### 4.1.1 æ•°æ®å®‰å…¨ä¸éšç§çš„å®šä¹‰

#### æ•°æ®å®‰å…¨çš„å®šä¹‰

æ•°æ®å®‰å…¨æ˜¯æŒ‡ä¿æŠ¤æ•°æ®å…å—æœªç»æˆæƒçš„è®¿é—®ã€ä½¿ç”¨ã€æŠ«éœ²ã€ä¿®æ”¹ã€ç ´åæˆ–æ³„éœ²ã€‚æ•°æ®å®‰å…¨æ¶µç›–ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ ï¼š

1. **æœºå¯†æ€§ï¼ˆConfidentialityï¼‰**ï¼šç¡®ä¿æ•°æ®ä»…è¢«æˆæƒäººå‘˜è®¿é—®
2. **å®Œæ•´æ€§ï¼ˆIntegrityï¼‰**ï¼šç¡®ä¿æ•°æ®åœ¨ä¼ è¾“å’Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¸è¢«ç¯¡æ”¹
3. **å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰**ï¼šç¡®ä¿æˆæƒç”¨æˆ·åœ¨éœ€è¦æ—¶èƒ½å¤Ÿè®¿é—®æ•°æ®

> **æ€è€ƒé¢˜**ï¼šä¸ºä»€ä¹ˆè¯´æ•°æ®å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§çš„é¡¹ç›®ï¼Ÿ

#### éšç§çš„å®šä¹‰ä¸ç‰¹ç‚¹

éšç§æ˜¯æŒ‡ä¸ªäººå¯¹å…¶ä¸ªäººä¿¡æ¯çš„æ§åˆ¶æƒã€‚éšç§ä¿æŠ¤å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ä¸ªäººæƒåˆ©å¯¼å‘**ï¼šå¼ºè°ƒä¸ªäººå¯¹å…¶ä¿¡æ¯çš„æ§åˆ¶
2. **æƒ…å¢ƒç›¸å…³æ€§**ï¼šéšç§æœŸæœ›å› æƒ…å¢ƒè€Œå¼‚
3. **åŠ¨æ€æ¼”è¿›æ€§**ï¼šéšç§æ¦‚å¿µéšæŠ€æœ¯å’Œæ–‡åŒ–å‘å±•è€Œå˜åŒ–
4. **åˆè§„é©±åŠ¨æ€§**ï¼šå—æ³•å¾‹æ³•è§„å’Œè¡Œä¸šæ ‡å‡†çº¦æŸ

### 4.1.2 æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†çš„é‡è¦æ€§

#### æ³•å¾‹åˆè§„è¦æ±‚

å…¨çƒèŒƒå›´å†…æ•°æ®ä¿æŠ¤æ³•è§„æ—¥ç›Šä¸¥æ ¼ï¼š

| åœ°åŒº/æ³•è§„ | å…³é”®è¦æ±‚ | è¿è§„å¤„ç½š |
|-----------|----------|----------|
| **GDPRï¼ˆæ¬§ç›Ÿï¼‰** | æ•°æ®æœ€å°åŒ–ã€ç›®çš„é™åˆ¶ã€çŸ¥æƒ…åŒæ„ | æœ€é«˜2000ä¸‡æ¬§å…ƒæˆ–å…¨çƒè¥æ”¶4% |
| **CCPA/CPRAï¼ˆåŠ å·ï¼‰** | æ¶ˆè´¹è€…æƒåˆ©ã€æ•°æ®åˆ†ç±»ã€é€‰æ‹©é€€å‡º | æœ€é«˜7500ç¾å…ƒ/è¿è§„ |
| **PIPLï¼ˆä¸­å›½ï¼‰** | çŸ¥æƒ…åŒæ„ã€å¿…è¦åŸåˆ™ã€å®‰å…¨ä¿éšœ | æœ€é«˜5000ä¸‡å…ƒæˆ–ä¸Šå¹´åº¦è¥ä¸šé¢5% |
| **PDPAï¼ˆæ–°åŠ å¡ï¼‰** | é€šçŸ¥ä¹‰åŠ¡ã€ä½¿ç”¨é™åˆ¶ã€å®‰å…¨ä¿éšœ | æœ€é«˜100ä¸‡æ–°å…ƒ |

#### ä¸šåŠ¡é£é™©ä¸æŸå¤±

æ•°æ®å®‰å…¨äº‹ä»¶å¯èƒ½å¯¼è‡´ï¼š

- **è´¢åŠ¡æŸå¤±**ï¼šç½šæ¬¾ã€èµ”å¿ã€å®‰å…¨æŠ•å…¥å¢åŠ 
- **å£°èª‰æŸå®³**ï¼šå®¢æˆ·ä¿¡ä»»åº¦ä¸‹é™ã€å“ç‰Œå½¢è±¡å—æŸ
- **ä¸šåŠ¡ä¸­æ–­**ï¼šç³»ç»Ÿåœæœºã€è¿è¥å—é˜»
- **ç«äº‰ä¼˜åŠ¿ä¸§å¤±**ï¼šæ ¸å¿ƒæ•°æ®æ³„éœ²ã€çŸ¥è¯†äº§æƒæŸå¤±

### 4.1.3 æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†æ¡†æ¶

#### æ²»ç†æ¡†æ¶è¦ç´ 

ä¸€ä¸ªå®Œæ•´çš„æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†æ¡†æ¶åº”åŒ…å«ï¼š

```mermaid
graph TD
    A[æ”¿ç­–ä¸æ ‡å‡†] --> B[ç»„ç»‡ä¸è§’è‰²]
    A --> C[æŠ€æœ¯ä¸å·¥å…·]
    A --> D[æµç¨‹ä¸æ§åˆ¶]
    B --> E[é£é™©è¯„ä¼°]
    C --> E
    D --> E
    E --> F[ç›‘æ§ä¸å®¡è®¡]
    F --> G[æŒç»­æ”¹è¿›]
    G --> A
```

#### å…³é”®æ²»ç†åŸåˆ™

1. **è´£ä»»æ˜ç¡®**ï¼šæ˜ç¡®å„è§’è‰²å’ŒèŒè´£
2. **é£é™©ç®¡ç†**ï¼šåŸºäºé£é™©è¯„ä¼°ç¡®å®šä¼˜å…ˆçº§
3. **åˆè§„å¯¼å‘**ï¼šæ»¡è¶³æ³•å¾‹æ³•è§„è¦æ±‚
4. **æŠ€æœ¯å®ç°**ï¼šé€šè¿‡æŠ€æœ¯æ‰‹æ®µè½å®æ§åˆ¶æªæ–½
5. **æŒç»­æ”¹è¿›**ï¼šå®šæœŸè¯„ä¼°å’Œä¼˜åŒ–æ²»ç†ä½“ç³»

---

## 4.2 æ•°æ®å®‰å…¨æ¶æ„ä¸é£é™©è¯„ä¼°

### 4.2.1 æ•°æ®å®‰å…¨æ¶æ„è®¾è®¡

#### åˆ†å±‚å®‰å…¨æ¶æ„

```mermaid
graph TD
    A[åº”ç”¨å®‰å…¨å±‚] --> B[æ•°æ®å®‰å…¨å±‚]
    B --> C[ç½‘ç»œå®‰å…¨å±‚]
    C --> D[åŸºç¡€è®¾æ–½å®‰å…¨å±‚]
    D --> E[ç‰©ç†å®‰å…¨å±‚]
    
    A --> F[èº«ä»½ä¸è®¿é—®ç®¡ç†]
    B --> F
    C --> F
    D --> F
    E --> F
    
    F --> G[å®‰å…¨ç›‘æ§ä¸å“åº”]
```

#### æ•°æ®åˆ†ç±»ä¸åˆ†çº§

æ•°æ®åˆ†ç±»æ˜¯å®‰å…¨çš„åŸºç¡€ï¼Œé€šå¸¸æŒ‰ä»¥ä¸‹ç»´åº¦è¿›è¡Œï¼š

1. **æ•æ„Ÿæ€§åˆ†ç±»**
   - **å…¬å¼€æ•°æ®**ï¼šå¯è‡ªç”±å…¬å¼€çš„ä¿¡æ¯
   - **å†…éƒ¨æ•°æ®**ï¼šä»…é™ç»„ç»‡å†…éƒ¨ä½¿ç”¨
   - **æœºå¯†æ•°æ®**ï¼šéœ€è¦ç‰¹æ®Šæˆæƒè®¿é—®
   - **é«˜åº¦æœºå¯†æ•°æ®**ï¼šæœ€æ•æ„Ÿçš„ä¿¡æ¯

2. **ç”Ÿå‘½å‘¨æœŸé˜¶æ®µåˆ†ç±»**
   - **åˆ›å»ºé˜¶æ®µ**ï¼šæ–°ç”Ÿæˆçš„æ•°æ®
   - **ä½¿ç”¨é˜¶æ®µ**ï¼šæ­£åœ¨å¤„ç†å’Œåˆ†æçš„æ•°æ®
   - **å½’æ¡£é˜¶æ®µ**ï¼šä¸ç»å¸¸ä½¿ç”¨ä½†éœ€ä¿ç•™çš„æ•°æ®
   - **é”€æ¯é˜¶æ®µ**ï¼šéœ€è¦å®‰å…¨åˆ é™¤çš„æ•°æ®

3. **ä¸šåŠ¡å½±å“åˆ†ç±»**
   - **å…³é”®æ•°æ®**ï¼šå½±å“æ ¸å¿ƒä¸šåŠ¡è¿è¥
   - **é‡è¦æ•°æ®**ï¼šå½±å“ä¸šåŠ¡æ•ˆç‡
   - **ä¸€èˆ¬æ•°æ®**ï¼šæ—¥å¸¸ä¸šåŠ¡æ•°æ®
   - **éå…³é”®æ•°æ®**ï¼šå½±å“è¾ƒå°çš„æ•°æ®

### 4.2.2 æ•°æ®å®‰å…¨é£é™©è¯„ä¼°

#### é£é™©è¯„ä¼°æ¡†æ¶

```python
class DataSecurityRiskAssessment:
    """æ•°æ®å®‰å…¨é£é™©è¯„ä¼°å·¥å…·"""
    
    def __init__(self):
        self.risk_matrix = {
            'high_high': ['æ— æ³•æ¥å—', 'ç«‹å³å¤„ç†'],
            'high_medium': ['é«˜é£é™©', 'å°½å¿«å¤„ç†'],
            'high_low': ['ä¸­é£é™©', 'è®¡åˆ’å¤„ç†'],
            'medium_high': ['é«˜é£é™©', 'å°½å¿«å¤„ç†'],
            'medium_medium': ['ä¸­é£é™©', 'è®¡åˆ’å¤„ç†'],
            'medium_low': ['ä½é£é™©', 'å®šæœŸæ£€æŸ¥'],
            'low_high': ['ä¸­é£é™©', 'è®¡åˆ’å¤„ç†'],
            'low_medium': ['ä½é£é™©', 'å®šæœŸæ£€æŸ¥'],
            'low_low': ['å¯æ¥å—', 'æŒç»­ç›‘æ§']
        }
    
    def assess_threat_likelihood(self, threat_factors):
        """è¯„ä¼°å¨èƒå‘ç”Ÿå¯èƒ½æ€§"""
        # å¨èƒå› ç´ è¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰
        threat_score = 0
        weights = {
            'threat_source_capability': 0.3,  # å¨èƒæºèƒ½åŠ›
            'motivation': 0.2,               # åŠ¨æœºå¼ºåº¦
            'vulnerability_exposure': 0.3,   # æ¼æ´æš´éœ²ç¨‹åº¦
            'control_effectiveness': 0.2     # æ§åˆ¶æªæ–½æœ‰æ•ˆæ€§
        }
        
        for factor, score in threat_factors.items():
            threat_score += score * weights.get(factor, 0)
        
        # è½¬æ¢ä¸ºå¯èƒ½æ€§ç­‰çº§
        if threat_score >= 4.0:
            return 'high'
        elif threat_score >= 2.5:
            return 'medium'
        else:
            return 'low'
    
    def assess_impact(self, impact_factors):
        """è¯„ä¼°å½±å“ç¨‹åº¦"""
        # å½±å“å› ç´ è¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰
        impact_score = 0
        weights = {
            'data_sensitivity': 0.3,      # æ•°æ®æ•æ„Ÿæ€§
            'business_criticality': 0.3,   # ä¸šåŠ¡å…³é”®æ€§
            'scope_of_impact': 0.2,       # å½±å“èŒƒå›´
            'recovery_complexity': 0.2    # æ¢å¤å¤æ‚æ€§
        }
        
        for factor, score in impact_factors.items():
            impact_score += score * weights.get(factor, 0)
        
        # è½¬æ¢ä¸ºå½±å“ç­‰çº§
        if impact_score >= 4.0:
            return 'high'
        elif impact_score >= 2.5:
            return 'medium'
        else:
            return 'low'
    
    def calculate_risk(self, likelihood, impact):
        """è®¡ç®—é£é™©ç­‰çº§"""
        risk_key = f"{likelihood}_{impact}"
        risk_info = self.risk_matrix.get(risk_key, ['æœªçŸ¥', 'æœªå®šä¹‰'])
        
        return {
            'likelihood': likelihood,
            'impact': impact,
            'risk_level': risk_info[0],
            'recommended_action': risk_info[1]
        }
    
    def generate_risk_report(self, data_assets):
        """ç”Ÿæˆé£é™©è¯„ä¼°æŠ¥å‘Š"""
        risk_assessments = []
        
        for asset in data_assets:
            # è¯„ä¼°å¨èƒå¯èƒ½æ€§
            likelihood = self.assess_threat_likelihood(asset.get('threat_factors', {}))
            
            # è¯„ä¼°å½±å“ç¨‹åº¦
            impact = self.assess_impact(asset.get('impact_factors', {}))
            
            # è®¡ç®—é£é™©ç­‰çº§
            risk = self.calculate_risk(likelihood, impact)
            
            risk_assessments.append({
                'asset_name': asset['name'],
                'asset_type': asset['type'],
                'risk_level': risk['risk_level'],
                'recommended_action': risk['recommended_action'],
                'details': risk
            })
        
        return risk_assessments

# ä½¿ç”¨ç¤ºä¾‹
assessor = DataSecurityRiskAssessment()

# å®šä¹‰æ•°æ®èµ„äº§
data_assets = [
    {
        'name': 'å®¢æˆ·ä¸ªäººä¿¡æ¯',
        'type': 'ä¸ªäººæ•æ„Ÿæ•°æ®',
        'threat_factors': {
            'threat_source_capability': 4,  # é«˜çº§æ”»å‡»è€…
            'motivation': 4,                # ç»æµåˆ©ç›Šé©±åŠ¨
            'vulnerability_exposure': 3,  # ä¸­ç­‰æš´éœ²
            'control_effectiveness': 2    # æ§åˆ¶æªæ–½è¾ƒå¼±
        },
        'impact_factors': {
            'data_sensitivity': 5,          # é«˜åº¦æ•æ„Ÿ
            'business_criticality': 4,     # ä¸šåŠ¡å…³é”®
            'scope_of_impact': 4,          # å¹¿æ³›å½±å“
            'recovery_complexity': 3        # æ¢å¤è¾ƒå¤æ‚
        }
    },
    {
        'name': 'è´¢åŠ¡æŠ¥è¡¨æ•°æ®',
        'type': 'ä¼ä¸šæœºå¯†æ•°æ®',
        'threat_factors': {
            'threat_source_capability': 3,
            'motivation': 4,
            'vulnerability_exposure': 2,
            'control_effectiveness': 4
        },
        'impact_factors': {
            'data_sensitivity': 4,
            'business_criticality': 5,
            'scope_of_impact': 3,
            'recovery_complexity': 2
        }
    }
]

# ç”Ÿæˆé£é™©è¯„ä¼°æŠ¥å‘Š
risk_report = assessor.generate_risk_report(data_assets)
print(risk_report)
```

### 4.2.3 æ•°æ®å®‰å…¨æ§åˆ¶æªæ–½

#### æŠ€æœ¯æ§åˆ¶æªæ–½

1. **è®¿é—®æ§åˆ¶**
   - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
   - åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰
   - å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰
   - ç‰¹æƒè´¦å·ç®¡ç†ï¼ˆPAMï¼‰

2. **åŠ å¯†æŠ€æœ¯**
   - ä¼ è¾“åŠ å¯†ï¼ˆTLS/SSLï¼‰
   - å­˜å‚¨åŠ å¯†ï¼ˆé™æ€åŠ å¯†ï¼‰
   - å­—æ®µçº§åŠ å¯†
   - å¯†é’¥ç®¡ç†

3. **æ•°æ®è„±æ•**
   - æ•°æ®å±è”½
   - ä»¤ç‰ŒåŒ–
   - åŒ¿ååŒ–
   - å‡ååŒ–

#### ç®¡ç†æ§åˆ¶æªæ–½

1. **ç­–ç•¥ä¸æ ‡å‡†**
   - æ•°æ®åˆ†ç±»ç­–ç•¥
   - è®¿é—®æ§åˆ¶ç­–ç•¥
   - æ•°æ®å¤„ç†æ ‡å‡†
   - å®‰å…¨åŸ¹è®­è¦æ±‚

2. **æµç¨‹æ§åˆ¶**
   - æ•°æ®å¤„ç†æµç¨‹
   - å˜æ›´ç®¡ç†æµç¨‹
   - äº‹ä»¶å“åº”æµç¨‹
   - å®¡è®¡æµç¨‹

---

## 4.3 éšç§ä¿æŠ¤æŠ€æœ¯ä¸éšç§å¢å¼ºæŠ€æœ¯

### 4.3.1 éšç§ä¿æŠ¤åŸºç¡€æŠ€æœ¯

#### æ•°æ®åŒ¿ååŒ–

æ•°æ®åŒ¿ååŒ–æ˜¯æŒ‡ç§»é™¤æˆ–æ¨¡ç³Šä¸ªäººæ ‡è¯†ç¬¦ï¼Œä½¿æ•°æ®æ— æ³•å…³è”åˆ°ç‰¹å®šä¸ªäººã€‚

```python
import hashlib
import random
import pandas as pd
from faker import Faker

class DataAnonymizer:
    """æ•°æ®åŒ¿ååŒ–å·¥å…·"""
    
    def __init__(self):
        self.fake = Faker('zh_CN')
    
    def hash_anonymization(self, data, salt=""):
        """å“ˆå¸ŒåŒ¿ååŒ–"""
        if pd.isna(data):
            return data
        return hashlib.sha256(f"{data}{salt}".encode()).hexdigest()
    
    def tokenization(self, data):
        """ä»¤ç‰ŒåŒ–"""
        if pd.isna(data):
            return data
        
        # ç”Ÿæˆéšæœºä»¤ç‰Œå¹¶å­˜å‚¨æ˜ å°„
        token = f"TOKEN_{random.randint(100000, 999999)}"
        
        # åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”å°†åŸå§‹å€¼å’Œä»¤ç‰Œçš„æ˜ å°„å…³ç³»å®‰å…¨å­˜å‚¨
        return token
    
    def masking(self, data, mask_type="partial"):
        """æ•°æ®å±è”½"""
        if pd.isna(data):
            return data
        
        data_str = str(data)
        
        if mask_type == "partial":
            # éƒ¨åˆ†å±è”½ï¼Œä¿ç•™å‰åå‡ ä½
            if len(data_str) <= 4:
                return "*" * len(data_str)
            return data_str[:2] + "*" * (len(data_str) - 4) + data_str[-2:]
        
        elif mask_type == "full":
            # å®Œå…¨å±è”½
            return "*" * len(data_str)
        
        elif mask_type == "email":
            # é‚®ç®±å±è”½
            if "@" not in data_str:
                return data_str
            
            username, domain = data_str.split("@", 1)
            if len(username) <= 2:
                username_mask = "*" * len(username)
            else:
                username_mask = username[0] + "*" * (len(username) - 2) + username[-1]
            
            return f"{username_mask}@{domain}"
        
        elif mask_type == "phone":
            # æ‰‹æœºå·å±è”½
            if len(data_str) < 7:
                return "*" * len(data_str)
            
            return data_str[:3] + "*" * (len(data_str) - 6) + data_str[-3:]
        
        return data_str
    
    def fake_data_generation(self, data_type="name"):
        """ç”Ÿæˆè™šå‡æ•°æ®"""
        if data_type == "name":
            return self.fake.name()
        elif data_type == "email":
            return self.fake.email()
        elif data_type == "phone":
            return self.fake.phone_number()
        elif data_type == "address":
            return self.fake.address()
        elif data_type == "company":
            return self.fake.company()
        else:
            return self.fake.text(max_nb_chars=20)
    
    def k_anonymity(self, df, quasi_identifiers, k=3):
        """K-åŒ¿ååŒ–"""
        # å¯¹å‡†æ ‡è¯†ç¬¦è¿›è¡Œæ³›åŒ–
        anonymized_df = df.copy()
        
        for column in quasi_identifiers:
            if column not in anonymized_df.columns:
                continue
            
            # ç®€å•æ³›åŒ–ç¤ºä¾‹ï¼šæ•°å€¼å‹æ•°æ®æŒ‰åŒºé—´åˆ†ç»„
            if anonymized_df[column].dtype in ['int64', 'float64']:
                min_val = anonymized_df[column].min()
                max_val = anonymized_df[column].max()
                num_bins = max(5, len(anonymized_df) // k)
                
                # åˆ›å»ºåˆ†ç»„æ ‡ç­¾
                anonymized_df[column] = pd.cut(
                    anonymized_df[column],
                    bins=num_bins,
                    labels=[f"Bin_{i}" for i in range(num_bins)]
                )
            
            # æ–‡æœ¬å‹æ•°æ®è¿›è¡Œæ³›åŒ–
            else:
                # è¿™é‡Œå¯ä»¥å®ç°æ›´å¤æ‚çš„æ³›åŒ–é€»è¾‘
                # ç¤ºä¾‹ï¼šä¿ç•™å‰Nä¸ªå­—ç¬¦
                anonymized_df[column] = anonymized_df[column].astype(str).str[:3] + "*"
        
        # æ£€æŸ¥K-åŒ¿ååŒ–æ˜¯å¦æ»¡è¶³
        value_counts = anonymized_df[quasi_identifiers].value_counts()
        violating_records = value_counts[value_counts < k].sum()
        
        print(f"K-åŒ¿ååŒ–ç»“æœï¼š{len(anonymized_df)} æ¡è®°å½•ä¸­ï¼Œ{violating_records} æ¡è¿å {k}-åŒ¿åæ€§")
        
        return anonymized_df

# ä½¿ç”¨ç¤ºä¾‹
anonymizer = DataAnonymizer()

# ç¤ºä¾‹æ•°æ®
data = {
    'name': ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ'],
    'id_card': ['110101199001011234', '110101199002022345', '110101199003033456', 
                '110101199004044567', '110101199005055678'],
    'phone': ['13812345678', '13912345678', '13612345678', '13712345678', '13512345678'],
    'email': ['zhangsan@example.com', 'lisi@example.com', 'wangwu@example.com', 
              'zhaoliu@example.com', 'qianqi@example.com'],
    'address': ['åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯1å·', 'åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—2å·', 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºé™†å®¶å˜´ç¯è·¯3å·', 
                'å¹¿å·å¸‚å¤©æ²³åŒºç æ±Ÿæ–°åŸ4å·', 'æ·±åœ³å¸‚å—å±±åŒºç§‘æŠ€å›­5å·'],
    'age': [25, 30, 35, 40, 45]
}

df = pd.DataFrame(data)

# åº”ç”¨ä¸åŒçš„åŒ¿ååŒ–æŠ€æœ¯
anonymized_data = pd.DataFrame()
anonymized_data['name_hash'] = df['name'].apply(anonymizer.hash_anonymization)
anonymized_data['id_card_token'] = df['id_card'].apply(anonymizer.tokenization)
anonymized_data['phone_masked'] = df['phone'].apply(lambda x: anonymizer.masking(x, 'phone'))
anonymized_data['email_masked'] = df['email'].apply(lambda x: anonymizer.masking(x, 'email'))
anonymized_data['fake_address'] = df['address'].apply(lambda x: anonymizer.fake_data_generation('address'))

print("åŸå§‹æ•°æ®:")
print(df.head())
print("\nåŒ¿ååŒ–åæ•°æ®:")
print(anonymized_data.head())

# K-åŒ¿ååŒ–ç¤ºä¾‹
quasi_identifiers = ['age']
k_anonymized_df = anonymizer.k_anonymity(df, quasi_identifiers, k=2)
print("\nK-åŒ¿ååŒ–æ•°æ®:")
print(k_anonymized_df.head())
```

#### å·®åˆ†éšç§

å·®åˆ†éšç§é€šè¿‡åœ¨æŸ¥è¯¢ç»“æœä¸­æ·»åŠ ç²¾å¿ƒè®¡ç®—çš„å™ªå£°æ¥ä¿æŠ¤ä¸ªäººéšç§ã€‚

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

class DifferentialPrivacy:
    """å·®åˆ†éšç§å·¥å…·"""
    
    def __init__(self, epsilon=1.0, sensitivity=1.0):
        """
        åˆå§‹åŒ–å·®åˆ†éšç§
        
        Args:
            epsilon (float): éšç§é¢„ç®—ï¼Œè¶Šå°éšç§ä¿æŠ¤è¶Šå¼º
            sensitivity (float): æŸ¥è¯¢æ•æ„Ÿæ€§
        """
        self.epsilon = epsilon
        self.sensitivity = sensitivity
    
    def laplace_mechanism(self, true_value):
        """
        æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶å®ç°å·®åˆ†éšç§
        
        Args:
            true_value: çœŸå®æŸ¥è¯¢ç»“æœ
            
        Returns:
            æ·»åŠ å™ªå£°åçš„å€¼
        """
        # è®¡ç®—å™ªå£°è§„æ¨¡
        scale = self.sensitivity / self.epsilon
        
        # ä»æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒä¸­æ·»åŠ å™ªå£°
        noise = np.random.laplace(0, scale, 1)[0]
        
        return true_value + noise
    
    def count_query_dp(self, data):
        """
        å¸¦å·®åˆ†éšç§çš„è®¡æ•°æŸ¥è¯¢
        
        Args:
            data: æ•°æ®é›†
            
        Returns:
            å¸¦å™ªå£°çš„è®¡æ•°ç»“æœ
        """
        true_count = len(data)
        return self.laplace_mechanism(true_count)
    
    def mean_query_dp(self, data, column):
        """
        å¸¦å·®åˆ†éšç§çš„å¹³å‡å€¼æŸ¥è¯¢
        
        Args:
            data: æ•°æ®é›†
            column: è®¡ç®—å¹³å‡å€¼çš„åˆ—
            
        Returns:
            å¸¦å™ªå£°çš„å¹³å‡å€¼
        """
        true_mean = data[column].mean()
        
        # å¹³å‡å€¼æŸ¥è¯¢çš„æ•æ„Ÿæ€§ä¸ºæ•°æ®èŒƒå›´/æ•°æ®é‡
        sensitivity = (data[column].max() - data[column].min()) / len(data)
        
        # ä¸´æ—¶æ›´æ–°æ•æ„Ÿæ€§
        original_sensitivity = self.sensitivity
        self.sensitivity = sensitivity
        
        result = self.laplace_mechanism(true_mean)
        
        # æ¢å¤åŸå§‹æ•æ„Ÿæ€§
        self.sensitivity = original_sensitivity
        
        return result
    
    def histogram_query_dp(self, data, column):
        """
        å¸¦å·®åˆ†éšç§çš„ç›´æ–¹å›¾æŸ¥è¯¢
        
        Args:
            data: æ•°æ®é›†
            column: ç»˜åˆ¶ç›´æ–¹å›¾çš„åˆ—
            
        Returns:
            å¸¦å™ªå£°çš„ç›´æ–¹å›¾æ•°æ®
        """
        # è·å–å€¼è®¡æ•°
        true_counts = data[column].value_counts()
        
        # å¯¹æ¯ä¸ªè®¡æ•°æ·»åŠ å™ªå£°
        dp_counts = {key: self.laplace_mechanism(count) 
                    for key, count in true_counts.items()}
        
        return dp_counts
    
    def composition_experiment(self, data, num_queries=10):
        """
        å·®åˆ†éšç§ç»„åˆå®éªŒ
        
        Args:
            data: æ•°æ®é›†
            num_queries: æŸ¥è¯¢æ¬¡æ•°
            
        Returns:
            æŸ¥è¯¢ç»“æœå’Œéšç§é¢„ç®—æ¶ˆè€—
        """
        # åˆå§‹åŒ–æŸ¥è¯¢ç»“æœ
        results = []
        
        # è®°å½•éšç§é¢„ç®—
        total_epsilon = 0
        
        # æ‰§è¡Œå¤šæ¬¡æŸ¥è¯¢
        for i in range(num_queries):
            # æ¯æ¬¡æŸ¥è¯¢ä½¿ç”¨ç›¸åŒçš„éšç§é¢„ç®—
            query_epsilon = self.epsilon / num_queries
            
            # ä¸´æ—¶æ›´æ–°éšç§é¢„ç®—
            original_epsilon = self.epsilon
            self.epsilon = query_epsilon
            
            # æ‰§è¡Œè®¡æ•°æŸ¥è¯¢
            result = self.count_query_dp(data)
            results.append(result)
            
            # æ›´æ–°éšç§é¢„ç®—æ¶ˆè€—
            total_epsilon += query_epsilon
            
            # æ¢å¤åŸå§‹éšç§é¢„ç®—
            self.epsilon = original_epsilon
        
        return results, total_epsilon

# ä½¿ç”¨ç¤ºä¾‹
dp = DifferentialPrivacy(epsilon=1.0, sensitivity=1.0)

# ç”Ÿæˆç¤ºä¾‹æ•°æ®
np.random.seed(42)
n = 1000
data = pd.DataFrame({
    'age': np.random.randint(18, 65, n),
    'income': np.random.normal(50000, 15000, n),
    'region': np.random.choice(['North', 'South', 'East', 'West'], n)
})

# æ¯”è¾ƒçœŸå®æŸ¥è¯¢ç»“æœå’Œå·®åˆ†éšç§æŸ¥è¯¢ç»“æœ
true_age_mean = data['age'].mean()
dp_age_mean = dp.mean_query_dp(data, 'age')

print(f"çœŸå®å¹´é¾„å¹³å‡å€¼: {true_age_mean:.2f}")
print(f"å·®åˆ†éšç§å¹´é¾„å¹³å‡å€¼: {dp_age_mean:.2f}")
print(f"ç»å¯¹è¯¯å·®: {abs(true_age_mean - dp_age_mean):.2f}")

# ç›´æ–¹å›¾æŸ¥è¯¢
true_region_counts = data['region'].value_counts()
dp_region_counts = dp.histogram_query_dp(data, 'region')

print("\nçœŸå®åŒºåŸŸåˆ†å¸ƒ:")
print(true_region_counts)
print("\nå·®åˆ†éšç§åŒºåŸŸåˆ†å¸ƒ:")
dp_region_series = pd.Series(dp_region_counts)
print(dp_region_series)

# éšç§é¢„ç®—æ¶ˆè€—å®éªŒ
results, total_epsilon = dp.composition_experiment(data, num_queries=10)
print(f"\næ‰§è¡Œ10æ¬¡æŸ¥è¯¢åçš„æ€»éšç§é¢„ç®—æ¶ˆè€—: {total_epsilon:.2f}")

# å¯è§†åŒ–éšç§é¢„ç®—ä¸å‡†ç¡®æ€§çš„æƒè¡¡
epsilons = [0.1, 0.5, 1.0, 2.0, 5.0]
errors = []

for eps in epsilons:
    dp_test = DifferentialPrivacy(epsilon=eps, sensitivity=1.0)
    dp_mean = dp_test.mean_query_dp(data, 'age')
    error = abs(dp_mean - true_age_mean)
    errors.append(error)

# ç»˜åˆ¶è¯¯å·®ä¸éšç§é¢„ç®—çš„å…³ç³»
plt.figure(figsize=(10, 6))
plt.plot(epsilons, errors, 'bo-', linewidth=2, markersize=8)
plt.xlabel('éšç§é¢„ç®— (Îµ)')
plt.ylabel('ç»å¯¹è¯¯å·®')
plt.title('éšç§é¢„ç®—ä¸æŸ¥è¯¢å‡†ç¡®æ€§çš„æƒè¡¡')
plt.grid(True)
plt.show()
```

### 4.3.2 éšç§å¢å¼ºæŠ€æœ¯ï¼ˆPETsï¼‰

#### åŒæ€åŠ å¯†

åŒæ€åŠ å¯†å…è®¸åœ¨åŠ å¯†æ•°æ®ä¸Šç›´æ¥è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸éœ€è¦è§£å¯†ã€‚

```python
import numpy as np
from typing import Tuple

class HomomorphicEncryption:
    """ç®€åŒ–çš„åŒæ€åŠ å¯†å®ç°ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰"""
    
    def __init__(self, key_size=1024):
        """åˆå§‹åŒ–å¯†é’¥"""
        # åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”ä½¿ç”¨ä¸“ä¸šçš„åŒæ€åŠ å¯†åº“å¦‚HElibæˆ–PALISADE
        # è¿™é‡Œä»…ç”¨äºæ¦‚å¿µæ¼”ç¤º
        self.key_size = key_size
        self.public_key, self.private_key = self._generate_keypair()
    
    def _generate_keypair(self) -> Tuple[dict, dict]:
        """ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆç®€åŒ–å®ç°ï¼‰"""
        # å®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨å’Œå¤æ‚çš„æ•°å­¦è¿ç®—
        public_key = {
            'n': 1000003,  # å¤§ç´ æ•°
            'g': 5         # ç”Ÿæˆå…ƒ
        }
        
        private_key = {
            'lambda': 500001,  # ç§æœ‰å‚æ•°
            'mu': 400007       # è§£å¯†å‚æ•°
        }
        
        return public_key, private_key
    
    def encrypt(self, message: int) -> int:
        """åŠ å¯†æ¶ˆæ¯"""
        # ç®€åŒ–çš„PaillieråŠ å¯†å®ç°
        m = message
        n = self.public_key['n']
        g = self.public_key['g']
        
        # éšæœºæ•°
        r = np.random.randint(1, n)
        
        # åŠ å¯†ï¼šc = g^m * r^n mod n^2
        cipher = (pow(g, m, n**2) * pow(r, n, n**2)) % (n**2)
        
        return cipher
    
    def decrypt(self, cipher: int) -> int:
        """è§£å¯†æ¶ˆæ¯"""
        # ç®€åŒ–çš„Paillierè§£å¯†å®ç°
        c = cipher
        n = self.public_key['n']
        lambda_ = self.private_key['lambda']
        mu = self.private_key['mu']
        
        # è§£å¯†ï¼šm = L(c^Î» mod n^2) * Î¼ mod n
        # Lå‡½æ•°ï¼šL(u) = (u-1)/n
        l_function = lambda u: (u - 1) // n
        
        message = (l_function(pow(c, lambda_, n**2)) * mu) % n
        
        return message
    
    def add_encrypted(self, cipher1: int, cipher2: int) -> int:
        """åŠ å¯†å€¼åŠ æ³•"""
        n = self.public_key['n']
        # åŒæ€åŠ æ³•ï¼šEnc(m1) * Enc(m2) = Enc(m1 + m2) mod n^2
        return (cipher1 * cipher2) % (n**2)
    
    def multiply_encrypted(self, cipher: int, constant: int) -> int:
        """åŠ å¯†å€¼ä¸å¸¸æ•°ä¹˜æ³•"""
        n = self.public_key['n']
        g = self.public_key['g']
        # åŒæ€ä¹˜æ³•ï¼šEnc(m)^k = Enc(k*m) mod n^2
        return pow(cipher, constant, n**2)
    
    def secure_aggregation_example(self):
        """å®‰å…¨èšåˆç¤ºä¾‹"""
        print("åŒæ€åŠ å¯†å®‰å…¨èšåˆç¤ºä¾‹")
        print("=" * 50)
        
        # æ¨¡æ‹Ÿä¸‰ä¸ªå®¢æˆ·ç«¯çš„ç§æœ‰æ•°æ®
        client1_data = 15
        client2_data = 25
        client3_data = 30
        
        print(f"å®¢æˆ·ç«¯1çš„çœŸå®æ•°æ®: {client1_data}")
        print(f"å®¢æˆ·ç«¯2çš„çœŸå®æ•°æ®: {client2_data}")
        print(f"å®¢æˆ·ç«¯3çš„çœŸå®æ•°æ®: {client3_data}")
        
        # å®¢æˆ·ç«¯åŠ å¯†æ•°æ®
        cipher1 = self.encrypt(client1_data)
        cipher2 = self.encrypt(client2_data)
        cipher3 = self.encrypt(client3_data)
        
        print(f"\nå®¢æˆ·ç«¯1åŠ å¯†æ•°æ®: {cipher1}")
        print(f"å®¢æˆ·ç«¯2åŠ å¯†æ•°æ®: {cipher2}")
        print(f"å®¢æˆ·ç«¯3åŠ å¯†æ•°æ®: {cipher3}")
        
        # æœåŠ¡å™¨èšåˆåŠ å¯†æ•°æ®ï¼ˆæ— éœ€è§£å¯†ï¼‰
        aggregated_cipher = self.add_encrypted(
            self.add_encrypted(cipher1, cipher2), 
            cipher3
        )
        
        print(f"\næœåŠ¡å™¨èšåˆåŠ å¯†æ•°æ®: {aggregated_cipher}")
        
        # æœåŠ¡å™¨è§£å¯†èšåˆç»“æœ
        aggregated_result = self.decrypt(aggregated_cipher)
        true_sum = client1_data + client2_data + client3_data
        
        print(f"\nè§£å¯†åçš„èšåˆç»“æœ: {aggregated_result}")
        print(f"çœŸå®æ€»å’Œ: {true_sum}")
        print(f"éªŒè¯ç»“æœ: {'âœ“ æ­£ç¡®' if aggregated_result == true_sum else 'âœ— é”™è¯¯'}")

# ä½¿ç”¨ç¤ºä¾‹
he = HomomorphicEncryption()
he.secure_aggregation_example()
```

#### å®‰å…¨å¤šæ–¹è®¡ç®—ï¼ˆSMPCï¼‰

å®‰å…¨å¤šæ–¹è®¡ç®—å…è®¸å¤šä¸ªå‚ä¸æ–¹åœ¨ä¸æ³„éœ²å„è‡ªç§æœ‰æ•°æ®çš„æƒ…å†µä¸‹å…±åŒè®¡ç®—ä¸€ä¸ªå‡½æ•°ã€‚

```python
import random
import hashlib
from typing import List, Dict, Any

class SecureMultiPartyComputation:
    """å®‰å…¨å¤šæ–¹è®¡ç®—ç®€åŒ–å®ç°"""
    
    def __init__(self):
        """åˆå§‹åŒ–"""
        self.participants = {}
        self.shares = {}
    
    def add_participant(self, participant_id: str, participant_data: Any):
        """æ·»åŠ å‚ä¸æ–¹"""
        self.participants[participant_id] = participant_data
    
    def shamir_secret_sharing(self, secret: int, num_shares: int, threshold: int) -> List[Dict]:
        """
        Shamirç§˜å¯†å…±äº«
        
        Args:
            secret: è¦å…±äº«çš„ç§˜å¯†
            num_shares: ç§˜å¯†åˆ†ç‰‡æ•°é‡
            threshold: é‡æ„ç§˜å¯†æ‰€éœ€çš„æœ€å°åˆ†ç‰‡æ•°
            
        Returns:
            ç§˜å¯†åˆ†ç‰‡åˆ—è¡¨
        """
        # é€‰æ‹©ä¸€ä¸ªå¤§ç´ æ•°
        prime = 1000003
        
        # ç”Ÿæˆéšæœºå¤šé¡¹å¼ç³»æ•°
        # f(x) = secret + a1*x + a2*x^2 + ... + a_{t-1}*x^{t-1}
        coefficients = [secret] + [random.randint(0, prime-1) for _ in range(threshold-1)]
        
        # ç”Ÿæˆåˆ†ç‰‡
        shares = []
        for i in range(1, num_shares + 1):
            x = i
            # è®¡ç®—f(x)
            y = 0
            for j, coeff in enumerate(coefficients):
                y = (y + coeff * pow(x, j, prime)) % prime
            
            shares.append({
                'x': x,
                'y': y,
                'participant': f'Participant_{i}'
            })
        
        return shares
    
    def reconstruct_secret(self, shares: List[Dict], threshold: int) -> int:
        """
        ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥æ’å€¼é‡æ„ç§˜å¯†
        
        Args:
            shares: ç§˜å¯†åˆ†ç‰‡
            threshold: é˜ˆå€¼
            
        Returns:
            é‡æ„çš„ç§˜å¯†
        """
        prime = 1000003
        
        # é€‰æ‹©å‰thresholdä¸ªåˆ†ç‰‡
        selected_shares = shares[:threshold]
        
        # æ‹‰æ ¼æœ—æ—¥æ’å€¼è®¡ç®—f(0)
        secret = 0
        for i, share in enumerate(selected_shares):
            xi, yi = share['x'], share['y']
            
            # è®¡ç®—æ‹‰æ ¼æœ—æ—¥åŸºå‡½æ•°
            li = 1
            for j, other_share in enumerate(selected_shares):
                if i != j:
                    xj = other_share['x']
                    li = (li * (-xj) * pow(xi - xj, -1, prime)) % prime
            
            # ç´¯åŠ è´¡çŒ®
            secret = (secret + yi * li) % prime
        
        return secret
    
    def secure_sum_example(self):
        """å®‰å…¨æ±‚å’Œç¤ºä¾‹"""
        print("å®‰å…¨å¤šæ–¹è®¡ç®— - å®‰å…¨æ±‚å’Œç¤ºä¾‹")
        print("=" * 50)
        
        # æ¨¡æ‹Ÿä¸‰ä¸ªå‚ä¸æ–¹
        participants_data = {
            'Alice': 15,
            'Bob': 25,
            'Charlie': 30
        }
        
        print("å‚ä¸æ–¹ç§æœ‰æ•°æ®:")
        for participant, value in participants_data.items():
            print(f"  {participant}: {value}")
        
        # æ¯ä¸ªå‚ä¸æ–¹å°†ç§˜å¯†åˆ†æˆå¤šä¸ªåˆ†ç‰‡
        num_participants = len(participants_data)
        threshold = num_participants  # éœ€è¦æ‰€æœ‰åˆ†ç‰‡æ‰èƒ½é‡æ„
        
        # ä¸ºæ¯ä¸ªå‚ä¸æ–¹åˆ›å»ºåˆ†ç‰‡
        all_shares = {}
        for participant, secret_value in participants_data.items():
            shares = self.shamir_secret_sharing(secret_value, num_participants, threshold)
            all_shares[participant] = shares
            
            print(f"\n{participant}çš„ç§˜å¯†åˆ†ç‰‡:")
            for share in shares:
                print(f"  åˆ†ç‰‡ {share['participant']}: (x={share['x']}, y={share['y']})")
        
        # å‚ä¸æ–¹äº¤æ¢åˆ†ç‰‡
        exchanged_shares = {}
        for participant in participants_data:
            exchanged_shares[participant] = []
        
        # æ¯ä¸ªå‚ä¸æ–¹æ”¶åˆ°æ¥è‡ªå…¶ä»–å‚ä¸æ–¹çš„å¯¹åº”åˆ†ç‰‡
        for participant, shares in all_shares.items():
            for i, share in enumerate(shares):
                recipient = list(participants_data.keys())[i]
                exchanged_shares[recipient].append(share)
        
        # æ¯ä¸ªå‚ä¸æ–¹è®¡ç®—è‡ªå·±çš„éƒ¨åˆ†å’Œ
        partial_sums = {}
        for participant, shares in exchanged_shares.items():
            participant_sum = 0
            for share in shares:
                participant_sum += share['y']
            
            # ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥æ’å€¼è®¡ç®—éƒ¨åˆ†å’Œ
            partial_sums[participant] = self.reconstruct_secret(shares, threshold)
            
            print(f"\n{participant}è®¡ç®—çš„éƒ¨åˆ†å’Œ: {partial_sums[participant]}")
        
        # è®¡ç®—æ€»å’Œ
        total_sum = sum(partial_sums.values())
        true_sum = sum(participants_data.values())
        
        print(f"\næœ€ç»ˆæ€»å’Œ: {total_sum}")
        print(f"çœŸå®æ€»å’Œ: {true_sum}")
        print(f"éªŒè¯ç»“æœ: {'âœ“ æ­£ç¡®' if total_sum == true_sum else 'âœ— é”™è¯¯'}")
    
    def secure_average_example(self):
        """å®‰å…¨å¹³å‡å€¼è®¡ç®—ç¤ºä¾‹"""
        print("\nå®‰å…¨å¤šæ–¹è®¡ç®— - å®‰å…¨å¹³å‡å€¼ç¤ºä¾‹")
        print("=" * 50)
        
        # æ¨¡æ‹Ÿä¸‰ä¸ªå‚ä¸æ–¹
        participants_data = {
            'Alice': 80,
            'Bob': 90,
            'Charlie': 85
        }
        
        print("å‚ä¸æ–¹ç§æœ‰æ•°æ®:")
        for participant, value in participants_data.items():
            print(f"  {participant}: {value}")
        
        # è®¡ç®—å¹³å‡å€¼ï¼ˆä¸æ³„éœ²å•ä¸ªå€¼ï¼‰
        num_participants = len(participants_data)
        threshold = num_participants
        
        # æ¯ä¸ªå‚ä¸æ–¹å°†ç§˜å¯†åˆ†æˆå¤šä¸ªåˆ†ç‰‡
        all_shares = {}
        for participant, secret_value in participants_data.items():
            shares = self.shamir_secret_sharing(secret_value, num_participants, threshold)
            all_shares[participant] = shares
        
        # å‚ä¸æ–¹äº¤æ¢åˆ†ç‰‡
        exchanged_shares = {}
        for participant in participants_data:
            exchanged_shares[participant] = []
        
        for participant, shares in all_shares.items():
            for i, share in enumerate(shares):
                recipient = list(participants_data.keys())[i]
                exchanged_shares[recipient].append(share)
        
        # æ¯ä¸ªå‚ä¸æ–¹è®¡ç®—è‡ªå·±çš„éƒ¨åˆ†å’Œ
        partial_sums = {}
        for participant, shares in exchanged_shares.items():
            partial_sums[participant] = self.reconstruct_secret(shares, threshold)
        
        # è®¡ç®—æ€»å’Œå’Œå¹³å‡å€¼
        total_sum = sum(partial_sums.values())
        average = total_sum / num_participants
        true_average = sum(participants_data.values()) / num_participants
        
        print(f"\nè®¡ç®—çš„å¹³å‡å€¼: {average:.2f}")
        print(f"çœŸå®å¹³å‡å€¼: {true_average:.2f}")
        print(f"éªŒè¯ç»“æœ: {'âœ“ æ­£ç¡®' if abs(average - true_average) < 0.01 else 'âœ— é”™è¯¯'}")
        
        print("\næ³¨æ„ï¼šåœ¨æ­¤ç®€åŒ–å®ç°ä¸­ï¼Œå‚ä¸æ–¹å¯èƒ½èƒ½å¤Ÿæ¨æ–­å…¶ä»–æ–¹çš„ä¿¡æ¯ã€‚")
        print("å®é™…åº”ç”¨ä¸­éœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„æŠ€æœ¯å’ŒåŠ å¯†åè®®ã€‚")

# ä½¿ç”¨ç¤ºä¾‹
smpc = SecureMultiPartyComputation()
smpc.secure_sum_example()
smpc.secure_average_example()
```

---

## 4.4 æ•°æ®åˆè§„è¦æ±‚ä¸æ³•è§„æ¡†æ¶

### 4.4.1 å…¨çƒä¸»è¦æ•°æ®ä¿æŠ¤æ³•è§„

#### æ¬§ç›ŸGDPRï¼ˆé€šç”¨æ•°æ®ä¿æŠ¤æ¡ä¾‹ï¼‰

GDPRæ˜¯æ¬§ç›Ÿåˆ¶å®šçš„æ•°æ®ä¿æŠ¤æ³•è§„ï¼Œå¯¹å¤„ç†æ¬§ç›Ÿå±…æ°‘æ•°æ®çš„ç»„ç»‡å…·æœ‰å…¨çƒå½±å“ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š

1. **åˆæ³•æ€§ã€å…¬å¹³æ€§ã€é€æ˜æ€§**ï¼šæ•°æ®å¤„ç†å¿…é¡»åˆæ³•ã€å…¬å¹³ï¼Œå¹¶å¯¹æ•°æ®ä¸»ä½“é€æ˜
2. **ç›®çš„é™åˆ¶**ï¼šåªèƒ½ä¸ºç‰¹å®šã€æ˜ç¡®å’Œåˆæ³•çš„ç›®çš„æ”¶é›†æ•°æ®
3. **æ•°æ®æœ€å°åŒ–**ï¼šåªæ”¶é›†å’Œå¤„ç†å¿…è¦çš„æœ€å°‘æ•°æ®
4. **å‡†ç¡®æ€§**ï¼šç¡®ä¿æ•°æ®å‡†ç¡®å¹¶ä¿æŒæ›´æ–°
5. **å­˜å‚¨é™åˆ¶**ï¼šä»…åœ¨å¿…è¦æœŸé—´ä¿ç•™æ•°æ®
6. **å®Œæ•´æ€§ä¸ä¿å¯†æ€§**ï¼šç¡®ä¿æ•°æ®å®‰å…¨
7. **é—®è´£åˆ¶**ï¼šæ•°æ®æ§åˆ¶è€…è´Ÿè´£å¹¶èƒ½å¤Ÿè¯æ˜åˆè§„

**æ•°æ®ä¸»ä½“æƒåˆ©**ï¼š

```python
class GDPRCompliance:
    """GDPRåˆè§„æ£€æŸ¥å·¥å…·"""
    
    def __init__(self):
        self.compliance_matrix = {
            'lawfulness': {
                'description': 'åˆæ³•æ€§ã€å…¬å¹³æ€§å’Œé€æ˜æ€§åŸåˆ™',
                'requirements': [
                    'æœ‰åˆæ³•çš„å¤„ç†ä¾æ®ï¼ˆåŒæ„ã€åˆåŒå±¥è¡Œã€æ³•å¾‹ä¹‰åŠ¡ç­‰ï¼‰',
                    'å‘æ•°æ®ä¸»ä½“æä¾›é€æ˜ä¿¡æ¯',
                    'æ•°æ®å¤„ç†æ–¹å¼å…¬å¹³'
                ]
            },
            'purpose_limitation': {
                'description': 'ç›®çš„é™åˆ¶åŸåˆ™',
                'requirements': [
                    'ä»…ä¸ºç‰¹å®šã€æ˜ç¡®å’Œåˆæ³•çš„ç›®çš„æ”¶é›†æ•°æ®',
                    'ä¸å¤„ç†ä¸ç›®çš„ä¸ç¬¦çš„æ•°æ®',
                    'å¯¹è¶…å‡ºåŸå§‹ç›®çš„çš„å¤„ç†éœ€è¦æ–°çš„æ³•å¾‹ä¾æ®'
                ]
            },
            'data_minimization': {
                'description': 'æ•°æ®æœ€å°åŒ–åŸåˆ™',
                'requirements': [
                    'åªæ”¶é›†å’Œå¤„ç†å¿…è¦çš„æœ€å°‘æ•°æ®',
                    'å®šæœŸå®¡æŸ¥å’Œåˆ é™¤ä¸å¿…è¦çš„æ•°æ®',
                    'é¿å…æ”¶é›†å’Œå¤„ç†è¿‡åº¦æ•°æ®'
                ]
            },
            'accuracy': {
                'description': 'å‡†ç¡®æ€§åŸåˆ™',
                'requirements': [
                    'é‡‡å–åˆç†æªæ–½ç¡®ä¿æ•°æ®å‡†ç¡®',
                    'åŠæ—¶æ›´æ–°ä¸å‡†ç¡®çš„æ•°æ®',
                    'æä¾›çº æ­£é”™è¯¯æ•°æ®çš„æœºåˆ¶'
                ]
            },
            'storage_limitation': {
                'description': 'å­˜å‚¨é™åˆ¶åŸåˆ™',
                'requirements': [
                    'ä»…åœ¨å¿…è¦æœŸé—´ä¿ç•™æ•°æ®',
                    'å®æ–½åˆé€‚çš„æ•°æ®ä¿ç•™æ”¿ç­–',
                    'å®‰å…¨åˆ é™¤ä¸å†éœ€è¦çš„æ•°æ®'
                ]
            },
            'security': {
                'description': 'å®Œæ•´æ€§ä¸ä¿å¯†æ€§åŸåˆ™',
                'requirements': [
                    'å®æ–½é€‚å½“çš„æŠ€æœ¯å’Œç»„ç»‡æªæ–½',
                    'ç¡®ä¿æ•°æ®å¤„ç†å®‰å…¨',
                    'å»ºç«‹æ•°æ®æ³„éœ²åº”å¯¹æœºåˆ¶'
                ]
            },
            'accountability': {
                'description': 'é—®è´£åˆ¶åŸåˆ™',
                'requirements': [
                    'æ•°æ®æ§åˆ¶è€…è´Ÿè´£åˆè§„',
                    'èƒ½å¤Ÿè¯æ˜åˆè§„æ€§',
                    'å»ºç«‹æ•°æ®æ²»ç†æ¡†æ¶'
                ]
            }
        }
        
        self.data_subject_rights = {
            'right_to_be_informed': {
                'description': 'çŸ¥æƒ…æƒ',
                'details': 'æ•°æ®ä¸»ä½“æœ‰æƒäº†è§£å…¶æ•°æ®å¦‚ä½•è¢«æ”¶é›†ã€ä½¿ç”¨å’Œå¤„ç†'
            },
            'right_of_access': {
                'description': 'è®¿é—®æƒ',
                'details': 'æ•°æ®ä¸»ä½“æœ‰æƒè®¿é—®å…¶ä¸ªäººæ•°æ®'
            },
            'right_to_rectification': {
                'description': 'æ›´æ­£æƒ',
                'details': 'æ•°æ®ä¸»ä½“æœ‰æƒæ›´æ­£ä¸å‡†ç¡®çš„ä¸ªäººæ•°æ®'
            },
            'right_to_erasure': {
                'description': 'åˆ é™¤æƒï¼ˆè¢«é—å¿˜æƒï¼‰',
                'details': 'åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œæ•°æ®ä¸»ä½“æœ‰æƒè¦æ±‚åˆ é™¤å…¶ä¸ªäººæ•°æ®'
            },
            'right_to_restrict_processing': {
                'description': 'é™åˆ¶å¤„ç†æƒ',
                'details': 'åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œæ•°æ®ä¸»ä½“æœ‰æƒé™åˆ¶å…¶æ•°æ®çš„å¤„ç†'
            },
            'right_to_data_portability': {
                'description': 'æ•°æ®å¯æºå¸¦æƒ',
                'details': 'æ•°æ®ä¸»ä½“æœ‰æƒä»¥ç»“æ„åŒ–ã€å¸¸ç”¨å’Œæœºå™¨å¯è¯»çš„æ ¼å¼è·å–å…¶æ•°æ®'
            },
            'right_to_object': {
                'description': 'åå¯¹æƒ',
                'details': 'æ•°æ®ä¸»ä½“æœ‰æƒåå¯¹å…¶æ•°æ®çš„å¤„ç†'
            },
            'rights_related_to_automated_decision_making_and_profiling': {
                'description': 'ä¸è‡ªåŠ¨åŒ–å†³ç­–å’Œç”»åƒåˆ†æç›¸å…³çš„æƒåˆ©',
                'details': 'æ•°æ®ä¸»ä½“æœ‰æƒä¸æ¥å—çº¯åŸºäºè‡ªåŠ¨åŒ–å¤„ç†çš„å†³ç­–'
            }
        }
    
    def check_gdpr_compliance(self, data_processing_activities):
        """
        æ£€æŸ¥GDPRåˆè§„æ€§
        
        Args:
            data_processing_activities: æ•°æ®å¤„ç†æ´»åŠ¨åˆ—è¡¨
            
        Returns:
            åˆè§„æ€§è¯„ä¼°ç»“æœ
        """
        compliance_results = {}
        
        for principle, details in self.compliance_matrix.items():
            principle_score = 0
            principle_issues = []
            
            for requirement in details['requirements']:
                # æ£€æŸ¥æ¯ä¸ªè¦æ±‚æ˜¯å¦æ»¡è¶³ï¼ˆç®€åŒ–è¯„ä¼°ï¼‰
                requirement_met = False
                
                # åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥æœ‰æ›´å¤æ‚çš„é€»è¾‘
                for activity in data_processing_activities:
                    if principle in activity.get('compliance_measures', []):
                        requirement_met = True
                        break
                
                if requirement_met:
                    principle_score += 1
                else:
                    principle_issues.append(requirement)
            
            # è®¡ç®—åˆè§„ç™¾åˆ†æ¯”
            total_requirements = len(details['requirements'])
            compliance_percentage = (principle_score / total_requirements) * 100
            
            compliance_results[principle] = {
                'description': details['description'],
                'compliance_score': compliance_percentage,
                'requirements_met': principle_score,
                'total_requirements': total_requirements,
                'issues': principle_issues
            }
        
        return compliance_results
    
    def generate_gdpr_report(self, compliance_results):
        """ç”ŸæˆGDPRåˆè§„æŠ¥å‘Š"""
        # è®¡ç®—æ€»ä½“åˆè§„å¾—åˆ†
        total_score = sum(result['compliance_score'] for result in compliance_results.values())
        overall_compliance = total_score / len(compliance_results)
        
        # ç¡®å®šåˆè§„ç­‰çº§
        if overall_compliance >= 90:
            compliance_level = "é«˜åº¦åˆè§„"
        elif overall_compliance >= 70:
            compliance_level = "åŸºæœ¬åˆè§„"
        elif overall_compliance >= 50:
            compliance_level = "éƒ¨åˆ†åˆè§„"
        else:
            compliance_level = "ä¸åˆè§„"
        
        # ç”ŸæˆæŠ¥å‘Š
        report = {
            'overall_compliance': overall_compliance,
            'compliance_level': compliance_level,
            'principle_results': compliance_results,
            'recommendations': self._generate_gdpr_recommendations(compliance_results)
        }
        
        return report
    
    def _generate_gdpr_recommendations(self, compliance_results):
        """ç”ŸæˆGDPRåˆè§„æ”¹è¿›å»ºè®®"""
        recommendations = []
        
        for principle, result in compliance_results.items():
            if result['compliance_score'] < 80:
                recommendations.append({
                    'principle': principle,
                    'priority': 'é«˜' if result['compliance_score'] < 50 else 'ä¸­',
                    'description': f"æ”¹è¿›{result['description']}çš„åˆè§„æ€§",
                    'issues': result['issues']
                })
        
        return recommendations

# ä½¿ç”¨ç¤ºä¾‹
gdpr = GDPRCompliance()

# å®šä¹‰æ•°æ®å¤„ç†æ´»åŠ¨
data_processing_activities = [
    {
        'activity': 'å®¢æˆ·æ•°æ®æ”¶é›†',
        'purpose': 'æä¾›äº§å“å’ŒæœåŠ¡',
        'compliance_measures': ['lawfulness', 'purpose_limitation', 'data_minimization']
    },
    {
        'activity': 'è¥é”€æ´»åŠ¨',
        'purpose': 'æ¨å¹¿äº§å“',
        'compliance_measures': ['lawfulness', 'purpose_limitation']
    },
    {
        'activity': 'æ•°æ®åˆ†æ',
        'purpose': 'æ”¹è¿›æœåŠ¡',
        'compliance_measures': ['security', 'accountability']
    }
]

# æ£€æŸ¥GDPRåˆè§„æ€§
compliance_results = gdpr.check_gdpr_compliance(data_processing_activities)

# ç”Ÿæˆåˆè§„æŠ¥å‘Š
gdpr_report = gdpr.generate_gdpr_report(compliance_results)

print("GDPRåˆè§„æ€§è¯„ä¼°æŠ¥å‘Š")
print("=" * 50)
print(f"æ€»ä½“åˆè§„å¾—åˆ†: {gdpr_report['overall_compliance']:.1f}%")
print(f"åˆè§„ç­‰çº§: {gdpr_report['compliance_level']}")

print("\nå„é¡¹åŸåˆ™åˆè§„æƒ…å†µ:")
for principle, result in gdpr_report['principle_results'].items():
    status = "âœ“" if result['compliance_score'] >= 80 else "âœ—"
    print(f"  {status} {principle}: {result['compliance_score']:.1f}%")
    print(f"    {result['description']}")

print("\næ”¹è¿›å»ºè®®:")
for recommendation in gdpr_report['recommendations']:
    priority_emoji = "ğŸ”´" if recommendation['priority'] == 'é«˜' else "ğŸŸ¡"
    print(f"  {priority_emoji} {recommendation['description']} (ä¼˜å…ˆçº§: {recommendation['priority']})")
    for issue in recommendation['issues'][:2]:  # åªæ˜¾ç¤ºå‰ä¸¤ä¸ªé—®é¢˜
        print(f"    - {issue}")
```

#### ä¸­å›½ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ï¼ˆPIPLï¼‰

ä¸­å›½ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•äº2021å¹´11æœˆ1æ—¥ç”Ÿæ•ˆï¼Œæ˜¯ä¸­å›½é¦–éƒ¨å…¨é¢çš„æ•°æ®ä¿æŠ¤æ³•ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

1. **ä¸ªäººä¿¡æ¯**ï¼šä»¥ç”µå­æˆ–è€…å…¶ä»–æ–¹å¼è®°å½•çš„ä¸å·²è¯†åˆ«æˆ–è€…å¯è¯†åˆ«çš„è‡ªç„¶äººæœ‰å…³çš„å„ç§ä¿¡æ¯
2. **æ•æ„Ÿä¸ªäººä¿¡æ¯**ï¼šä¸€æ—¦æ³„éœ²æˆ–è€…éæ³•ä½¿ç”¨ï¼Œå®¹æ˜“å¯¼è‡´è‡ªç„¶äººçš„äººæ ¼å°Šä¸¥å—åˆ°ä¾µå®³æˆ–è€…äººèº«ã€è´¢äº§å®‰å…¨å—åˆ°å±å®³çš„ä¸ªäººä¿¡æ¯

```python
class PIPLCompliance:
    """ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•åˆè§„æ£€æŸ¥å·¥å…·"""
    
    def __init__(self):
        self.core_principles = {
            'legitimate_lawful_necessary': {
                'description': 'åˆæ³•ã€æ­£å½“ã€å¿…è¦å’Œè¯šä¿¡åŸåˆ™',
                'requirements': [
                    'å¤„ç†ä¸ªäººä¿¡æ¯åº”å½“å…·æœ‰åˆæ³•ã€æ­£å½“çš„ç›®çš„',
                    'åº”å½“é™äºå®ç°å¤„ç†ç›®çš„çš„æœ€å°èŒƒå›´',
                    'ä¸å¾—è¿‡åº¦æ”¶é›†ä¸ªäººä¿¡æ¯',
                    'åº”å½“éµå¾ªè¯šä¿¡åŸåˆ™'
                ]
            },
            'purpose_limitation': {
                'description': 'ç›®çš„æ˜ç¡®åŸåˆ™',
                'requirements': [
                    'å¤„ç†ä¸ªäººä¿¡æ¯åº”å½“å…·æœ‰æ˜ç¡®ã€åˆç†çš„ç›®çš„',
                    'åº”å½“ä¸å¤„ç†ç›®çš„ç›´æ¥ç›¸å…³',
                    'é‡‡å–å¯¹ä¸ªäººæƒç›Šå½±å“æœ€å°çš„æ–¹å¼',
                    'ä¸å¾—ç”¨äºä¸å¤„ç†ç›®çš„æ— å…³çš„å…¶ä»–ç”¨é€”'
                ]
            },
            'informed_consent': {
                'description': 'çŸ¥æƒ…åŒæ„åŸåˆ™',
                'requirements': [
                    'å¤„ç†ä¸ªäººä¿¡æ¯åº”å½“å–å¾—ä¸ªäººåŒæ„',
                    'åº”å½“å……åˆ†å‘ŠçŸ¥å¤„ç†äº‹é¡¹',
                    'åŒæ„åº”å½“ç”±ä¸ªäººåœ¨å……åˆ†çŸ¥æƒ…çš„å‰æä¸‹è‡ªæ„¿ã€æ˜ç¡®ä½œå‡º',
                    'å¯¹äºæ•æ„Ÿä¸ªäººä¿¡æ¯åº”å½“å–å¾—ä¸ªäººçš„å•ç‹¬åŒæ„'
                ]
            },
            'data_security': {
                'description': 'å®‰å…¨ä¿éšœåŸåˆ™',
                'requirements': [
                    'é‡‡å–å¿…è¦æªæ–½ä¿éšœä¸ªäººä¿¡æ¯å®‰å…¨',
                    'é˜²æ­¢ä¸ªäººä¿¡æ¯æ³„éœ²ã€ç¯¡æ”¹ã€ä¸¢å¤±',
                    'å‘ç”Ÿæˆ–è€…å¯èƒ½å‘ç”Ÿä¸ªäººä¿¡æ¯æ³„éœ²çš„ï¼Œåº”å½“ç«‹å³é‡‡å–è¡¥æ•‘æªæ–½',
                    'å»ºç«‹ä¸ªäººä¿¡æ¯å®‰å…¨äº‹ä»¶åº”æ€¥æœºåˆ¶'
                ]
            }
        }
        
        self.sensitive_data_types = [
            'ç”Ÿç‰©è¯†åˆ«ä¿¡æ¯',
            'å®—æ•™ä¿¡ä»°',
            'ç‰¹å®šèº«ä»½',
            'åŒ»ç–—å¥åº·',
            'é‡‘èè´¦æˆ·',
            'è¡Œè¸ªè½¨è¿¹',
            'æ•æ„Ÿä¸ªäººä¿¡æ¯'
        ]
    
    def check_personal_info_processing(self, processing_activity):
        """
        æ£€æŸ¥ä¸ªäººä¿¡æ¯å¤„ç†æ´»åŠ¨åˆè§„æ€§
        
        Args:
            processing_activity: ä¸ªäººä¿¡æ¯å¤„ç†æ´»åŠ¨æè¿°
            
        Returns:
            åˆè§„æ€§æ£€æŸ¥ç»“æœ
        """
        compliance_results = {}
        
        for principle, details in self.core_principles.items():
            compliance_score = 0
            issues = []
            
            for requirement in details['requirements']:
                # ç®€åŒ–çš„åˆè§„æ£€æŸ¥é€»è¾‘
                is_compliant = False
                
                # æ£€æŸ¥å¤„ç†æ´»åŠ¨æ˜¯å¦ç¬¦åˆè¦æ±‚
                if principle in processing_activity.get('compliance_measures', []):
                    is_compliant = True
                
                # ç‰¹æ®Šæ£€æŸ¥ï¼šæ•æ„Ÿä¸ªäººä¿¡æ¯éœ€è¦å•ç‹¬åŒæ„
                if principle == 'informed_consent' and processing_activity.get('is_sensitive', False):
                    if processing_activity.get('separate_consent', False):
                        is_compliant = True
                    else:
                        is_compliant = False
                        issues.append("å¤„ç†æ•æ„Ÿä¸ªäººä¿¡æ¯æœªå–å¾—å•ç‹¬åŒæ„")
                
                if is_compliant:
                    compliance_score += 1
                else:
                    issues.append(requirement)
            
            total_requirements = len(details['requirements'])
            compliance_percentage = (compliance_score / total_requirements) * 100
            
            compliance_results[principle] = {
                'description': details['description'],
                'compliance_score': compliance_percentage,
                'requirements_met': compliance_score,
                'total_requirements': total_requirements,
                'issues': issues
            }
        
        return compliance_results
    
    def identify_sensitive_info(self, data_fields):
        """
        è¯†åˆ«æ•æ„Ÿä¸ªäººä¿¡æ¯
        
        Args:
            data_fields: æ•°æ®å­—æ®µåˆ—è¡¨
            
        Returns:
            æ•æ„Ÿä¿¡æ¯è¯†åˆ«ç»“æœ
        """
        sensitive_fields = []
        
        # æ•æ„Ÿä¿¡æ¯å…³é”®è¯æ˜ å°„
        sensitive_keywords = {
            'biometric': ['æŒ‡çº¹', 'äººè„¸', 'è™¹è†œ', 'å£°çº¹', 'æŒçº¹', 'æ­¥æ€'],
            'religious': ['å®—æ•™', 'ä¿¡ä»°', 'å®—æ•™ä¿¡ä»°'],
            'identity': ['èº«ä»½è¯å·', 'æŠ¤ç…§å·', 'æ°‘æ—', 'ç§æ—'],
            'health': ['ç—…å²', 'ç—…å†', 'ä½“æ£€', 'å¥åº·', 'åŒ»ç–—', 'ç—…æƒ…'],
            'financial': ['é“¶è¡Œå¡å·', 'é“¶è¡Œè´¦å·', 'é‡‘èè´¦æˆ·', 'è´¢äº§ä¿¡æ¯', 'æ”¶å…¥'],
            'location': ['ä½ç½®', 'è½¨è¿¹', 'è¡Œè¸ª', 'å®šä½', 'GPS'],
            'other': ['æ”¿æ²»è§‚ç‚¹', 'æ€§å–å‘', 'å©šå§»çŠ¶å†µ']
        }
        
        for field in data_fields:
            field_lower = field.lower()
            field_type = None
            
            for category, keywords in sensitive_keywords.items():
                for keyword in keywords:
                    if keyword in field_lower:
                        field_type = category
                        break
                
                if field_type:
                    break
            
            if field_type:
                sensitive_fields.append({
                    'field_name': field,
                    'sensitive_type': field_type,
                    'category': next((cat for cat, keywords in sensitive_keywords.items() 
                                     if any(kw in field_lower for kw in keywords)), None)
                })
        
        return sensitive_fields
    
    def generate_compliance_report(self, processing_activities):
        """
        ç”ŸæˆPIPLåˆè§„æŠ¥å‘Š
        
        Args:
            processing_activities: ä¸ªäººä¿¡æ¯å¤„ç†æ´»åŠ¨åˆ—è¡¨
            
        Returns:
            åˆè§„æŠ¥å‘Š
        """
        overall_results = {}
        all_sensitive_fields = []
        
        for activity in processing_activities:
            activity_name = activity['name']
            
            # æ£€æŸ¥åˆè§„æ€§
            compliance_results = self.check_personal_info_processing(activity)
            
            # è¯†åˆ«æ•æ„Ÿä¿¡æ¯
            sensitive_fields = self.identify_sensitive_info(activity.get('data_fields', []))
            all_sensitive_fields.extend(sensitive_fields)
            
            overall_results[activity_name] = {
                'compliance_results': compliance_results,
                'sensitive_fields': sensitive_fields,
                'is_sensitive_processing': len(sensitive_fields) > 0
            }
        
        # è®¡ç®—æ€»ä½“åˆè§„å¾—åˆ†
        total_score = 0
        total_principles = 0
        
        for activity_result in overall_results.values():
            for principle_result in activity_result['compliance_results'].values():
                total_score += principle_result['compliance_score']
                total_principles += 1
        
        overall_compliance = total_score / total_principles if total_principles > 0 else 0
        
        # ç”ŸæˆæŠ¥å‘Š
        report = {
            'overall_compliance': overall_compliance,
            'processing_activities': overall_results,
            'sensitive_fields': all_sensitive_fields,
            'recommendations': self._generate_pipl_recommendations(overall_results)
        }
        
        return report
    
    def _generate_pipl_recommendations(self, overall_results):
        """ç”ŸæˆPIPLåˆè§„æ”¹è¿›å»ºè®®"""
        recommendations = []
        
        for activity_name, activity_result in overall_results.items():
            for principle, result in activity_result['compliance_results'].items():
                if result['compliance_score'] < 80:
                    recommendations.append({
                        'activity': activity_name,
                        'principle': principle,
                        'description': result['description'],
                        'issues': result['issues']
                    })
        
        # æ£€æŸ¥æ•æ„Ÿä¿¡æ¯å¤„ç†
        has_sensitive_processing = any(
            result['is_sensitive_processing'] 
            for result in overall_results.values()
        )
        
        if has_sensitive_processing:
            recommendations.append({
                'activity': 'å…¨éƒ¨æ´»åŠ¨',
                'principle': 'æ•æ„Ÿä¿¡æ¯å¤„ç†',
                'description': 'æ•æ„Ÿä¸ªäººä¿¡æ¯éœ€è¦ç‰¹æ®Šä¿æŠ¤æªæ–½',
                'issues': [
                    'ç¡®ä¿å–å¾—å•ç‹¬åŒæ„',
                    'å®æ–½æ›´ä¸¥æ ¼çš„ä¿æŠ¤æªæ–½',
                    'è¿›è¡Œä¸ªäººä¿¡æ¯ä¿æŠ¤å½±å“è¯„ä¼°'
                ]
            })
        
        return recommendations

# ä½¿ç”¨ç¤ºä¾‹
pipl = PIPLCompliance()

# å®šä¹‰ä¸ªäººä¿¡æ¯å¤„ç†æ´»åŠ¨
processing_activities = [
    {
        'name': 'ç”¨æˆ·æ³¨å†Œ',
        'purpose': 'åˆ›å»ºç”¨æˆ·è´¦æˆ·',
        'data_fields': ['ç”¨æˆ·å', 'å¯†ç ', 'æ‰‹æœºå·', 'é‚®ç®±'],
        'compliance_measures': ['legitimate_lawful_necessary', 'purpose_limitation', 'informed_consent'],
        'is_sensitive': False,
        'separate_consent': False
    },
    {
        'name': 'èº«ä»½éªŒè¯',
        'purpose': 'éªŒè¯ç”¨æˆ·èº«ä»½',
        'data_fields': ['èº«ä»½è¯å·', 'äººè„¸è¯†åˆ«', 'æŒ‡çº¹ä¿¡æ¯'],
        'compliance_measures': ['legitimate_lawful_necessary', 'informed_consent'],
        'is_sensitive': True,
        'separate_consent': True
    },
    {
        'name': 'å¥åº·æ•°æ®æ”¶é›†',
        'purpose': 'å¥åº·ç›‘æµ‹',
        'data_fields': ['èº«é«˜', 'ä½“é‡', 'è¡€å‹', 'å¿ƒç‡', 'å¥åº·æ¡£æ¡ˆ'],
        'compliance_measures': ['legitimate_lawful_necessary'],
        'is_sensitive': True,
        'separate_consent': False  # é—®é¢˜ï¼šæ•æ„Ÿä¿¡æ¯æœªå–å¾—å•ç‹¬åŒæ„
    }
]

# ç”Ÿæˆåˆè§„æŠ¥å‘Š
pipl_report = pipl.generate_compliance_report(processing_activities)

print("ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•åˆè§„æ€§è¯„ä¼°æŠ¥å‘Š")
print("=" * 50)
print(f"æ€»ä½“åˆè§„å¾—åˆ†: {pipl_report['overall_compliance']:.1f}%")

print("\nå¤„ç†æ´»åŠ¨åˆè§„æƒ…å†µ:")
for activity_name, activity_result in pipl_report['processing_activities'].items():
    print(f"\næ´»åŠ¨: {activity_name}")
    
    if activity_result['is_sensitive_processing']:
        print(f"  âš ï¸ å¤„ç†æ•æ„Ÿä¸ªäººä¿¡æ¯: {len(activity_result['sensitive_fields'])}ä¸ªå­—æ®µ")
        for field in activity_result['sensitive_fields']:
            print(f"    - {field['field_name']} ({field['sensitive_type']})")
    
    for principle, result in activity_result['compliance_results'].items():
        status = "âœ“" if result['compliance_score'] >= 80 else "âœ—"
        print(f"  {status} {principle}: {result['compliance_score']:.1f}%")

print("\næ”¹è¿›å»ºè®®:")
for recommendation in pipl_report['recommendations']:
    print(f"  ğŸ”´ æ´»åŠ¨: {recommendation['activity']}")
    print(f"     åŸåˆ™: {recommendation['description']}")
    for issue in recommendation['issues'][:2]:  # åªæ˜¾ç¤ºå‰ä¸¤ä¸ªé—®é¢˜
        print(f"       - {issue}")
```

---

## 4.5 æ•°æ®è®¿é—®æ§åˆ¶ä¸èº«ä»½è®¤è¯

### 4.5.1 èº«ä»½ä¸è®¿é—®ç®¡ç†ï¼ˆIAMï¼‰

#### åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

RBACæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è®¿é—®æ§åˆ¶æ¨¡å‹ï¼Œé€šè¿‡è§’è‰²å°†æƒé™ä¸ç”¨æˆ·åˆ†ç¦»ã€‚

```python
from enum import Enum
from typing import Dict, List, Set, Optional
import json
from datetime import datetime

class Permission(Enum):
    """æƒé™æšä¸¾"""
    READ = "read"
    WRITE = "write"
    DELETE = "delete"
    EXECUTE = "execute"
    ADMIN = "admin"

class Role:
    """è§’è‰²ç±»"""
    
    def __init__(self, name: str, description: str = ""):
        self.name = name
        self.description = description
        self.permissions: Set[Permission] = set()
        self.created_at = datetime.now()
    
    def add_permission(self, permission: Permission):
        """æ·»åŠ æƒé™"""
        self.permissions.add(permission)
    
    def remove_permission(self, permission: Permission):
        """ç§»é™¤æƒé™"""
        self.permissions.discard(permission)
    
    def has_permission(self, permission: Permission) -> bool:
        """æ£€æŸ¥æ˜¯å¦æœ‰æƒé™"""
        return permission in self.permissions

class User:
    """ç”¨æˆ·ç±»"""
    
    def __init__(self, user_id: str, name: str, email: str):
        self.user_id = user_id
        self.name = name
        self.email = email
        self.roles: List[Role] = []
        self.created_at = datetime.now()
        self.last_login = None
        self.is_active = True
    
    def assign_role(self, role: Role):
        """åˆ†é…è§’è‰²"""
        if role not in self.roles:
            self.roles.append(role)
    
    def revoke_role(self, role: Role):
        """æ’¤é”€è§’è‰²"""
        if role in self.roles:
            self.roles.remove(role)
    
    def has_permission(self, permission: Permission) -> bool:
        """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™"""
        if not self.is_active:
            return False
            
        for role in self.roles:
            if role.has_permission(permission):
                return True
        
        return False
    
    def get_effective_permissions(self) -> Set[Permission]:
        """è·å–ç”¨æˆ·æœ‰æ•ˆæƒé™"""
        effective_permissions = set()
        
        for role in self.roles:
            effective_permissions.update(role.permissions)
        
        return effective_permissions

class Resource:
    """èµ„æºç±»"""
    
    def __init__(self, resource_id: str, name: str, resource_type: str):
        self.resource_id = resource_id
        self.name = name
        self.resource_type = resource_type
        self.required_permissions: Dict[str, Permission] = {}  # æ“ä½œå -> æƒé™
        self.created_at = datetime.now()
    
    def set_required_permission(self, action: str, permission: Permission):
        """è®¾ç½®æ“ä½œæ‰€éœ€çš„æƒé™"""
        self.required_permissions[action] = permission
    
    def check_access(self, user: User, action: str) -> bool:
        """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®èµ„æº"""
        if action not in self.required_permissions:
            return False  # æœªå®šä¹‰çš„æ“ä½œ
        
        required_permission = self.required_permissions[action]
        return user.has_permission(required_permission)

class RBACSystem:
    """åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿ"""
    
    def __init__(self):
        self.users: Dict[str, User] = {}
        self.roles: Dict[str, Role] = {}
        self.resources: Dict[str, Resource] = {}
        self.audit_log: List[Dict] = []
    
    def create_user(self, user_id: str, name: str, email: str) -> User:
        """åˆ›å»ºç”¨æˆ·"""
        if user_id in self.users:
            raise ValueError(f"ç”¨æˆ·ID {user_id} å·²å­˜åœ¨")
        
        user = User(user_id, name, email)
        self.users[user_id] = user
        
        self._log_action("create_user", {"user_id": user_id})
        return user
    
    def create_role(self, role_name: str, description: str = "") -> Role:
        """åˆ›å»ºè§’è‰²"""
        if role_name in self.roles:
            raise ValueError(f"è§’è‰² {role_name} å·²å­˜åœ¨")
        
        role = Role(role_name, description)
        self.roles[role_name] = role
        
        self._log_action("create_role", {"role_name": role_name})
        return role
    
    def create_resource(self, resource_id: str, name: str, resource_type: str) -> Resource:
        """åˆ›å»ºèµ„æº"""
        if resource_id in self.resources:
            raise ValueError(f"èµ„æºID {resource_id} å·²å­˜åœ¨")
        
        resource = Resource(resource_id, name, resource_type)
        self.resources[resource_id] = resource
        
        self._log_action("create_resource", {"resource_id": resource_id})
        return resource
    
    def assign_role_to_user(self, user_id: str, role_name: str):
        """ä¸ºç”¨æˆ·åˆ†é…è§’è‰²"""
        if user_id not in self.users:
            raise ValueError(f"ç”¨æˆ·ID {user_id} ä¸å­˜åœ¨")
        
        if role_name not in self.roles:
            raise ValueError(f"è§’è‰² {role_name} ä¸å­˜åœ¨")
        
        user = self.users[user_id]
        role = self.roles[role_name]
        
        user.assign_role(role)
        
        self._log_action("assign_role", {
            "user_id": user_id,
            "role_name": role_name
        })
    
    def check_access(self, user_id: str, resource_id: str, action: str) -> bool:
        """æ£€æŸ¥è®¿é—®æƒé™"""
        if user_id not in self.users:
            self._log_action("access_denied", {
                "user_id": user_id,
                "resource_id": resource_id,
                "action": action,
                "reason": "ç”¨æˆ·ä¸å­˜åœ¨"
            })
            return False
        
        if resource_id not in self.resources:
            self._log_action("access_denied", {
                "user_id": user_id,
                "resource_id": resource_id,
                "action": action,
                "reason": "èµ„æºä¸å­˜åœ¨"
            })
            return False
        
        user = self.users[user_id]
        resource = self.resources[resource_id]
        
        access_granted = resource.check_access(user, action)
        
        self._log_action("access_check", {
            "user_id": user_id,
            "resource_id": resource_id,
            "action": action,
            "access_granted": access_granted
        })
        
        return access_granted
    
    def get_user_permissions(self, user_id: str) -> Dict:
        """è·å–ç”¨æˆ·æƒé™"""
        if user_id not in self.users:
            return {}
        
        user = self.users[user_id]
        permissions = user.get_effective_permissions()
        
        return {
            "user_id": user_id,
            "user_name": user.name,
            "roles": [role.name for role in user.roles],
            "permissions": [perm.value for perm in permissions]
        }
    
    def _log_action(self, action: str, details: Dict):
        """è®°å½•å®¡è®¡æ—¥å¿—"""
        log_entry = {
            "timestamp": datetime.now().isoformat(),
            "action": action,
            "details": details
        }
        
        self.audit_log.append(log_entry)
    
    def get_audit_log(self, action_filter: Optional[str] = None) -> List[Dict]:
        """è·å–å®¡è®¡æ—¥å¿—"""
        if action_filter:
            return [log for log in self.audit_log if log["action"] == action_filter]
        
        return self.audit_log

# ä½¿ç”¨ç¤ºä¾‹
rbac = RBACSystem()

# åˆ›å»ºè§’è‰²
admin_role = rbac.create_role("admin", "ç³»ç»Ÿç®¡ç†å‘˜")
admin_role.add_permission(Permission.READ)
admin_role.add_permission(Permission.WRITE)
admin_role.add_permission(Permission.DELETE)
admin_role.add_permission(Permission.EXECUTE)
admin_role.add_permission(Permission.ADMIN)

analyst_role = rbac.create_role("analyst", "æ•°æ®åˆ†æå¸ˆ")
analyst_role.add_permission(Permission.READ)
analyst_role.add_permission(Permission.EXECUTE)

viewer_role = rbac.create_role("viewer", "åªè¯»ç”¨æˆ·")
viewer_role.add_permission(Permission.READ)

# åˆ›å»ºç”¨æˆ·
admin_user = rbac.create_user("admin01", "å¼ ä¸‰", "zhangsan@example.com")
analyst_user = rbac.create_user("analyst01", "æå››", "lisi@example.com")
viewer_user = rbac.create_user("viewer01", "ç‹äº”", "wangwu@example.com")

# ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
rbac.assign_role_to_user("admin01", "admin")
rbac.assign_role_to_user("analyst01", "analyst")
rbac.assign_role_to_user("viewer01", "viewer")

# åˆ›å»ºèµ„æº
customer_data = rbac.create_resource("customer_data", "å®¢æˆ·æ•°æ®", "database")
customer_data.set_required_permission("read", Permission.READ)
customer_data.set_required_permission("write", Permission.WRITE)
customer_data.set_required_permission("delete", Permission.DELETE)

report_system = rbac.create_resource("report_system", "æŠ¥è¡¨ç³»ç»Ÿ", "application")
report_system.set_required_permission("view", Permission.READ)
report_system.set_required_permission("generate", Permission.EXECUTE)

# æµ‹è¯•è®¿é—®æƒé™
print("è®¿é—®æƒé™æµ‹è¯•:")
print(f"ç®¡ç†å‘˜è¯»å–å®¢æˆ·æ•°æ®: {rbac.check_access('admin01', 'customer_data', 'read')}")
print(f"åˆ†æå¸ˆå†™å…¥å®¢æˆ·æ•°æ®: {rbac.check_access('analyst01', 'customer_data', 'write')}")
print(f"åªè¯»ç”¨æˆ·åˆ é™¤å®¢æˆ·æ•°æ®: {rbac.check_access('viewer01', 'customer_data', 'delete')}")
print(f"åˆ†æå¸ˆç”ŸæˆæŠ¥è¡¨: {rbac.check_access('analyst01', 'report_system', 'generate')}")
print(f"åªè¯»ç”¨æˆ·æŸ¥çœ‹æŠ¥è¡¨: {rbac.check_access('viewer01', 'report_system', 'view')}")

# æŸ¥çœ‹ç”¨æˆ·æƒé™
print("\nç”¨æˆ·æƒé™:")
for user_id in rbac.users:
    permissions = rbac.get_user_permissions(user_id)
    print(f"{permissions['user_name']} ({permissions['user_id']}):")
    print(f"  è§’è‰²: {', '.join(permissions['roles'])}")
    print(f"  æƒé™: {', '.join(permissions['permissions'])}")

# æŸ¥çœ‹å®¡è®¡æ—¥å¿—
print("\nå®¡è®¡æ—¥å¿—:")
for log_entry in rbac.get_audit_log():
    timestamp = log_entry['timestamp']
    action = log_entry['action']
    details = log_entry['details']
    
    print(f"{timestamp}: {action}")
    for key, value in details.items():
        print(f"  {key}: {value}")
```

#### åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰

ABACæ˜¯ä¸€ç§æ›´çµæ´»çš„è®¿é—®æ§åˆ¶æ¨¡å‹ï¼ŒåŸºäºå±æ€§ï¼ˆç”¨æˆ·ã€èµ„æºã€ç¯å¢ƒå±æ€§ï¼‰æ¥å†³ç­–ã€‚

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, List
from enum import Enum
import json
from datetime import datetime

class AttributeType(Enum):
    """å±æ€§ç±»å‹"""
    USER = "user"
    RESOURCE = "resource"
    ENVIRONMENT = "environment"
    ACTION = "action"

class ComparisonOperator(Enum):
    """æ¯”è¾ƒæ“ä½œç¬¦"""
    EQUAL = "=="
    NOT_EQUAL = "!="
    GREATER_THAN = ">"
    GREATER_EQUAL = ">="
    LESS_THAN = "<"
    LESS_EQUAL = "<="
    IN = "in"
    NOT_IN = "not_in"
    CONTAINS = "contains"
    STARTS_WITH = "starts_with"
    ENDS_WITH = "ends_with"

class Attribute:
    """å±æ€§ç±»"""
    
    def __init__(self, name: str, value: Any, attribute_type: AttributeType):
        self.name = name
        self.value = value
        self.attribute_type = attribute_type

class PolicyCondition:
    """ç­–ç•¥æ¡ä»¶"""
    
    def __init__(self, 
                 attribute_type: AttributeType, 
                 attribute_name: str, 
                 operator: ComparisonOperator, 
                 expected_value: Any):
        self.attribute_type = attribute_type
        self.attribute_name = attribute_name
        self.operator = operator
        self.expected_value = expected_value
    
    def evaluate(self, attributes: Dict[AttributeType, Dict[str, Any]]) -> bool:
        """è¯„ä¼°æ¡ä»¶æ˜¯å¦æ»¡è¶³"""
        # è·å–å±æ€§å€¼
        if self.attribute_type not in attributes:
            return False
        
        if self.attribute_name not in attributes[self.attribute_type]:
            return False
        
        actual_value = attributes[self.attribute_type][self.attribute_name]
        
        # æ ¹æ®æ“ä½œç¬¦è¿›è¡Œæ¯”è¾ƒ
        if self.operator == ComparisonOperator.EQUAL:
            return actual_value == self.expected_value
        elif self.operator == ComparisonOperator.NOT_EQUAL:
            return actual_value != self.expected_value
        elif self.operator == ComparisonOperator.GREATER_THAN:
            return actual_value > self.expected_value
        elif self.operator == ComparisonOperator.GREATER_EQUAL:
            return actual_value >= self.expected_value
        elif self.operator == ComparisonOperator.LESS_THAN:
            return actual_value < self.expected_value
        elif self.operator == ComparisonOperator.LESS_EQUAL:
            return actual_value <= self.expected_value
        elif self.operator == ComparisonOperator.IN:
            return actual_value in self.expected_value
        elif self.operator == ComparisonOperator.NOT_IN:
            return actual_value not in self.expected_value
        elif self.operator == ComparisonOperator.CONTAINS:
            return self.expected_value in actual_value
        elif self.operator == ComparisonOperator.STARTS_WITH:
            return actual_value.startswith(self.expected_value)
        elif self.operator == ComparisonOperator.ENDS_WITH:
            return actual_value.endswith(self.expected_value)
        
        return False

class AccessPolicy:
    """è®¿é—®ç­–ç•¥"""
    
    def __init__(self, policy_id: str, name: str, description: str = ""):
        self.policy_id = policy_id
        self.name = name
        self.description = description
        self.conditions: List[PolicyCondition] = []
        self.effect = "allow"  # "allow" æˆ– "deny"
        self.priority = 0  # ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
        self.created_at = datetime.now()
    
    def add_condition(self, condition: PolicyCondition):
        """æ·»åŠ æ¡ä»¶"""
        self.conditions.append(condition)
    
    def evaluate(self, 
                 user_attributes: Dict[str, Any],
                 resource_attributes: Dict[str, Any],
                 action_attributes: Dict[str, Any],
                 environment_attributes: Dict[str, Any]) -> bool:
        """è¯„ä¼°ç­–ç•¥"""
        # æ„å»ºå±æ€§å­—å…¸
        attributes = {
            AttributeType.USER: user_attributes,
            AttributeType.RESOURCE: resource_attributes,
            AttributeType.ACTION: action_attributes,
            AttributeType.ENVIRONMENT: environment_attributes
        }
        
        # æ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³
        for condition in self.conditions:
            if not condition.evaluate(attributes):
                return False
        
        return True

class ABACSystem:
    """åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿ"""
    
    def __init__(self):
        self.policies: Dict[str, AccessPolicy] = {}
        self.audit_log: List[Dict] = []
    
    def add_policy(self, policy: AccessPolicy):
        """æ·»åŠ ç­–ç•¥"""
        self.policies[policy.policy_id] = policy
        self._log_action("add_policy", {
            "policy_id": policy.policy_id,
            "policy_name": policy.name
        })
    
    def check_access(self,
                    user_id: str,
                    user_attributes: Dict[str, Any],
                    resource_id: str,
                    resource_attributes: Dict[str, Any],
                    action: str,
                    action_attributes: Dict[str, Any],
                    environment_attributes: Dict[str, Any] = None) -> Dict:
        """æ£€æŸ¥è®¿é—®æƒé™"""
        if environment_attributes is None:
            environment_attributes = {}
        
        # å‡†å¤‡å†³ç­–ç»“æœ
        decision = {
            "access_granted": False,
            "applied_policy": None,
            "reason": "",
            "timestamp": datetime.now().isoformat()
        }
        
        # æŒ‰ä¼˜å…ˆçº§æ’åºç­–ç•¥
        sorted_policies = sorted(
            self.policies.values(),
            key=lambda p: p.priority
        )
        
        # è¯„ä¼°ç­–ç•¥
        for policy in sorted_policies:
            if policy.evaluate(
                user_attributes,
                resource_attributes,
                {"action": action, **action_attributes},
                environment_attributes
            ):
                decision["applied_policy"] = policy.policy_id
                decision["access_granted"] = policy.effect == "allow"
                decision["reason"] = f"ç­–ç•¥ {policy.name} ({policy.effect})"
                break
        
        # è®°å½•å®¡è®¡æ—¥å¿—
        self._log_action("access_check", {
            "user_id": user_id,
            "resource_id": resource_id,
            "action": action,
            "access_granted": decision["access_granted"],
            "applied_policy": decision["applied_policy"],
            "reason": decision["reason"]
        })
        
        return decision
    
    def _log_action(self, action: str, details: Dict):
        """è®°å½•å®¡è®¡æ—¥å¿—"""
        log_entry = {
            "timestamp": datetime.now().isoformat(),
            "action": action,
            "details": details
        }
        
        self.audit_log.append(log_entry)
    
    def get_audit_log(self, action_filter: str = None) -> List[Dict]:
        """è·å–å®¡è®¡æ—¥å¿—"""
        if action_filter:
            return [log for log in self.audit_log if log["action"] == action_filter]
        
        return self.audit_log

# ä½¿ç”¨ç¤ºä¾‹
abac = ABACSystem()

# åˆ›å»ºç­–ç•¥1ï¼šæ•°æ®ç§‘å­¦å®¶åªèƒ½åœ¨å·¥ä½œæ—¶é—´è®¿é—®ç”Ÿäº§æ•°æ®
scientist_policy = AccessPolicy(
    "scientist_prod_access",
    "æ•°æ®ç§‘å­¦å®¶ç”Ÿäº§æ•°æ®è®¿é—®",
    "å…è®¸æ•°æ®ç§‘å­¦å®¶åœ¨å·¥ä½œæ—¶é—´è®¿é—®ç”Ÿäº§æ•°æ®"
)
scientist_policy.effect = "allow"
scientist_policy.priority = 1

# æ·»åŠ æ¡ä»¶
scientist_policy.add_condition(PolicyCondition(
    AttributeType.USER, "role", ComparisonOperator.EQUAL, "data_scientist"
))
scientist_policy.add_condition(PolicyCondition(
    AttributeType.RESOURCE, "environment", ComparisonOperator.EQUAL, "production"
))
scientist_policy.add_condition(PolicyCondition(
    AttributeType.ENVIRONMENT, "hour", ComparisonOperator.IN, list(range(9, 18))  # 9:00-17:59
))

# åˆ›å»ºç­–ç•¥2ï¼šæ‹’ç»æ‰€æœ‰å¤–éƒ¨ç”¨æˆ·è®¿é—®æ•æ„Ÿæ•°æ®
external_user_policy = AccessPolicy(
    "deny_external_sensitive",
    "æ‹’ç»å¤–éƒ¨ç”¨æˆ·è®¿é—®æ•æ„Ÿæ•°æ®",
    "æ‹’ç»å¤–éƒ¨ç”¨æˆ·è®¿é—®æ•æ„Ÿæ•°æ®"
)
external_user_policy.effect = "deny"
external_user_policy.priority = 0  # é«˜ä¼˜å…ˆçº§

# æ·»åŠ æ¡ä»¶
external_user_policy.add_condition(PolicyCondition(
    AttributeType.USER, "location", ComparisonOperator.NOT_IN, ["internal", "VPN"]
))
external_user_policy.add_condition(PolicyCondition(
    AttributeType.RESOURCE, "sensitivity", ComparisonOperator.EQUAL, "high"
))

# åˆ›å»ºç­–ç•¥3ï¼šé»˜è®¤å…è®¸å†…éƒ¨ç”¨æˆ·è¯»å–éæ•æ„Ÿæ•°æ®
default_access_policy = AccessPolicy(
    "default_internal_access",
    "é»˜è®¤å†…éƒ¨è®¿é—®",
    "å…è®¸å†…éƒ¨ç”¨æˆ·è¯»å–éæ•æ„Ÿæ•°æ®"
)
default_access_policy.effect = "allow"
default_access_policy.priority = 10  # ä½ä¼˜å…ˆçº§

# æ·»åŠ æ¡ä»¶
default_access_policy.add_condition(PolicyCondition(
    AttributeType.USER, "location", ComparisonOperator.IN, ["internal", "VPN"]
))
default_access_policy.add_condition(PolicyCondition(
    AttributeType.ACTION, "action", ComparisonOperator.EQUAL, "read"
))
default_access_policy.add_condition(PolicyCondition(
    AttributeType.RESOURCE, "sensitivity", ComparisonOperator.IN, ["low", "medium"]
))

# æ·»åŠ ç­–ç•¥åˆ°ç³»ç»Ÿ
abac.add_policy(scientist_policy)
abac.add_policy(external_user_policy)
abac.add_policy(default_access_policy)

# æµ‹è¯•åœºæ™¯
def test_scenario(name, user_id, user_attrs, resource_id, resource_attrs, action, env_attrs):
    print(f"\nåœºæ™¯: {name}")
    decision = abac.check_access(
        user_id=user_id,
        user_attributes=user_attrs,
        resource_id=resource_id,
        resource_attributes=resource_attrs,
        action=action,
        action_attributes={"action": action},
        environment_attributes=env_attrs
    )
    
    status = "âœ“ å…è®¸" if decision["access_granted"] else "âœ— æ‹’ç»"
    print(f"  ç»“æœ: {status}")
    print(f"  åŸå› : {decision['reason']}")
    if decision["applied_policy"]:
        print(f"  åº”ç”¨ç­–ç•¥: {decision['applied_policy']}")

# æµ‹è¯•åœºæ™¯1ï¼šæ•°æ®ç§‘å­¦å®¶åœ¨å·¥ä½œæ—¶é—´è®¿é—®ç”Ÿäº§æ•°æ®
test_scenario(
    "æ•°æ®ç§‘å­¦å®¶åœ¨å·¥ä½œæ—¶é—´è®¿é—®ç”Ÿäº§æ•°æ®",
    "scientist01",
    {"role": "data_scientist", "location": "internal"},
    "customer_data_prod",
    {"environment": "production", "sensitivity": "high"},
    "read",
    {"hour": 14}  # ä¸‹åˆ2ç‚¹
)

# æµ‹è¯•åœºæ™¯2ï¼šæ•°æ®ç§‘å­¦å®¶åœ¨éå·¥ä½œæ—¶é—´è®¿é—®ç”Ÿäº§æ•°æ®
test_scenario(
    "æ•°æ®ç§‘å­¦å®¶åœ¨éå·¥ä½œæ—¶é—´è®¿é—®ç”Ÿäº§æ•°æ®",
    "scientist01",
    {"role": "data_scientist", "location": "internal"},
    "customer_data_prod",
    {"environment": "production", "sensitivity": "high"},
    "read",
    {"hour": 20}  # æ™šä¸Š8ç‚¹
)

# æµ‹è¯•åœºæ™¯3ï¼šå¤–éƒ¨ç”¨æˆ·è®¿é—®æ•æ„Ÿæ•°æ®
test_scenario(
    "å¤–éƒ¨ç”¨æˆ·è®¿é—®æ•æ„Ÿæ•°æ®",
    "external01",
    {"role": "analyst", "location": "external"},
    "customer_data_prod",
    {"environment": "production", "sensitivity": "high"},
    "read",
    {"hour": 14}  # ä¸‹åˆ2ç‚¹
)

# æµ‹è¯•åœºæ™¯4ï¼šå†…éƒ¨ç”¨æˆ·è¯»å–éæ•æ„Ÿæ•°æ®
test_scenario(
    "å†…éƒ¨ç”¨æˆ·è¯»å–éæ•æ„Ÿæ•°æ®",
    "analyst01",
    {"role": "analyst", "location": "internal"},
    "product_catalog",
    {"environment": "production", "sensitivity": "low"},
    "read",
    {"hour": 14}  # ä¸‹åˆ2ç‚¹
)

# æŸ¥çœ‹å®¡è®¡æ—¥å¿—
print("\nå®¡è®¡æ—¥å¿—:")
for log_entry in abac.get_audit_log("access_check"):
    timestamp = log_entry['timestamp']
    details = log_entry['details']
    access_result = "å…è®¸" if details['access_granted'] else "æ‹’ç»"
    
    print(f"{timestamp}: {details['user_id']} è®¿é—® {details['resource_id']} ({details['action']}) - {access_result}")
```

---

## 4.6 æ•°æ®å®‰å…¨äº‹ä»¶å“åº”

### 4.6.1 äº‹ä»¶å“åº”æ¡†æ¶

#### äº‹ä»¶å“åº”ç”Ÿå‘½å‘¨æœŸ

```mermaid
graph TD
    A[å‡†å¤‡é˜¶æ®µ] --> B[æ£€æµ‹ä¸åˆ†æ]
    B --> C[éåˆ¶ã€æ ¹é™¤ä¸æ¢å¤]
    C --> D[äº‹åæ´»åŠ¨]
    D --> A
```

#### æ•°æ®å®‰å…¨äº‹ä»¶åˆ†ç±»

| äº‹ä»¶ç±»å‹ | ä¸¥é‡æ€§ | æè¿° | å“åº”æ—¶é—´è¦æ±‚ |
|----------|--------|------|--------------|
| **æ•°æ®æ³„éœ²** | é«˜ | æ•æ„Ÿæ•°æ®è¢«æœªç»æˆæƒçš„ä¸ªäººè®¿é—®æˆ–è·å– | 1å°æ—¶å†… |
| **æ•°æ®ç¯¡æ”¹** | é«˜ | æ•°æ®è¢«æœªç»æˆæƒä¿®æ”¹ | 1å°æ—¶å†… |
| **å‹’ç´¢è½¯ä»¶** | é«˜ | æ•°æ®è¢«åŠ å¯†å¹¶è¢«å‹’ç´¢èµé‡‘ | 1å°æ—¶å†… |
| **ç³»ç»Ÿå…¥ä¾µ** | ä¸­é«˜ | ç³»ç»Ÿè¢«æœªç»æˆæƒè®¿é—® | 4å°æ—¶å†… |
| **æ¶æ„è½¯ä»¶** | ä¸­ | æ¶æ„è½¯ä»¶æ„ŸæŸ“ç³»ç»Ÿ | 12å°æ—¶å†… |
| **è®¿é—®å¼‚å¸¸** | ä¸­ | å¼‚å¸¸è®¿é—®æ¨¡å¼æ£€æµ‹ | 24å°æ—¶å†… |
| **é…ç½®é”™è¯¯** | ä½ | å®‰å…¨é…ç½®ä¸å½“ | 72å°æ—¶å†… |

### 4.6.2 äº‹ä»¶å“åº”å®æ–½

```python
import json
import hashlib
import random
from datetime import datetime, timedelta
from enum import Enum
from typing import Dict, List, Optional, Any
import pandas as pd

class IncidentSeverity(Enum):
    """äº‹ä»¶ä¸¥é‡æ€§"""
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"

class IncidentStatus(Enum):
    """äº‹ä»¶çŠ¶æ€"""
    NEW = "new"
    IN_PROGRESS = "in_progress"
    RESOLVED = "resolved"
    CLOSED = "closed"

class IncidentType(Enum):
    """äº‹ä»¶ç±»å‹"""
    DATA_BREACH = "data_breach"
    DATA_TAMPERING = "data_tampering"
    RANSOMWARE = "ransomware"
    SYSTEM_COMPROMISE = "system_compromise"
    MALWARE = "malware"
    ACCESS_ANOMALY = "access_anomaly"
    MISCONFIGURATION = "misconfiguration"

class DataSecurityIncident:
    """æ•°æ®å®‰å…¨äº‹ä»¶"""
    
    def __init__(self, incident_id: str, title: str):
        self.incident_id = incident_id
        self.title = title
        self.description = ""
        self.incident_type: Optional[IncidentType] = None
        self.severity: Optional[IncidentSeverity] = None
        self.status = IncidentStatus.NEW
        self.detected_at = datetime.now()
        self.affected_assets: List[str] = []
        self.data_categories: List[str] = []
        self.affected_records_count = 0
        self.root_cause = ""
        self.containment_actions: List[str] = []
        self.eradication_actions: List[str] = []
        self.recovery_actions: List[str] = []
        self.reported_to_authorities = False
        self.reported_to_individuals = False
        self.resolution_time = None
        self.assigned_to = ""
        self.timeline: List[Dict] = []
        
        # è®°å½•åˆå§‹çŠ¶æ€
        self.add_timeline_entry("äº‹ä»¶åˆ›å»º", "äº‹ä»¶è¢«åˆ›å»ºå’Œè®°å½•")
    
    def add_timeline_entry(self, action: str, description: str, actor: str = "ç³»ç»Ÿ"):
        """æ·»åŠ æ—¶é—´çº¿æ¡ç›®"""
        entry = {
            "timestamp": datetime.now().isoformat(),
            "action": action,
            "description": description,
            "actor": actor
        }
        self.timeline.append(entry)
    
    def update_status(self, status: IncidentStatus, actor: str = "ç³»ç»Ÿ"):
        """æ›´æ–°äº‹ä»¶çŠ¶æ€"""
        old_status = self.status.value
        self.status = status
        self.add_timeline_entry("çŠ¶æ€æ›´æ–°", f"çŠ¶æ€ä» {old_status} æ›´æ–°ä¸º {status.value}", actor)
        
        if status == IncidentStatus.RESOLVED:
            self.resolution_time = datetime.now()
    
    def assign_to(self, assignee: str):
        """åˆ†é…äº‹ä»¶ç»™å¤„ç†äººå‘˜"""
        self.assigned_to = assignee
        self.add_timeline_entry("åˆ†é…å¤„ç†", f"äº‹ä»¶åˆ†é…ç»™ {assignee}", "ç³»ç»Ÿ")
    
    def calculate_severity(self, data_sensitivity: List[str], affected_users: int, business_impact: str):
        """è®¡ç®—äº‹ä»¶ä¸¥é‡æ€§"""
        # æ•°æ®æ•æ„Ÿæ€§è¯„åˆ†
        sensitivity_score = 0
        if "highly_sensitive" in data_sensitivity:
            sensitivity_score = 3
        elif "sensitive" in data_sensitivity:
            sensitivity_score = 2
        elif "internal" in data_sensitivity:
            sensitivity_score = 1
        
        # å½±å“ç”¨æˆ·æ•°è¯„åˆ†
        impact_score = 0
        if affected_users > 10000:
            impact_score = 3
        elif affected_users > 1000:
            impact_score = 2
        elif affected_users > 100:
            impact_score = 1
        
        # ä¸šåŠ¡å½±å“è¯„åˆ†
        business_score = 0
        if business_impact == "critical":
            business_score = 3
        elif business_impact == "high":
            business_score = 2
        elif business_impact == "medium":
            business_score = 1
        
        # è®¡ç®—æ€»ä½“ä¸¥é‡æ€§
        total_score = sensitivity_score + impact_score + business_score
        
        if total_score >= 7:
            self.severity = IncidentSeverity.CRITICAL
        elif total_score >= 5:
            self.severity = IncidentSeverity.HIGH
        elif total_score >= 3:
            self.severity = IncidentSeverity.MEDIUM
        else:
            self.severity = IncidentSeverity.LOW
        
        self.add_timeline_entry(
            "ä¸¥é‡æ€§è¯„ä¼°", 
            f"äº‹ä»¶ä¸¥é‡æ€§è¯„ä¼°ä¸º {self.severity.value} (è¯„åˆ†: {total_score})"
        )
    
    def check_notification_requirements(self):
        """æ£€æŸ¥é€šçŸ¥è¦æ±‚"""
        requirements = {
            "notify_management": False,
            "notify_authorities": False,
            "notify_individuals": False,
            "notify_time_limit": None
        }
        
        # GDPRå’Œå…¶ä»–æ³•è§„è¦æ±‚çš„æ—¶é—´é™åˆ¶
        if self.incident_type == IncidentType.DATA_BREACH:
            if self.severity in [IncidentSeverity.CRITICAL, IncidentSeverity.HIGH]:
                requirements["notify_management"] = True
                requirements["notify_authorities"] = True
                requirements["notify_individuals"] = True
                requirements["notify_time_limit"] = 72  # 72å°æ—¶å†…
            
            elif self.severity == IncidentSeverity.MEDIUM:
                requirements["notify_management"] = True
                requirements["notify_authorities"] = True
                requirements["notify_time_limit"] = 72
        
        return requirements

class IncidentResponseSystem:
    """äº‹ä»¶å“åº”ç³»ç»Ÿ"""
    
    def __init__(self):
        self.incidents: Dict[str, DataSecurityIncident] = {}
        self.templates: Dict[str, Dict] = self._load_response_templates()
        self.notification_channels = []
        self.response_team: Dict[str, Dict] = {}
        self.audit_log: List[Dict] = []
        
        # ç”Ÿæˆäº‹ä»¶IDè®¡æ•°å™¨
        self.incident_counter = 1000
    
    def _load_response_templates(self):
        """åŠ è½½å“åº”æ¨¡æ¿"""
        return {
            IncidentType.DATA_BREACH.value: {
                "containment": [
                    "éš”ç¦»å—å½±å“çš„ç³»ç»Ÿ",
                    "é‡ç½®æ‰€æœ‰ç›¸å…³è´¦æˆ·å¯†ç ",
                    "é˜»æ­¢å—æ”»å‡»çš„IPåœ°å€"
                ],
                "eradication": [
                    "è¯†åˆ«å¹¶ä¿®å¤æ¼æ´",
                    "æ¸…é™¤æ¶æ„è½¯ä»¶",
                    "åŠ å¼ºè®¿é—®æ§åˆ¶"
                ],
                "recovery": [
                    "ä»å¤‡ä»½æ¢å¤ç³»ç»Ÿ",
                    "éªŒè¯æ•°æ®å®Œæ•´æ€§",
                    "ç›‘æ§ç³»ç»Ÿå¼‚å¸¸æ´»åŠ¨"
                ]
            },
            IncidentType.RANSOMWARE.value: {
                "containment": [
                    "éš”ç¦»å—æ„ŸæŸ“ç³»ç»Ÿ",
                    "æ–­å¼€ç½‘ç»œè¿æ¥",
                    "ä¿å­˜å†…å­˜é•œåƒ"
                ],
                "eradication": [
                    "åˆ†æå‹’ç´¢è½¯ä»¶å˜ç§",
                    "å¯»æ‰¾è§£å¯†å·¥å…·",
                    "æ¸…é™¤æ¶æ„è½¯ä»¶"
                ],
                "recovery": [
                    "ä»å¹²å‡€å¤‡ä»½æ¢å¤",
                    "é‡å»ºç³»ç»Ÿ",
                    "åŠ å¼ºå®‰å…¨é˜²æŠ¤"
                ]
            }
        }
    
    def create_incident(self, title: str, description: str) -> DataSecurityIncident:
        """åˆ›å»ºæ–°äº‹ä»¶"""
        incident_id = f"INC-{self.incident_counter}"
        self.incident_counter += 1
        
        incident = DataSecurityIncident(incident_id, title)
        incident.description = description
        
        self.incidents[incident_id] = incident
        
        self._log_action("create_incident", {
            "incident_id": incident_id,
            "title": title
        })
        
        return incident
    
    def update_incident(self, incident_id: str, update_data: Dict):
        """æ›´æ–°äº‹ä»¶ä¿¡æ¯"""
        if incident_id not in self.incidents:
            raise ValueError(f"äº‹ä»¶ID {incident_id} ä¸å­˜åœ¨")
        
        incident = self.incidents[incident_id]
        
        for key, value in update_data.items():
            if hasattr(incident, key):
                setattr(incident, key, value)
        
        self._log_action("update_incident", {
            "incident_id": incident_id,
            "update_fields": list(update_data.keys())
        })
    
    def assign_incident(self, incident_id: str, assignee: str):
        """åˆ†é…äº‹ä»¶"""
        if incident_id not in self.incidents:
            raise ValueError(f"äº‹ä»¶ID {incident_id} ä¸å­˜åœ¨")
        
        incident = self.incidents[incident_id]
        incident.assign_to(assignee)
        
        self._log_action("assign_incident", {
            "incident_id": incident_id,
            "assignee": assignee
        })
    
    def generate_response_plan(self, incident_id: str) -> Dict:
        """ç”Ÿæˆå“åº”è®¡åˆ’"""
        if incident_id not in self.incidents:
            raise ValueError(f"äº‹ä»¶ID {incident_id} ä¸å­˜åœ¨")
        
        incident = self.incidents[incident_id]
        
        # è·å–æ¨¡æ¿
        template = self.templates.get(
            incident.incident_type.value, 
            {
                "containment": ["åˆ†æäº‹ä»¶èŒƒå›´", "é™åˆ¶è¿›ä¸€æ­¥æŸå®³"],
                "eradication": ["è¯†åˆ«æ ¹æœ¬åŸå› ", "æ¶ˆé™¤å¨èƒ"],
                "recovery": ["æ¢å¤ç³»ç»Ÿ", "éªŒè¯åŠŸèƒ½"]
            }
        )
        
        # æ ¹æ®ä¸¥é‡æ€§è°ƒæ•´å“åº”è®¡åˆ’
        if incident.severity == IncidentSeverity.CRITICAL:
            # å…³é”®äº‹ä»¶éœ€è¦é¢å¤–æªæ–½
            template["containment"].insert(0, "ç«‹å³é€šçŸ¥ç®¡ç†å±‚")
            template["containment"].insert(1, "æ¿€æ´»åº”æ€¥å“åº”å›¢é˜Ÿ")
            template["eradication"].append("è”ç³»å¤–éƒ¨å®‰å…¨ä¸“å®¶")
            template["recovery"].append("å®æ–½é¢å¤–ç›‘æ§")
        
        response_plan = {
            "incident_id": incident_id,
            "severity": incident.severity.value if incident.severity else "unknown",
            "incident_type": incident.incident_type.value if incident.incident_type else "unknown",
            "containment_actions": template["containment"],
            "eradication_actions": template["eradication"],
            "recovery_actions": template["recovery"],
            "created_at": datetime.now().isoformat()
        }
        
        # æ›´æ–°äº‹ä»¶
        incident.containment_actions = response_plan["containment_actions"]
        incident.eradication_actions = response_plan["eradication_actions"]
        incident.recovery_actions = response_plan["recovery_actions"]
        
        incident.add_timeline_entry("ç”Ÿæˆå“åº”è®¡åˆ’", f"ä¸ºäº‹ä»¶ç”Ÿæˆäº†å“åº”è®¡åˆ’")
        
        return response_plan
    
    def assess_notification_requirements(self, incident_id: str) -> Dict:
        """è¯„ä¼°é€šçŸ¥è¦æ±‚"""
        if incident_id not in self.incidents:
            raise ValueError(f"äº‹ä»¶ID {incident_id} ä¸å­˜åœ¨")
        
        incident = self.incidents[incident_id]
        requirements = incident.check_notification_requirements()
        
        # è®¡ç®—é€šçŸ¥æˆªæ­¢æ—¶é—´
        if requirements["notify_time_limit"]:
            detected_at = incident.detected_at
            notification_deadline = detected_at + timedelta(hours=requirements["notify_time_limit"])
            requirements["notification_deadline"] = notification_deadline.isoformat()
            
            # æ£€æŸ¥æ˜¯å¦å·²è¶…è¿‡æœŸé™
            now = datetime.now()
            if now > notification_deadline:
                requirements["deadline_exceeded"] = True
            else:
                time_remaining = notification_deadline - now
                requirements["time_remaining"] = str(time_remaining)
                requirements["deadline_exceeded"] = False
        
        return requirements
    
    def generate_incident_report(self, incident_id: str) -> Dict:
        """ç”Ÿæˆäº‹ä»¶æŠ¥å‘Š"""
        if incident_id not in self.incidents:
            raise ValueError(f"äº‹ä»¶ID {incident_id} ä¸å­˜åœ¨")
        
        incident = self.incidents[incident_id]
        
        # è®¡ç®—æŒç»­æ—¶é—´
        if incident.resolution_time:
            duration = incident.resolution_time - incident.detected_at
            duration_hours = duration.total_seconds() / 3600
        else:
            duration = datetime.now() - incident.detected_at
            duration_hours = duration.total_seconds() / 3600
        
        report = {
            "incident_id": incident.incident_id,
            "title": incident.title,
            "description": incident.description,
            "incident_type": incident.incident_type.value if incident.incident_type else "unknown",
            "severity": incident.severity.value if incident.severity else "unknown",
            "status": incident.status.value,
            "detected_at": incident.detected_at.isoformat(),
            "resolution_time": incident.resolution_time.isoformat() if incident.resolution_time else None,
            "duration_hours": round(duration_hours, 2),
            "affected_assets": incident.affected_assets,
            "data_categories": incident.data_categories,
            "affected_records_count": incident.affected_records_count,
            "root_cause": incident.root_cause,
            "assigned_to": incident.assigned_to,
            "timeline": incident.timeline,
            "notification_requirements": self.assess_notification_requirements(incident_id),
            "generated_at": datetime.now().isoformat()
        }
        
        return report
    
    def get_incident_metrics(self) -> Dict:
        """è·å–äº‹ä»¶æŒ‡æ ‡"""
        if not self.incidents:
            return {
                "total_incidents": 0,
                "resolved_incidents": 0,
                "open_incidents": 0,
                "severity_distribution": {},
                "type_distribution": {},
                "average_resolution_time": 0
            }
        
        total_incidents = len(self.incidents)
        resolved_incidents = len([
            inc for inc in self.incidents.values() 
            if inc.status in [IncidentStatus.RESOLVED, IncidentStatus.CLOSED]
        ])
        
        open_incidents = total_incidents - resolved_incidents
        
        # ä¸¥é‡æ€§åˆ†å¸ƒ
        severity_counts = {}
        for incident in self.incidents.values():
            if incident.severity:
                severity = incident.severity.value
                severity_counts[severity] = severity_counts.get(severity, 0) + 1
        
        # äº‹ä»¶ç±»å‹åˆ†å¸ƒ
        type_counts = {}
        for incident in self.incidents.values():
            if incident.incident_type:
                inc_type = incident.incident_type.value
                type_counts[inc_type] = type_counts.get(inc_type, 0) + 1
        
        # å¹³å‡è§£å†³æ—¶é—´
        resolved_incident_list = [
            inc for inc in self.incidents.values() 
            if inc.status in [IncidentStatus.RESOLVED, IncidentStatus.CLOSED] and inc.resolution_time
        ]
        
        if resolved_incident_list:
            total_resolution_time = sum([
                (inc.resolution_time - inc.detected_at).total_seconds() / 3600
                for inc in resolved_incident_list
            ])
            average_resolution_time = total_resolution_time / len(resolved_incident_list)
        else:
            average_resolution_time = 0
        
        return {
            "total_incidents": total_incidents,
            "resolved_incidents": resolved_incidents,
            "open_incidents": open_incidents,
            "severity_distribution": severity_counts,
            "type_distribution": type_counts,
            "average_resolution_time": round(average_resolution_time, 2)
        }
    
    def _log_action(self, action: str, details: Dict):
        """è®°å½•å®¡è®¡æ—¥å¿—"""
        log_entry = {
            "timestamp": datetime.now().isoformat(),
            "action": action,
            "details": details
        }
        
        self.audit_log.append(log_entry)

# ä½¿ç”¨ç¤ºä¾‹
irs = IncidentResponseSystem()

# åˆ›å»ºä¸€ä¸ªæ•°æ®æ³„éœ²äº‹ä»¶
data_breach_incident = irs.create_incident(
    "å®¢æˆ·æ•°æ®æ³„éœ²",
    "æ£€æµ‹åˆ°å®¢æˆ·æ•°æ®åº“æœªç»æˆæƒè®¿é—®ï¼Œå¯èƒ½æ¶‰åŠä¸ªäººèº«ä»½ä¿¡æ¯æ³„éœ²"
)

# æ›´æ–°äº‹ä»¶è¯¦æƒ…
irs.update_incident(data_breach_incident.incident_id, {
    "incident_type": IncidentType.DATA_BREACH,
    "affected_assets": ["customer_database", "web_server"],
    "data_categories": ["personal_identifiable", "financial"],
    "affected_records_count": 15000
})

# è®¡ç®—ä¸¥é‡æ€§
irs.update_incident(data_breach_incident.incident_id, {
    "data_categories": ["sensitive", "financial"],
    "affected_records_count": 15000
})

# é‡æ–°è·å–äº‹ä»¶å¹¶è®¡ç®—ä¸¥é‡æ€§
incident = irs.incidents[data_breach_incident.incident_id]
incident.calculate_severity(
    data_categories=incident.data_categories,
    affected_users=incident.affected_records_count,
    business_impact="high"
)

# åˆ†é…äº‹ä»¶
irs.assign_incident(data_breach_incident.incident_id, "å®‰å…¨å“åº”å›¢é˜Ÿ")

# ç”Ÿæˆå“åº”è®¡åˆ’
response_plan = irs.generate_response_plan(data_breach_incident.incident_id)

# è¯„ä¼°é€šçŸ¥è¦æ±‚
notification_requirements = irs.assess_notification_requirements(data_breach_incident.incident_id)

# ç”Ÿæˆäº‹ä»¶æŠ¥å‘Š
incident_report = irs.generate_incident_report(data_breach_incident.incident_id)

# è¾“å‡ºç»“æœ
print("æ•°æ®å®‰å…¨äº‹ä»¶å“åº”ç¤ºä¾‹")
print("=" * 50)
print(f"äº‹ä»¶ID: {incident_report['incident_id']}")
print(f"æ ‡é¢˜: {incident_report['title']}")
print(f"ç±»å‹: {incident_report['incident_type']}")
print(f"ä¸¥é‡æ€§: {incident_report['severity']}")
print(f"çŠ¶æ€: {incident_report['status']}")
print(f"å—å½±å“è®°å½•æ•°: {incident_report['affected_records_count']:,}")
print(f"æŒç»­æ—¶é—´: {incident_report['duration_hours']} å°æ—¶")

print("\né€šçŸ¥è¦æ±‚:")
if notification_requirements["notify_management"]:
    print("  âœ“ éœ€è¦é€šçŸ¥ç®¡ç†å±‚")
else:
    print("  âœ— ä¸éœ€è¦é€šçŸ¥ç®¡ç†å±‚")

if notification_requirements["notify_authorities"]:
    print("  âœ“ éœ€è¦é€šçŸ¥ç›‘ç®¡æœºæ„")
else:
    print("  âœ— ä¸éœ€è¦é€šçŸ¥ç›‘ç®¡æœºæ„")

if notification_requirements["notify_individuals"]:
    print("  âœ“ éœ€è¦é€šçŸ¥å—å½±å“ä¸ªäºº")
else:
    print("  âœ— ä¸éœ€è¦é€šçŸ¥å—å½±å“ä¸ªäºº")

if "notification_deadline" in notification_requirements:
    print(f"  é€šçŸ¥æˆªæ­¢æ—¶é—´: {notification_requirements['notification_deadline']}")
    
    if notification_requirements.get("deadline_exceeded"):
        print("  âš ï¸ å·²è¶…è¿‡é€šçŸ¥æˆªæ­¢æ—¶é—´!")
    else:
        print(f"  å‰©ä½™æ—¶é—´: {notification_requirements.get('time_remaining', 'æœªçŸ¥')}")

print("\néåˆ¶æªæ–½:")
for action in incident.containment_actions:
    print(f"  - {action}")

print("\næ ¹é™¤æªæ–½:")
for action in incident.eradication_actions:
    print(f"  - {action}")

print("\næ¢å¤æªæ–½:")
for action in incident.recovery_actions:
    print(f"  - {action}")

# è·å–äº‹ä»¶æŒ‡æ ‡
metrics = irs.get_incident_metrics()
print("\näº‹ä»¶æŒ‡æ ‡:")
print(f"  æ€»äº‹ä»¶æ•°: {metrics['total_incidents']}")
print(f"  å·²è§£å†³äº‹ä»¶: {metrics['resolved_incidents']}")
print(f"  æœªè§£å†³äº‹ä»¶: {metrics['open_incidents']}")
print(f"  å¹³å‡è§£å†³æ—¶é—´: {metrics['average_resolution_time']} å°æ—¶")
```

---

## 4.7 æœ¬ç« æ€»ç»“

### 4.7.1 å…³é”®è¦ç‚¹å›é¡¾

1. **æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†åŸºç¡€**
   - æ•°æ®å®‰å…¨ä¸‰è¦ç´ ï¼šæœºå¯†æ€§ã€å®Œæ•´æ€§ã€å¯ç”¨æ€§
   - éšç§ä¿æŠ¤çš„æ ¸å¿ƒåŸåˆ™ï¼šä¸ªäººæ§åˆ¶æƒã€æƒ…å¢ƒç›¸å…³æ€§ã€åˆè§„é©±åŠ¨
   - æ²»ç†æ¡†æ¶äº”è¦ç´ ï¼šæ”¿ç­–ä¸æ ‡å‡†ã€ç»„ç»‡ä¸è§’è‰²ã€æŠ€æœ¯ä¸å·¥å…·ã€æµç¨‹ä¸æ§åˆ¶ã€ç›‘æ§ä¸å®¡è®¡

2. **æ•°æ®å®‰å…¨æ¶æ„ä¸é£é™©è¯„ä¼°**
   - åˆ†å±‚å®‰å…¨æ¶æ„ï¼šåº”ç”¨å®‰å…¨å±‚ã€æ•°æ®å®‰å…¨å±‚ã€ç½‘ç»œå®‰å…¨å±‚ã€åŸºç¡€è®¾æ–½å±‚ã€ç‰©ç†å®‰å…¨å±‚
   - æ•°æ®åˆ†ç±»åˆ†çº§ï¼šæ•æ„Ÿæ€§åˆ†ç±»ã€ç”Ÿå‘½å‘¨æœŸåˆ†ç±»ã€ä¸šåŠ¡å½±å“åˆ†ç±»
   - é£é™©è¯„ä¼°æ–¹æ³•ï¼šå¨èƒå¯èƒ½æ€§è¯„ä¼°ã€å½±å“ç¨‹åº¦è¯„ä¼°ã€é£é™©ç­‰çº§è®¡ç®—

3. **éšç§ä¿æŠ¤æŠ€æœ¯ä¸éšç§å¢å¼ºæŠ€æœ¯**
   - æ•°æ®åŒ¿ååŒ–ï¼šå“ˆå¸ŒåŒ¿ååŒ–ã€ä»¤ç‰ŒåŒ–ã€æ•°æ®å±è”½ã€K-åŒ¿ååŒ–
   - å·®åˆ†éšç§ï¼šæ‹‰æ™®æ‹‰æ–¯æœºåˆ¶ã€éšç§é¢„ç®—ã€ç»„åˆæ€§
   - éšç§å¢å¼ºæŠ€æœ¯ï¼šåŒæ€åŠ å¯†ã€å®‰å…¨å¤šæ–¹è®¡ç®—

4. **æ•°æ®åˆè§„è¦æ±‚ä¸æ³•è§„æ¡†æ¶**
   - GDPRï¼šæ ¸å¿ƒåŸåˆ™ã€æ•°æ®ä¸»ä½“æƒåˆ©ã€è¿è§„å¤„ç½š
   - PIPLï¼šå¤„ç†åŸåˆ™ã€æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ã€åˆè§„è¦æ±‚
   - å…¶ä»–é‡è¦æ³•è§„ï¼šCCPA/CPRAã€PDPAç­‰

5. **æ•°æ®è®¿é—®æ§åˆ¶ä¸èº«ä»½è®¤è¯**
   - IAMæ¨¡å‹ï¼šRBACã€ABAC
   - è®¿é—®æ§åˆ¶å®ç°ï¼šç­–ç•¥è®¾è®¡ã€æ¡ä»¶è¯„ä¼°ã€å®¡è®¡è®°å½•
   - èº«ä»½è®¤è¯æœºåˆ¶ï¼šå¤šå› ç´ è®¤è¯ã€å•ç‚¹ç™»å½•ã€é›¶ä¿¡ä»»æ¶æ„

6. **æ•°æ®å®‰å…¨äº‹ä»¶å“åº”**
   - äº‹ä»¶å“åº”ç”Ÿå‘½å‘¨æœŸï¼šå‡†å¤‡ã€æ£€æµ‹ä¸åˆ†æã€éåˆ¶ã€æ ¹é™¤ä¸æ¢å¤ã€äº‹åæ´»åŠ¨
   - äº‹ä»¶åˆ†ç±»ä¸ä¸¥é‡æ€§è¯„ä¼°
   - å“åº”è®¡åˆ’ç”Ÿæˆä¸æ‰§è¡Œ

### 4.7.2 å®è·µå»ºè®®

1. **å»ºç«‹å…¨é¢çš„å®‰å…¨æ²»ç†ä½“ç³»**
   - ä»ä¸šåŠ¡éœ€æ±‚å‡ºå‘ï¼Œè®¾è®¡åˆé€‚çš„å®‰å…¨æ¶æ„
   - æ˜ç¡®å®‰å…¨è´£ä»»å’Œè§’è‰²ï¼Œå»ºç«‹é—®è´£æœºåˆ¶
   - å®šæœŸè¿›è¡Œå®‰å…¨è¯„ä¼°å’Œé£é™©åˆ†æ

2. **å®æ–½çºµæ·±é˜²å¾¡ç­–ç•¥**
   - åœ¨å¤šä¸ªå±‚æ¬¡éƒ¨ç½²å®‰å…¨æ§åˆ¶æªæ–½
   - ç»“åˆæŠ€æœ¯æ§åˆ¶å’Œç®¡ç†æ§åˆ¶
   - é‡ç‚¹ä¿æŠ¤å…³é”®æ•°æ®èµ„äº§

3. **å¹³è¡¡å®‰å…¨ä¸ä¸šåŠ¡éœ€æ±‚**
   - é¿å…è¿‡åº¦å®‰å…¨å½±å“ä¸šåŠ¡æ•ˆç‡
   - æ ¹æ®æ•°æ®æ•æ„Ÿæ€§å®æ–½å·®å¼‚åŒ–ä¿æŠ¤
   - å®šæœŸè¯„ä¼°å®‰å…¨æªæ–½çš„æœ‰æ•ˆæ€§

4. **åŠ å¼ºéšç§ä¿æŠ¤èƒ½åŠ›**
   - äº†è§£å¹¶éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„
   - é‡‡ç”¨éšç§ä¿æŠ¤æŠ€æœ¯ï¼ˆå¦‚å·®åˆ†éšç§ï¼‰
   - å»ºç«‹éšç§å½±å“è¯„ä¼°æœºåˆ¶

5. **å»ºç«‹æœ‰æ•ˆçš„äº‹ä»¶å“åº”èƒ½åŠ›**
   - åˆ¶å®šè¯¦ç»†çš„äº‹ä»¶å“åº”è®¡åˆ’
   - å®šæœŸè¿›è¡Œäº‹ä»¶å“åº”æ¼”ç»ƒ
   - å»ºç«‹äº‹ä»¶å­¦ä¹ æœºåˆ¶ï¼ŒæŒç»­æ”¹è¿›

### 4.7.3 è¿›é˜¶å­¦ä¹ è·¯å¾„

1. **æ·±å…¥å­¦ä¹ å®‰å…¨æ¶æ„**
   - é›¶ä¿¡ä»»æ¶æ„è®¾è®¡åŸåˆ™
   - äº‘å®‰å…¨æ¶æ„æœ€ä½³å®è·µ
   - å¾®æœåŠ¡å®‰å…¨è®¾è®¡æ¨¡å¼

2. **æŒæ¡é«˜çº§éšç§æŠ€æœ¯**
   - æ·±å…¥ç ”ç©¶åŒæ€åŠ å¯†ç®—æ³•
   - å­¦ä¹ è”é‚¦å­¦ä¹ ç­‰éšç§è®¡ç®—æŠ€æœ¯
   - äº†è§£æœ€æ–°çš„éšç§æ³•è§„å’Œåˆè§„è¦æ±‚

3. **äº†è§£è¡Œä¸šæœ€ä½³å®è·µ**
   - ç ”ç©¶åŒè¡Œä¸šçš„å®‰å…¨æ¡ˆä¾‹
   - å‚åŠ å®‰å…¨ä¼šè®®å’ŒåŸ¹è®­
   - è·å–ä¸“ä¸šå®‰å…¨è®¤è¯ï¼ˆå¦‚CISSPã€CISMï¼‰

4. **å®è·µå®‰å…¨é¡¹ç›®**
   - å‚ä¸å®é™…çš„å®‰å…¨é¡¹ç›®
   - å»ºç«‹ä¸ªäººå®‰å…¨å®éªŒç¯å¢ƒ
   - å‚ä¸å¼€æºå®‰å…¨é¡¹ç›®

### 4.7.4 å®è·µä½œä¸š

1. **å®‰å…¨é£é™©è¯„ä¼°**
   - é€‰æ‹©ä¸€ä¸ªå…³é”®æ•°æ®èµ„äº§
   - å®Œæˆå®Œæ•´çš„å®‰å…¨é£é™©è¯„ä¼°
   - æå‡ºæ”¹è¿›å»ºè®®å’Œå®æ–½è®¡åˆ’

2. **éšç§ä¿æŠ¤å®ç°**
   - é€‰æ‹©ä¸€ç§éšç§ä¿æŠ¤æŠ€æœ¯
   - å®ç°ä¸€ä¸ªç®€å•çš„åŸå‹ç³»ç»Ÿ
   - æµ‹è¯•å…¶æ€§èƒ½å’Œéšç§ä¿æŠ¤æ•ˆæœ

3. **è®¿é—®æ§åˆ¶ç³»ç»Ÿè®¾è®¡**
   - ä¸ºç‰¹å®šåœºæ™¯è®¾è®¡è®¿é—®æ§åˆ¶ç³»ç»Ÿ
   - å®ç°RBACæˆ–ABACæ¨¡å‹
   - æµ‹è¯•ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯ç”¨æ€§

4. **å®‰å…¨äº‹ä»¶å“åº”æ¼”ç»ƒ**
   - è®¾è®¡ä¸€ä¸ªå®‰å…¨äº‹ä»¶åœºæ™¯
   - åˆ¶å®šè¯¦ç»†çš„äº‹ä»¶å“åº”è®¡åˆ’
   - æ‰§è¡Œæ¼”ç»ƒå¹¶æ€»ç»“ç»éªŒ

---

## é™„å½•ï¼šä»£ç ç¤ºä¾‹

æœ¬ç« æä¾›äº†å¤šä¸ªå®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼Œæ¶µç›–äº†æ•°æ®å®‰å…¨ä¸éšç§æ²»ç†çš„å„ä¸ªæ–¹é¢ï¼š

1. **æ•°æ®å®‰å…¨é£é™©è¯„ä¼°å·¥å…·**ï¼ˆè§`code/chapter4/risk_assessment.py`ï¼‰
2. **æ•°æ®åŒ¿ååŒ–å·¥å…·**ï¼ˆè§`code/chapter4/data_anonymization.py`ï¼‰
3. **å·®åˆ†éšç§å®ç°**ï¼ˆè§`code/chapter4/differential_privacy.py`ï¼‰
4. **åŒæ€åŠ å¯†æ¼”ç¤º**ï¼ˆè§`code/chapter4/homomorphic_encryption.py`ï¼‰
5. **å®‰å…¨å¤šæ–¹è®¡ç®—å®ç°**ï¼ˆè§`code/chapter4/secure_multiparty_computation.py`ï¼‰
6. **RBACè®¿é—®æ§åˆ¶ç³»ç»Ÿ**ï¼ˆè§`code/chapter4/rbac_system.py`ï¼‰
7. **ABACè®¿é—®æ§åˆ¶ç³»ç»Ÿ**ï¼ˆè§`code/chapter4/abac_system.py`ï¼‰
8. **äº‹ä»¶å“åº”ç³»ç»Ÿ**ï¼ˆè§`code/chapter4/incident_response.py`ï¼‰

è¯·å‚è€ƒä»£ç ç›®å½•ä¸­çš„å®Œæ•´ç¤ºä¾‹ï¼Œæ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä½¿ç”¨ã€‚è¿™äº›ä»£ç ä¸ä»…å¯ä»¥å¸®åŠ©ç†è§£ç†è®ºæ¦‚å¿µï¼Œè¿˜å¯ä»¥ä½œä¸ºå®é™…é¡¹ç›®çš„åŸºç¡€ã€‚